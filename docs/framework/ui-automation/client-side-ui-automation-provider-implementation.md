---
title: 客户端 UI 自动化提供程序的实现
description: 了解客户端 UI 自动化提供程序实现。 了解如何分发、注册和配置客户端提供程序。
ms.date: 03/30/2017
helpviewer_keywords:
- UI Automation, client-side provider implementation
- client-side UI Automation provider, implementation
- provider implementation, UI Automation
ms.assetid: 3584c0a1-9cd0-4968-8b63-b06390890ef6
ms.openlocfilehash: a2903df0722a931ec2fe37a5b2f3581611965567
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/26/2020
ms.locfileid: "96241650"
---
# <a name="client-side-ui-automation-provider-implementation"></a><span data-ttu-id="ea523-104">客户端 UI 自动化提供程序的实现</span><span class="sxs-lookup"><span data-stu-id="ea523-104">Client-Side UI Automation Provider Implementation</span></span>

> [!NOTE]
> <span data-ttu-id="ea523-105">本文档适用于想要使用 [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] 命名空间中定义的托管 <xref:System.Windows.Automation> 类的 .NET Framework 开发人员。</span><span class="sxs-lookup"><span data-stu-id="ea523-105">This documentation is intended for .NET Framework developers who want to use the managed [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] classes defined in the <xref:System.Windows.Automation> namespace.</span></span> <span data-ttu-id="ea523-106">有关 [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)]的最新信息，请参阅 [Windows 自动化 API：UI 自动化](/windows/win32/winauto/entry-uiauto-win32)。</span><span class="sxs-lookup"><span data-stu-id="ea523-106">For the latest information about [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)], see [Windows Automation API: UI Automation](/windows/win32/winauto/entry-uiauto-win32).</span></span>  
  
 <span data-ttu-id="ea523-107">Microsoft 操作系统中使用几种不同的 [!INCLUDE[TLA#tla_ui](../../../includes/tlasharptla-ui-md.md)] 框架，包括 Win32、Windows 窗体和 [!INCLUDE[TLA#tla_winclient](../../../includes/tlasharptla-winclient-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="ea523-107">Several different [!INCLUDE[TLA#tla_ui](../../../includes/tlasharptla-ui-md.md)] frameworks are in use within Microsoft operating systems, including Win32, Windows Forms, and [!INCLUDE[TLA#tla_winclient](../../../includes/tlasharptla-winclient-md.md)].</span></span> [!INCLUDE[TLA#tla_uiautomation](../../../includes/tlasharptla-uiautomation-md.md)] <span data-ttu-id="ea523-108">向客户公开有关 UI 元素的信息。</span><span class="sxs-lookup"><span data-stu-id="ea523-108">exposes information about UI elements to clients.</span></span> <span data-ttu-id="ea523-109">但是， [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] 本身并不了解存在于这些框架中的不同类型的控件以及从中提取信息所需的技术。</span><span class="sxs-lookup"><span data-stu-id="ea523-109">However, [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] does not itself have awareness of the different types of controls that exist in these frameworks and the techniques that are needed to extract information from them.</span></span> <span data-ttu-id="ea523-110">而是将此任务留给称为提供程序的对象。</span><span class="sxs-lookup"><span data-stu-id="ea523-110">Instead, it leaves this task to objects called providers.</span></span> <span data-ttu-id="ea523-111">一个提供程序从特定控件中提取信息，并将该信息传递给 [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)]，后者随后以一致的方式将其呈现给客户端。</span><span class="sxs-lookup"><span data-stu-id="ea523-111">A provider extracts information from a specific control and hands that information to [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)], which then presents it to the client in a consistent manner.</span></span>  
  
 <span data-ttu-id="ea523-112">提供程序可以存在于服务器端或客户端上。</span><span class="sxs-lookup"><span data-stu-id="ea523-112">Providers can exist either on the server side or on the client side.</span></span> <span data-ttu-id="ea523-113">服务器端提供程序由控件本身实现。</span><span class="sxs-lookup"><span data-stu-id="ea523-113">A server-side provider is implemented by the control itself.</span></span> [!INCLUDE[TLA2#tla_winclient](../../../includes/tla2sharptla-winclient-md.md)] <span data-ttu-id="ea523-114">元素实现提供程序，正如可以在考虑到 [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] 的情况下写入第三方控件一样。</span><span class="sxs-lookup"><span data-stu-id="ea523-114">elements implement providers, as can any third-party controls written with [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] in mind.</span></span>  
  
 <span data-ttu-id="ea523-115">但较旧的控件（如 Win32 和 Windows 窗体中的控件）不直接支持 [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="ea523-115">However, older controls such as those in Win32 and Windows Forms do not directly support [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)].</span></span> <span data-ttu-id="ea523-116">这些控件都将改为由存在于客户端进程中的提供程序提供，并且使用跨进程通信获取有关控件的信息；例如，通过监视在窗口与控件之间来回的消息。</span><span class="sxs-lookup"><span data-stu-id="ea523-116">These controls are served instead by providers that exist in the client process and obtain information about controls using cross-process communication; for example, by monitoring windows messages to and from the controls.</span></span> <span data-ttu-id="ea523-117">此类客户端提供程序有时称为代理。</span><span class="sxs-lookup"><span data-stu-id="ea523-117">Such client-side providers are sometimes called proxies.</span></span>  
  
 <span data-ttu-id="ea523-118">Windows Vista 为标准 Win32 和 Windows 窗体控件提供提供程序。</span><span class="sxs-lookup"><span data-stu-id="ea523-118">Windows Vista supplies providers for standard Win32 and Windows Forms controls.</span></span> <span data-ttu-id="ea523-119">此外，回退提供程序为 [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] 任何不由另一个服务器端提供程序或代理提供但具有 Microsoft Active Accessibility 实现的控件提供部分支持。</span><span class="sxs-lookup"><span data-stu-id="ea523-119">In addition, a fallback provider gives partial [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] support to any control that is not served by another server-side provider or proxy but has a Microsoft Active Accessibility implementation.</span></span> <span data-ttu-id="ea523-120">所有这样的提供程序均已自动加载，并且可供客户端应用程序使用。</span><span class="sxs-lookup"><span data-stu-id="ea523-120">All these providers are automatically loaded and available to client applications.</span></span>  
  
 <span data-ttu-id="ea523-121">有关 Win32 和 Windows 窗体控件支持的详细信息，请参阅 [UI 自动化对标准控件的支持](ui-automation-support-for-standard-controls.md)。</span><span class="sxs-lookup"><span data-stu-id="ea523-121">For more information on support for Win32 and Windows Forms controls, see [UI Automation Support for Standard Controls](ui-automation-support-for-standard-controls.md).</span></span>  
  
 <span data-ttu-id="ea523-122">应用程序还可以注册其他客户端提供程序。</span><span class="sxs-lookup"><span data-stu-id="ea523-122">Applications can also register other client-side providers.</span></span>  
  
<a name="Distributing_Client-Side_Providers"></a>

## <a name="distributing-client-side-providers"></a><span data-ttu-id="ea523-123">分布客户端提供程序</span><span class="sxs-lookup"><span data-stu-id="ea523-123">Distributing Client-Side Providers</span></span>  

 [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] <span data-ttu-id="ea523-124">预期在托管代码程序集中查找客户端提供程序。</span><span class="sxs-lookup"><span data-stu-id="ea523-124">expects to find client-side providers in a managed-code assembly.</span></span> <span data-ttu-id="ea523-125">此程序集中命名空间的名称应与程序集名称相同。</span><span class="sxs-lookup"><span data-stu-id="ea523-125">The namespace in this assembly should have the same name as the assembly.</span></span> <span data-ttu-id="ea523-126">例如，名为 ContosoProxies.dll 的程序集将包含 ContosoProxies 命名空间。</span><span class="sxs-lookup"><span data-stu-id="ea523-126">For example, an assembly called ContosoProxies.dll would contain the ContosoProxies namespace.</span></span> <span data-ttu-id="ea523-127">在命名空间内创建一个 <xref:UIAutomationClientsideProviders.UIAutomationClientSideProviders> 类。</span><span class="sxs-lookup"><span data-stu-id="ea523-127">Within the namespace, create a <xref:UIAutomationClientsideProviders.UIAutomationClientSideProviders> class.</span></span> <span data-ttu-id="ea523-128">在静态 <xref:UIAutomationClientsideProviders.UIAutomationClientSideProviders.ClientSideProviderDescriptionTable> 字段的实现中，创建一个描述提供程序的 <xref:System.Windows.Automation.ClientSideProviderDescription> 结构数组。</span><span class="sxs-lookup"><span data-stu-id="ea523-128">In the implementation of the static <xref:UIAutomationClientsideProviders.UIAutomationClientSideProviders.ClientSideProviderDescriptionTable> field, create an array of <xref:System.Windows.Automation.ClientSideProviderDescription> structures describing the providers.</span></span>  
  
<a name="Registering_and_Configuring_Client-Side_Providers"></a>

## <a name="registering-and-configuring-client-side-providers"></a><span data-ttu-id="ea523-129">注册并配置客户端提供程序</span><span class="sxs-lookup"><span data-stu-id="ea523-129">Registering and Configuring Client-Side Providers</span></span>  

 <span data-ttu-id="ea523-130">动态链接库中的客户端提供程序 (DLL) 通过调用加载 <xref:System.Windows.Automation.ClientSettings.RegisterClientSideProviderAssembly%2A> 。</span><span class="sxs-lookup"><span data-stu-id="ea523-130">Client-side providers in a dynamic-link library (DLL) are loaded by calling <xref:System.Windows.Automation.ClientSettings.RegisterClientSideProviderAssembly%2A>.</span></span> <span data-ttu-id="ea523-131">客户端应用程序不需要任何进一步的操作即可使用提供程序。</span><span class="sxs-lookup"><span data-stu-id="ea523-131">No further action is required by a client application to make use of the providers.</span></span>  
  
 <span data-ttu-id="ea523-132">在客户端自己的代码中实现的提供程序通过使用 <xref:System.Windows.Automation.ClientSettings.RegisterClientSideProviders%2A>注册。</span><span class="sxs-lookup"><span data-stu-id="ea523-132">Providers implemented in the client's own code are registered by using <xref:System.Windows.Automation.ClientSettings.RegisterClientSideProviders%2A>.</span></span> <span data-ttu-id="ea523-133">此方法将 <xref:System.Windows.Automation.ClientSideProviderDescription> 结构数组作为参数，每个结构均指定以下属性：</span><span class="sxs-lookup"><span data-stu-id="ea523-133">This method takes as an argument an array of <xref:System.Windows.Automation.ClientSideProviderDescription> structures, each of which specifies the following properties:</span></span>  
  
- <span data-ttu-id="ea523-134">创建提供程序对象的回调函数。</span><span class="sxs-lookup"><span data-stu-id="ea523-134">A callback function that creates the provider object.</span></span>  
  
- <span data-ttu-id="ea523-135">提供程序将提供的控件的类名。</span><span class="sxs-lookup"><span data-stu-id="ea523-135">The class name of the controls that the provider will serve.</span></span>  
  
- <span data-ttu-id="ea523-136">提供程序将提供的应用程序（通常为可执行文件的完整名称）的映像名称。</span><span class="sxs-lookup"><span data-stu-id="ea523-136">The image name of the application (usually the full name of the executable file) that the provider will serve.</span></span>  
  
- <span data-ttu-id="ea523-137">控制如何将类名与在目标应用程序中找到的窗口类进行匹配的标志。</span><span class="sxs-lookup"><span data-stu-id="ea523-137">Flags that govern how the class name is matched against window classes found in the target application.</span></span>  
  
 <span data-ttu-id="ea523-138">最后两个参数为可选。</span><span class="sxs-lookup"><span data-stu-id="ea523-138">The last two parameters are optional.</span></span> <span data-ttu-id="ea523-139">当客户端需要为不同的应用程序使用不同的提供程序时，它可能会指定目标应用程序的映像名称。</span><span class="sxs-lookup"><span data-stu-id="ea523-139">The client might specify the image name of the target application when it wants to use different providers for different applications.</span></span> <span data-ttu-id="ea523-140">例如，客户端可能会在支持多个视图模式的已知应用程序中为 Win32 列表视图控件使用一个提供程序，而在另一个未使用的已知应用程序中使用另一个提供程序。</span><span class="sxs-lookup"><span data-stu-id="ea523-140">For example, the client might use one provider for a Win32 list view control in a known application that supports the Multiple View pattern, and another for a similar control in another known application that does not.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ea523-141">另请参阅</span><span class="sxs-lookup"><span data-stu-id="ea523-141">See also</span></span>

- [<span data-ttu-id="ea523-142">创建客户端 UI 自动化提供程序</span><span class="sxs-lookup"><span data-stu-id="ea523-142">Create a Client-Side UI Automation Provider</span></span>](create-a-client-side-ui-automation-provider.md)
- [<span data-ttu-id="ea523-143">在客户端应用程序中实现 UI 自动化提供程序</span><span class="sxs-lookup"><span data-stu-id="ea523-143">Implement UI Automation Providers in a Client Application</span></span>](implement-ui-automation-providers-in-a-client-application.md)
