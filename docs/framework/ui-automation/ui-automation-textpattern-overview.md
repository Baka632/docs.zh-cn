---
title: UI 自动化 TextPattern 概述
description: 在 UI 自动化中阅读 TextPattern 控件模式的概述。 此控件模式公开控件的文本内容，包括格式和样式。
ms.date: 03/30/2017
helpviewer_keywords:
- UI Automation, TextPattern class
- TextPattern class
- classes, TextPattern
ms.assetid: 41787927-df1f-4f4a-aba3-641662854fc4
ms.openlocfilehash: 986b601bbd212582c09c559a9bb22983ba59fa17
ms.sourcegitcommit: 40de8df14289e1e05b40d6e5c1daabd3c286d70c
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 07/22/2020
ms.locfileid: "86924664"
---
# <a name="ui-automation-textpattern-overview"></a><span data-ttu-id="f5d3b-104">UI 自动化 TextPattern 概述</span><span class="sxs-lookup"><span data-stu-id="f5d3b-104">UI Automation TextPattern Overview</span></span>

> [!NOTE]
> <span data-ttu-id="f5d3b-105">本文档适用于想要使用 [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] 命名空间中定义的托管 <xref:System.Windows.Automation> 类的 .NET Framework 开发人员。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-105">This documentation is intended for .NET Framework developers who want to use the managed [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] classes defined in the <xref:System.Windows.Automation> namespace.</span></span> <span data-ttu-id="f5d3b-106">有关 [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)]的最新信息，请参阅 [Windows 自动化 API：UI 自动化](/windows/win32/winauto/entry-uiauto-win32)。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-106">For the latest information about [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)], see [Windows Automation API: UI Automation](/windows/win32/winauto/entry-uiauto-win32).</span></span>

<span data-ttu-id="f5d3b-107">本概述介绍如何使用 [!INCLUDE[TLA#tla_uiautomation](../../../includes/tlasharptla-uiautomation-md.md)] 公开文本内容，其中包括在 [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)]支持的平台中的文本控件的格式和样式特性。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-107">This overview describes how to use [!INCLUDE[TLA#tla_uiautomation](../../../includes/tlasharptla-uiautomation-md.md)] to expose the textual content, including format and style attributes, of text controls in [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)]-supported platforms.</span></span> <span data-ttu-id="f5d3b-108">这些控件包括但不限于 Microsoft .NET 框架 <xref:System.Windows.Controls.TextBox> 及其 <xref:System.Windows.Controls.RichTextBox> Win32 等效项。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-108">These controls include, but are not limited to, the Microsoft .NET Framework <xref:System.Windows.Controls.TextBox> and <xref:System.Windows.Controls.RichTextBox> as well as their Win32 equivalents.</span></span>

<span data-ttu-id="f5d3b-109">控件文本内容的功能通过使用 <xref:System.Windows.Automation.TextPattern> 控件模式完成，该控件模式表示作为文本流的文本容器的内容。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-109">Exposing the textual content of a control is accomplished through the use of the <xref:System.Windows.Automation.TextPattern> control pattern, which represents the contents of a text container as a text stream.</span></span> <span data-ttu-id="f5d3b-110">与之相反， <xref:System.Windows.Automation.TextPattern> 需要 <xref:System.Windows.Automation.Text.TextPatternRange> 的支持，以公开格式和样式特性。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-110">In turn, <xref:System.Windows.Automation.TextPattern> requires the support of the <xref:System.Windows.Automation.Text.TextPatternRange> class to expose format and style attributes.</span></span> <span data-ttu-id="f5d3b-111"><xref:System.Windows.Automation.Text.TextPatternRange> 通过采用一系列 <xref:System.Windows.Automation.TextPattern> 和 <xref:System.Windows.Automation.Text.TextPatternRangeEndpoint.Start> 终结点表示文本容器中连续或多个不连续的的文本段来支持 <xref:System.Windows.Automation.Text.TextPatternRangeEndpoint.End> 。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-111"><xref:System.Windows.Automation.Text.TextPatternRange> supports <xref:System.Windows.Automation.TextPattern> by representing contiguous or multiple, disjoint text spans in a text container with a collection of <xref:System.Windows.Automation.Text.TextPatternRangeEndpoint.Start> and <xref:System.Windows.Automation.Text.TextPatternRangeEndpoint.End> endpoints.</span></span> <span data-ttu-id="f5d3b-112"><xref:System.Windows.Automation.Text.TextPatternRange> 支持功能包括选择、比较、检索和遍历。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-112"><xref:System.Windows.Automation.Text.TextPatternRange> supports functionality such as selection, comparison, retrieval and traversal.</span></span>

> [!NOTE]
> <span data-ttu-id="f5d3b-113"><xref:System.Windows.Automation.TextPattern> 类不提供插入或修改文本的方法。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-113">The <xref:System.Windows.Automation.TextPattern> classes do not provide a means to insert or modify text.</span></span> <span data-ttu-id="f5d3b-114">但是，这可以通过 [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] <xref:System.Windows.Automation.ValuePattern> 或直接键盘输入来实现，具体取决于控件。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-114">However, depending on the control, this may be accomplished by the [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] <xref:System.Windows.Automation.ValuePattern> or through direct keyboard input.</span></span> <span data-ttu-id="f5d3b-115">有关示例，请参见 [TextPattern Insert Text Sample](https://github.com/Microsoft/WPF-Samples/tree/master/Accessibility/InsertText) 。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-115">See the [TextPattern Insert Text Sample](https://github.com/Microsoft/WPF-Samples/tree/master/Accessibility/InsertText) for an example.</span></span>

<span data-ttu-id="f5d3b-116">本概述中所述的功能对辅助技术供应商及其最终用户至关重要。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-116">The functionality described in this overview is vital to assistive technology vendors and their end users.</span></span> <span data-ttu-id="f5d3b-117">辅助技术可以使用 [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] 为用户收集完整的文本格式信息，并通过 <xref:System.Windows.Automation.Text.TextUnit> （字符、单词、行或段落）提供编程方式导航和文本选择。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-117">Assistive technologies can use [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] to gather complete text formatting information for the user and provide programmatic navigation and selection of text by <xref:System.Windows.Automation.Text.TextUnit> (character, word, line, or paragraph).</span></span>

<a name="UI_Automation_TextPattern_vs__Cicero"></a>

## <a name="ui-automation-textpattern-vs-text-services-framework"></a><span data-ttu-id="f5d3b-118">UI 自动化 TextPattern 与文本服务框架</span><span class="sxs-lookup"><span data-stu-id="f5d3b-118">UI Automation TextPattern vs. Text Services Framework</span></span>

<span data-ttu-id="f5d3b-119">文本服务框架（TSF）是一个简单的可伸缩系统框架，可在桌面上和应用程序中启用自然语言服务和高级文本输入。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-119">Text Services Framework (TSF) is a simple and scalable system framework that enables natural language services and advanced text input on the desktop and within applications.</span></span> <span data-ttu-id="f5d3b-120">除了为应用程序提供接口以公开其文本存储，它还支持该文本存储的元数据。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-120">In addition to providing interfaces for applications to expose their text store it also supports metadata for that text store.</span></span>

<span data-ttu-id="f5d3b-121">不过，TSF 是针对需要将输入注入到上下文感知方案中的应用程序而设计的，而 <xref:System.Windows.Automation.TextPattern> 是只读解决方案（上面提到的有限解决方法），旨在为屏幕阅读器和盲文设备提供对文本存储的优化访问。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-121">However, TSF was designed for applications that need to inject input into context-aware scenarios whereas <xref:System.Windows.Automation.TextPattern> is a read-only solution (with the limited workaround noted above) meant to provide optimized access to a text store for screen-readers and Braille devices.</span></span>

<span data-ttu-id="f5d3b-122">简而言之，需要对文本存储的只读访问权限的可访问技术可以使用 <xref:System.Windows.Automation.TextPattern> ，但对于上下文感知输入，需要更复杂的 TSF 功能。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-122">In short, accessible technologies that require read-only access to a text store can use <xref:System.Windows.Automation.TextPattern>, but will need the more complex functionality of TSF for context-aware input.</span></span>

<a name="Control_Types"></a>

## <a name="control-types"></a><span data-ttu-id="f5d3b-123">控件类型</span><span class="sxs-lookup"><span data-stu-id="f5d3b-123">Control Types</span></span>

### <a name="text"></a><span data-ttu-id="f5d3b-124">Text</span><span class="sxs-lookup"><span data-stu-id="f5d3b-124">Text</span></span>

<span data-ttu-id="f5d3b-125">Text 控件是表示屏幕上一段文本的基本元素。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-125">The Text control is the basic element representing a piece of text on the screen.</span></span>

<span data-ttu-id="f5d3b-126">独立的文本控件可用作标签或窗体上的静态文本。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-126">A standalone text control can be used as a label or static text on a form.</span></span> <span data-ttu-id="f5d3b-127">文本控件也可包含在 <xref:System.Windows.Automation.ControlType.ListItem>、 <xref:System.Windows.Automation.ControlType.TreeItem> 或 <xref:System.Windows.Automation.ControlType.DataItem>的结构中。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-127">Text controls can also be contained within the structure of a <xref:System.Windows.Automation.ControlType.ListItem>, <xref:System.Windows.Automation.ControlType.TreeItem> or <xref:System.Windows.Automation.ControlType.DataItem>.</span></span>

> [!NOTE]
> <span data-ttu-id="f5d3b-128">文本控件可能不会显示在 [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] 树的内容视图中（请参阅 [UI Automation Tree Overview](ui-automation-tree-overview.md)）。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-128">Text controls might not appear in the content view of the [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] tree (see [UI Automation Tree Overview](ui-automation-tree-overview.md)).</span></span> <span data-ttu-id="f5d3b-129">这是因为文本控件通常通过另一个控件的 Name 属性显示。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-129">This is because text controls are often displayed through the Name property of another control.</span></span> <span data-ttu-id="f5d3b-130">例如，用于标记编辑控件的文本是通过编辑控件的 Name 属性公开的。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-130">For instance, the text that is used to label an Edit control is exposed through the Name property of the Edit control.</span></span> <span data-ttu-id="f5d3b-131">因为，此编辑控件位于 [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] 树的内容视图中，文本元素自身没有必要处于 [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] 树的视图中。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-131">Because the Edit control is in the content view of the [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] tree, it is not necessary for the text element itself to be in that view of the [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] tree.</span></span> <span data-ttu-id="f5d3b-132">在内容视图中显示的唯一文本为不是冗余信息的文本。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-132">The only text that shows up in the content view is text that is not redundant information.</span></span> <span data-ttu-id="f5d3b-133">这能让任何辅助技术仅对其用户需要的信息段进行快速筛选。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-133">This enables any assistive technology to quickly filter only on the pieces of information that their users need.</span></span>

### <a name="edit"></a><span data-ttu-id="f5d3b-134">编辑</span><span class="sxs-lookup"><span data-stu-id="f5d3b-134">Edit</span></span>

<span data-ttu-id="f5d3b-135">编辑控件使用户可以查看和编辑单个文本行。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-135">Edit controls enable a user to view and edit a single line of text.</span></span>

> [!NOTE]
> <span data-ttu-id="f5d3b-136">在某些布局方案中，单个文本行可能会换行。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-136">The single line of text may wrap in certain layout scenarios.</span></span>

### <a name="document"></a><span data-ttu-id="f5d3b-137">文档</span><span class="sxs-lookup"><span data-stu-id="f5d3b-137">Document</span></span>

<span data-ttu-id="f5d3b-138">文档控件能让用户导航并从多个页面的文本上获取的信息。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-138">Document controls let a user navigate and obtain information from multiple pages of text.</span></span>

<a name="TextPattern_Client_API_s"></a>

## <a name="textpattern-client-apis"></a><span data-ttu-id="f5d3b-139">TextPattern 客户端 Api</span><span class="sxs-lookup"><span data-stu-id="f5d3b-139">TextPattern Client APIs</span></span>

|||
|-|-|
|`System.Windows.Automation.TextPattern Class`|<span data-ttu-id="f5d3b-140">文本模型 [!INCLUDE[TLA#tla_uiautomation](../../../includes/tlasharptla-uiautomation-md.md)] 的入口点。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-140">The entry point for the [!INCLUDE[TLA#tla_uiautomation](../../../includes/tlasharptla-uiautomation-md.md)] text model.</span></span><br /><br /> <span data-ttu-id="f5d3b-141">此类还包含两个 <xref:System.Windows.Automation.TextPattern> 事件侦听器： <xref:System.Windows.Automation.TextPattern.TextSelectionChangedEvent> 和 <xref:System.Windows.Automation.TextPattern.TextChangedEvent>。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-141">This class also contains the two <xref:System.Windows.Automation.TextPattern> event listeners, <xref:System.Windows.Automation.TextPattern.TextSelectionChangedEvent> and <xref:System.Windows.Automation.TextPattern.TextChangedEvent>.</span></span>|
|`System.Windows.Automation.Text.TextPatternRange Class`|<span data-ttu-id="f5d3b-142">支持 <xref:System.Windows.Automation.TextPattern>的文本容器内的文本段的表示形式。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-142">The representation of a span of text within a text container that supports <xref:System.Windows.Automation.TextPattern>.</span></span><br /><br /> <span data-ttu-id="f5d3b-143">UI 自动化客户端应该小心使用 <xref:System.Windows.Automation.Text.TextPatternRange>创建的文本范围的当前有效性。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-143">UI Automation clients should be careful about the current validity of a text range created using <xref:System.Windows.Automation.Text.TextPatternRange>.</span></span> <span data-ttu-id="f5d3b-144">如果新的文本完全替换文本控件中的原始文本，则当前的文本范围将变为无效。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-144">If the original text in the text control is completely replaced by new text, the current text range becomes invalid.</span></span> <span data-ttu-id="f5d3b-145">但是，如果只更改了原始文本的一部分，并且基础的文本控件使用定位点（或终结点）而不是绝对字符定位来管理其文本“指示器”，则文本范围可能仍具有有效性。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-145">However, the text range may still have some viability if only part of the original text is changed and the underlying text control is managing its text "pointer" with anchors (or endpoints) rather than with absolute character positioning.</span></span><br /><br /> <span data-ttu-id="f5d3b-146">客户端可以侦听 <xref:System.Windows.Automation.TextPattern.TextChangedEvent> ，获取任何他们正在处理的文本内容的更改通知。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-146">Clients can listen for a <xref:System.Windows.Automation.TextPattern.TextChangedEvent> for notification of any changes to the textual content they are working with.</span></span>|
|`System.Windows.Automation.AutomationTextAttribute Class`|<span data-ttu-id="f5d3b-147">用于标识文本范围的格式属性。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-147">Used to identify the formatting attributes of a text range.</span></span>|

<a name="TextPattern_Provider_API_s"></a>

## <a name="textpattern-provider-apis"></a><span data-ttu-id="f5d3b-148">TextPattern 提供程序 Api</span><span class="sxs-lookup"><span data-stu-id="f5d3b-148">TextPattern Provider APIs</span></span>

<span data-ttu-id="f5d3b-149">在本机或通过 <xref:System.Windows.Automation.TextPattern> 代理的方式执行 <xref:System.Windows.Automation.Provider.ITextProvider> 和 <xref:System.Windows.Automation.Provider.ITextRangeProvider> 接口来支持 [!INCLUDE[TLA#tla_uiautomation](../../../includes/tlasharptla-uiautomation-md.md)] 的 UI 元素或控件，除了提供强大的导航功能之外，还能够公开它们包含的任何文本的详细的属性信息。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-149">UI elements or controls that support <xref:System.Windows.Automation.TextPattern> by implementing the <xref:System.Windows.Automation.Provider.ITextProvider> and <xref:System.Windows.Automation.Provider.ITextRangeProvider> interfaces, either natively or through [!INCLUDE[TLA#tla_uiautomation](../../../includes/tlasharptla-uiautomation-md.md)] proxies, are capable of exposing detailed attribute information for any text they contain in addition to providing robust navigational capabilities.</span></span>

<span data-ttu-id="f5d3b-150">如果控件缺少对任何特定特性的支持，则 <xref:System.Windows.Automation.TextPattern> 提供程序不需要支持所有的文本特性。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-150">A <xref:System.Windows.Automation.TextPattern> provider does not have to support all text attributes if the control lacks support for any particular attributes.</span></span>

<span data-ttu-id="f5d3b-151">如果控件支持在文本区域（或系统插入标记）内的文本选择或位置，则 <xref:System.Windows.Automation.TextPattern> 提供程序必须支持 <xref:System.Windows.Automation.TextPattern.GetSelection%2A> 和 <xref:System.Windows.Automation.Text.TextPatternRange.Select%2A> 函数。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-151">A <xref:System.Windows.Automation.TextPattern> provider must support the <xref:System.Windows.Automation.TextPattern.GetSelection%2A> and <xref:System.Windows.Automation.Text.TextPatternRange.Select%2A> functions if the control supports text selection or placement of the text cursor (or system caret) within the text area.</span></span> <span data-ttu-id="f5d3b-152">如果该控件不支持此功能，则它不必支持上述任一方法。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-152">If the control does not support this functionality then it does not need to support either of these methods.</span></span> <span data-ttu-id="f5d3b-153">但是，该控件必须通过执行 <xref:System.Windows.Automation.Provider.ITextProvider.SupportedTextSelection%2A> 属性公开其支持的文本选择类型。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-153">However, the control must expose the type of text selection it supports by implementing the <xref:System.Windows.Automation.Provider.ITextProvider.SupportedTextSelection%2A> property.</span></span>

<span data-ttu-id="f5d3b-154">一个 <xref:System.Windows.Automation.TextPattern> 提供程序必须始终支持 <xref:System.Windows.Automation.Text.TextUnit> 常量 <xref:System.Windows.Automation.Text.TextUnit.Character> 和 <xref:System.Windows.Automation.Text.TextUnit.Document> 及其支持的任何其他 <xref:System.Windows.Automation.Text.TextUnit> 常量。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-154">A <xref:System.Windows.Automation.TextPattern> provider must always support the <xref:System.Windows.Automation.Text.TextUnit> constants <xref:System.Windows.Automation.Text.TextUnit.Character> and <xref:System.Windows.Automation.Text.TextUnit.Document> as well as any other <xref:System.Windows.Automation.Text.TextUnit> constants it is capable of supporting.</span></span>

> [!NOTE]
> <span data-ttu-id="f5d3b-155">提供程序可以跳过某一特定 <xref:System.Windows.Automation.Text.TextUnit> 的支持，只需通过按如下顺序延迟到下一个受支持的最大 <xref:System.Windows.Automation.Text.TextUnit>：<xref:System.Windows.Automation.Text.TextUnit.Character><xref:System.Windows.Automation.Text.TextUnit.Format><xref:System.Windows.Automation.Text.TextUnit.Word><xref:System.Windows.Automation.Text.TextUnit.Line>、<xref:System.Windows.Automation.Text.TextUnit.Paragraph>、<xref:System.Windows.Automation.Text.TextUnit.Page> 和 <xref:System.Windows.Automation.Text.TextUnit.Document>。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-155">The provider may skip support for a specific <xref:System.Windows.Automation.Text.TextUnit> by deferring to the next largest <xref:System.Windows.Automation.Text.TextUnit> supported in the following order: <xref:System.Windows.Automation.Text.TextUnit.Character>, <xref:System.Windows.Automation.Text.TextUnit.Format>, <xref:System.Windows.Automation.Text.TextUnit.Word>, <xref:System.Windows.Automation.Text.TextUnit.Line>, <xref:System.Windows.Automation.Text.TextUnit.Paragraph>, <xref:System.Windows.Automation.Text.TextUnit.Page>, and <xref:System.Windows.Automation.Text.TextUnit.Document>.</span></span>

|||
|-|-|
|`ITextProvider Interface`|<span data-ttu-id="f5d3b-156">公开在客户端应用程序中支持 <xref:System.Windows.Automation.TextPattern> 的方法、属性和特性（请参阅 <xref:System.Windows.Automation.Provider.ITextProvider>）。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-156">Exposes methods, properties and attributes that support <xref:System.Windows.Automation.TextPattern> in client applications (see <xref:System.Windows.Automation.Provider.ITextProvider>).</span></span>|
|`ITextRangeProvider Interface`|<span data-ttu-id="f5d3b-157">表示文本提供程序中的一段文本（请参阅 <xref:System.Windows.Automation.Provider.ITextRangeProvider>）。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-157">Represents a span of text in a text provider (see <xref:System.Windows.Automation.Provider.ITextRangeProvider>).</span></span>|
|`System.Windows.Automation.TextPatternIdentifiers Class`|<span data-ttu-id="f5d3b-158">包含用作文本提供程序标识符的值（请参阅 <xref:System.Windows.Automation.TextPatternIdentifiers>）。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-158">Contains values that are used as identifiers for text providers (see <xref:System.Windows.Automation.TextPatternIdentifiers>).</span></span>|

<a name="Security"></a>

## <a name="security"></a><span data-ttu-id="f5d3b-159">安全性</span><span class="sxs-lookup"><span data-stu-id="f5d3b-159">Security</span></span>

<span data-ttu-id="f5d3b-160">此 [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] 体系结构的设计考虑到了安全性（请参阅[UI 自动化安全性概述](ui-automation-security-overview.md)）。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-160">The [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] architecture was designed with security in mind (see [UI Automation Security Overview](ui-automation-security-overview.md)).</span></span> <span data-ttu-id="f5d3b-161">但是，此概述中所述的 TextPattern 类需要一些特定的安全注意事项。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-161">However, the TextPattern classes described in this overview require some specific security considerations.</span></span>

- [!INCLUDE[TLA#tla_uiautomation](../../../includes/tlasharptla-uiautomation-md.md)] <span data-ttu-id="f5d3b-162">文本提供程序提供只读接口，并且不提供能够更改控件中的现有文本的功能。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-162">text providers supply read-only interfaces and do not provide the ability to change the existing text in a control.</span></span>

- <span data-ttu-id="f5d3b-163">如果 UI 自动化客户端是完全“信任”的，则 UI 自动化客户端只能使用 [!INCLUDE[TLA#tla_uiautomation](../../../includes/tlasharptla-uiautomation-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-163">UI Automation clients can only use [!INCLUDE[TLA#tla_uiautomation](../../../includes/tlasharptla-uiautomation-md.md)] if they are fully "trusted".</span></span> <span data-ttu-id="f5d3b-164">此示例将为受保护的登录桌面，只有已知和受信任的应用程序可以运行。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-164">An example of this would be the protected Logon Desktop, where only known and trusted applications can run.</span></span>

- <span data-ttu-id="f5d3b-165">UI 自动化提供程序的开发人员应注意：所有他们选择通过 [!INCLUDE[TLA#tla_uiautomation](../../../includes/tlasharptla-uiautomation-md.md)] 在控件中公开的信息实质上是公用的并且其他代码都可访问。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-165">Developers of UI Automation providers should be aware that all information they choose to expose in their controls through [!INCLUDE[TLA#tla_uiautomation](../../../includes/tlasharptla-uiautomation-md.md)] is essentially public and fully accessible by other code.</span></span> [!INCLUDE[TLA#tla_uiautomation](../../../includes/tlasharptla-uiautomation-md.md)] <span data-ttu-id="f5d3b-166">不会尝试确定任何 UI 自动化客户端的可信度，因此 UI 自动化提供程序不应公开受保护内容或敏感文本信息（如密码字段）。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-166">makes no effort to determine the trustworthiness of any UI Automation client and therefore the UI Automation provider should not expose protected content or sensitive textual information (such as password fields).</span></span>

- <span data-ttu-id="f5d3b-167">Windows Vista 安全性的最重大更改之一被广泛称为 "安全输入"，其中包含一些技术（例如最小特权（或有限）用户帐户（LUA）和用户界面特权级别隔离（UIPI））。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-167">One of the most significant changes in security for Windows Vista is broadly referred to as "Secure Input" which encompasses technologies such as Least-privileged (or Limited) User Accounts (LUA) and UI Privilege Level Isolation (UIPI).</span></span>

  - <span data-ttu-id="f5d3b-168">UIPI 防止一个程序控制和/或监控另一个具有更多“特权”的程序，防止欺骗用户输入的跨进程窗口消息攻击。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-168">UIPI prevents one program from controlling and/or monitoring another more "privileged" program, preventing cross-process window message attacks that spoof user input.</span></span>

  - <span data-ttu-id="f5d3b-169">LUA 对 Administrators 组中的用户正在运行的应用程序的权限进行限制设置。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-169">LUA sets limits on the privileges of applications being run by users in the Administrators group.</span></span> <span data-ttu-id="f5d3b-170">应用程序不一定具有管理员权限，但将以必需的最低权限运行。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-170">Applications won't necessarily have administrator privileges, but will instead run with the least privileges necessary.</span></span> <span data-ttu-id="f5d3b-171">因此，可能会在 LUA 方案中强制执行一些限制。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-171">As a consequence, there may be some restrictions enforced in LUA scenarios.</span></span> <span data-ttu-id="f5d3b-172">最值得注意的字符串截断（包括 TextPattern 字符串），可能有必要限制从管理员级别的应用程序检索的字符串的大小，因此它们不会被强制将内存分配给禁用该应用程序的点。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-172">Most notably string truncation (including TextPattern strings), where it may be necessary to limit the size of strings being retrieved from administrator-level applications so they aren't forced to allocate memory to the point of disabling the application.</span></span>

<a name="Performance"></a>

## <a name="performance"></a><span data-ttu-id="f5d3b-173">性能</span><span class="sxs-lookup"><span data-stu-id="f5d3b-173">Performance</span></span>

<span data-ttu-id="f5d3b-174">由于 TextPattern 依赖于跨进程调用其大多数功能，处理内容时，它不提供缓存机制来提高性能。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-174">Because TextPattern relies on cross-process calls for most of its functionality, it does not provide a caching mechanism to improve performance when processing content.</span></span> <span data-ttu-id="f5d3b-175">这与其他可以使用 [!INCLUDE[TLA#tla_uiautomation](../../../includes/tlasharptla-uiautomation-md.md)] 或 <xref:System.Windows.Automation.AutomationElement.GetCachedPattern%2A> 方法访问的 <xref:System.Windows.Automation.AutomationElement.TryGetCachedPattern%2A> 中的控件模式不同。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-175">This is unlike other control patterns in [!INCLUDE[TLA#tla_uiautomation](../../../includes/tlasharptla-uiautomation-md.md)] that can be accessed using the <xref:System.Windows.Automation.AutomationElement.GetCachedPattern%2A> or <xref:System.Windows.Automation.AutomationElement.TryGetCachedPattern%2A> methods.</span></span>

<span data-ttu-id="f5d3b-176">改善性能的一种策略是通过确保 UI 自动化客户端使用 <xref:System.Windows.Automation.Text.TextPatternRange.GetText%2A>尝试检索中等规模的文本块。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-176">One tactic for improving performance is by making sure UI Automation clients attempt to retrieve moderately-sized blocks of text using <xref:System.Windows.Automation.Text.TextPatternRange.GetText%2A>.</span></span> <span data-ttu-id="f5d3b-177">例如，GetText(1) 调用将对每个字符产生跨进程命中，而一次 GetText(-1) 调用将产生一次跨进程命中，但根据文本提供程序的大小，可以具有高延时。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-177">For example, GetText(1) calls will incur cross-process hits for each character whereas one GetText(-1) call will incur one cross-process hit, but can have high latency depending on the size of the text provider.</span></span>

<a name="Glossary"></a>

## <a name="textpattern-terminology"></a><span data-ttu-id="f5d3b-178">TextPattern 术语</span><span class="sxs-lookup"><span data-stu-id="f5d3b-178">TextPattern Terminology</span></span>

<span data-ttu-id="f5d3b-179">**Attribute**</span><span class="sxs-lookup"><span data-stu-id="f5d3b-179">**Attribute**</span></span>\
<span data-ttu-id="f5d3b-180">文本范围的格式特性（例如， <xref:System.Windows.Automation.TextPattern.IsItalicAttribute> 或 <xref:System.Windows.Automation.TextPattern.FontNameAttribute>）。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-180">A formatting characteristic of a text range (for example, <xref:System.Windows.Automation.TextPattern.IsItalicAttribute> or <xref:System.Windows.Automation.TextPattern.FontNameAttribute>).</span></span>

<span data-ttu-id="f5d3b-181">**退化范围**</span><span class="sxs-lookup"><span data-stu-id="f5d3b-181">**Degenerate Range**</span></span>\
<span data-ttu-id="f5d3b-182">退化范围为空或零字符文本区域。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-182">A degenerate range is an empty or zero-character text range.</span></span> <span data-ttu-id="f5d3b-183">出于 TextPattern 控件模式的目的，文本插入点（或系统插入标记）被视为退化范围。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-183">For the purposes of the TextPattern control pattern, the text insertion point (or system caret) is considered a degenerate range.</span></span> <span data-ttu-id="f5d3b-184">如果未选择文本， <xref:System.Windows.Automation.TextPattern.GetSelection%2A> 将返回文本插入点处的退化范围， <xref:System.Windows.Automation.TextPattern.RangeFromPoint%2A> 将返回退化范围作为其起始终结点。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-184">If no text is selected, <xref:System.Windows.Automation.TextPattern.GetSelection%2A> would return a degenerate range at the text insertion point and <xref:System.Windows.Automation.TextPattern.RangeFromPoint%2A> would return a degenerate range as its starting endpoint.</span></span> <span data-ttu-id="f5d3b-185">文本提供程序找不到任何与给定条件相匹配的文本范围时，<xref:System.Windows.Automation.TextPattern.RangeFromChild%2A> 和 <xref:System.Windows.Automation.TextPattern.GetVisibleRanges%2A> 可能会返回退化范围。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-185"><xref:System.Windows.Automation.TextPattern.RangeFromChild%2A> and <xref:System.Windows.Automation.TextPattern.GetVisibleRanges%2A> may return degenerate ranges when the text provider cannot find any text ranges that match the given condition.</span></span> <span data-ttu-id="f5d3b-186">此退化范围可用作文本提供程序内的起始终结点。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-186">This degenerate range can be used as a starting endpoint within the text provider.</span></span> <span data-ttu-id="f5d3b-187"><xref:System.Windows.Automation.Text.TextPatternRange.FindText%2A>和 <xref:System.Windows.Automation.Text.TextPatternRange.FindAttribute%2A> 返回空引用（ `Nothing` 在 Microsoft Visual Basic .net 中），以避免与发现的范围和退化范围相混淆。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-187"><xref:System.Windows.Automation.Text.TextPatternRange.FindText%2A> and <xref:System.Windows.Automation.Text.TextPatternRange.FindAttribute%2A> return a null reference (`Nothing` in Microsoft Visual Basic .NET) to avoid confusion with a discovered range versus a degenerate range.</span></span>

<span data-ttu-id="f5d3b-188">**嵌入对象**</span><span class="sxs-lookup"><span data-stu-id="f5d3b-188">**Embedded Object**</span></span>\
<span data-ttu-id="f5d3b-189">在 [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] 文本模型中，有两种类型的嵌入对象。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-189">There are two types of embedded objects in the [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] text model.</span></span> <span data-ttu-id="f5d3b-190">它们包含基于文本的内容元素，如超链接或表，以及控制元素（如图像和按钮）。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-190">They consist of text-based content elements such as hyperlinks or tables, and control elements such as images and buttons.</span></span> <span data-ttu-id="f5d3b-191">有关详细信息，请参见 [Access Embedded Objects Using UI Automation](access-embedded-objects-using-ui-automation.md)。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-191">For more detailed information, see [Access Embedded Objects Using UI Automation](access-embedded-objects-using-ui-automation.md).</span></span>

<span data-ttu-id="f5d3b-192">**终结点**</span><span class="sxs-lookup"><span data-stu-id="f5d3b-192">**Endpoint**</span></span>\
<span data-ttu-id="f5d3b-193">文本容器内的文本范围的绝对 <xref:System.Windows.Automation.Text.TextPatternRangeEndpoint.Start> 或 <xref:System.Windows.Automation.Text.TextPatternRangeEndpoint.End> 点。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-193">The absolute <xref:System.Windows.Automation.Text.TextPatternRangeEndpoint.Start> or <xref:System.Windows.Automation.Text.TextPatternRangeEndpoint.End> point of a text range within a text container.</span></span>

<span data-ttu-id="f5d3b-194">![TextPatternRangeEndpoints &#40;开始和结束&#41;。](./media/uia-textpattern-endpoints.PNG "UIA_TextPattern_Endpoints")</span><span class="sxs-lookup"><span data-stu-id="f5d3b-194">![TextPatternRangeEndpoints &#40;start and end&#41;.](./media/uia-textpattern-endpoints.PNG "UIA_TextPattern_Endpoints")</span></span>
<span data-ttu-id="f5d3b-195">下面显示了一套起始点和终结点。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-195">The following illustrates a set of start and end points.</span></span>

<span data-ttu-id="f5d3b-196">**TextRange**</span><span class="sxs-lookup"><span data-stu-id="f5d3b-196">**TextRange**</span></span>\
<span data-ttu-id="f5d3b-197">表示包括所有的相关特性和功能的文本容器中带起始点和终结点的一段文本。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-197">A representation of a span of text, with start and end points, in a text container including all associated attributes and functionality.</span></span>

<xref:System.Windows.Automation.Text.TextUnit>\
<span data-ttu-id="f5d3b-198">用于导航文本范围的逻辑分段的预定义文本单元（字符、单词、行或段落）。</span><span class="sxs-lookup"><span data-stu-id="f5d3b-198">A pre-defined unit of text (character, word, line, or paragraph) used for navigating through logical segments of a text range.</span></span>

## <a name="see-also"></a><span data-ttu-id="f5d3b-199">另请参阅</span><span class="sxs-lookup"><span data-stu-id="f5d3b-199">See also</span></span>

- [<span data-ttu-id="f5d3b-200">客户端的 UI 自动化控件模式</span><span class="sxs-lookup"><span data-stu-id="f5d3b-200">UI Automation Control Patterns for Clients</span></span>](ui-automation-control-patterns-for-clients.md)
- [<span data-ttu-id="f5d3b-201">UI 自动化控件模式概述</span><span class="sxs-lookup"><span data-stu-id="f5d3b-201">UI Automation Control Patterns Overview</span></span>](ui-automation-control-patterns-overview.md)
- [<span data-ttu-id="f5d3b-202">UI 自动化树概述</span><span class="sxs-lookup"><span data-stu-id="f5d3b-202">UI Automation Tree Overview</span></span>](ui-automation-tree-overview.md)
- [<span data-ttu-id="f5d3b-203">在 UI 自动化中使用缓存</span><span class="sxs-lookup"><span data-stu-id="f5d3b-203">Use Caching in UI Automation</span></span>](use-caching-in-ui-automation.md)
- [<span data-ttu-id="f5d3b-204">在 UI 自动化提供程序中支持控件模式</span><span class="sxs-lookup"><span data-stu-id="f5d3b-204">Support Control Patterns in a UI Automation Provider</span></span>](support-control-patterns-in-a-ui-automation-provider.md)
- [<span data-ttu-id="f5d3b-205">UI 自动化客户端的控件模式映射</span><span class="sxs-lookup"><span data-stu-id="f5d3b-205">Control Pattern Mapping for UI Automation Clients</span></span>](control-pattern-mapping-for-ui-automation-clients.md)
- [<span data-ttu-id="f5d3b-206">文本服务框架</span><span class="sxs-lookup"><span data-stu-id="f5d3b-206">Text Services Framework</span></span>](/windows/desktop/api/_tsf/)
