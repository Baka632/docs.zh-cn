---
title: SQL Server 中的授权和权限
description: 了解如何显式授予权限，使用户可以在 SQL Server 中通过 ADO.NET 访问你创建的数据库对象。
ms.date: 03/30/2017
ms.assetid: d340405c-91f4-4837-a3cc-a238ee89888a
ms.openlocfilehash: 748d40ff2c64ae59f43e6296ef591efcb5ff9831
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/24/2020
ms.locfileid: "91197490"
---
# <a name="authorization-and-permissions-in-sql-server"></a><span data-ttu-id="d27a6-103">SQL Server 中的授权和权限</span><span class="sxs-lookup"><span data-stu-id="d27a6-103">Authorization and Permissions in SQL Server</span></span>

<span data-ttu-id="d27a6-104">在创建数据库对象时，必须显式授予权限以使用户可以访问它们。</span><span class="sxs-lookup"><span data-stu-id="d27a6-104">When you create database objects, you must explicitly grant permissions to make them accessible to users.</span></span> <span data-ttu-id="d27a6-105">每个可保护对象都具有可使用权限语句授予主体的权限。</span><span class="sxs-lookup"><span data-stu-id="d27a6-105">Every securable object has permissions that can be granted to a principal using permission statements.</span></span>  
  
## <a name="the-principle-of-least-privilege"></a><span data-ttu-id="d27a6-106">最低特权原则</span><span class="sxs-lookup"><span data-stu-id="d27a6-106">The Principle of Least Privilege</span></span>  

 <span data-ttu-id="d27a6-107">使用最低特权用户帐户 (LUA) 方法来开发应用程序是抵御安全威胁的全面防御策略的重要组成部分。</span><span class="sxs-lookup"><span data-stu-id="d27a6-107">Developing an application using a least-privileged user account (LUA) approach is an important part of a defensive, in-depth strategy for countering security threats.</span></span> <span data-ttu-id="d27a6-108">LUA 方法确保用户遵循最低特权原则并始终使用受限制的用户帐户登录。</span><span class="sxs-lookup"><span data-stu-id="d27a6-108">The LUA approach ensures that users follow the principle of least privilege and always log on with limited user accounts.</span></span> <span data-ttu-id="d27a6-109">使用不同的固定服务器角色分别执行不同的管理任务，`sysadmin` 固定服务器角色的使用受到严格限制。</span><span class="sxs-lookup"><span data-stu-id="d27a6-109">Administrative tasks are broken out using fixed server roles, and the use of the `sysadmin` fixed server role is severely restricted.</span></span>  
  
 <span data-ttu-id="d27a6-110">向数据库用户授予权限时，应始终遵循最低特权原则。</span><span class="sxs-lookup"><span data-stu-id="d27a6-110">Always follow the principle of least privilege when granting permissions to database users.</span></span> <span data-ttu-id="d27a6-111">向用户或角色授予完成给定任务所必需的最低权限。</span><span class="sxs-lookup"><span data-stu-id="d27a6-111">Grant the minimum permissions necessary to a user or role to accomplish a given task.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="d27a6-112">使用 LUA 方法开发和测试应用程序会给开发过程增加一定的难度。</span><span class="sxs-lookup"><span data-stu-id="d27a6-112">Developing and testing an application using the LUA approach adds a degree of difficulty to the development process.</span></span> <span data-ttu-id="d27a6-113">以系统管理员或数据库所有者身份登录时，创建对象和编写代码要比使用 LUA 帐户登录更容易。</span><span class="sxs-lookup"><span data-stu-id="d27a6-113">It is easier to create objects and write code while logged on as a system administrator or database owner than it is using a LUA account.</span></span> <span data-ttu-id="d27a6-114">不过，在最低特权用户试图运行需要提升权限才能正常工作的应用程序时，使用高特权帐户开发的应用程序会使功能减少所带来的影响变得混淆。</span><span class="sxs-lookup"><span data-stu-id="d27a6-114">However, developing applications using a highly privileged account can obfuscate the impact of reduced functionality when least privileged users attempt to run an application that requires elevated permissions in order to function correctly.</span></span> <span data-ttu-id="d27a6-115">授予用户过多的权限以重新获得失去的功能会使您的应用程序容易受到攻击。</span><span class="sxs-lookup"><span data-stu-id="d27a6-115">Granting excessive permissions to users in order to reacquire lost functionality can leave your application vulnerable to attack.</span></span> <span data-ttu-id="d27a6-116">在使用 LUA 帐户登录时设计、开发和测试应用程序会强制使用规范的方法进行安全规划，以消除异常和以授予提升特权作为快速解决问题的倾向做法。</span><span class="sxs-lookup"><span data-stu-id="d27a6-116">Designing, developing and testing your application logged on with a LUA account enforces a disciplined approach to security planning that eliminates unpleasant surprises and the temptation to grant elevated privileges as a quick fix.</span></span> <span data-ttu-id="d27a6-117">即使你的应用程序旨在使用 Windows 身份验证来进行部署，你也可以使用 SQL Server 登录名进行测试。</span><span class="sxs-lookup"><span data-stu-id="d27a6-117">You can use a SQL Server login for testing even if your application is intended to deploy using Windows authentication.</span></span>  
  
## <a name="role-based-permissions"></a><span data-ttu-id="d27a6-118">基于角色的权限</span><span class="sxs-lookup"><span data-stu-id="d27a6-118">Role-Based Permissions</span></span>  

 <span data-ttu-id="d27a6-119">向角色而不是用户授予权限可简化安全管理。</span><span class="sxs-lookup"><span data-stu-id="d27a6-119">Granting permissions to roles rather than to users simplifies security administration.</span></span> <span data-ttu-id="d27a6-120">分配给角色的权限集由该角色的所有成员继承。</span><span class="sxs-lookup"><span data-stu-id="d27a6-120">Permission sets that are assigned to roles are inherited by all members of the role.</span></span> <span data-ttu-id="d27a6-121">在角色中添加或移除用户要比为单个用户重新创建单独的权限集更为简便。</span><span class="sxs-lookup"><span data-stu-id="d27a6-121">It is easier to add or remove users from a role than it is to recreate separate permission sets for individual users.</span></span> <span data-ttu-id="d27a6-122">角色可以嵌套；但是，嵌套的级别太多会降低性能。</span><span class="sxs-lookup"><span data-stu-id="d27a6-122">Roles can be nested; however, too many levels of nesting can degrade performance.</span></span> <span data-ttu-id="d27a6-123">您也可以将用户添加到固定数据库角色来简化权限的分配。</span><span class="sxs-lookup"><span data-stu-id="d27a6-123">You can also add users to fixed database roles to simplify assigning permissions.</span></span>  
  
 <span data-ttu-id="d27a6-124">您可以授予架构级别的权限。</span><span class="sxs-lookup"><span data-stu-id="d27a6-124">You can grant permissions at the schema level.</span></span> <span data-ttu-id="d27a6-125">对于在架构中创建的所有新对象，用户可以自动继承权限；您无需在创建新对象时授予权限。</span><span class="sxs-lookup"><span data-stu-id="d27a6-125">Users automatically inherit permissions on all new objects created in the schema; you do not need to grant permissions as new objects are created.</span></span>  
  
## <a name="permissions-through-procedural-code"></a><span data-ttu-id="d27a6-126">通过过程代码授予权限</span><span class="sxs-lookup"><span data-stu-id="d27a6-126">Permissions Through Procedural Code</span></span>  

 <span data-ttu-id="d27a6-127">通过模块（如存储过程和用户定义函数）包装数据访问可在应用程序周围提供额外的保护层。</span><span class="sxs-lookup"><span data-stu-id="d27a6-127">Encapsulating data access through modules such as stored procedures and user-defined functions provides an additional layer of protection around your application.</span></span> <span data-ttu-id="d27a6-128">通过仅对存储过程或函数授予权限，同时对基础对象（如表）拒绝权限，您可以防止用户直接与数据库对象进行交互。</span><span class="sxs-lookup"><span data-stu-id="d27a6-128">You can prevent users from directly interacting with database objects by granting permissions only to stored procedures or functions while denying permissions to underlying objects such as tables.</span></span> <span data-ttu-id="d27a6-129">SQL Server 通过所有权链接实现此目的。</span><span class="sxs-lookup"><span data-stu-id="d27a6-129">SQL Server achieves this by ownership chaining.</span></span>  
  
## <a name="permission-statements"></a><span data-ttu-id="d27a6-130">权限语句</span><span class="sxs-lookup"><span data-stu-id="d27a6-130">Permission Statements</span></span>  

 <span data-ttu-id="d27a6-131">下表说明了三个 Transact-SQL 权限语句。</span><span class="sxs-lookup"><span data-stu-id="d27a6-131">The three Transact-SQL permission statements are described in the following table.</span></span>  
  
|<span data-ttu-id="d27a6-132">权限语句</span><span class="sxs-lookup"><span data-stu-id="d27a6-132">Permission Statement</span></span>|<span data-ttu-id="d27a6-133">描述</span><span class="sxs-lookup"><span data-stu-id="d27a6-133">Description</span></span>|  
|--------------------------|-----------------|  
|<span data-ttu-id="d27a6-134">GRANT</span><span class="sxs-lookup"><span data-stu-id="d27a6-134">GRANT</span></span>|<span data-ttu-id="d27a6-135">授予权限。</span><span class="sxs-lookup"><span data-stu-id="d27a6-135">Grants a permission.</span></span>|  
|<span data-ttu-id="d27a6-136">REVOKE</span><span class="sxs-lookup"><span data-stu-id="d27a6-136">REVOKE</span></span>|<span data-ttu-id="d27a6-137">撤消权限。</span><span class="sxs-lookup"><span data-stu-id="d27a6-137">Revokes a permission.</span></span> <span data-ttu-id="d27a6-138">这是新对象的默认状态。</span><span class="sxs-lookup"><span data-stu-id="d27a6-138">This is the default state of a new object.</span></span> <span data-ttu-id="d27a6-139">从用户或角色撤消的权限仍可以从主体分配到的其他组或角色继承。</span><span class="sxs-lookup"><span data-stu-id="d27a6-139">A permission revoked from a user or role can still be inherited from other groups or roles to which the principal is assigned.</span></span>|  
|<span data-ttu-id="d27a6-140">DENY</span><span class="sxs-lookup"><span data-stu-id="d27a6-140">DENY</span></span>|<span data-ttu-id="d27a6-141">DENY 撤消一个权限，使其不能被继承。</span><span class="sxs-lookup"><span data-stu-id="d27a6-141">DENY revokes a permission so that it cannot be inherited.</span></span> <span data-ttu-id="d27a6-142">DENY 优先于所有权限，只是 DENY 不适用于对象所有者或 `sysadmin` 的成员。</span><span class="sxs-lookup"><span data-stu-id="d27a6-142">DENY takes precedence over all permissions, except DENY does not apply to object owners or members of `sysadmin`.</span></span> <span data-ttu-id="d27a6-143">如果您针对 `public` 角色对某个对象执行 DENY 权限语句，则会拒绝该对象的所有者和 `sysadmin` 成员以外的所有用户和角色访问该对象。</span><span class="sxs-lookup"><span data-stu-id="d27a6-143">If you DENY permissions on an object to the `public` role it is denied to all users and roles except for object owners and `sysadmin` members.</span></span>|  
  
- <span data-ttu-id="d27a6-144">GRANT 语句可以为能够由数据库用户继承的组或角色分配权限。</span><span class="sxs-lookup"><span data-stu-id="d27a6-144">The GRANT statement can assign permissions to a group or role that can be inherited by database users.</span></span> <span data-ttu-id="d27a6-145">但是，DENY 语句优先于所有其他权限语句。</span><span class="sxs-lookup"><span data-stu-id="d27a6-145">However, the DENY statement takes precedence over all other permission statements.</span></span> <span data-ttu-id="d27a6-146">因此，已被拒绝某一权限的用户无法从其他角色继承该权限。</span><span class="sxs-lookup"><span data-stu-id="d27a6-146">Therefore, a user who has been denied a permission cannot inherit it from another role.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="d27a6-147">不能对 `sysadmin` 固定服务器角色和成员对象所有者拒绝权限。</span><span class="sxs-lookup"><span data-stu-id="d27a6-147">Members of the `sysadmin` fixed server role and object owners cannot be denied permissions.</span></span>  
  
## <a name="ownership-chains"></a><span data-ttu-id="d27a6-148">所有权链</span><span class="sxs-lookup"><span data-stu-id="d27a6-148">Ownership Chains</span></span>  

 <span data-ttu-id="d27a6-149">SQL Server 确保只有已被授予权限的主体才能访问对象。</span><span class="sxs-lookup"><span data-stu-id="d27a6-149">SQL Server ensures that only principals that have been granted permission can access objects.</span></span> <span data-ttu-id="d27a6-150">当多个数据库对象互相访问时，该序列称为链。</span><span class="sxs-lookup"><span data-stu-id="d27a6-150">When multiple database objects access each other, the sequence is known as a chain.</span></span> <span data-ttu-id="d27a6-151">当 SQL Server 遍历链中的链接时，它计算权限的方式不同于单独访问各项时计算权限的方式。</span><span class="sxs-lookup"><span data-stu-id="d27a6-151">When SQL Server is traversing the links in the chain, it evaluates permissions differently than it would if it were accessing each item separately.</span></span> <span data-ttu-id="d27a6-152">当通过链访问一个对象时，SQL Server 首选将对象的所有者与调用对象的所有者（链中的上一个链接）进行比较。</span><span class="sxs-lookup"><span data-stu-id="d27a6-152">When an object is accessed through a chain, SQL Server first compares the object's owner to the owner of the calling object (the previous link in the chain).</span></span> <span data-ttu-id="d27a6-153">如果这两个对象具有相同所有者，则不检查被引用对象的权限。</span><span class="sxs-lookup"><span data-stu-id="d27a6-153">If both objects have the same owner, permissions on the referenced object are not checked.</span></span> <span data-ttu-id="d27a6-154">每当一个对象访问另一个具有不同所有者的对象时，所有权链就会断开，因此 SQL Server 必须检查调用方的安全上下文。</span><span class="sxs-lookup"><span data-stu-id="d27a6-154">Whenever an object accesses another object that has a different owner, the ownership chain is broken and SQL Server must check the caller's security context.</span></span>  
  
## <a name="procedural-code-and-ownership-chaining"></a><span data-ttu-id="d27a6-155">过程代码和所有权链接</span><span class="sxs-lookup"><span data-stu-id="d27a6-155">Procedural Code and Ownership Chaining</span></span>  

 <span data-ttu-id="d27a6-156">假设为某一用户授予了对从表中选择数据的存储过程的执行权限。</span><span class="sxs-lookup"><span data-stu-id="d27a6-156">Suppose that a user is granted execute permissions on a stored procedure that selects data from a table.</span></span> <span data-ttu-id="d27a6-157">如果存储过程和表具有相同的所有者，则无需向用户授予对表的任何权限，甚至可以拒绝权限。</span><span class="sxs-lookup"><span data-stu-id="d27a6-157">If the stored procedure and the table have the same owner, the user doesn't need to be granted any permissions on the table and can even be denied permissions.</span></span> <span data-ttu-id="d27a6-158">但是，如果存储过程和表具有不同的所有者，则 SQL Server 在允许访问数据前必须检查用户对表的权限。</span><span class="sxs-lookup"><span data-stu-id="d27a6-158">However, if the stored procedure and the table have different owners, SQL Server must check the user's permissions on the table before allowing access to the data.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="d27a6-159">所有权链接不适用于动态 SQL 语句的情况。</span><span class="sxs-lookup"><span data-stu-id="d27a6-159">Ownership chaining does not apply in the case of dynamic SQL statements.</span></span> <span data-ttu-id="d27a6-160">若要调用执行 SQL 语句的过程，必须向调用方授予对基础表的权限，这会使您的应用程序容易受到 SQL 注入攻击。</span><span class="sxs-lookup"><span data-stu-id="d27a6-160">To call a procedure that executes an SQL statement, the caller must be granted permissions on the underlying tables, leaving your application vulnerable to SQL Injection attack.</span></span> <span data-ttu-id="d27a6-161">SQL Server 提供了新的机制（如模拟和使用证书对模块进行签名），这些机制无需授予基础表的权限。</span><span class="sxs-lookup"><span data-stu-id="d27a6-161">SQL Server provides new mechanisms, such as impersonation and signing modules with certificates, that do not require granting permissions on the underlying tables.</span></span> <span data-ttu-id="d27a6-162">它们还可与 CLR 存储过程一起使用。</span><span class="sxs-lookup"><span data-stu-id="d27a6-162">These can also be used with CLR stored procedures.</span></span>  
  
## <a name="external-resources"></a><span data-ttu-id="d27a6-163">外部资源</span><span class="sxs-lookup"><span data-stu-id="d27a6-163">External Resources</span></span>  

 <span data-ttu-id="d27a6-164">有关详细信息，请参阅以下资源。</span><span class="sxs-lookup"><span data-stu-id="d27a6-164">For more information, see the following resources.</span></span>  
  
|<span data-ttu-id="d27a6-165">资源</span><span class="sxs-lookup"><span data-stu-id="d27a6-165">Resource</span></span>|<span data-ttu-id="d27a6-166">说明</span><span class="sxs-lookup"><span data-stu-id="d27a6-166">Description</span></span>|  
|--------------|-----------------|  
|[<span data-ttu-id="d27a6-167">权限</span><span class="sxs-lookup"><span data-stu-id="d27a6-167">Permissions</span></span>](/sql/relational-databases/security/permissions-database-engine)|<span data-ttu-id="d27a6-168">包含说明权限层次结构、目录视图以及固定服务器角色权限和数据库角色权限的主题。</span><span class="sxs-lookup"><span data-stu-id="d27a6-168">Contains topics describing permissions hierarchy, catalog views, and permissions of fixed server and database roles.</span></span>|
  
## <a name="see-also"></a><span data-ttu-id="d27a6-169">请参阅</span><span class="sxs-lookup"><span data-stu-id="d27a6-169">See also</span></span>

- [<span data-ttu-id="d27a6-170">保证 ADO.NET 应用程序的安全</span><span class="sxs-lookup"><span data-stu-id="d27a6-170">Securing ADO.NET Applications</span></span>](../securing-ado-net-applications.md)
- [<span data-ttu-id="d27a6-171">SQL Server 中的应用程序安全方案</span><span class="sxs-lookup"><span data-stu-id="d27a6-171">Application Security Scenarios in SQL Server</span></span>](application-security-scenarios-in-sql-server.md)
- [<span data-ttu-id="d27a6-172">SQL Server 中的身份验证</span><span class="sxs-lookup"><span data-stu-id="d27a6-172">Authentication in SQL Server</span></span>](authentication-in-sql-server.md)
- [<span data-ttu-id="d27a6-173">SQL Server 中的服务器和数据库角色</span><span class="sxs-lookup"><span data-stu-id="d27a6-173">Server and Database Roles in SQL Server</span></span>](server-and-database-roles-in-sql-server.md)
- [<span data-ttu-id="d27a6-174">SQL Server 中的所有权和用户架构分离</span><span class="sxs-lookup"><span data-stu-id="d27a6-174">Ownership and User-Schema Separation in SQL Server</span></span>](ownership-and-user-schema-separation-in-sql-server.md)
- [<span data-ttu-id="d27a6-175">ADO.NET 概述</span><span class="sxs-lookup"><span data-stu-id="d27a6-175">ADO.NET Overview</span></span>](../ado-net-overview.md)
