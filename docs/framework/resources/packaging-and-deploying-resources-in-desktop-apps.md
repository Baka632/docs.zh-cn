---
title: 打包和部署 .NET 应用中的资源
description: 使用主程序集（中枢）和附属程序集（轮辐）在 .NET 应用中打包和部署资源。 轮辐包含本地化资源，但不包含代码。
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- deploying applications [.NET Framework], resources
- resource files, deploying
- hub-and-spoke resource deployment model
- resource files, packaging
- application resources, packaging
- single resource assembly
- satellite assemblies
- default culture for applications
- names [.NET Framework], resources
- fallback process for resources
- grouping cultures
- application resources, deploying
- application resources, naming conventions
- culture, packaging and deploying resources
- resource files, naming conventions
- packaging application resources
- application resources, fallback processes
- resource files, fallback processes
- localizing resources
- neutral cultures
ms.assetid: b224d7c0-35f8-4e82-a705-dd76795e8d16
ms.openlocfilehash: 7b06ca4444b75f0a7002323b32732dd4f855f692
ms.sourcegitcommit: 87cfeb69226fef01acb17c56c86f978f4f4a13db
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 07/24/2020
ms.locfileid: "87166182"
---
# <a name="packaging-and-deploying-resources-in-net-apps"></a><span data-ttu-id="2dcb5-104">打包和部署 .NET 应用中的资源</span><span class="sxs-lookup"><span data-stu-id="2dcb5-104">Packaging and Deploying Resources in .NET Apps</span></span>

<span data-ttu-id="2dcb5-105">应用程序依靠 .NET Framework Resource Manager（由 <xref:System.Resources.ResourceManager> 类表示）来检索已本地化的资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-105">Applications rely on the .NET Framework Resource Manager, represented by the <xref:System.Resources.ResourceManager> class, to retrieve localized resources.</span></span> <span data-ttu-id="2dcb5-106">Resource Manager 假定使用中枢轮辐式模型来打包和部署资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-106">The Resource Manager assumes that a hub and spoke model is used to package and deploy resources.</span></span> <span data-ttu-id="2dcb5-107">中枢即主程序集，包含不可本地化的可执行代码和单个区域性（称作非特定区域性或默认区域性）的资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-107">The hub is the main assembly that contains the nonlocalizable executable code and the resources for a single culture, called the neutral or default culture.</span></span> <span data-ttu-id="2dcb5-108">默认区域性是应用程序的回退区域性；如果找不到已本地化的资源，则使用默认区域性的资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-108">The default culture is the fallback culture for the application; it is the culture whose resources are used if localized resources cannot be found.</span></span> <span data-ttu-id="2dcb5-109">每条轮辐均连接到一个附属程序集，该附属程序集包含单个区域性的资源，但不包含任何代码。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-109">Each spoke connects to a satellite assembly that contains the resources for a single culture, but does not contain any code.</span></span>

<span data-ttu-id="2dcb5-110">此模型有以下优点：</span><span class="sxs-lookup"><span data-stu-id="2dcb5-110">There are several advantages to this model:</span></span>

- <span data-ttu-id="2dcb5-111">部署应用程序后，可针对新区域性以增量方式添加资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-111">You can incrementally add resources for new cultures after you have deployed an application.</span></span> <span data-ttu-id="2dcb5-112">因为特定于区域性资源的后续开发可能需要大量时间，这使你能够先发布主要应用程序，并在以后发布特定于区域性的资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-112">Because subsequent development of culture-specific resources can require a significant amount of time, this allows you to release your main application first, and deliver culture-specific resources at a later date.</span></span>
- <span data-ttu-id="2dcb5-113">可更新和更改应用程序的附属程序集，无需重新编译应用程序。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-113">You can update and change an application's satellite assemblies without recompiling the application.</span></span>
- <span data-ttu-id="2dcb5-114">应用程序只需加载那些包含特定区域性所需资源的附属程序集。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-114">An application needs to load only those satellite assemblies that contain the resources needed for a particular culture.</span></span> <span data-ttu-id="2dcb5-115">这可显著减少系统资源的使用。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-115">This can significantly reduce the use of system resources.</span></span>

 <span data-ttu-id="2dcb5-116">但是，该模型也有以下缺点：</span><span class="sxs-lookup"><span data-stu-id="2dcb5-116">However, there are also disadvantages to this model:</span></span>

- <span data-ttu-id="2dcb5-117">必须管理多组资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-117">You must manage multiple sets of resources.</span></span>
- <span data-ttu-id="2dcb5-118">测试应用程序的初始成本增加，因为必须测试多种配置。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-118">The initial cost of testing an application increases, because you must test several configurations.</span></span> <span data-ttu-id="2dcb5-119">请注意，从长远角度看，测试使用多个附属程序集测试多个核心应用程序会比测试并维护多个并行国际版本更轻松，成本更低。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-119">Note that in the long term it will be easier and less expensive to test one core application with several satellites, than to test and maintain several parallel international versions.</span></span>

## <a name="resource-naming-conventions"></a><span data-ttu-id="2dcb5-120">资源命名约定</span><span class="sxs-lookup"><span data-stu-id="2dcb5-120">Resource naming conventions</span></span>

<span data-ttu-id="2dcb5-121">在打包应用程序的资源时，必须使用公共语言运行时所要求的资源命名约定对其进行命名。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-121">When you package your application's resources, you must name them using the resource naming conventions that the common language runtime expects.</span></span> <span data-ttu-id="2dcb5-122">运行时可按其区域性名称标识资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-122">The runtime identifies a resource by its culture name.</span></span> <span data-ttu-id="2dcb5-123">每个区域性均被赋予唯一名称，通常是与语言相关的两个小写字母的区域性名称和必要情况下，与国家或地区相关的两个大写子母的区域性名称的组合。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-123">Each culture is given a unique name, which is usually a combination of a two-letter, lowercase culture name associated with a language and, if required, a two-letter, uppercase subculture name associated with a country or region.</span></span> <span data-ttu-id="2dcb5-124">子区域性名称跟在区域性名称后，以短划线 (-) 隔开。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-124">The subculture name follows the culture name, separated by a dash (-).</span></span> <span data-ttu-id="2dcb5-125">例如：ja-JP 表示日本日语，en-US 表示美国英语，de-DE 表示德国德语，de-AT 表示奥地利德语。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-125">Examples include ja-JP for Japanese as spoken in Japan, en-US for English as spoken in the United States, de-DE for German as spoken in Germany, or de-AT for German as spoken in Austria.</span></span> <span data-ttu-id="2dcb5-126">请参阅 [Windows 支持的语言/区域名称列表](https://docs.microsoft.com/openspecs/windows_protocols/ms-lcid/a9eac961-e77d-41a6-90a5-ce1a8b0cdb9c)中的“语言标记”  列。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-126">See the **Language tag** column in the [list of language/region names supported by Windows](https://docs.microsoft.com/openspecs/windows_protocols/ms-lcid/a9eac961-e77d-41a6-90a5-ce1a8b0cdb9c).</span></span> <span data-ttu-id="2dcb5-127">列名遵循 [BCP 47](https://tools.ietf.org/html/bcp47) 定义的标准。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-127">Culture names follow the standard defined by [BCP 47](https://tools.ietf.org/html/bcp47).</span></span>

> [!NOTE]
> <span data-ttu-id="2dcb5-128">两字母区域性名称有一些例外，如表示中文（简体）的 `zh-Hans`。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-128">There are some exceptions for the two-letter culture names, such as `zh-Hans` for Chinese (Simplified).</span></span>

> [!NOTE]
> <span data-ttu-id="2dcb5-129">有关创建资源文件的信息，请参阅[创建资源文件](creating-resource-files-for-desktop-apps.md)和[创建附属程序集](creating-satellite-assemblies-for-desktop-apps.md)。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-129">For information about creating resource files, see [Creating Resource Files](creating-resource-files-for-desktop-apps.md) and [Creating Satellite Assemblies](creating-satellite-assemblies-for-desktop-apps.md).</span></span>

<a name="cpconpackagingdeployingresourcesanchor1"></a>

## <a name="the-resource-fallback-process"></a><span data-ttu-id="2dcb5-130">资源回退进程</span><span class="sxs-lookup"><span data-stu-id="2dcb5-130">The Resource Fallback Process</span></span>

<span data-ttu-id="2dcb5-131">用于打包和部署资源的中枢轮辐式模型可使用回退过程来定位相应的资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-131">The hub and spoke model for packaging and deploying resources uses a fallback process to locate appropriate resources.</span></span> <span data-ttu-id="2dcb5-132">如果应用程序请求不可用的已本地化资源，则公共语言运行时会在区域性层次结构中查找与用户应用程序请求最匹配的合适回退资源，并且只在最后迫不得已的情况下才引发异常。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-132">If an application requests a localized resource  that is unavailable, the common language runtime searches the hierarchy of cultures for an appropriate fallback resource that most closely matches the user's application's request, and throws an exception only as a last resort.</span></span> <span data-ttu-id="2dcb5-133">如果在层次结构的任意级别找到了合适的资源，运行时就会使用该资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-133">At each level of the hierarchy, if an appropriate resource is found, the runtime uses it.</span></span> <span data-ttu-id="2dcb5-134">如果未找到资源，则将继续在下一级别中搜索。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-134">If the resource is not found, the search continues at the next level.</span></span>

<span data-ttu-id="2dcb5-135">若要提高查找性能，可将 <xref:System.Resources.NeutralResourcesLanguageAttribute> 属性应用到主程序集，并向其传递将与主程序集一起使用的非特定语言的名称。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-135">To improve lookup performance, apply the <xref:System.Resources.NeutralResourcesLanguageAttribute> attribute to your main assembly, and pass it the name of the neutral language that will work with your main assembly.</span></span>

### <a name="net-framework-resource-fallback-process"></a><span data-ttu-id="2dcb5-136">.NET Framework 资源回退进程</span><span class="sxs-lookup"><span data-stu-id="2dcb5-136">.NET Framework resource fallback process</span></span>

<span data-ttu-id="2dcb5-137">.NET Framework 资源回退进程包含以下步骤：</span><span class="sxs-lookup"><span data-stu-id="2dcb5-137">The .NET Framework resource fallback process involves the following steps:</span></span>

> [!TIP]
> <span data-ttu-id="2dcb5-138">可以使用 [\<relativeBindForResources>](../configure-apps/file-schema/runtime/relativebindforresources-element.md) 配置元素来优化资源回退过程和运行时针对资源程序集探测所依据的过程。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-138">You may be able to use the [\<relativeBindForResources>](../configure-apps/file-schema/runtime/relativebindforresources-element.md) configuration element to optimize the resource fallback process and the process by which the runtime probes for resource assemblies.</span></span> <span data-ttu-id="2dcb5-139">有关详细信息，请参阅 [优化资源回退进程](packaging-and-deploying-resources-in-desktop-apps.md#Optimizing)一节。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-139">For more information, see the [Optimizing the Resource Fallback Process](packaging-and-deploying-resources-in-desktop-apps.md#Optimizing) section.</span></span>

1. <span data-ttu-id="2dcb5-140">运行时首先检查[全局程序集缓存](../app-domains/gac.md)，找到与为应用程序请求的区域性匹配的程序集。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-140">The runtime first checks the [global assembly cache](../app-domains/gac.md) for an assembly that matches the requested culture for your application.</span></span>

     <span data-ttu-id="2dcb5-141">全局程序集缓存可存储由许多应用程序共享的资源程序集。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-141">The global assembly cache can store resource assemblies that are shared by many applications.</span></span> <span data-ttu-id="2dcb5-142">这使你无需在创建的每个应用程序的目录结构中包括特定的资源集。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-142">This frees you from having to include specific sets of resources in the directory structure of every application you create.</span></span> <span data-ttu-id="2dcb5-143">如果运行时找到了对程序集的引用，它将搜索程序集，查找请求的资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-143">If the runtime finds a reference to the assembly, it searches the assembly for the requested resource.</span></span> <span data-ttu-id="2dcb5-144">如果在程序集中找到了该项，则使用请求的资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-144">If it finds the entry in the assembly, it uses the requested resource.</span></span> <span data-ttu-id="2dcb5-145">如果找不到该项，将继续搜索。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-145">If it doesn't find the entry, it continues the search.</span></span>

2. <span data-ttu-id="2dcb5-146">接下来，运行时将检查当前正在执行程序集的目录，查找与请求的区域性匹配的子目录。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-146">The runtime next checks the directory of the currently executing assembly for a subdirectory that matches the requested culture.</span></span> <span data-ttu-id="2dcb5-147">如果找到该子目录，它将搜索该子目录以找到请求的区域性的有效附属程序集。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-147">If it finds the subdirectory, it searches that subdirectory for a valid satellite assembly for the requested culture.</span></span> <span data-ttu-id="2dcb5-148">然后，运行时将搜索附属程序集，寻找请求的资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-148">The runtime then searches the satellite assembly for the requested resource.</span></span> <span data-ttu-id="2dcb5-149">如果在程序集中找到该资源，则使用它。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-149">If it finds the resource in the assembly, it uses it.</span></span> <span data-ttu-id="2dcb5-150">如果找不到该资源，将继续搜索。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-150">If it doesn't find the resource, it continues the search.</span></span>

3. <span data-ttu-id="2dcb5-151">接下来，运行时将查询 Windows Installer，以确定是否要按需安装附属程序集。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-151">The runtime next queries the Windows Installer to determine whether the satellite assembly is to be installed on demand.</span></span> <span data-ttu-id="2dcb5-152">如果是，它将处理安装，加载程序集，以及搜索它或搜索请求的资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-152">If so, it handles the installation, loads the assembly, and searches it or the requested resource.</span></span> <span data-ttu-id="2dcb5-153">如果在程序集中找到该资源，则使用它。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-153">If it finds the resource in the assembly, it uses it.</span></span> <span data-ttu-id="2dcb5-154">如果找不到该资源，将继续搜索。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-154">If it doesn't find the resource, it continues the search.</span></span>

4. <span data-ttu-id="2dcb5-155">运行时引发 <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> 事件以指示找不到附属程序集。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-155">The runtime raises the <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> event to indicate that it is unable to find the satellite assembly.</span></span> <span data-ttu-id="2dcb5-156">如果选择对事件进行处理，事件处理程序可以返回对其资源将用于查找的附属程序集的引用。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-156">If you choose to handle the event, your event handler can return a reference to the satellite assembly whose resources will be used for the lookup.</span></span> <span data-ttu-id="2dcb5-157">否则，事件处理程序将返回 `null`，搜索继续。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-157">Otherwise, the event handler returns `null` and the search continues.</span></span>

5. <span data-ttu-id="2dcb5-158">接下来，运行时将再次搜索全局程序集缓存，这次是为了请求的区域性的父程序集。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-158">The runtime next searches the global assembly cache again, this time for the parent assembly of the requested culture.</span></span> <span data-ttu-id="2dcb5-159">如果全局程序集缓存中存在父程序集，运行时将搜索程序集，寻找请求的资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-159">If the parent assembly exists in the global assembly cache, the runtime searches the assembly for the requested resource.</span></span>

     <span data-ttu-id="2dcb5-160">父区域性被定义为合适的回退区域性。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-160">The parent culture is defined as the appropriate fallback culture.</span></span> <span data-ttu-id="2dcb5-161">将父区域性视为回退候选项，因为提供任何资源都比引发异常更可取。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-161">Consider parents as fallback candidates, because providing any resource is preferable to throwing an exception.</span></span> <span data-ttu-id="2dcb5-162">此过程还允许重复使用资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-162">This process also allows you to reuse resources.</span></span> <span data-ttu-id="2dcb5-163">仅当子无需本地化所请求的资源时，才应在父级别包含特定资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-163">You should include a particular resource at the parent level only if the child culture doesn't need to localize the requested resource.</span></span> <span data-ttu-id="2dcb5-164">例如，如果提供 `en`（非特定英语）的附属程序集：`en-GB`（英国英语）和 `en-US`（美国英语），则 `en` 附属程序集应包含公共术语，并且 `en-GB` 和 `en-US` 附属程序集可能只对那些不同的术语提供替代项。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-164">For example, if you supply satellite assemblies for `en` (neutral English), `en-GB` (English as spoken in the United Kingdom), and `en-US` (English as spoken in the United States), the `en` satellite would contain the common terminology, and the `en-GB` and `en-US` satellites could provide overrides for only those terms that differ.</span></span>

6. <span data-ttu-id="2dcb5-165">接下来，运行时将检查当前正在执行程序集的目录，查看是否包含父目录。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-165">The runtime next checks the directory of the currently executing assembly to see if it contains a parent directory.</span></span> <span data-ttu-id="2dcb5-166">如果存在父目录，则运行时将搜索该目录，寻找父区域性的有效附属程序集。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-166">If a parent directory exists, the runtime searches the directory for a valid satellite assembly for the parent culture.</span></span> <span data-ttu-id="2dcb5-167">如果找到该程序集，运行时将搜索程序集，寻找请求的资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-167">If it finds the assembly, the runtime searches the assembly for the requested resource.</span></span> <span data-ttu-id="2dcb5-168">如果找到该资源，则使用它。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-168">If it finds the resource, it uses it.</span></span> <span data-ttu-id="2dcb5-169">如果找不到该资源，将继续搜索。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-169">If it doesn't find the resource, it continues the search.</span></span>

7. <span data-ttu-id="2dcb5-170">接下来，运行时将查询 Windows Installer，以确定是否要按需安装父级附属程序集。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-170">The runtime next queries the Windows Installer to determine whether the parent satellite assembly is to be installed on demand.</span></span> <span data-ttu-id="2dcb5-171">如果是，它将处理安装，加载程序集，以及搜索它或搜索请求的资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-171">If so, it handles the installation, loads the assembly, and searches it or the requested resource.</span></span> <span data-ttu-id="2dcb5-172">如果在程序集中找到该资源，则使用它。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-172">If it finds the resource in the assembly, it uses it.</span></span> <span data-ttu-id="2dcb5-173">如果找不到该资源，将继续搜索。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-173">If it doesn't find the resource, it continues the search.</span></span>

8. <span data-ttu-id="2dcb5-174">运行时引发 <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> 事件以指示找不到合适的回退资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-174">The runtime raises the <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> event to indicate that it is unable to find an appropriate fallback resource.</span></span> <span data-ttu-id="2dcb5-175">如果选择对事件进行处理，事件处理程序可以返回对其资源将用于查找的附属程序集的引用。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-175">If you choose to handle the event, your event handler can return a reference to the satellite assembly whose resources will be used for the lookup.</span></span> <span data-ttu-id="2dcb5-176">否则，事件处理程序将返回 `null`，搜索继续。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-176">Otherwise, the event handler returns `null` and the search continues.</span></span>

9. <span data-ttu-id="2dcb5-177">接下来，如前前面三个步骤所述，运行时将通过许多可能的级别搜索父程序集。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-177">The runtime next searches parent assemblies, as in the previous three steps, through many potential levels.</span></span> <span data-ttu-id="2dcb5-178">每个区域性只有一个父区域性（由 <xref:System.Globalization.CultureInfo.Parent%2A?displayProperty=nameWithType> 属性定义），但一个父区域性可能还有其自己的父区域性。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-178">Each culture has only one parent, which is defined by the <xref:System.Globalization.CultureInfo.Parent%2A?displayProperty=nameWithType> property, but a parent might have its own parent.</span></span> <span data-ttu-id="2dcb5-179">如果区域性的 <xref:System.Globalization.CultureInfo.Parent%2A> 属性返回 <xref:System.Globalization.CultureInfo.InvariantCulture%2A?displayProperty=nameWithType>，父区域性搜索将停止；对于资源回退，固定区域性不被视为父区域性，也不被视为具有资源的区域性。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-179">The search for parent cultures stops when a culture's <xref:System.Globalization.CultureInfo.Parent%2A> property returns <xref:System.Globalization.CultureInfo.InvariantCulture%2A?displayProperty=nameWithType>; for resource fallback, the invariant culture is not considered a parent culture or a culture that can have resources.</span></span>

10. <span data-ttu-id="2dcb5-180">如果区域性是最初指定的，且已搜索所有父级，但仍未找到资源，则使用默认（回退）区域性的资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-180">If the culture that was originally specified and all parents have been searched and the resource is still not found, the resource for the default (fallback) culture is used.</span></span> <span data-ttu-id="2dcb5-181">通常，默认区域性的资源包含在主应用程序集中。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-181">Typically, the resources for the default culture are included in the main application assembly.</span></span> <span data-ttu-id="2dcb5-182">但是，可指定 <xref:System.Resources.NeutralResourcesLanguageAttribute> 特性的 <xref:System.Resources.NeutralResourcesLanguageAttribute.Location%2A> 属性的值为 <xref:System.Resources.UltimateResourceFallbackLocation.Satellite>，以指定资源的最终回退位置是附属程序集，而不是主程序集。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-182">However, you can specify a value of <xref:System.Resources.UltimateResourceFallbackLocation.Satellite> for the <xref:System.Resources.NeutralResourcesLanguageAttribute.Location%2A> property of the <xref:System.Resources.NeutralResourcesLanguageAttribute> attribute to indicate that the ultimate fallback location for resources is a satellite assembly, rather than the main assembly.</span></span>

    > [!NOTE]
    > <span data-ttu-id="2dcb5-183">默认资源是唯一可与主程序集一起编译的资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-183">The default resource is the only resource that can be compiled with the main assembly.</span></span> <span data-ttu-id="2dcb5-184">除非通过使用 <xref:System.Resources.NeutralResourcesLanguageAttribute> 属性指定附属程序集，否则为最终回退（最终父级）。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-184">Unless you specify a satellite assembly by using the <xref:System.Resources.NeutralResourcesLanguageAttribute> attribute, it is the ultimate fallback (final parent).</span></span> <span data-ttu-id="2dcb5-185">因此，建议在主程序集中始终包含一组默认资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-185">Therefore, we recommend that you always include a default set of resources in your main assembly.</span></span> <span data-ttu-id="2dcb5-186">这有助于防止引发异常。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-186">This helps prevent exceptions from being thrown.</span></span> <span data-ttu-id="2dcb5-187">通过包含默认资源文件，可为所有资源提供回退，并确保始终向用户呈现至少一种资源，即使该资源不是特定于区域性的。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-187">By including a default resource, file you provide a fallback for all resources and ensure that at least one resource is always present for the user, even if it is not culturally specific.</span></span>

11. <span data-ttu-id="2dcb5-188">最后，如果运行时找不到默认（回退）区域性的资源，将引发 <xref:System.Resources.MissingManifestResourceException> 或 <xref:System.Resources.MissingSatelliteAssemblyException> 异常，指示找不到该资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-188">Finally, if the runtime doesn't find a resource for a default (fallback) culture, a <xref:System.Resources.MissingManifestResourceException> or <xref:System.Resources.MissingSatelliteAssemblyException> exception is thrown to indicate that the resource could not be found.</span></span>

<span data-ttu-id="2dcb5-189">例如，假定应用程序请求本地化为墨西哥西班牙语（`es-MX` 区域性）所需的资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-189">For example, suppose the application requests a resource localized for Spanish (Mexico) (the `es-MX` culture).</span></span> <span data-ttu-id="2dcb5-190">运行时将首先搜索全局程序集缓存，寻找匹配 `es-MX` 的程序集，但找不到。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-190">The runtime first searches the global assembly cache for the assembly that matches `es-MX`, but doesn't find it.</span></span> <span data-ttu-id="2dcb5-191">然后，运行时将搜索当前正在执行的程序集，寻找 `es-MX` 目录。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-191">The runtime then searches the directory of the currently executing assembly for an `es-MX` directory.</span></span> <span data-ttu-id="2dcb5-192">如果失败，运行时将再次搜索全局程序集缓存，寻找反映相应回退区域性的父程序集 — 在本例中为 `es`（西班牙语）。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-192">Failing that, the runtime searches the global assembly cache again for a parent assembly that reflects the appropriate fallback culture — in this case, `es` (Spanish).</span></span> <span data-ttu-id="2dcb5-193">如果找不到父程序集，运行时将针对 `es-MX` 区域性搜索父程序集的所有可能级别，直到它找到对应的资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-193">If the parent assembly is not found, the runtime searches all potential levels of parent assemblies for the `es-MX` culture until it finds a corresponding resource.</span></span> <span data-ttu-id="2dcb5-194">如果找不到资源，运行时将使用默认区域性的资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-194">If a resource isn't found, the runtime uses the resource for the default culture.</span></span>

<a name="Optimizing"></a>

#### <a name="optimizing-the-net-framework-resource-fallback-process"></a><span data-ttu-id="2dcb5-195">优化 .NET Framework 资源回退进程</span><span class="sxs-lookup"><span data-stu-id="2dcb5-195">Optimizing the .NET Framework Resource Fallback Process</span></span>

<span data-ttu-id="2dcb5-196">在下列情况下，可以按运行时搜索附属程序集中的资源所依据的内容优化进程</span><span class="sxs-lookup"><span data-stu-id="2dcb5-196">Under the following conditions, you can optimize the process by which the runtime searches for resources in satellite assemblies</span></span>

- <span data-ttu-id="2dcb5-197">附属程序集部署在与代码程序集相同的位置。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-197">Satellite assemblies are deployed in the same location as the code assembly.</span></span> <span data-ttu-id="2dcb5-198">如果代码程序集安装在[全局程序集缓存](../app-domains/gac.md)中，则附属程序集也会安装到全局程序集缓存中。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-198">If the code assembly is installed in the [Global Assembly Cache](../app-domains/gac.md), satellite assemblies are also installed in the global assembly cache.</span></span> <span data-ttu-id="2dcb5-199">如果代码程序集安装在一个目录中，则附属程序集安装在该目录的特定于区域性的文件夹中。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-199">If the code assembly is installed in a directory, satellite assemblies are installed in culture-specific folders of that directory.</span></span>

- <span data-ttu-id="2dcb5-200">附属程序集不会按需进行安装。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-200">Satellite assemblies are not installed on demand.</span></span>

- <span data-ttu-id="2dcb5-201">应用程序代码不会处理 <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> 事件。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-201">Application code does not handle the <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> event.</span></span>

<span data-ttu-id="2dcb5-202">可通过在应用程序配置文件中包含 [\<relativeBindForResources>](../configure-apps/file-schema/runtime/relativebindforresources-element.md) 元素并将其 `enabled` 属性设为 `true`，优化附属程序集探测，如下例所示。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-202">You optimize the probe for satellite assemblies by including the [\<relativeBindForResources>](../configure-apps/file-schema/runtime/relativebindforresources-element.md) element and setting its `enabled` attribute to `true` in the application configuration file, as shown in the following example.</span></span>

```xml
<configuration>
   <runtime>
      <relativeBindForResources enabled="true" />
   </runtime>
</configuration>
```

<span data-ttu-id="2dcb5-203">优化的附属程序集探测是选择加入功能。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-203">The optimized probe for satellite assemblies is an opt-in feature.</span></span> <span data-ttu-id="2dcb5-204">也就是说，运行时遵循[资源回退过程](packaging-and-deploying-resources-in-desktop-apps.md#cpconpackagingdeployingresourcesanchor1)中记录的步骤，除非 [\<relativeBindForResources>](../configure-apps/file-schema/runtime/relativebindforresources-element.md) 元素位于应用程序的配置文件中，并且其 `enabled` 属性已设为 `true`。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-204">That is, the runtime follows the steps documented in [The Resource Fallback Process](packaging-and-deploying-resources-in-desktop-apps.md#cpconpackagingdeployingresourcesanchor1) unless the [\<relativeBindForResources>](../configure-apps/file-schema/runtime/relativebindforresources-element.md) element is present in the application's configuration file and its `enabled` attribute is set to `true`.</span></span> <span data-ttu-id="2dcb5-205">如果出现这种情况，附属程序集探测过程将进行如下修改：</span><span class="sxs-lookup"><span data-stu-id="2dcb5-205">If this is the case, the process of probing for a satellite assembly is modified as follows:</span></span>

- <span data-ttu-id="2dcb5-206">运行时使用父代码程序集位置来探测附属程序集。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-206">The runtime uses the location of the parent code assembly to probe for the satellite assembly.</span></span> <span data-ttu-id="2dcb5-207">如果父程序集安装在全局程序集缓存中，则运行时在缓存，而不是在应用程序的目录中探测。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-207">If the parent assembly is installed in the global assembly cache, the runtime probes in the cache but not in the application's directory.</span></span> <span data-ttu-id="2dcb5-208">如果父程序集安装在应用程序目录中，则运行时在应用程序目录，而不是在全局程序集缓存中探测。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-208">If the parent assembly is installed in an application directory, the runtime probes in the application directory but not in the global assembly cache.</span></span>

- <span data-ttu-id="2dcb5-209">运行时不会查询 Windows Installer，寻找附属程序集的按需安装。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-209">The runtime doesn't query the Windows Installer for on-demand installation of satellite assemblies.</span></span>

- <span data-ttu-id="2dcb5-210">如果特定资源程序集探测失败，运行时将不会引发 <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> 事件。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-210">If the probe for a particular resource assembly fails, the runtime does not raise the <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> event.</span></span>

### <a name="net-core-resource-fallback-process"></a><span data-ttu-id="2dcb5-211">.NET Core 资源回退进程</span><span class="sxs-lookup"><span data-stu-id="2dcb5-211">.NET Core resource fallback process</span></span>

<span data-ttu-id="2dcb5-212">.NET Core 资源回退进程包含以下步骤：</span><span class="sxs-lookup"><span data-stu-id="2dcb5-212">The .NET Core resource fallback process involves the following steps:</span></span>

1. <span data-ttu-id="2dcb5-213">运行时尝试加载请求的区域性的附属程序集。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-213">The runtime attempts to load a satellite assembly for the requested culture.</span></span>
     - <span data-ttu-id="2dcb5-214">检查当前正在执行程序集的目录，查找与请求的区域性匹配的子目录。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-214">Checks the directory of the currently executing assembly for a subdirectory that matches the requested culture.</span></span> <span data-ttu-id="2dcb5-215">如果找到该子目录，它将搜索该子目录以找到请求的区域性的有效附属程序集并加载该程序集。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-215">If it finds the subdirectory, it searches that subdirectory for a valid satellite assembly for the requested culture and loads it.</span></span>

       > [!NOTE]
       > <span data-ttu-id="2dcb5-216">在具有区分大小写的文件系统（即 Linux 和 macOS）的操作系统上，区域性名称子目录搜索区分大小写。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-216">On operating systems with case-sensitive file systems (that is, Linux and macOS), the culture name subdirectory search is case-sensitive.</span></span> <span data-ttu-id="2dcb5-217">子目录名称必须与 <xref:System.Globalization.CultureInfo.Name?displayProperty=nameWithType> 的大小写完全匹配（例如，`es` 或 `es-MX`）。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-217">The subdirectory name must exactly match the case of the <xref:System.Globalization.CultureInfo.Name?displayProperty=nameWithType> (for example, `es` or `es-MX`).</span></span>

       > [!NOTE]
       > <span data-ttu-id="2dcb5-218">如果程序员从 <xref:System.Runtime.Loader.AssemblyLoadContext> 派生了自定义程序集加载上下文，则情况会很复杂。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-218">If the programmer has derived a custom assembly load context from <xref:System.Runtime.Loader.AssemblyLoadContext>, the situation is complicated.</span></span> <span data-ttu-id="2dcb5-219">如果将正在执行程序集加载到自定义上下文中，则运行时会将附属程序集加载到自定义上下文中。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-219">If the executing assembly was loaded into the custom context, the runtime loads the satellite assembly into the custom context.</span></span> <span data-ttu-id="2dcb5-220">相关详细信息超出了本文档所涉及的范围。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-220">The details are out of scope for this document.</span></span> <span data-ttu-id="2dcb5-221">请参阅<xref:System.Runtime.Loader.AssemblyLoadContext>。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-221">See  <xref:System.Runtime.Loader.AssemblyLoadContext>.</span></span>

     - <span data-ttu-id="2dcb5-222">如果未找到附属程序集，<xref:System.Runtime.Loader.AssemblyLoadContext> 引发 <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving?displayProperty=nameWithType> 事件以指示找不到附属程序集。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-222">If a satellite assemble has not been found, the <xref:System.Runtime.Loader.AssemblyLoadContext> raises the <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving?displayProperty=nameWithType> event to indicate that it is unable to find the satellite assembly.</span></span> <span data-ttu-id="2dcb5-223">如果选择对事件进行处理，事件处理程序可以加载引用并返回对附属程序集的引用。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-223">If you choose to handle the event, your event handler can load and return a reference to the satellite assembly.</span></span>
     - <span data-ttu-id="2dcb5-224">如果仍未找到附属程序集，则 AssemblyLoadContext 会导致 AppDomain 触发 <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> 事件以指示找不到附属程序集。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-224">If a satellite assembly still has not been found, the AssemblyLoadContext causes the AppDomain to trigger an <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> event to indicate that it is unable to find the satellite assembly.</span></span> <span data-ttu-id="2dcb5-225">如果选择对事件进行处理，事件处理程序可以加载引用并返回对附属程序集的引用。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-225">If you choose to handle the event, your event handler can load and return a reference to the satellite assembly.</span></span>

2. <span data-ttu-id="2dcb5-226">如果找到附属程序集，则运行时将搜索请求的资源的附属程序集。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-226">If a satellite assembly is found, the runtime searches it for the requested resource.</span></span> <span data-ttu-id="2dcb5-227">如果在程序集中找到该资源，则使用它。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-227">If it finds the resource in the assembly, it uses it.</span></span> <span data-ttu-id="2dcb5-228">如果找不到该资源，将继续搜索。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-228">If it doesn't find the resource, it continues the search.</span></span>

     > [!NOTE]
     > <span data-ttu-id="2dcb5-229">要在附属程序集中查找资源，运行时将搜索 <xref:System.Resources.ResourceManager> 为当前 <xref:System.Globalization.CultureInfo.Name?displayProperty=nameWithType> 请求的资源文件。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-229">To find a resource within the satellite assembly, the runtime searches for the resource file requested by the <xref:System.Resources.ResourceManager> for the current <xref:System.Globalization.CultureInfo.Name?displayProperty=nameWithType>.</span></span> <span data-ttu-id="2dcb5-230">在资源文件中，它搜索所请求的资源名称。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-230">Within the resource file it searches for the requested resource name.</span></span> <span data-ttu-id="2dcb5-231">如果找不到上述任何一个，则资源将被视为未找到。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-231">If either is not found, the resource is treated as not found.</span></span>

3. <span data-ttu-id="2dcb5-232">接下来，运行时通过许多潜在级别搜索父区域性程序集，每次均重复步骤 1 和 2。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-232">The runtime next searches the parent culture assemblies through many potential levels, each time repeating steps 1 & 2.</span></span>

     <span data-ttu-id="2dcb5-233">父区域性被定义为合适的回退区域性。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-233">The parent culture is defined as an appropriate fallback culture.</span></span> <span data-ttu-id="2dcb5-234">将父区域性视为回退候选项，因为提供任何资源都比引发异常更可取。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-234">Consider parents as fallback candidates, because providing any resource is preferable to throwing an exception.</span></span> <span data-ttu-id="2dcb5-235">此过程还允许重复使用资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-235">This process also allows you to reuse resources.</span></span> <span data-ttu-id="2dcb5-236">仅当子无需本地化所请求的资源时，才应在父级别包含特定资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-236">You should include a particular resource at the parent level only if the child culture doesn't need to localize the requested resource.</span></span> <span data-ttu-id="2dcb5-237">例如，如果提供 `en`（非特定英语）的附属程序集：`en-GB`（英国英语）和 `en-US`（美国英语），则 `en` 附属程序集应包含公共术语，并且 `en-GB` 和 `en-US` 附属程序集只对那些不同的术语提供替代项。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-237">For example, if you supply satellite assemblies for `en` (neutral English), `en-GB` (English as spoken in the United Kingdom), and `en-US` (English as spoken in the United States), the `en` satellite contains the common terminology, and the `en-GB` and `en-US` satellites provides overrides for only those terms that differ.</span></span>

     <span data-ttu-id="2dcb5-238">每个区域性只有一个父区域性（由 <xref:System.Globalization.CultureInfo.Parent%2A?displayProperty=nameWithType> 属性定义），但一个父区域性可能还有其自己的父区域性。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-238">Each culture has only one parent, which is defined by the <xref:System.Globalization.CultureInfo.Parent%2A?displayProperty=nameWithType> property, but a parent might have its own parent.</span></span> <span data-ttu-id="2dcb5-239">当区域性的 <xref:System.Globalization.CultureInfo.Parent%2A> 属性返回 <xref:System.Globalization.CultureInfo.InvariantCulture%2A?displayProperty=nameWithType> 时，父区域性搜索将停止。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-239">The search for parent cultures stops when a culture's <xref:System.Globalization.CultureInfo.Parent%2A> property returns <xref:System.Globalization.CultureInfo.InvariantCulture%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="2dcb5-240">对于资源回退，固定区域性不被视为父区域性，也不被视为具有资源的区域性。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-240">For resource fallback, the invariant culture is not considered a parent culture or a culture that can have resources.</span></span>

4. <span data-ttu-id="2dcb5-241">如果区域性是最初指定的，且已搜索所有父级，但仍未找到资源，则使用默认（回退）区域性的资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-241">If the culture that was originally specified and all parents have been searched and the resource is still not found, the resource for the default (fallback) culture is used.</span></span> <span data-ttu-id="2dcb5-242">通常，默认区域性的资源包含在主应用程序集中。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-242">Typically, the resources for the default culture are included in the main application assembly.</span></span> <span data-ttu-id="2dcb5-243">但是，可指定 <xref:System.Resources.NeutralResourcesLanguageAttribute.Location%2A> 属性的值为 <xref:System.Resources.UltimateResourceFallbackLocation.Satellite?displayProperty.nameWithType>，以指示资源的最终回退位置是附属程序集，而不是主程序集。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-243">However, you can specify a value of <xref:System.Resources.UltimateResourceFallbackLocation.Satellite?displayProperty.nameWithType> for the <xref:System.Resources.NeutralResourcesLanguageAttribute.Location%2A> property to indicate that the ultimate fallback location for resources is a satellite assembly rather than the main assembly.</span></span>

    > [!NOTE]
    > <span data-ttu-id="2dcb5-244">默认资源是唯一可与主程序集一起编译的资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-244">The default resource is the only resource that can be compiled with the main assembly.</span></span> <span data-ttu-id="2dcb5-245">除非通过使用 <xref:System.Resources.NeutralResourcesLanguageAttribute> 属性指定附属程序集，否则为最终回退（最终父级）。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-245">Unless you specify a satellite assembly by using the <xref:System.Resources.NeutralResourcesLanguageAttribute> attribute, it is the ultimate fallback (final parent).</span></span> <span data-ttu-id="2dcb5-246">因此，建议在主程序集中始终包含一组默认资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-246">Therefore, we recommend that you always include a default set of resources in your main assembly.</span></span> <span data-ttu-id="2dcb5-247">这有助于防止引发异常。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-247">This helps prevent exceptions from being thrown.</span></span> <span data-ttu-id="2dcb5-248">通过包含默认资源文件，可为所有资源提供回退，并确保始终向用户呈现至少一种资源，即使该资源不是特定于区域性的。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-248">By including a default resource file, you provide a fallback for all resources and ensure that at least one resource is always present for the user, even if it is not culturally specific.</span></span>

5. <span data-ttu-id="2dcb5-249">最后，如果运行时找不到默认（回退）区域性的资源文件，将引发 <xref:System.Resources.MissingManifestResourceException> 或 <xref:System.Resources.MissingSatelliteAssemblyException> 异常，指示找不到该资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-249">Finally, if the runtime doesn't find a resource file for a default (fallback) culture, a <xref:System.Resources.MissingManifestResourceException> or <xref:System.Resources.MissingSatelliteAssemblyException> exception is thrown to indicate that the resource could not be found.</span></span> <span data-ttu-id="2dcb5-250">如果找到资源文件但是请求的资源不存在，则请求返回 `null`。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-250">If the resource file is found but the requested resource is not present the request returns `null`.</span></span>

### <a name="ultimate-fallback-to-satellite-assembly"></a><span data-ttu-id="2dcb5-251">最终回退到附属程序集</span><span class="sxs-lookup"><span data-stu-id="2dcb5-251">Ultimate Fallback to Satellite Assembly</span></span>

<span data-ttu-id="2dcb5-252">可选择从主程序集中删除资源，并指定运行时应加载对应于特定区域性的附属程序集中的最终回退资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-252">You can optionally remove resources from the main assembly and specify that the runtime should load the ultimate fallback resources from a satellite assembly that corresponds to a specific culture.</span></span> <span data-ttu-id="2dcb5-253">若要控制回退进程，请使用 <xref:System.Resources.NeutralResourcesLanguageAttribute.%23ctor%28System.String%2CSystem.Resources.UltimateResourceFallbackLocation%29> 构造函数并提供 <xref:System.Resources.UltimateResourceFallbackLocation> 参数的值，用于指定 Resource Manager 是应从主程序集还是应从附属程序集中提取回退资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-253">To control the fallback process, you use the <xref:System.Resources.NeutralResourcesLanguageAttribute.%23ctor%28System.String%2CSystem.Resources.UltimateResourceFallbackLocation%29> constructor and supply a value for the <xref:System.Resources.UltimateResourceFallbackLocation> parameter that specifies whether Resource Manager should extract the fallback resources from the main assembly or from a satellite assembly.</span></span>

<span data-ttu-id="2dcb5-254">下面的 .NET Framework 示例使用 <xref:System.Resources.NeutralResourcesLanguageAttribute> 属性将应用程序回退资源存储在法语 (`fr`) 语言的附属程序集中。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-254">The following .NET Framework example uses the <xref:System.Resources.NeutralResourcesLanguageAttribute> attribute to store an application's fallback resources in a satellite assembly for the French (`fr`) language.</span></span> <span data-ttu-id="2dcb5-255">本示例介绍了两个基于文本的资源文件，这两个文件用于定义名为 `Greeting` 的单个字符串资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-255">The example has two text-based resource files that define a single string resource named `Greeting`.</span></span> <span data-ttu-id="2dcb5-256">第一个文件 resources.fr.txt 包含法语资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-256">The first, resources.fr.txt, contains a French language resource.</span></span>

```text
Greeting=Bon jour!
```

<span data-ttu-id="2dcb5-257">第二个文件 resources.ru.txt 包含俄语资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-257">The second, resources,ru.txt, contains a Russian language resource.</span></span>

```text
Greeting=Добрый день
```

<span data-ttu-id="2dcb5-258">从命令行运行[资源文件生成器 (Resgen.exe)](../tools/resgen-exe-resource-file-generator.md) 可将这两个文件编译为 .resources 文件。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-258">These two files are compiled to .resources files by running the [resource file generator (Resgen.exe)](../tools/resgen-exe-resource-file-generator.md) from the command line.</span></span> <span data-ttu-id="2dcb5-259">对于法语资源，命令为：</span><span class="sxs-lookup"><span data-stu-id="2dcb5-259">For the French language resource, the command is:</span></span>

<span data-ttu-id="2dcb5-260">resgen.exe resources.fr.txt</span><span class="sxs-lookup"><span data-stu-id="2dcb5-260">**resgen.exe resources.fr.txt**</span></span>

<span data-ttu-id="2dcb5-261">对于俄语资源，命令为：</span><span class="sxs-lookup"><span data-stu-id="2dcb5-261">For the Russian language resource, the command is:</span></span>

<span data-ttu-id="2dcb5-262">resgen.exe resources.ru.txt</span><span class="sxs-lookup"><span data-stu-id="2dcb5-262">**resgen.exe resources.ru.txt**</span></span>

<span data-ttu-id="2dcb5-263">对于法语资源，从命令行运行[程序集连接器 (Al.exe)](../tools/al-exe-assembly-linker.md)，将 .resources 文件嵌入动态链接库，如下所示：</span><span class="sxs-lookup"><span data-stu-id="2dcb5-263">The .resources files are embedded into dynamic link libraries by running [assembly linker (Al.exe)](../tools/al-exe-assembly-linker.md) from the command line for the French language resource as follows:</span></span>

<span data-ttu-id="2dcb5-264">al /t:lib /embed:resources.fr.resources /culture:fr /out:fr\Example1.resources.dll</span><span class="sxs-lookup"><span data-stu-id="2dcb5-264">**al /t:lib /embed:resources.fr.resources /culture:fr /out:fr\Example1.resources.dll**</span></span>

<span data-ttu-id="2dcb5-265">而对于俄语资源，则为如下所示：</span><span class="sxs-lookup"><span data-stu-id="2dcb5-265">and for the Russian language resource as follows:</span></span>

<span data-ttu-id="2dcb5-266">al /t:lib /embed:resources.ru.resources /culture:ru /out:ru\Example1.resources.dll</span><span class="sxs-lookup"><span data-stu-id="2dcb5-266">**al /t:lib /embed:resources.ru.resources /culture:ru /out:ru\Example1.resources.dll**</span></span>

<span data-ttu-id="2dcb5-267">应用程序源代码位于名为 Example1.cs 或 Example1.vb 的文件中。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-267">The application source code resides in a file named Example1.cs or Example1.vb.</span></span> <span data-ttu-id="2dcb5-268">它包括 <xref:System.Resources.NeutralResourcesLanguageAttribute> 属性，以指示默认应用程序资源位于 fr 子目录中。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-268">It includes the <xref:System.Resources.NeutralResourcesLanguageAttribute> attribute to indicate that the default application resource is in the fr subdirectory.</span></span> <span data-ttu-id="2dcb5-269">它可实例化 Resource Manager，检索 `Greeting` 资源的值，并将其显示到控制台。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-269">It instantiates the Resource Manager, retrieves the value of the `Greeting` resource, and displays it to the console.</span></span>

[!code-csharp[Conceptual.Resources.Packaging#1](~/samples/snippets/csharp/VS_Snippets_CLR/conceptual.resources.packaging/cs/example1.cs#1)]
[!code-vb[Conceptual.Resources.Packaging#1](~/samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.resources.packaging/vb/example1.vb#1)]

<span data-ttu-id="2dcb5-270">然后，可以从命令行编译 C# 源代码，如下所示：</span><span class="sxs-lookup"><span data-stu-id="2dcb5-270">You can then compile C# source code from the command line as follows:</span></span>

```console
csc Example1.cs
```

<span data-ttu-id="2dcb5-271">用于 Visual Basic 编译器的命令十分相似：</span><span class="sxs-lookup"><span data-stu-id="2dcb5-271">The command for the Visual Basic compiler is very similar:</span></span>

```console
vbc Example1.vb
```

<span data-ttu-id="2dcb5-272">由于没有嵌入在主程序集中的资源，因此无需使用 `/resource` 切换进行编译。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-272">Because there are no resources embedded in the main assembly, you do not have to compile by using the `/resource` switch.</span></span>

<span data-ttu-id="2dcb5-273">当从不是俄语的任何系统运行示例时，它将显示以下输出：</span><span class="sxs-lookup"><span data-stu-id="2dcb5-273">When you run the example from a system whose language is anything other than Russian, it displays the following output:</span></span>

```output
Bon jour!
```

## <a name="suggested-packaging-alternative"></a><span data-ttu-id="2dcb5-274">建议的打包替代项</span><span class="sxs-lookup"><span data-stu-id="2dcb5-274">Suggested Packaging Alternative</span></span>

<span data-ttu-id="2dcb5-275">由于时间或预算约束，可能无法为应用程序支持的每个子区域性均创建一组资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-275">Time or budget constraints might prevent you from creating a set of resources for every subculture that your application supports.</span></span> <span data-ttu-id="2dcb5-276">但可以为所有相关子区域性可用的父区域性创建单个附属程序集。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-276">Instead, you can create a single satellite assembly for a parent culture that all related subcultures can use.</span></span> <span data-ttu-id="2dcb5-277">例如，可以提供单个英语附属程序集 (en)，请求特定于区域的英语资源的用户将检索该程序集，并且为请求特定于区域的德语资源的用户创建单个德语附属程序集 (de)。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-277">For example, you can provide a single English satellite assembly (en) that is retrieved by users who request region-specific English resources, and a single German satellite assembly (de) for users who request region-specific German resources.</span></span> <span data-ttu-id="2dcb5-278">例如，对德国德语 (de-DE)、奥地利德语 (de-AT) 和瑞士德语 (de-CH) 的请求均会回退到德语附属程序集 (de)。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-278">For example, requests for German as spoken in Germany (de-DE), Austria (de-AT), and Switzerland (de-CH) would fall back to the German satellite assembly (de).</span></span> <span data-ttu-id="2dcb5-279">默认资源是最终回退资源，因而应是大多数应用程序用户将请求的资源，因此应仔细选择这些资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-279">The default resources are the final fallback and therefore should be the resources that will be requested by the majority of your application's users, so choose these resources carefully.</span></span> <span data-ttu-id="2dcb5-280">此方法可部署区域性特定性较低，但可显著减少应用程序本地化成本的资源。</span><span class="sxs-lookup"><span data-stu-id="2dcb5-280">This approach deploys resources that are less culturally specific, but can significantly reduce your application's localization costs.</span></span>

## <a name="see-also"></a><span data-ttu-id="2dcb5-281">请参阅</span><span class="sxs-lookup"><span data-stu-id="2dcb5-281">See also</span></span>

- [<span data-ttu-id="2dcb5-282">桌面应用中的资源</span><span class="sxs-lookup"><span data-stu-id="2dcb5-282">Resources in Desktop Apps</span></span>](index.md)
- [<span data-ttu-id="2dcb5-283">全局程序集缓存</span><span class="sxs-lookup"><span data-stu-id="2dcb5-283">Global Assembly Cache</span></span>](../app-domains/gac.md)
- [<span data-ttu-id="2dcb5-284">创建资源文件</span><span class="sxs-lookup"><span data-stu-id="2dcb5-284">Creating Resource Files</span></span>](creating-resource-files-for-desktop-apps.md)
- [<span data-ttu-id="2dcb5-285">创建附属程序集</span><span class="sxs-lookup"><span data-stu-id="2dcb5-285">Creating Satellite Assemblies</span></span>](creating-satellite-assemblies-for-desktop-apps.md)
