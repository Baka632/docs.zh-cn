---
title: 代码访问安全性
description: 了解 .NET 中的代码访问安全机制，此机制可帮助保护计算机系统免受恶意移动代码的攻击。
ms.date: 03/30/2017
helpviewer_keywords:
- named permission sets, code access security
- call stacks
- malicious code
- stack walk
- security [.NET Framework], code access security
- permissions [.NET Framework], code access security
- trusted code
- mobile code security
- unmanaged code, code access security
- granting permissions, code access security
- user authentication, code access security
- code access security
ms.assetid: 859af632-c80d-4736-8d6f-1e01b09ce127
ms.openlocfilehash: 6fa7983d0355a9e11728f8dbd0f4e06bbb0f8e5b
ms.sourcegitcommit: 97ce5363efa88179dd76e09de0103a500ca9b659
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 07/13/2020
ms.locfileid: "86281636"
---
# <a name="code-access-security"></a><span data-ttu-id="be2be-103">代码访问安全性</span><span class="sxs-lookup"><span data-stu-id="be2be-103">Code Access Security</span></span>
[!INCLUDE[net_security_note](../../../includes/net-security-note-md.md)]  
  
 <span data-ttu-id="be2be-104">当今高度连接的计算机系统频繁地暴露来自各种可能未知源的代码中。</span><span class="sxs-lookup"><span data-stu-id="be2be-104">Today's highly connected computer systems are frequently exposed to code originating from various, possibly unknown sources.</span></span> <span data-ttu-id="be2be-105">可以将代码附加到电子邮件，包含在文档中或通过 Internet 下载。</span><span class="sxs-lookup"><span data-stu-id="be2be-105">Code can be attached to email, contained in documents, or downloaded over the Internet.</span></span> <span data-ttu-id="be2be-106">不幸的是，许多计算机用户都亲身经历了恶意移动代码（包括病毒和蠕虫）所带来的影响，这些代码可能损坏或破坏数据、花费时间和资金。</span><span class="sxs-lookup"><span data-stu-id="be2be-106">Unfortunately, many computer users have experienced firsthand the effects of malicious mobile code, including viruses and worms, which can damage or destroy data and cost time and money.</span></span>  
  
 <span data-ttu-id="be2be-107">最常见的安全机制是根据用户的登录凭据（通常为密码）授予用户权限，以及限制允许用户访问的资源（通常为目录和文件）。</span><span class="sxs-lookup"><span data-stu-id="be2be-107">Most common security mechanisms give rights to users based on their logon credentials (usually a password) and restrict resources (often directories and files) that the user is allowed to access.</span></span> <span data-ttu-id="be2be-108">然而，这种方法无法解决以下几个问题：用户从许多来源获取代码，其中一些来源可能不可靠；代码包含 bug 或漏洞，被恶意代码所利用；代码有时会执行一些用户不知道的操作。</span><span class="sxs-lookup"><span data-stu-id="be2be-108">However, this approach fails to address several issues: users obtain code from many sources, some of which might be unreliable; code can contain bugs or vulnerabilities that enable it to be exploited by malicious code; and code sometimes does things that the user does not know it will do.</span></span> <span data-ttu-id="be2be-109">因此，当谨慎且值得信赖的用户运行恶意或有错的软件时，计算机系统可能会受到损坏并泄露私有数据。</span><span class="sxs-lookup"><span data-stu-id="be2be-109">As a result, computer systems can be damaged and private data can be leaked when cautious and trustworthy users run malicious or error-filled software.</span></span> <span data-ttu-id="be2be-110">大多数操作系统安全机制要求每一段代码必须完全可信方能运行（Web 页面上的脚本除外）。</span><span class="sxs-lookup"><span data-stu-id="be2be-110">Most operating system security mechanisms require that every piece of code must be completely trusted in order to run, except perhaps for scripts on a Web page.</span></span> <span data-ttu-id="be2be-111">因此，仍需要一个广泛适用的安全机制来允许源自一个计算机系统的代码在另一个系统中受保护运行，即使这两个系统之间没有信任关系。</span><span class="sxs-lookup"><span data-stu-id="be2be-111">Therefore, there is still a need for a widely applicable security mechanism that allows code originating from one computer system to execute with protection on another system, even when there is no trust relationship between the systems.</span></span>  
  
 <span data-ttu-id="be2be-112">.NET Framework 提供了一种安全机制，称为代码访问安全性。该机制可帮助保护计算机系统免受恶意移动代码的侵害，允许来自未知源的代码在实施保护的情况下运行，并帮助防止受信任的代码免受有意或无意安全性折损影响。</span><span class="sxs-lookup"><span data-stu-id="be2be-112">The .NET Framework provides a security mechanism called code access security to help protect computer systems from malicious mobile code, to allow code from unknown origins to run with protection, and to help prevent trusted code from intentionally or accidentally compromising security.</span></span> <span data-ttu-id="be2be-113">代码访问安全性使代码可以根据它所来自的位置以及代码标识的其他方面，获得不同等级的受信度。</span><span class="sxs-lookup"><span data-stu-id="be2be-113">Code access security enables code to be trusted to varying degrees depending on where the code originates and on other aspects of the code's identity.</span></span> <span data-ttu-id="be2be-114">代码访问安全性还对代码强制实施不同的信任级别，从而最大程度地减少必须完全可信方能运行的代码数量。</span><span class="sxs-lookup"><span data-stu-id="be2be-114">Code access security also enforces the varying levels of trust on code, which minimizes the amount of code that must be fully trusted in order to run.</span></span> <span data-ttu-id="be2be-115">使用代码访问安全性可以降低恶意或有错代码滥用代码的可能性。</span><span class="sxs-lookup"><span data-stu-id="be2be-115">Using code access security can reduce the likelihood that your code will be misused by malicious or error-filled code.</span></span> <span data-ttu-id="be2be-116">它可以减少责任，因为你可以指定允许代码执行的操作。</span><span class="sxs-lookup"><span data-stu-id="be2be-116">It can reduce your liability, because you can specify the set of operations your code should be allowed to perform.</span></span> <span data-ttu-id="be2be-117">代码访问安全性还可以最大程度地减少代码安全漏洞所产生的损害。</span><span class="sxs-lookup"><span data-stu-id="be2be-117">Code access security can also help minimize the damage that can result from security vulnerabilities in your code.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="be2be-118">已对 .NET Framework 4 中的代码访问安全性进行了重大更改。</span><span class="sxs-lookup"><span data-stu-id="be2be-118">Major changes have been made to code access security in the .NET Framework 4.</span></span> <span data-ttu-id="be2be-119">最值得注意的更改是[安全透明](security-transparent-code.md)的，但也有其他重大更改会影响代码访问安全性。</span><span class="sxs-lookup"><span data-stu-id="be2be-119">The most notable change has been [security transparency](security-transparent-code.md), but there are also other significant changes that affect code access security.</span></span> <span data-ttu-id="be2be-120">有关这些更改的信息，请参阅[安全更改](https://docs.microsoft.com/previous-versions/dotnet/framework/security/security-changes)。</span><span class="sxs-lookup"><span data-stu-id="be2be-120">For information about these changes, see [Security Changes](https://docs.microsoft.com/previous-versions/dotnet/framework/security/security-changes).</span></span>  
  
 <span data-ttu-id="be2be-121">代码访问安全性主要影响库代码和部分受信任的应用程序。</span><span class="sxs-lookup"><span data-stu-id="be2be-121">Code access security primarily affects library code and partially trusted applications.</span></span> <span data-ttu-id="be2be-122">库开发人员必须防止部分受信任的应用程序在未经授权的情况下访问其代码。</span><span class="sxs-lookup"><span data-stu-id="be2be-122">Library developers must protect their code from unauthorized access from partially trusted applications.</span></span> <span data-ttu-id="be2be-123">部分受信任的应用程序是从外部源（如 Internet）中加载的应用程序。</span><span class="sxs-lookup"><span data-stu-id="be2be-123">Partially trusted applications are applications that are loaded from external sources such as the Internet.</span></span> <span data-ttu-id="be2be-124">台式机或本地局域网中安装的应用程序完全受信任并可运行。</span><span class="sxs-lookup"><span data-stu-id="be2be-124">Applications that are installed on your desktop or on the local intranet run in full trust.</span></span> <span data-ttu-id="be2be-125">完全信任的应用程序不受代码访问安全性的影响，除非它们被标记为[安全透明](security-transparent-code.md)，因为这些应用程序完全受信任。</span><span class="sxs-lookup"><span data-stu-id="be2be-125">Full-trust applications are not affected by code access security unless they are marked as [security-transparent](security-transparent-code.md), because they are fully trusted.</span></span> <span data-ttu-id="be2be-126">完全受信任应用程序的唯一限制是，标记有 <xref:System.Security.SecurityTransparentAttribute> 特性的应用程序无法调用标记有 <xref:System.Security.SecurityCriticalAttribute> 特性的代码。</span><span class="sxs-lookup"><span data-stu-id="be2be-126">The only limitation for full-trust applications is that applications that are marked with the <xref:System.Security.SecurityTransparentAttribute> attribute cannot call code that is marked with the <xref:System.Security.SecurityCriticalAttribute> attribute.</span></span> <span data-ttu-id="be2be-127">部分受信任的应用程序必须在沙盒（如 Internet Explorer）中运行，以确保应用代码访问安全性。</span><span class="sxs-lookup"><span data-stu-id="be2be-127">Partially trusted applications must be run in a sandbox (for example, in Internet Explorer) so that code access security can be applied.</span></span> <span data-ttu-id="be2be-128">如果从 Internet 下载一个应用程序并尝试在台式机中运行该应用程序，那么将收到 <xref:System.NotSupportedException> 并且系统将显示消息：“尝试从网络地址加载程序集，这可能会导致程序集在旧版 .NET Framework 中进行沙盒处理。</span><span class="sxs-lookup"><span data-stu-id="be2be-128">If you download an application from the Internet and try to run it from your desktop, you will get a <xref:System.NotSupportedException> with the message: "An attempt was made to load an assembly from a network location which would have caused the assembly to be sandboxed in previous versions of the .NET Framework.</span></span> <span data-ttu-id="be2be-129">此版本的 .NET Framework 默认不启用 CAS 策略，因此加载可能存在危险。”</span><span class="sxs-lookup"><span data-stu-id="be2be-129">This release of the .NET Framework does not enable CAS policy by default, so this load may be dangerous."</span></span> <span data-ttu-id="be2be-130">如果你确定该应用程序可以信任，则可以通过使用[ \<loadFromRemoteSources> 元素](../configure-apps/file-schema/runtime/loadfromremotesources-element.md)使其运行为完全信任。</span><span class="sxs-lookup"><span data-stu-id="be2be-130">If you are sure that the application can be trusted, you can enable it to be run as full trust by using the [\<loadFromRemoteSources> element](../configure-apps/file-schema/runtime/loadfromremotesources-element.md).</span></span> <span data-ttu-id="be2be-131">有关在沙盒中运行应用程序的信息，请参阅[如何：在沙盒中运行部分受信任的代码](how-to-run-partially-trusted-code-in-a-sandbox.md)。</span><span class="sxs-lookup"><span data-stu-id="be2be-131">For information about running an application in a sandbox, see [How to: Run Partially Trusted Code in a Sandbox](how-to-run-partially-trusted-code-in-a-sandbox.md).</span></span>  
  
 <span data-ttu-id="be2be-132">面向公共语言运行时的所有托管代码都受益于代码访问安全性，即使该代码不调用单个代码访问安全性。</span><span class="sxs-lookup"><span data-stu-id="be2be-132">All managed code that targets the common language runtime receives the benefits of code access security, even if that code does not make a single code access security call.</span></span> <span data-ttu-id="be2be-133">有关详细信息，请参阅 [Code Access Security Basics](code-access-security-basics.md)。</span><span class="sxs-lookup"><span data-stu-id="be2be-133">For more information, see [Code Access Security Basics](code-access-security-basics.md).</span></span>  
  
<a name="key_functions"></a>
## <a name="key-functions-of-code-access-security"></a><span data-ttu-id="be2be-134">代码访问安全性的主要功能</span><span class="sxs-lookup"><span data-stu-id="be2be-134">Key Functions of Code Access Security</span></span>  
 <span data-ttu-id="be2be-135">代码访问安全性帮助限制代码对受保护资源和操作的访问权限。</span><span class="sxs-lookup"><span data-stu-id="be2be-135">Code access security helps limit the access that code has to protected resources and operations.</span></span> <span data-ttu-id="be2be-136">在 .NET Framework 中，代码访问安全性具有以下功能：</span><span class="sxs-lookup"><span data-stu-id="be2be-136">In the .NET Framework, code access security performs the following functions:</span></span>  
  
- <span data-ttu-id="be2be-137">定义权限和权限集，它们表示访问各种系统资源的权限。</span><span class="sxs-lookup"><span data-stu-id="be2be-137">Defines permissions and permission sets that represent the right to access various system resources.</span></span>  
  
- <span data-ttu-id="be2be-138">使代码能够要求其调用方拥有特定的权限。</span><span class="sxs-lookup"><span data-stu-id="be2be-138">Enables code to demand that its callers have specific permissions.</span></span>  
  
- <span data-ttu-id="be2be-139">使代码能够要求其调用方拥有数字签名，从而只允许特定组织或特定站点的调用方来调用受保护的代码。</span><span class="sxs-lookup"><span data-stu-id="be2be-139">Enables code to demand that its callers possess a digital signature, thus allowing only callers from a particular organization or site to call the protected code.</span></span>  
  
- <span data-ttu-id="be2be-140">通过将调用堆栈上为每个调用方授予的权限与调用方必须拥有的权限相比较，加强在运行时对代码的限制。</span><span class="sxs-lookup"><span data-stu-id="be2be-140">Enforces restrictions on code at run time by comparing the granted permissions of every caller on the call stack to the permissions that callers must have.</span></span>  
  
<a name="walking_the_call_stack"></a>
## <a name="walking-the-call-stack"></a><span data-ttu-id="be2be-141">审核调用堆栈</span><span class="sxs-lookup"><span data-stu-id="be2be-141">Walking the Call Stack</span></span>  
 <span data-ttu-id="be2be-142">为了确定代码是否有权访问某一资源或执行某一操作，运行时的安全系统将审核调用堆栈，以将每个调用方获得的权限与要求的权限进行比较。</span><span class="sxs-lookup"><span data-stu-id="be2be-142">To determine whether code is authorized to access a resource or perform an operation, the runtime's security system walks the call stack, comparing the granted permissions of each caller to the permission being demanded.</span></span> <span data-ttu-id="be2be-143">如果调用堆栈中的任何调用方不具备要求的权限，则会引发安全性异常并拒绝访问。</span><span class="sxs-lookup"><span data-stu-id="be2be-143">If any caller in the call stack does not have the demanded permission, a security exception is thrown and access is refused.</span></span> <span data-ttu-id="be2be-144">堆栈审核旨在帮助防止引诱攻击，引诱攻击是指不太受信任的代码调用高度受信任的代码，并利用高度受信任的代码来执行未经授权的操作。</span><span class="sxs-lookup"><span data-stu-id="be2be-144">The stack walk is designed to help prevent luring attacks, in which less-trusted code calls highly trusted code and uses it to perform unauthorized actions.</span></span> <span data-ttu-id="be2be-145">在运行时要求所有调用方的权限会影响性能，但是为了帮助防止代码免受不太受信任的代码的引诱攻击，这是很有必要的。</span><span class="sxs-lookup"><span data-stu-id="be2be-145">Demanding permissions of all callers at run time affects performance, but it is essential to help protect code from luring attacks by less-trusted code.</span></span> <span data-ttu-id="be2be-146">为了优化性能，可以使代码执行少量堆栈审核，但是必须确保每次进行此操作时不会暴露安全性漏洞。</span><span class="sxs-lookup"><span data-stu-id="be2be-146">To optimize performance, you can have your code perform fewer stack walks; however, you must be sure that you do not expose a security weakness whenever you do this.</span></span>  
  
 <span data-ttu-id="be2be-147">下图显示当程序集 A4 中的方法要求其调用方具备 P 权限时堆栈审核产生的结果。</span><span class="sxs-lookup"><span data-stu-id="be2be-147">The following illustration shows the stack walk that results when a method in Assembly A4 demands that its callers have permission P.</span></span>  
  
 <span data-ttu-id="be2be-148">![代码访问安全性](media/slide-10a.gif "slide_10a")</span><span class="sxs-lookup"><span data-stu-id="be2be-148">![Code access security](media/slide-10a.gif "slide_10a")</span></span>  
<span data-ttu-id="be2be-149">安全性堆栈审核</span><span class="sxs-lookup"><span data-stu-id="be2be-149">Security stack walk</span></span>  
  
<a name="related_topics"></a>
## <a name="related-topics"></a><span data-ttu-id="be2be-150">相关主题</span><span class="sxs-lookup"><span data-stu-id="be2be-150">Related Topics</span></span>  
  
|<span data-ttu-id="be2be-151">Title</span><span class="sxs-lookup"><span data-stu-id="be2be-151">Title</span></span>|<span data-ttu-id="be2be-152">说明</span><span class="sxs-lookup"><span data-stu-id="be2be-152">Description</span></span>|  
|-----------|-----------------|  
|[<span data-ttu-id="be2be-153">代码访问安全性基础知识</span><span class="sxs-lookup"><span data-stu-id="be2be-153">Code Access Security Basics</span></span>](code-access-security-basics.md)|<span data-ttu-id="be2be-154">描述代码访问安全性及其最常见的用途。</span><span class="sxs-lookup"><span data-stu-id="be2be-154">Describes code access security and its most common uses.</span></span>|  
|[<span data-ttu-id="be2be-155">安全透明的代码，级别 2</span><span class="sxs-lookup"><span data-stu-id="be2be-155">Security-Transparent Code, Level 2</span></span>](security-transparent-code-level-2.md)|<span data-ttu-id="be2be-156">描述 .NET Framework 4 中的安全透明度模型。</span><span class="sxs-lookup"><span data-stu-id="be2be-156">Describes the security transparency model in the .NET Framework 4.</span></span>|  
|[<span data-ttu-id="be2be-157">通过部分受信任的代码使用库</span><span class="sxs-lookup"><span data-stu-id="be2be-157">Using Libraries from Partially Trusted Code</span></span>](using-libraries-from-partially-trusted-code.md)|<span data-ttu-id="be2be-158">描述如何借助非托管代码启用库以及如何从非托管代码中使用库。</span><span class="sxs-lookup"><span data-stu-id="be2be-158">Describes how to enable libraries for use with unmanaged code and how to use libraries from unmanaged code.</span></span>|  
|[<span data-ttu-id="be2be-159">安全性的基础概念</span><span class="sxs-lookup"><span data-stu-id="be2be-159">Key Security Concepts</span></span>](../../standard/security/key-security-concepts.md)|<span data-ttu-id="be2be-160">概述 .NET Framework 安全性系统中使用的许多关键术语和概念。</span><span class="sxs-lookup"><span data-stu-id="be2be-160">Provides an overview of many of the key terms and concepts used in the .NET Framework security system.</span></span>|  
|[<span data-ttu-id="be2be-161">基于角色的安全性</span><span class="sxs-lookup"><span data-stu-id="be2be-161">Role-Based Security</span></span>](../../standard/security/role-based-security.md)|<span data-ttu-id="be2be-162">描述如何合并基于角色的安全性。</span><span class="sxs-lookup"><span data-stu-id="be2be-162">Describes how to incorporate security based on roles.</span></span>|  
|[<span data-ttu-id="be2be-163">加密服务</span><span class="sxs-lookup"><span data-stu-id="be2be-163">Cryptographic Services</span></span>](../../standard/security/cryptographic-services.md)|<span data-ttu-id="be2be-164">描述如何将加密合并到应用程序。</span><span class="sxs-lookup"><span data-stu-id="be2be-164">Describes how to incorporate cryptography into your applications.</span></span>|
