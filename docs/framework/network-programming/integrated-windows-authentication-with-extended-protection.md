---
title: 带有扩展保护的集成 Windows 身份验证
ms.date: 03/30/2017
ms.assetid: 81731998-d5e7-49e4-ad38-c8e6d01689d0
ms.openlocfilehash: 74f421131da0e5b11fd676ff23229f5ff6ec7eca
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/26/2020
ms.locfileid: "96241617"
---
# <a name="integrated-windows-authentication-with-extended-protection"></a><span data-ttu-id="469a6-102">带有扩展保护的集成 Windows 身份验证</span><span class="sxs-lookup"><span data-stu-id="469a6-102">Integrated Windows Authentication with Extended Protection</span></span>

<span data-ttu-id="469a6-103">进行了可影响以下类处理集成式 Windows 身份验证的方式的改进：<xref:System.Net.HttpWebRequest>、<xref:System.Net.HttpListener>、<xref:System.Net.Mail.SmtpClient>、<xref:System.Net.Security.SslStream>、<xref:System.Net.Security.NegotiateStream> 以及 <xref:System.Net> 和相关命名空间中的相关类。</span><span class="sxs-lookup"><span data-stu-id="469a6-103">Enhancements were made that affect how integrated Windows authentication is handled by the <xref:System.Net.HttpWebRequest>, <xref:System.Net.HttpListener>, <xref:System.Net.Mail.SmtpClient>, <xref:System.Net.Security.SslStream>, <xref:System.Net.Security.NegotiateStream>, and related classes in the <xref:System.Net> and related namespaces.</span></span> <span data-ttu-id="469a6-104">添加了对扩展保护的支持以增强安全性。</span><span class="sxs-lookup"><span data-stu-id="469a6-104">Support was added for extended protection to enhance security.</span></span>  
  
 <span data-ttu-id="469a6-105">这些更改会影响使用这些类来发出 Web 请求和接收响应的应用程序，这些应用程序使用集成式 Windows 身份验证。</span><span class="sxs-lookup"><span data-stu-id="469a6-105">These changes can affect applications that use these classes to make web requests and receive responses where integrated Windows authentication is used.</span></span> <span data-ttu-id="469a6-106">此更改也会影响配置为使用集成式 Windows 身份验证的 Web 服务器和客户端应用程序。</span><span class="sxs-lookup"><span data-stu-id="469a6-106">This change can also impact web servers and client applications that are configured to use integrated Windows authentication.</span></span>  
  
 <span data-ttu-id="469a6-107">这些更改还会影响使用这些类来发出其他请求类型和接收响应的应用程序，这些应用程序使用集成式 Windows 身份验证。</span><span class="sxs-lookup"><span data-stu-id="469a6-107">These changes can also affect applications that use these classes to make other types of requests and receive responses where integrated Windows authentication is used.</span></span>  
  
 <span data-ttu-id="469a6-108">支持扩展保护的更改仅适用于 Windows 7 和 Windows Server 2008 R2 上的应用程序。</span><span class="sxs-lookup"><span data-stu-id="469a6-108">The changes to support extended protection are available only for applications on Windows 7 and Windows Server 2008 R2.</span></span> <span data-ttu-id="469a6-109">扩展保护功能不可用于 Windows 的早期版本。</span><span class="sxs-lookup"><span data-stu-id="469a6-109">The extended protection features are not available on earlier versions of Windows.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="469a6-110">概述</span><span class="sxs-lookup"><span data-stu-id="469a6-110">Overview</span></span>  

 <span data-ttu-id="469a6-111">集成式 Windows 身份验证的设计能使某些凭据质询响应变得通用，这意味着可以重新使用或转发这些响应。</span><span class="sxs-lookup"><span data-stu-id="469a6-111">The design of integrated Windows authentication allows for some credential challenge responses to be universal, meaning they can be re-used or forwarded.</span></span> <span data-ttu-id="469a6-112">质询响应至少应与目标特定的信息一起构造，最好还包含一些通道特定的信息。</span><span class="sxs-lookup"><span data-stu-id="469a6-112">The challenge responses should be constructed at a minimum with target specific information and preferably also with some channel specific information.</span></span> <span data-ttu-id="469a6-113">然后，服务可提供扩展保护，确保凭据质询响应包含服务主体名称 (SPN) 等服务特定的信息。</span><span class="sxs-lookup"><span data-stu-id="469a6-113">Services can then provide extended protection to ensure that credential challenge responses contain service specific information such as a Service Principal Name (SPN).</span></span> <span data-ttu-id="469a6-114">凭据交换中含有此信息时，服务就能更好防范恶意使用那些可能已被不当使用的凭据质询响应。</span><span class="sxs-lookup"><span data-stu-id="469a6-114">With this information in the credential exchanges, services are able to better protect against malicious use of credential challenge responses that might have been improperly used.</span></span>  
  
 <span data-ttu-id="469a6-115">扩展保护设计是对身份验证协议的增强，旨在减轻身份验证中继攻击。</span><span class="sxs-lookup"><span data-stu-id="469a6-115">The extended protection design is an enhancement to authentication protocols designed to mitigate authentication relay attacks.</span></span> <span data-ttu-id="469a6-116">它围绕通道和服务绑定信息的概念展开。</span><span class="sxs-lookup"><span data-stu-id="469a6-116">It revolves around the concept of channel and service binding information.</span></span>  
  
 <span data-ttu-id="469a6-117">总体目标如下所示：</span><span class="sxs-lookup"><span data-stu-id="469a6-117">The overall objectives are the following:</span></span>  
  
1. <span data-ttu-id="469a6-118">如果客户端更新为支持扩展保护，应用程序应为所有受支持身份验证协议提供通道绑定和服务绑定信息。</span><span class="sxs-lookup"><span data-stu-id="469a6-118">If the client is updated to support the extended protection, applications should supply a channel binding and service binding information to all supported authentication protocols.</span></span> <span data-ttu-id="469a6-119">仅当有要绑定到的通道 (TLS) 时，才提供通道绑定信息。</span><span class="sxs-lookup"><span data-stu-id="469a6-119">Channel binding information can only be supplied when there is a channel (TLS) to bind to.</span></span> <span data-ttu-id="469a6-120">应始终提供服务绑定信息。</span><span class="sxs-lookup"><span data-stu-id="469a6-120">Service binding information should always be supplied.</span></span>  
  
2. <span data-ttu-id="469a6-121">适当配置的已更新服务器可能会在通道和服务绑定信息出现在客户端身份验证令牌中时验证这些信息，如果通道绑定不匹配则拒绝身份验证尝试。</span><span class="sxs-lookup"><span data-stu-id="469a6-121">Updated servers which are properly configured may verify the channel and service binding information when it is present in the client authentication token and reject the authentication attempt if the channel bindings do not match.</span></span> <span data-ttu-id="469a6-122">根据部署方案，服务器可能会验证通道绑定或服务绑定或同时验证两者。</span><span class="sxs-lookup"><span data-stu-id="469a6-122">Depending on the deployment scenario, servers may verify channel binding, service binding or both.</span></span>  
  
3. <span data-ttu-id="469a6-123">更新的服务器可以基于策略接受或拒绝不包含通道绑定信息的下层客户端请求。</span><span class="sxs-lookup"><span data-stu-id="469a6-123">Updated servers have the ability to accept or reject down-level client requests that do not contain the channel binding information based on policy.</span></span>  
  
 <span data-ttu-id="469a6-124">扩展保护使用的信息由以下两个部分或其中一个部分组成：</span><span class="sxs-lookup"><span data-stu-id="469a6-124">Information used by extended protection consists of one or both of the following two parts:</span></span>  
  
1. <span data-ttu-id="469a6-125">通道绑定令牌（即 CBT）。</span><span class="sxs-lookup"><span data-stu-id="469a6-125">A Channel Binding Token or CBT.</span></span>  
  
2. <span data-ttu-id="469a6-126">服务主体名称（即 SPN）形式的服务绑定信息。</span><span class="sxs-lookup"><span data-stu-id="469a6-126">Service Binding information in the form of a Service Principal Name or SPN.</span></span>  
  
 <span data-ttu-id="469a6-127">服务绑定信息指示客户端想对特定服务终结点验证自己的身份。</span><span class="sxs-lookup"><span data-stu-id="469a6-127">Service Binding information is an indication of a client’s intent to authenticate to a particular service endpoint.</span></span> <span data-ttu-id="469a6-128">它随以下属性从客户端传输到服务器：</span><span class="sxs-lookup"><span data-stu-id="469a6-128">It is communicated from client to server with the following properties:</span></span>  
  
- <span data-ttu-id="469a6-129">SPN 值必须可用于以明文形式执行客户端身份验证的服务器。</span><span class="sxs-lookup"><span data-stu-id="469a6-129">The SPN value must be available to the server performing client authentication in clear text form.</span></span>  
  
- <span data-ttu-id="469a6-130">SPN 的值是公共的。</span><span class="sxs-lookup"><span data-stu-id="469a6-130">The value of the SPN is public.</span></span>  
  
- <span data-ttu-id="469a6-131">SPN 在传输过程中必须受到加密保护，以便中间人攻击不会插入、删除或修改它的值。</span><span class="sxs-lookup"><span data-stu-id="469a6-131">The SPN must be cryptographically protected in transit such that a man-in-the-middle attack cannot insert, remove or modify its value.</span></span>  
  
 <span data-ttu-id="469a6-132">CBT 是外部安全通道（如 TLS）的属性，用于通过验证了客户端的内部通道将其绑定到会话。</span><span class="sxs-lookup"><span data-stu-id="469a6-132">A CBT is a property of the outer secure channel (such as TLS) used to tie (bind) it to a conversation over an inner, client-authenticated channel.</span></span> <span data-ttu-id="469a6-133">CBT 必须具有以下属性（也由 IETF RFC 5056 定义）：</span><span class="sxs-lookup"><span data-stu-id="469a6-133">The CBT must have the following properties (also defined by IETF RFC 5056):</span></span>  
  
- <span data-ttu-id="469a6-134">当存在外部通道时，CBT 的值必须是标识外部通道或服务器终结点的属性，由会话的客户端和服务器端独立获取。</span><span class="sxs-lookup"><span data-stu-id="469a6-134">When an outer channel exists, the value of the CBT must be a property identifying either the outer channel or the server endpoint, independently arrived at by both client and server sides of a conversation.</span></span>  
  
- <span data-ttu-id="469a6-135">客户端发送的 CBT 的值必须是攻击者不能影响的。</span><span class="sxs-lookup"><span data-stu-id="469a6-135">Value of the CBT sent by the client must not be something an attacker can influence.</span></span>  
  
- <span data-ttu-id="469a6-136">对 CBT 值的保密性不作任何保证。</span><span class="sxs-lookup"><span data-stu-id="469a6-136">No guarantees are made about secrecy of the CBT value.</span></span> <span data-ttu-id="469a6-137">但这不意味着，服务绑定值和通道绑定信息总是可由其他任何服务器进行检查（执行身份验证服务器除外），因为携带 CBT 的协议可能对其进行加密。</span><span class="sxs-lookup"><span data-stu-id="469a6-137">This does not however mean that the value of the service binding as well as channel binding information can always be examined by any other but the server performing authentication, as the protocol carrying the CBT may be encrypting it.</span></span>  
  
- <span data-ttu-id="469a6-138">CBT 在传输过程中必须受到加密完整性保护，以便攻击者不会插入、删除或修改它的值。</span><span class="sxs-lookup"><span data-stu-id="469a6-138">The CBT must be cryptographically integrity protected in transit such that an attacker cannot insert, remove or modify its value.</span></span>  
  
 <span data-ttu-id="469a6-139">通道绑定是由客户端将 SPN 和 CBT 以防干扰方式传输给服务器而完成的。</span><span class="sxs-lookup"><span data-stu-id="469a6-139">Channel binding is accomplished by the client transferring the SPN and the CBT to the server in a tamperproof fashion.</span></span> <span data-ttu-id="469a6-140">服务器根据其策略验证通道绑定信息，并拒绝它认为自身不是预期目标的身份验证尝试。</span><span class="sxs-lookup"><span data-stu-id="469a6-140">The server validates the channel binding information in accordance with its policy and rejects authentication attempts for which it does not believe itself to have been the intended target.</span></span> <span data-ttu-id="469a6-141">这样，两个通道加密绑定在一起。</span><span class="sxs-lookup"><span data-stu-id="469a6-141">This way, the two channels become cryptographically bound together.</span></span>  
  
 <span data-ttu-id="469a6-142">为了保持与现有客户端和应用程序的兼容性，可能将服务器配置为允许尚不支持扩展保护的客户端进行身份验证尝试。</span><span class="sxs-lookup"><span data-stu-id="469a6-142">To preserve compatibility with existing clients and applications, a server may be configured to allow authentication attempts by clients that do not yet support extended protection.</span></span> <span data-ttu-id="469a6-143">这被称为“部分强化”配置（相较于“完全强化”配置）。</span><span class="sxs-lookup"><span data-stu-id="469a6-143">This is referred to as a "partially hardened" configuration, in contrast to a "fully hardened" configuration.</span></span>  
  
 <span data-ttu-id="469a6-144"><xref:System.Net> 和 <xref:System.Net.Security> 命名空间中的多个组件代表调用应用程序执行集成式 Windows 身份验证。</span><span class="sxs-lookup"><span data-stu-id="469a6-144">Multiple components in the <xref:System.Net> and <xref:System.Net.Security> namespaces perform integrated Windows authentication on behalf of a calling application.</span></span> <span data-ttu-id="469a6-145">本部分介绍为扩展 System.Net 组件在使用集成式 Windows 身份验证方面的保护对这些组件做出的更改。</span><span class="sxs-lookup"><span data-stu-id="469a6-145">This section describes changes to System.Net components to add extended protection in their use of integrated Windows authentication.</span></span>  
  
 <span data-ttu-id="469a6-146">当前 Windows 7 支持扩展保护。</span><span class="sxs-lookup"><span data-stu-id="469a6-146">Extended protection is currently supported on Windows 7.</span></span> <span data-ttu-id="469a6-147">提供了一种机制，所以应用程序可以确定操作系统是否支持扩展保护。</span><span class="sxs-lookup"><span data-stu-id="469a6-147">A mechanism is provided so an application can determine if the operating system supports extended protection.</span></span>  
  
## <a name="changes-to-support-extended-protection"></a><span data-ttu-id="469a6-148">对支持扩展保护的更改</span><span class="sxs-lookup"><span data-stu-id="469a6-148">Changes to Support Extended Protection</span></span>  

 <span data-ttu-id="469a6-149">身份验证与集成式 Windows 身份验证一起使用时，其过程通常包括由目标计算机发出质询并将质询发送回客户端计算机，具体取决于使用的身份验证协议。</span><span class="sxs-lookup"><span data-stu-id="469a6-149">The authentication process used with integrated Windows authentication, depending on the authentication protocol used, often includes a challenge issued by the destination computer and sent back to the client computer.</span></span> <span data-ttu-id="469a6-150">扩展保护将新功能添加到此身份验证进程</span><span class="sxs-lookup"><span data-stu-id="469a6-150">Extended protection adds new features to this authentication process</span></span>  
  
 <span data-ttu-id="469a6-151"><xref:System.Security.Authentication.ExtendedProtection> 命名空间对采用应用程序扩展保护的身份验证提供支持。</span><span class="sxs-lookup"><span data-stu-id="469a6-151">The <xref:System.Security.Authentication.ExtendedProtection> namespace provides support for authentication using extended protection for applications.</span></span> <span data-ttu-id="469a6-152">此命名空间中的 <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding> 类表示通道绑定。</span><span class="sxs-lookup"><span data-stu-id="469a6-152">The <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding> class in this namespace represents a channel binding.</span></span> <span data-ttu-id="469a6-153">此命名空间中的 <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> 类表示服务器用来验证传入客户端连接的扩展保护策略。</span><span class="sxs-lookup"><span data-stu-id="469a6-153">The <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> class in this namespace represents the extended protection policy used by the server to validate incoming client connections.</span></span> <span data-ttu-id="469a6-154">其他类成员用于扩展保护。</span><span class="sxs-lookup"><span data-stu-id="469a6-154">Other class members are used with extended protection.</span></span>  
  
 <span data-ttu-id="469a6-155">对于服务器应用程序，这些类包括以下内容：</span><span class="sxs-lookup"><span data-stu-id="469a6-155">For server applications, these classes include the following:</span></span>  
  
 <span data-ttu-id="469a6-156">含有以下元素的 <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy>：</span><span class="sxs-lookup"><span data-stu-id="469a6-156">A <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> that has the following elements:</span></span>  
  
- <span data-ttu-id="469a6-157"><xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy.OSSupportsExtendedProtection%2A> 属性，指示操作系统是否支持使用扩展保护的集成式 Windows 身份验证。</span><span class="sxs-lookup"><span data-stu-id="469a6-157">An <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy.OSSupportsExtendedProtection%2A> property that indicates whether the operating system supports integrated windows authentication with extended protection.</span></span>  
  
- <span data-ttu-id="469a6-158"><xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> 值，该值指示应何时强制实施扩展保护策略。</span><span class="sxs-lookup"><span data-stu-id="469a6-158">A <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> value that indicates when the extended protection policy should be enforced.</span></span>  
  
- <span data-ttu-id="469a6-159"><xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> 值，指示部署方案。</span><span class="sxs-lookup"><span data-stu-id="469a6-159">A <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> value that indicates the deployment scenario.</span></span> <span data-ttu-id="469a6-160">这会影响扩展保护的检查方式。</span><span class="sxs-lookup"><span data-stu-id="469a6-160">This influences how extended protection is checked.</span></span>  
  
- <span data-ttu-id="469a6-161">可选的 <xref:System.Security.Authentication.ExtendedProtection.ServiceNameCollection>，其中包含自定义 SPN 列表，该列表用于根据客户端提供的作为身份验证预期目标的 SPN 进行匹配。</span><span class="sxs-lookup"><span data-stu-id="469a6-161">An optional <xref:System.Security.Authentication.ExtendedProtection.ServiceNameCollection> that contains the custom SPN list that is used to match against the SPN provided by the client as the intended target of the authentication.</span></span>  
  
- <span data-ttu-id="469a6-162">可选的 <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding>，其中包含用于验证的自定义通道绑定。</span><span class="sxs-lookup"><span data-stu-id="469a6-162">An optional <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding> that contains a custom channel binding to use for validation.</span></span> <span data-ttu-id="469a6-163">这不常见</span><span class="sxs-lookup"><span data-stu-id="469a6-163">This scenario is not a common case</span></span>  
  
 <span data-ttu-id="469a6-164"><xref:System.Security.Authentication.ExtendedProtection.Configuration> 命名空间为采用应用程序扩展保护的身份验证提供配置支持。</span><span class="sxs-lookup"><span data-stu-id="469a6-164">The <xref:System.Security.Authentication.ExtendedProtection.Configuration> namespace provides support for configuration of authentication using extended protection for applications.</span></span>  
  
 <span data-ttu-id="469a6-165">进行了大量的功能更改来支持现有 <xref:System.Net> 命名空间中的扩展保护。</span><span class="sxs-lookup"><span data-stu-id="469a6-165">A number of feature changes were made to support extended protection in the existing <xref:System.Net> namespace.</span></span> <span data-ttu-id="469a6-166">包括以下更改：</span><span class="sxs-lookup"><span data-stu-id="469a6-166">These changes include the following:</span></span>  
  
- <span data-ttu-id="469a6-167">新的 <xref:System.Net.TransportContext> 类添加到表示传输上下文的 <xref:System.Net> 命名空间。</span><span class="sxs-lookup"><span data-stu-id="469a6-167">A new <xref:System.Net.TransportContext> class added to the <xref:System.Net> namespace that represents a transport context.</span></span>  
  
- <span data-ttu-id="469a6-168">在 <xref:System.Net.HttpWebRequest> 类中新增 <xref:System.Net.HttpWebRequest.EndGetRequestStream%2A> 和 <xref:System.Net.HttpWebRequest.GetRequestStream%2A> 重载方法，允许检索 <xref:System.Net.TransportContext> 以支持客户端应用程序的扩展保护。</span><span class="sxs-lookup"><span data-stu-id="469a6-168">New <xref:System.Net.HttpWebRequest.EndGetRequestStream%2A> and <xref:System.Net.HttpWebRequest.GetRequestStream%2A> overload methods in the <xref:System.Net.HttpWebRequest> class that allow retrieving the <xref:System.Net.TransportContext> to support extended protection for client applications.</span></span>  
  
- <span data-ttu-id="469a6-169">对 <xref:System.Net.HttpListener> 和 <xref:System.Net.HttpListenerRequest> 类进行添加补充以支持服务器应用程序。</span><span class="sxs-lookup"><span data-stu-id="469a6-169">Additions to the <xref:System.Net.HttpListener> and <xref:System.Net.HttpListenerRequest> classes to support server applications.</span></span>  
  
 <span data-ttu-id="469a6-170">进行了功能更改，为现有 <xref:System.Net.Mail> 命名空间中的 SMTP 客户端应用程序提供扩展保护支持：</span><span class="sxs-lookup"><span data-stu-id="469a6-170">A feature change was made to support extended protection for SMTP client applications in the existing <xref:System.Net.Mail> namespace:</span></span>  
  
- <span data-ttu-id="469a6-171"><xref:System.Net.Mail.SmtpClient> 类中的 <xref:System.Net.Mail.SmtpClient.TargetName%2A> 属性，在为 SMTP 客户端应用程序使用扩展保护时表示用于身份验证的 SPN。</span><span class="sxs-lookup"><span data-stu-id="469a6-171">A <xref:System.Net.Mail.SmtpClient.TargetName%2A> property in the <xref:System.Net.Mail.SmtpClient> class that represents the SPN to use for authentication when using extended protection for SMTP client applications.</span></span>  
  
 <span data-ttu-id="469a6-172">进行了大量的功能更改来支持现有 <xref:System.Net.Security> 命名空间中的扩展保护。</span><span class="sxs-lookup"><span data-stu-id="469a6-172">A number of feature changes were made to support extended protection in the existing <xref:System.Net.Security> namespace.</span></span> <span data-ttu-id="469a6-173">包括以下更改：</span><span class="sxs-lookup"><span data-stu-id="469a6-173">These changes include the following:</span></span>  
  
- <span data-ttu-id="469a6-174">在 <xref:System.Net.Security.NegotiateStream> 类中新增 <xref:System.Net.Security.NegotiateStream.BeginAuthenticateAsClient%2A> 和 <xref:System.Net.Security.NegotiateStream.AuthenticateAsClient%2A> 重载方法，允许传递 CBT 来支持客户端应用程序的扩展保护。</span><span class="sxs-lookup"><span data-stu-id="469a6-174">New <xref:System.Net.Security.NegotiateStream.BeginAuthenticateAsClient%2A> and <xref:System.Net.Security.NegotiateStream.AuthenticateAsClient%2A> overload methods in the <xref:System.Net.Security.NegotiateStream> class that allow passing a CBT to support extended protection for client applications.</span></span>  
  
- <span data-ttu-id="469a6-175">在 <xref:System.Net.Security.NegotiateStream> 类中新增 <xref:System.Net.Security.NegotiateStream.BeginAuthenticateAsServer%2A> 和 <xref:System.Net.Security.NegotiateStream.AuthenticateAsServer%2A> 重载方法，允许传递 <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> 来支持服务器应用程序的扩展保护。</span><span class="sxs-lookup"><span data-stu-id="469a6-175">New <xref:System.Net.Security.NegotiateStream.BeginAuthenticateAsServer%2A> and <xref:System.Net.Security.NegotiateStream.AuthenticateAsServer%2A> overload methods in the <xref:System.Net.Security.NegotiateStream> class that allow passing an <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> to support extended protection for server applications.</span></span>  
  
- <span data-ttu-id="469a6-176">在 <xref:System.Net.Security.SslStream> 类中新增 <xref:System.Net.Security.SslStream.TransportContext%2A> 属性来支持客户端和服务器应用程序的扩展保护。</span><span class="sxs-lookup"><span data-stu-id="469a6-176">A new <xref:System.Net.Security.SslStream.TransportContext%2A> property in the <xref:System.Net.Security.SslStream> class to support extended protection for client and server applications.</span></span>  
  
 <span data-ttu-id="469a6-177">添加了 <xref:System.Net.Configuration.SmtpNetworkElement> 属性以支持在 <xref:System.Net.Security> 命名空间中为 SMTP 客户端配置扩展保护。</span><span class="sxs-lookup"><span data-stu-id="469a6-177">A <xref:System.Net.Configuration.SmtpNetworkElement> property was added to support configuration of extended protection for SMTP clients in the <xref:System.Net.Security> namespace.</span></span>  
  
## <a name="extended-protection-for-client-applications"></a><span data-ttu-id="469a6-178">客户端应用程序的扩展保护</span><span class="sxs-lookup"><span data-stu-id="469a6-178">Extended Protection for Client Applications</span></span>  

 <span data-ttu-id="469a6-179">大多数客户端应用程序的扩展保护支持会自动发生。</span><span class="sxs-lookup"><span data-stu-id="469a6-179">Extended protection support for most client applications happens automatically.</span></span> <span data-ttu-id="469a6-180">只要 Windows 的基础版本支持扩展保护，<xref:System.Net.HttpWebRequest> 和 <xref:System.Net.Mail.SmtpClient> 类就支持扩展保护。</span><span class="sxs-lookup"><span data-stu-id="469a6-180">The <xref:System.Net.HttpWebRequest> and <xref:System.Net.Mail.SmtpClient> classes support extended protection whenever the underlying version of Windows supports extended protection.</span></span> <span data-ttu-id="469a6-181"><xref:System.Net.HttpWebRequest> 实例发送从 <xref:System.Uri> 构造的 SPN。</span><span class="sxs-lookup"><span data-stu-id="469a6-181">An <xref:System.Net.HttpWebRequest> instance sends an SPN constructed from the <xref:System.Uri>.</span></span> <span data-ttu-id="469a6-182">默认情况下，<xref:System.Net.Mail.SmtpClient> 实例发送从 SMTP 邮件服务器的主机名构造的 SPN。</span><span class="sxs-lookup"><span data-stu-id="469a6-182">By default, an <xref:System.Net.Mail.SmtpClient> instance sends an SPN constructed from the host name of the SMTP mail server.</span></span>  
  
 <span data-ttu-id="469a6-183">对于自定义身份验证，客户端应用程序可以使用 <xref:System.Net.HttpWebRequest> 类中的 <xref:System.Net.HttpWebRequest.EndGetRequestStream%28System.IAsyncResult%2CSystem.Net.TransportContext%40%29?displayProperty=nameWithType> 或 <xref:System.Net.HttpWebRequest.GetRequestStream%28System.Net.TransportContext%40%29?displayProperty=nameWithType> 方法，允许使用 <xref:System.Net.TransportContext.GetChannelBinding%2A> 方法来检索 <xref:System.Net.TransportContext> 和 CBT。</span><span class="sxs-lookup"><span data-stu-id="469a6-183">For custom authentication, client applications can use the <xref:System.Net.HttpWebRequest.EndGetRequestStream%28System.IAsyncResult%2CSystem.Net.TransportContext%40%29?displayProperty=nameWithType> or <xref:System.Net.HttpWebRequest.GetRequestStream%28System.Net.TransportContext%40%29?displayProperty=nameWithType> methods in the <xref:System.Net.HttpWebRequest> class that allow retrieving the <xref:System.Net.TransportContext> and the CBT using the <xref:System.Net.TransportContext.GetChannelBinding%2A> method.</span></span>  
  
 <span data-ttu-id="469a6-184">通过设置 <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A> 属性，可重写 <xref:System.Net.HttpWebRequest> 实例向给定服务发送集成式身份验证所用的 SPN。</span><span class="sxs-lookup"><span data-stu-id="469a6-184">The SPN to use for integrated Windows authentication sent by an <xref:System.Net.HttpWebRequest> instance to a given service can be overridden by setting the <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A> property.</span></span>  
  
 <span data-ttu-id="469a6-185"><xref:System.Net.Mail.SmtpClient.TargetName%2A> 属性可用来设置用于 SMTP 连接的集成式 Windows 身份验证的自定义 SPN。</span><span class="sxs-lookup"><span data-stu-id="469a6-185">The <xref:System.Net.Mail.SmtpClient.TargetName%2A> property can be used to set a custom SPN to use for integrated Windows authentication for the SMTP connection.</span></span>  
  
## <a name="extended-protection-for-server-applications"></a><span data-ttu-id="469a6-186">服务器应用程序的扩展保护</span><span class="sxs-lookup"><span data-stu-id="469a6-186">Extended Protection for Server Applications</span></span>  

 <span data-ttu-id="469a6-187"><xref:System.Net.HttpListener> 自动提供执行 HTTP 身份验证时验证服务绑定的机制。</span><span class="sxs-lookup"><span data-stu-id="469a6-187"><xref:System.Net.HttpListener> automatically provides mechanisms for validating service bindings when performing HTTP authentication.</span></span>  
  
 <span data-ttu-id="469a6-188">最安全的方案是为 `HTTPS://` 前缀启用扩展保护。</span><span class="sxs-lookup"><span data-stu-id="469a6-188">The most secure scenario is to enable extended protection for `HTTPS://` prefixes.</span></span> <span data-ttu-id="469a6-189">在这种情况下，将 <xref:System.Net.HttpListener.ExtendedProtectionPolicy%2A?displayProperty=nameWithType> 设置为 <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy>（其中 <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> 设置为 <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> 或 <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always>），并且将 <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> 设置为 <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario.TransportSelected>。<xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> 的值使 <xref:System.Net.HttpListener> 处于部分强化模式，而 <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> 对应完全强化模式。</span><span class="sxs-lookup"><span data-stu-id="469a6-189">In this case, set <xref:System.Net.HttpListener.ExtendedProtectionPolicy%2A?displayProperty=nameWithType> to an <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> with <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> set to <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> or <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always>, and <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> set to <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario.TransportSelected> A value of  <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> puts <xref:System.Net.HttpListener> in partially hardened mode, while <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> corresponds to fully hardened mode.</span></span>  
  
 <span data-ttu-id="469a6-190">在此配置中，当通过外部安全通道向服务器发送请求时，将查询外部通道的通道绑定。</span><span class="sxs-lookup"><span data-stu-id="469a6-190">In this configuration when a request is made to the server through an outer secure channel, the outer channel is queried for a channel binding.</span></span> <span data-ttu-id="469a6-191">将此通道绑定传递到身份验证 SSPI 调用，这将验证身份验证 Blob 中的通道绑定是否匹配。</span><span class="sxs-lookup"><span data-stu-id="469a6-191">This channel binding is passed to the authentication SSPI calls, which validate that the channel binding in the authentication blob matches.</span></span> <span data-ttu-id="469a6-192">有三个可能的结果：</span><span class="sxs-lookup"><span data-stu-id="469a6-192">There are three possible outcomes:</span></span>  
  
1. <span data-ttu-id="469a6-193">服务器的基础操作系统不支持扩展保护。</span><span class="sxs-lookup"><span data-stu-id="469a6-193">The server’s underlying operating system does not support extended protection.</span></span> <span data-ttu-id="469a6-194">请求不会向应用程序公开，并且未授权的 (401) 响应将返回到客户端。</span><span class="sxs-lookup"><span data-stu-id="469a6-194">The request will not be exposed to the application, and an unauthorized (401) response will be returned to the client.</span></span> <span data-ttu-id="469a6-195">消息将记录到指定失败原因的 <xref:System.Net.HttpListener> 跟踪源。</span><span class="sxs-lookup"><span data-stu-id="469a6-195">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
2. <span data-ttu-id="469a6-196">SSPI 调用失败，指示客户端指定了与从外部通道检索的期望值不匹配的通道绑定，或者指示当服务器上的扩展保护策略配置为 <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> 时，客户端未能提供通道绑定。</span><span class="sxs-lookup"><span data-stu-id="469a6-196">The SSPI call fails indicating that either the client specified a channel binding that did not match the expected value retrieved from the outer channel or the client failed to supply a channel binding when the extended protection policy on the server was configured for <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always>.</span></span> <span data-ttu-id="469a6-197">在这两种情况下，请求不会向应用程序公开，并且未授权的 (401) 响应将返回到客户端。</span><span class="sxs-lookup"><span data-stu-id="469a6-197">In both cases, the request will not be exposed to the application, and an unauthorized (401) response will be returned to the client.</span></span> <span data-ttu-id="469a6-198">消息将记录到指定失败原因的 <xref:System.Net.HttpListener> 跟踪源。</span><span class="sxs-lookup"><span data-stu-id="469a6-198">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
3. <span data-ttu-id="469a6-199">客户端指定正确的通道绑定或能够不指定通道绑定进行连接，因为服务器上的扩展保护策略配置为 <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported>。请求将返回到应用程序进行处理。</span><span class="sxs-lookup"><span data-stu-id="469a6-199">The client specifies the correct channel binding or is allowed to connect without specifying a channel binding since the extended protection policy on the server is configured with <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> The request is returned to the application for processing.</span></span> <span data-ttu-id="469a6-200">不会自动执行服务器名称检查。</span><span class="sxs-lookup"><span data-stu-id="469a6-200">No service name check is performed automatically.</span></span> <span data-ttu-id="469a6-201">应用程序可能使用 <xref:System.Net.HttpListenerRequest.ServiceName%2A> 属性来选择执行其自己的服务名称验证，但在这些情况下它是多余的。</span><span class="sxs-lookup"><span data-stu-id="469a6-201">An application may choose to perform its own service name validation using the <xref:System.Net.HttpListenerRequest.ServiceName%2A> property, but under these circumstances it is redundant.</span></span>  
  
 <span data-ttu-id="469a6-202">如果应用程序自己进行 SSPI 调用以基于 HTTP 请求主体中来回传递的 Blob 执行身份验证，并且想要支持通道绑定，则它需要使用 <xref:System.Net.HttpListener> 来检索外部安全通道的预期通道绑定，以便将其传递给本机 Win32 [AcceptSecurityContext](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) 函数。</span><span class="sxs-lookup"><span data-stu-id="469a6-202">If an application makes its own SSPI calls to perform authentication based on blobs passed back and forth within the body of an HTTP request and wishes to support channel binding, it needs to retrieve the expected channel binding from the outer secure channel using <xref:System.Net.HttpListener> in order to pass it to native Win32 [AcceptSecurityContext](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) function.</span></span> <span data-ttu-id="469a6-203">若要执行此操作，请使用 <xref:System.Net.HttpListenerRequest.TransportContext%2A> 属性并调用 <xref:System.Net.TransportContext.GetChannelBinding%2A> 方法来检索 CBT。</span><span class="sxs-lookup"><span data-stu-id="469a6-203">To do this, use the <xref:System.Net.HttpListenerRequest.TransportContext%2A> property and call <xref:System.Net.TransportContext.GetChannelBinding%2A> method to retrieve the CBT.</span></span> <span data-ttu-id="469a6-204">仅支持终结点绑定。</span><span class="sxs-lookup"><span data-stu-id="469a6-204">Only endpoint bindings are supported.</span></span> <span data-ttu-id="469a6-205">如果指定除 <xref:System.Security.Authentication.ExtendedProtection.ChannelBindingKind.Endpoint> 外的其他内容，将引发 <xref:System.NotSupportedException>。</span><span class="sxs-lookup"><span data-stu-id="469a6-205">If anything other <xref:System.Security.Authentication.ExtendedProtection.ChannelBindingKind.Endpoint> is specified, a <xref:System.NotSupportedException> will be thrown.</span></span> <span data-ttu-id="469a6-206">如果基础操作系统支持通道绑定，<xref:System.Net.TransportContext.GetChannelBinding%2A> 方法将返回 <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding><xref:System.Runtime.InteropServices.SafeHandle>，包装指向适合传递到 [AcceptSecurityContext](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) 函数的通道绑定的指针，因为 SecBuffer 结构的 pvBuffer 成员传入了 `pInput` 参数。</span><span class="sxs-lookup"><span data-stu-id="469a6-206">If the underlying operating system supports channel binding, the <xref:System.Net.TransportContext.GetChannelBinding%2A> method will return a <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding><xref:System.Runtime.InteropServices.SafeHandle> wrapping a pointer to a channel binding suitable for passing to [AcceptSecurityContext](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) function as the pvBuffer member of a SecBuffer structure passed in the `pInput` parameter.</span></span> <span data-ttu-id="469a6-207"><xref:System.Security.Authentication.ExtendedProtection.ChannelBinding.Size%2A> 属性包含通道绑定的以字节为单位的长度。</span><span class="sxs-lookup"><span data-stu-id="469a6-207">The <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding.Size%2A> property contains the length, in bytes, of the channel binding.</span></span> <span data-ttu-id="469a6-208">如果基础操作系统不支持通道绑定，该函数将返回 `null`。</span><span class="sxs-lookup"><span data-stu-id="469a6-208">If the underlying operating system does not support channel bindings, the function will return `null`.</span></span>  
  
 <span data-ttu-id="469a6-209">另一种可能的情况是未使用代理时为 `HTTP://` 前缀启用扩展保护。</span><span class="sxs-lookup"><span data-stu-id="469a6-209">Another possible scenario is to enable extended protection for `HTTP://` prefixes when proxies are not used.</span></span> <span data-ttu-id="469a6-210">在这种情况下，将 <xref:System.Net.HttpListener.ExtendedProtectionPolicy%2A?displayProperty=nameWithType> 设置为 <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy>（其中 <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> 设置为 <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> 或 <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always>），并且将 <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> 设置为 <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario.TransportSelected>。<xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> 的值使 <xref:System.Net.HttpListener> 处于部分强化模式，而 <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> 对应完全强化模式。</span><span class="sxs-lookup"><span data-stu-id="469a6-210">In this case, set <xref:System.Net.HttpListener.ExtendedProtectionPolicy%2A?displayProperty=nameWithType> to an <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> with <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> set to <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> or <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always>, and <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> set to <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario.TransportSelected> A value of  <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> puts <xref:System.Net.HttpListener> in partially hardened mode, while <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> corresponds to fully hardened mode.</span></span>  
  
 <span data-ttu-id="469a6-211">基于已向 <xref:System.Net.HttpListener> 注册的前缀创建允许的服务名称的默认列表。</span><span class="sxs-lookup"><span data-stu-id="469a6-211">A default list of allowed service names is created based on the prefixes which have been registered with the <xref:System.Net.HttpListener>.</span></span> <span data-ttu-id="469a6-212">可以通过 <xref:System.Net.HttpListener.DefaultServiceNames%2A> 属性检查此默认列表。</span><span class="sxs-lookup"><span data-stu-id="469a6-212">This default list can be examined through the <xref:System.Net.HttpListener.DefaultServiceNames%2A> property.</span></span> <span data-ttu-id="469a6-213">如果此列表不全面，应用程序可以在 <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> 类的构造函数中指定将使用的自定义服务名称集合，而不使用默认服务名称列表。</span><span class="sxs-lookup"><span data-stu-id="469a6-213">If this list is not comprehensive, an application can specify a custom service name collection in the constructor for the <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> class which will be used instead of the default service name list.</span></span>  
  
 <span data-ttu-id="469a6-214">在此配置中，当没有外部安全通道身份验证情况下向服务器发出请求，通常不进行通道绑定检查。</span><span class="sxs-lookup"><span data-stu-id="469a6-214">In this configuration, when a request is made to the server without an outer secure channel authentication proceeds normally without a channel binding check.</span></span> <span data-ttu-id="469a6-215">如果身份验证成功，将查询上下文获取客户端提供的服务名称，并根据可接受服务名称列表验证上下文。</span><span class="sxs-lookup"><span data-stu-id="469a6-215">If the authentication succeeds, the context is queried for the service name that the client provided and validated against the list of acceptable service names.</span></span> <span data-ttu-id="469a6-216">有四个可能的结果：</span><span class="sxs-lookup"><span data-stu-id="469a6-216">There are four possible outcomes:</span></span>  
  
1. <span data-ttu-id="469a6-217">服务器的基础操作系统不支持扩展保护。</span><span class="sxs-lookup"><span data-stu-id="469a6-217">The server’s underlying operating system does not support extended protection.</span></span> <span data-ttu-id="469a6-218">请求不会向应用程序公开，并且未授权的 (401) 响应将返回到客户端。</span><span class="sxs-lookup"><span data-stu-id="469a6-218">The request will not be exposed to the application, and an unauthorized (401) response will be returned to the client.</span></span> <span data-ttu-id="469a6-219">消息将记录到指定失败原因的 <xref:System.Net.HttpListener> 跟踪源。</span><span class="sxs-lookup"><span data-stu-id="469a6-219">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
2. <span data-ttu-id="469a6-220">客户端的基础操作系统不支持扩展保护。</span><span class="sxs-lookup"><span data-stu-id="469a6-220">The client’s underlying operating system does not support extended protection.</span></span> <span data-ttu-id="469a6-221">在 <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> 配置中，身份验证尝试将成功，并且请求将返回到应用程序。</span><span class="sxs-lookup"><span data-stu-id="469a6-221">In the <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> configuration, the authentication attempt will succeed and the request will be returned to the application.</span></span> <span data-ttu-id="469a6-222">在 <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> 配置中，身份验证尝试将失败。</span><span class="sxs-lookup"><span data-stu-id="469a6-222">In the <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> configuration, the authentication attempt will fail.</span></span> <span data-ttu-id="469a6-223">请求不会向应用程序公开，并且未授权的 (401) 响应将返回到客户端。</span><span class="sxs-lookup"><span data-stu-id="469a6-223">The request will not be exposed to the application, and an unauthorized (401) response will be returned to the client.</span></span> <span data-ttu-id="469a6-224">消息将记录到指定失败原因的 <xref:System.Net.HttpListener> 跟踪源。</span><span class="sxs-lookup"><span data-stu-id="469a6-224">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
3. <span data-ttu-id="469a6-225">客户端的基础操作系统支持扩展保护，但是应用程序未指定服务绑定。</span><span class="sxs-lookup"><span data-stu-id="469a6-225">The client’s underlying operating system supports extended protection, but the application did not specify a service binding.</span></span> <span data-ttu-id="469a6-226">请求不会向应用程序公开，并且未授权的 (401) 响应将返回到客户端。</span><span class="sxs-lookup"><span data-stu-id="469a6-226">The request will not be exposed to the application, and an unauthorized (401) response will be returned to the client.</span></span> <span data-ttu-id="469a6-227">消息将记录到指定失败原因的 <xref:System.Net.HttpListener> 跟踪源。</span><span class="sxs-lookup"><span data-stu-id="469a6-227">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
4. <span data-ttu-id="469a6-228">客户端指定了服务绑定。</span><span class="sxs-lookup"><span data-stu-id="469a6-228">The client specified a service binding.</span></span> <span data-ttu-id="469a6-229">服务绑定与允许的服务绑定列表进行比较。</span><span class="sxs-lookup"><span data-stu-id="469a6-229">The service binding is compared to the list of allowed service bindings.</span></span> <span data-ttu-id="469a6-230">如果匹配，请求会返回到应用程序。</span><span class="sxs-lookup"><span data-stu-id="469a6-230">If it matches, the request is returned to the application.</span></span> <span data-ttu-id="469a6-231">否则，请求不会向应用程序公开，并且未授权 (401) 响应将自动返回到客户端。</span><span class="sxs-lookup"><span data-stu-id="469a6-231">Otherwise, the request will not be exposed to the application, and an unauthorized (401) response will be automatically returned to the client.</span></span> <span data-ttu-id="469a6-232">消息将记录到指定失败原因的 <xref:System.Net.HttpListener> 跟踪源。</span><span class="sxs-lookup"><span data-stu-id="469a6-232">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
 <span data-ttu-id="469a6-233">如果使用可接受服务名称的允许列表这个简单方法还不够，应用程序可以通过查询 <xref:System.Net.HttpListenerRequest.ServiceName%2A> 属性提供自己的服务名称验证。</span><span class="sxs-lookup"><span data-stu-id="469a6-233">If this simple approach using an allowed list of acceptable service names is insufficient, an application may provide its own service name validation by querying the <xref:System.Net.HttpListenerRequest.ServiceName%2A> property.</span></span> <span data-ttu-id="469a6-234">在上述情况 1 和 2 中，该属性将返回 `null`。</span><span class="sxs-lookup"><span data-stu-id="469a6-234">In cases 1 and 2 above, the property will return `null`.</span></span> <span data-ttu-id="469a6-235">在第 3 种情况中，它将返回空字符串。</span><span class="sxs-lookup"><span data-stu-id="469a6-235">In case 3, it will return an empty string.</span></span> <span data-ttu-id="469a6-236">在第 4 种情况中，将返回由客户端指定的服务名称。</span><span class="sxs-lookup"><span data-stu-id="469a6-236">In case 4, the service name specified by the client will be returned.</span></span>  
  
 <span data-ttu-id="469a6-237">这些扩展保护功能也可由服务器应用程序用于其他请求类型的、使用了受信任代理时的身份验证。</span><span class="sxs-lookup"><span data-stu-id="469a6-237">These extended protection features can also be used by server applications for authentication with other types of requests and when trusted proxies are used.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="469a6-238">请参阅</span><span class="sxs-lookup"><span data-stu-id="469a6-238">See also</span></span>

- <xref:System.Security.Authentication.ExtendedProtection>
- <xref:System.Security.Authentication.ExtendedProtection.Configuration>
