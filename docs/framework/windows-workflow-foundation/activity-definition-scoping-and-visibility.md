---
title: 活动定义范围和可见性
ms.date: 03/30/2017
ms.assetid: ccdffa07-9503-4eea-a61b-17f1564368b7
ms.openlocfilehash: c7f656fee4960a8c43ac58abafba400ed9b35bc1
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/26/2020
ms.locfileid: "96289160"
---
# <a name="activity-definition-scoping-and-visibility"></a><span data-ttu-id="980b8-102">活动定义范围和可见性</span><span class="sxs-lookup"><span data-stu-id="980b8-102">Activity Definition Scoping and Visibility</span></span>

<span data-ttu-id="980b8-103">正如对象的范围和可见性一样，活动定义范围和可见性是其他对象或活动访问此活动成员的能力。</span><span class="sxs-lookup"><span data-stu-id="980b8-103">Activity definition scoping and visibility, just like scoping and visibility of an object, is the ability of other objects or activities to access members of the activity.</span></span> <span data-ttu-id="980b8-104">通过以下实现来执行活动定义：</span><span class="sxs-lookup"><span data-stu-id="980b8-104">Activity definition is performed by the following implementations:</span></span>  
  
1. <span data-ttu-id="980b8-105">确定活动可向其用户公开的成员（<xref:System.Activities.Argument>、<xref:System.Activities.Variable> 和 <xref:System.Activities.ActivityDelegate> 对象以及子活动）。</span><span class="sxs-lookup"><span data-stu-id="980b8-105">Determining the members (<xref:System.Activities.Argument>, <xref:System.Activities.Variable>, and <xref:System.Activities.ActivityDelegate> objects, and child activities) an activity exposes to its users.</span></span>  
  
2. <span data-ttu-id="980b8-106">实现活动的执行逻辑</span><span class="sxs-lookup"><span data-stu-id="980b8-106">Implementing the execution logic of the activity</span></span>  
  
 <span data-ttu-id="980b8-107">该实现可能涉及未向活动的使用者公开但却作为该实现的详细信息的成员。</span><span class="sxs-lookup"><span data-stu-id="980b8-107">The implementation may involve members that are not exposed to consumers of the activity, but are rather details of the implementation.</span></span>  <span data-ttu-id="980b8-108">与类型定义类似，作者利用活动模型可以限定与要定义的活动定义有关的活动成员的可见性。</span><span class="sxs-lookup"><span data-stu-id="980b8-108">Similar to type definition, the activity model allows an author to qualify the visibility of an activity member regarding the definition of the activity being defined.</span></span>  <span data-ttu-id="980b8-109">此可见性控制成员使用的各个方面，如数据范围。</span><span class="sxs-lookup"><span data-stu-id="980b8-109">This visibility governs aspects of member usage, such as data scoping.</span></span>  
  
## <a name="scope"></a><span data-ttu-id="980b8-110">范围</span><span class="sxs-lookup"><span data-stu-id="980b8-110">Scope</span></span>  

 <span data-ttu-id="980b8-111">除了数据范围之外，活动模型可见性还可限制对活动的其他方面的访问，例如验证、调试、跟踪或追踪。</span><span class="sxs-lookup"><span data-stu-id="980b8-111">In addition to data scoping, activity model visibility can restrict access to other aspects of the activity, such as validation, debugging, tracking, or tracing.</span></span> <span data-ttu-id="980b8-112">执行属性使用可见性和范围，将执行特征约束到特定的定义范围。</span><span class="sxs-lookup"><span data-stu-id="980b8-112">Execution properties use visibility and scoping for constraining execution characteristics to a particular scope of definition.</span></span> <span data-ttu-id="980b8-113">辅助根使用可见性和范围，将 <xref:System.Activities.Statements.CompensableActivity> 捕获的状态约束到使用补偿活动的定义范围。</span><span class="sxs-lookup"><span data-stu-id="980b8-113">Secondary roots use visibility and scoping to constrain the state captured by a <xref:System.Activities.Statements.CompensableActivity> to the scope of definition in which the compensable activities are used.</span></span>  
  
## <a name="definition-and-usage"></a><span data-ttu-id="980b8-114">定义和用法</span><span class="sxs-lookup"><span data-stu-id="980b8-114">Definition and usage</span></span>  

 <span data-ttu-id="980b8-115">通过继承基活动类，并通过使用 [内置活动库](net-framework-4-5-built-in-activity-library.md)中的活动，编写工作流。</span><span class="sxs-lookup"><span data-stu-id="980b8-115">A workflow is written by authoring new activities by inheriting from base activity classes, and by using activities from the [Built-In Activity Library](net-framework-4-5-built-in-activity-library.md).</span></span> <span data-ttu-id="980b8-116">若要使用某个活动，该活动的作者必须配置其定义的每个组件的可见性。</span><span class="sxs-lookup"><span data-stu-id="980b8-116">In order to use an activity, the activity author must configure the visibility of each component of its definition.</span></span>  
  
### <a name="activity-members"></a><span data-ttu-id="980b8-117">活动成员</span><span class="sxs-lookup"><span data-stu-id="980b8-117">Activity Members</span></span>  

 <span data-ttu-id="980b8-118">活动模型定义活动提供给使用者的自变量、变量、委托和子活动。</span><span class="sxs-lookup"><span data-stu-id="980b8-118">The activity model defines the arguments, variables, delegates, and child activities that the activity makes available to consumers.</span></span> <span data-ttu-id="980b8-119">其中每个成员均可声明为 `public` 或 `private`。</span><span class="sxs-lookup"><span data-stu-id="980b8-119">Each of these members can be declared as `public` or `private`.</span></span> <span data-ttu-id="980b8-120">公共成员由活动的使用者进行配置，而`private`成员使用活动的作者确定的实现。</span><span class="sxs-lookup"><span data-stu-id="980b8-120">Public members are configured by the consumer of the activity, whereas `private` members use an implementation fixed by the author of the activity.</span></span> <span data-ttu-id="980b8-121">数据范围的可见性规则如下：</span><span class="sxs-lookup"><span data-stu-id="980b8-121">The visibility rules for data scoping are as follows:</span></span>  
  
1. <span data-ttu-id="980b8-122">公共成员和公共子活动的公共成员可引用公共变量。</span><span class="sxs-lookup"><span data-stu-id="980b8-122">Public members and the public members of public child activities can reference public variables.</span></span>  
  
2. <span data-ttu-id="980b8-123">私有成员和公共子活动的公共成员可引用参数和私有变量。</span><span class="sxs-lookup"><span data-stu-id="980b8-123">Private members and the public members of public child activities can reference arguments and private variables.</span></span>  
  
 <span data-ttu-id="980b8-124">绝对不要将可由活动的使用者设置的成员设置为私有成员。</span><span class="sxs-lookup"><span data-stu-id="980b8-124">A member that can be set by the consumer of an activity should never be made private.</span></span>  
  
### <a name="authoring-models"></a><span data-ttu-id="980b8-125">创作模型</span><span class="sxs-lookup"><span data-stu-id="980b8-125">Authoring Models</span></span>  

 <span data-ttu-id="980b8-126">通过使用 <xref:System.Activities.NativeActivity>、<xref:System.Activities.Activity>、<xref:System.Activities.CodeActivity> 或 <xref:System.Activities.AsyncCodeActivity> 定义自定义活动。</span><span class="sxs-lookup"><span data-stu-id="980b8-126">Custom activities are defined by using <xref:System.Activities.NativeActivity>, <xref:System.Activities.Activity>, <xref:System.Activities.CodeActivity>, or <xref:System.Activities.AsyncCodeActivity>.</span></span> <span data-ttu-id="980b8-127">派生自这些类的活动可公开具有不同可见性的不同成员类型。</span><span class="sxs-lookup"><span data-stu-id="980b8-127">Activities that derive from these classes can expose different member types with different visibilities.</span></span>  
  
#### <a name="nativeactivity"></a><span data-ttu-id="980b8-128">NativeActivity</span><span class="sxs-lookup"><span data-stu-id="980b8-128">NativeActivity</span></span>  

 <span data-ttu-id="980b8-129">派生自 <xref:System.Activities.NativeActivity> 的活动具有使用命令性代码编写的行为，而且还可选择使用现有活动定义这些活动。</span><span class="sxs-lookup"><span data-stu-id="980b8-129">Activities that derive from <xref:System.Activities.NativeActivity> have behavior that is written in imperative code, and can optionally be defined by using existing activities.</span></span> <span data-ttu-id="980b8-130">从 <xref:System.Activities.NativeActivity> 派生活动可授予对运行时公开的所有功能的访问权限。</span><span class="sxs-lookup"><span data-stu-id="980b8-130">Deriving activities from <xref:System.Activities.NativeActivity> grants access to all of the features exposed by the runtime.</span></span> <span data-ttu-id="980b8-131">此类活动的任何成员都可通过使用公共或私有可见性（只能声明为 `public` 的自变量除外）进行定义。</span><span class="sxs-lookup"><span data-stu-id="980b8-131">Any member of such an activity can be defined by using either public or private visibility, except arguments, which can only be declared as `public`.</span></span>  
  
 <span data-ttu-id="980b8-132">使用传递给 <xref:System.Activities.NativeActivity> 方法的 <xref:System.Activities.NativeActivityMetadata> 结构，将派生自 <xref:System.Activities.NativeActivity.CacheMetadata%2A> 的类的成员声明为运行时。</span><span class="sxs-lookup"><span data-stu-id="980b8-132">Members of classes derived from <xref:System.Activities.NativeActivity> are declared to the runtime using the <xref:System.Activities.NativeActivityMetadata> struct passed to the <xref:System.Activities.NativeActivity.CacheMetadata%2A> method.</span></span>  
  
#### <a name="activity"></a><span data-ttu-id="980b8-133">活动</span><span class="sxs-lookup"><span data-stu-id="980b8-133">Activity</span></span>  

 <span data-ttu-id="980b8-134">使用 <xref:System.Activities.Activity> 创建的活动具有通过撰写其他活动而严格设计的行为。</span><span class="sxs-lookup"><span data-stu-id="980b8-134">Activities created by using <xref:System.Activities.Activity> have behavior that is designed strictly through composing other activities.</span></span> <span data-ttu-id="980b8-135"><xref:System.Activities.Activity> 类具有一个实现子活动，该活动由运行时通过使用 <xref:System.Activities.Activity.Implementation%2A> 获取。</span><span class="sxs-lookup"><span data-stu-id="980b8-135">The <xref:System.Activities.Activity> class has one implementation child activity, obtained by the runtime using <xref:System.Activities.Activity.Implementation%2A>.</span></span> <span data-ttu-id="980b8-136">派生自 <xref:System.Activities.Activity> 的活动可定义公共自变量、公共变量、导入的 ActivityDelegates 以及导入的 Activities。</span><span class="sxs-lookup"><span data-stu-id="980b8-136">An activity deriving from <xref:System.Activities.Activity> can define public arguments, public variables, imported ActivityDelegates, and imported Activities.</span></span>  
  
 <span data-ttu-id="980b8-137">导入的 ActivityDelegates 和 Activities 声明为活动的公共子活动，但不能由活动直接计划。</span><span class="sxs-lookup"><span data-stu-id="980b8-137">Imported ActivityDelegates and Activities are declared as public children of the activity, but cannot be directly scheduled by the activity.</span></span> <span data-ttu-id="980b8-138">验证期间使用此信息，可避免在从不执行活动的位置运行面向父活动的验证。</span><span class="sxs-lookup"><span data-stu-id="980b8-138">This information is used during validation to avoid running parent-facing validations at locations where the activity will never execute.</span></span> <span data-ttu-id="980b8-139">另外，正如公共子活动一样，导入的子活动也可由活动的实现进行引用和计划。</span><span class="sxs-lookup"><span data-stu-id="980b8-139">Also, imported children, just like public children, can be referenced and scheduled by the activity’s implementation.</span></span> <span data-ttu-id="980b8-140">这意味着，用来导入 Activity1 的活动可将 <xref:System.Activities.Statements.Sequence> 包含在其计划 Activity1 的实现中。</span><span class="sxs-lookup"><span data-stu-id="980b8-140">This means that an activity which imports an activity called Activity1 can contain a <xref:System.Activities.Statements.Sequence> in its implementation which schedules Activity1.</span></span>  
  
#### <a name="codeactivity-asynccodeactivity"></a><span data-ttu-id="980b8-141">CodeActivity/ AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="980b8-141">CodeActivity/ AsyncCodeActivity</span></span>  

 <span data-ttu-id="980b8-142">此基类用于使用命令性代码创作行为。</span><span class="sxs-lookup"><span data-stu-id="980b8-142">This base class is used for authoring behavior in imperative code.</span></span> <span data-ttu-id="980b8-143">派生自此类的活动仅具有对其公开的自变量的访问权限。</span><span class="sxs-lookup"><span data-stu-id="980b8-143">Activities that derive from this class only have access to the arguments they expose.</span></span> <span data-ttu-id="980b8-144">这意味着仅这些活动能够公开的成员为公共自变量。</span><span class="sxs-lookup"><span data-stu-id="980b8-144">This means that the only members that these activities can expose are public arguments.</span></span> <span data-ttu-id="980b8-145">任何其他成员或可见性都不适用于这些活动。</span><span class="sxs-lookup"><span data-stu-id="980b8-145">No other members or visibilities apply to these activities.</span></span>  
  
#### <a name="summary-of-visibilities"></a><span data-ttu-id="980b8-146">可见性摘要</span><span class="sxs-lookup"><span data-stu-id="980b8-146">Summary of visibilities</span></span>  

 <span data-ttu-id="980b8-147">下表汇总了本节前面的信息。</span><span class="sxs-lookup"><span data-stu-id="980b8-147">The following table summarizes the information earlier in this section.</span></span>  
  
|<span data-ttu-id="980b8-148">成员类型</span><span class="sxs-lookup"><span data-stu-id="980b8-148">Member Type</span></span>|<span data-ttu-id="980b8-149">NativeActivity</span><span class="sxs-lookup"><span data-stu-id="980b8-149">NativeActivity</span></span>|<span data-ttu-id="980b8-150">活动</span><span class="sxs-lookup"><span data-stu-id="980b8-150">Activity</span></span>|<span data-ttu-id="980b8-151">CodeActivity/ AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="980b8-151">CodeActivity/ AsyncCodeActivity</span></span>|  
|-----------------|--------------------|--------------|--------------------------------------|  
|<span data-ttu-id="980b8-152">参数</span><span class="sxs-lookup"><span data-stu-id="980b8-152">Arguments</span></span>|<span data-ttu-id="980b8-153">公共/私有</span><span class="sxs-lookup"><span data-stu-id="980b8-153">Public/ Private</span></span>|<span data-ttu-id="980b8-154">公共</span><span class="sxs-lookup"><span data-stu-id="980b8-154">Public</span></span>|<span data-ttu-id="980b8-155">不适用</span><span class="sxs-lookup"><span data-stu-id="980b8-155">not applicable</span></span>|  
|<span data-ttu-id="980b8-156">变量</span><span class="sxs-lookup"><span data-stu-id="980b8-156">Variables</span></span>|<span data-ttu-id="980b8-157">公共/私有</span><span class="sxs-lookup"><span data-stu-id="980b8-157">Public/ Private</span></span>|<span data-ttu-id="980b8-158">公共</span><span class="sxs-lookup"><span data-stu-id="980b8-158">Public</span></span>|<span data-ttu-id="980b8-159">不适用</span><span class="sxs-lookup"><span data-stu-id="980b8-159">not applicable</span></span>|  
|<span data-ttu-id="980b8-160">子活动</span><span class="sxs-lookup"><span data-stu-id="980b8-160">Child Activities</span></span>|<span data-ttu-id="980b8-161">公共/私有</span><span class="sxs-lookup"><span data-stu-id="980b8-161">Public/ Private</span></span>|<span data-ttu-id="980b8-162">公共，在实现中定义的一个固定的私有子活动。</span><span class="sxs-lookup"><span data-stu-id="980b8-162">Public, one fixed private child defined in Implementation.</span></span>|<span data-ttu-id="980b8-163">不适用</span><span class="sxs-lookup"><span data-stu-id="980b8-163">not applicable</span></span>|  
|<span data-ttu-id="980b8-164">ActivityDelegates</span><span class="sxs-lookup"><span data-stu-id="980b8-164">ActivityDelegates</span></span>|<span data-ttu-id="980b8-165">公共/私有</span><span class="sxs-lookup"><span data-stu-id="980b8-165">Public/ Private</span></span>|<span data-ttu-id="980b8-166">公共</span><span class="sxs-lookup"><span data-stu-id="980b8-166">Public</span></span>|<span data-ttu-id="980b8-167">不适用</span><span class="sxs-lookup"><span data-stu-id="980b8-167">not applicable</span></span>|  
  
 <span data-ttu-id="980b8-168">一般来说，活动的使用者无法设置的成员不应成为公共成员。</span><span class="sxs-lookup"><span data-stu-id="980b8-168">In general, a member that cannot be set by the consumer of an activity should not be made public.</span></span>  
  
### <a name="execution-properties"></a><span data-ttu-id="980b8-169">执行属性</span><span class="sxs-lookup"><span data-stu-id="980b8-169">Execution Properties</span></span>  

 <span data-ttu-id="980b8-170">在有些方案中，将特定执行属性的范围限定为某活动的公共子活动很有用。</span><span class="sxs-lookup"><span data-stu-id="980b8-170">In some scenarios, it is useful to scope a particular execution property to the public children of an activity.</span></span> <span data-ttu-id="980b8-171"><xref:System.Activities.ExecutionProperties> 集合使用 <xref:System.Activities.ExecutionProperties.Add%2A> 方法提供此功能。</span><span class="sxs-lookup"><span data-stu-id="980b8-171">The <xref:System.Activities.ExecutionProperties> collection provides this capability with the <xref:System.Activities.ExecutionProperties.Add%2A> method.</span></span> <span data-ttu-id="980b8-172">此方法具有一个 Boolean 参数，该参数指示是将特定属性的范围限定为所有子活动，还是只限定为公共活动。</span><span class="sxs-lookup"><span data-stu-id="980b8-172">This method has a Boolean parameter indicating whether a particular property is scoped to all children, or just those that are public.</span></span> <span data-ttu-id="980b8-173">如果此参数设置为 `true`，则属性仅对公共成员及其公共子活动的公共成员可见。</span><span class="sxs-lookup"><span data-stu-id="980b8-173">If this parameter is set to `true`, the property will only be visible to public members and the public members of their public children.</span></span>  
  
### <a name="secondary-roots"></a><span data-ttu-id="980b8-174">辅助根</span><span class="sxs-lookup"><span data-stu-id="980b8-174">Secondary Roots</span></span>  

 <span data-ttu-id="980b8-175">辅助根是运行时的内部机制，可用于管理补偿活动的状态。</span><span class="sxs-lookup"><span data-stu-id="980b8-175">A secondary root is the runtime’s internal mechanism for managing state for compensation activities.</span></span> <span data-ttu-id="980b8-176">当 <xref:System.Activities.Statements.CompensableActivity> 完成运行时，不会立即清除其状态。</span><span class="sxs-lookup"><span data-stu-id="980b8-176">When a <xref:System.Activities.Statements.CompensableActivity> has finished running, its state is not cleaned up immediately.</span></span> <span data-ttu-id="980b8-177">而是由运行时将此状态维护在辅助根中，直到补偿段完成。</span><span class="sxs-lookup"><span data-stu-id="980b8-177">Instead, the state is maintained by the runtime in a secondary root until the compensation episode has completed.</span></span> <span data-ttu-id="980b8-178">使用辅助根捕获的位置环境与使用补偿活动的定义的范围相对应。</span><span class="sxs-lookup"><span data-stu-id="980b8-178">The location environments captured with the secondary root correspond to the scope of definition in which the Compensable activity is used.</span></span>
