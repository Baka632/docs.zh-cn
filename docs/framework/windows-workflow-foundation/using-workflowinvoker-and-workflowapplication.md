---
title: 使用 WorkflowInvoker 和 WorkflowApplication
description: 本文介绍了如何使用 WorkflowInvoker 和 WorkflowApplication 在 Windows Workflow Foundation 中进行工作流托管。
ms.date: 03/30/2017
ms.assetid: cd0e583c-a3f9-4fa2-b247-c7b3368c48a7
ms.openlocfilehash: 1cc84afe002615c317309054179abd1af5800e9c
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/26/2020
ms.locfileid: "96254605"
---
# <a name="using-workflowinvoker-and-workflowapplication"></a><span data-ttu-id="54c9b-103">使用 WorkflowInvoker 和 WorkflowApplication</span><span class="sxs-lookup"><span data-stu-id="54c9b-103">Using WorkflowInvoker and WorkflowApplication</span></span>

<span data-ttu-id="54c9b-104">Windows Workflow Foundation (WF) 提供多种承载工作流的方法。</span><span class="sxs-lookup"><span data-stu-id="54c9b-104">Windows Workflow Foundation (WF) provides several methods of hosting workflows.</span></span> <span data-ttu-id="54c9b-105"><xref:System.Activities.WorkflowInvoker> 提供一种简单工作流调用方法，就像方法调用一样，仅可用于不使用持久性的工作流。</span><span class="sxs-lookup"><span data-stu-id="54c9b-105"><xref:System.Activities.WorkflowInvoker> provides a simple way for invoking a workflow as if it were a method call and can be used only for workflows that do not use persistence.</span></span> <span data-ttu-id="54c9b-106"><xref:System.Activities.WorkflowApplication> 为执行工作流（包括生命周期事件通知、执行控制、书签恢复和持久性）提供更丰富的模型。</span><span class="sxs-lookup"><span data-stu-id="54c9b-106"><xref:System.Activities.WorkflowApplication> provides a richer model for executing workflows that includes notification of lifecycle events, execution control, bookmark resumption, and persistence.</span></span> <span data-ttu-id="54c9b-107"><xref:System.ServiceModel.Activities.WorkflowServiceHost> 为消息传递活动提供支持，主要用于工作流服务。</span><span class="sxs-lookup"><span data-stu-id="54c9b-107"><xref:System.ServiceModel.Activities.WorkflowServiceHost> provides support for messaging activities and is primarily used with workflow services.</span></span> <span data-ttu-id="54c9b-108">本主题介绍使用 <xref:System.Activities.WorkflowInvoker> 和 <xref:System.Activities.WorkflowApplication> 的工作流承载。</span><span class="sxs-lookup"><span data-stu-id="54c9b-108">This topic introduces you to workflow hosting with <xref:System.Activities.WorkflowInvoker> and <xref:System.Activities.WorkflowApplication>.</span></span> <span data-ttu-id="54c9b-109">有关托管工作流的详细信息 <xref:System.ServiceModel.Activities.WorkflowServiceHost> ，请参阅 [工作流服务](../wcf/feature-details/workflow-services.md) 和 [承载工作流服务概述](../wcf/feature-details/hosting-workflow-services-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="54c9b-109">For more information about hosting workflows with <xref:System.ServiceModel.Activities.WorkflowServiceHost>, see [Workflow Services](../wcf/feature-details/workflow-services.md) and [Hosting Workflow Services Overview](../wcf/feature-details/hosting-workflow-services-overview.md).</span></span>  
  
## <a name="using-workflowinvoker"></a><span data-ttu-id="54c9b-110">使用 WorkflowInvoker</span><span class="sxs-lookup"><span data-stu-id="54c9b-110">Using WorkflowInvoker</span></span>  

 <span data-ttu-id="54c9b-111"><xref:System.Activities.WorkflowInvoker> 提供一种执行工作流的模型，如同使用方法调用。</span><span class="sxs-lookup"><span data-stu-id="54c9b-111"><xref:System.Activities.WorkflowInvoker> provides a model for executing a workflow as if it were a method call.</span></span> <span data-ttu-id="54c9b-112">若要使用 <xref:System.Activities.WorkflowInvoker> 调用工作流，请调用 <xref:System.Activities.WorkflowInvoker.Invoke%2A> 方法，并传入要调用的工作流的工作流定义。</span><span class="sxs-lookup"><span data-stu-id="54c9b-112">To invoke a workflow using <xref:System.Activities.WorkflowInvoker>, call the <xref:System.Activities.WorkflowInvoker.Invoke%2A> method and pass in the workflow definition of the workflow to invoke.</span></span> <span data-ttu-id="54c9b-113">在本示例中，使用 <xref:System.Activities.Statements.WriteLine> 调用 <xref:System.Activities.WorkflowInvoker> 活动。</span><span class="sxs-lookup"><span data-stu-id="54c9b-113">In this example, a <xref:System.Activities.Statements.WriteLine> activity is invoked using <xref:System.Activities.WorkflowInvoker>.</span></span>  
  
 [!code-csharp[CFX_WorkflowInvokerExample#1](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowinvokerexample/cs/program.cs#1)]  
  
 <span data-ttu-id="54c9b-114">使用 <xref:System.Activities.WorkflowInvoker> 调用工作流时，该工作流在调用线程上执行，并且在该工作流完成之前（包括任何空闲时间）会阻止 <xref:System.Activities.WorkflowInvoker.Invoke%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="54c9b-114">When a workflow is invoked using <xref:System.Activities.WorkflowInvoker>, the workflow executes on the calling thread and the <xref:System.Activities.WorkflowInvoker.Invoke%2A> method blocks until the workflow is complete, including any idle time.</span></span> <span data-ttu-id="54c9b-115">若要配置一个工作流必须在其间完成的超时间隔，请使用一个采用 <xref:System.Activities.WorkflowInvoker.Invoke%2A> 参数的 <xref:System.TimeSpan> 重载。</span><span class="sxs-lookup"><span data-stu-id="54c9b-115">To configure a time-out interval in which the workflow must complete, use one of the <xref:System.Activities.WorkflowInvoker.Invoke%2A> overloads that takes a <xref:System.TimeSpan> parameter.</span></span> <span data-ttu-id="54c9b-116">在本示例中，将使用两个不同的超时间隔来调用两次工作流。</span><span class="sxs-lookup"><span data-stu-id="54c9b-116">In this example, a workflow is invoked twice with two different time-out intervals.</span></span> <span data-ttu-id="54c9b-117">第一个工作流完成，但第二个工作流未完成。</span><span class="sxs-lookup"><span data-stu-id="54c9b-117">The first workflow complets, but the second does not.</span></span>  
  
 [!code-csharp[CFX_WorkflowInvokerExample#50](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowinvokerexample/cs/program.cs#50)]  
  
> [!NOTE]
> <span data-ttu-id="54c9b-118">仅在达到超时间隔且工作流在执行期间进入空闲状态时才会引发 <xref:System.TimeoutException>。</span><span class="sxs-lookup"><span data-stu-id="54c9b-118">The <xref:System.TimeoutException> is only thrown if the time-out interval elapses and the workflow becomes idle during execution.</span></span> <span data-ttu-id="54c9b-119">如果工作流未进入空闲状态，那么完成时间超过指定超时间隔的工作流将会成功完成。</span><span class="sxs-lookup"><span data-stu-id="54c9b-119">A workflow that takes longer than the specified time-out interval to complete completes successfully if the workflow does not become idle.</span></span>  
  
 <span data-ttu-id="54c9b-120"><xref:System.Activities.WorkflowInvoker> 还提供了调用方法的异步版本。</span><span class="sxs-lookup"><span data-stu-id="54c9b-120"><xref:System.Activities.WorkflowInvoker> also provides asynchronous versions of the invoke method.</span></span> <span data-ttu-id="54c9b-121">有关详细信息，请参阅 <xref:System.Activities.WorkflowInvoker.InvokeAsync%2A> 和 <xref:System.Activities.WorkflowInvoker.BeginInvoke%2A>。</span><span class="sxs-lookup"><span data-stu-id="54c9b-121">For more information, see <xref:System.Activities.WorkflowInvoker.InvokeAsync%2A> and <xref:System.Activities.WorkflowInvoker.BeginInvoke%2A>.</span></span>  
  
### <a name="setting-input-arguments-of-a-workflow"></a><span data-ttu-id="54c9b-122">设置工作流的输入自变量</span><span class="sxs-lookup"><span data-stu-id="54c9b-122">Setting Input Arguments of a Workflow</span></span>  

 <span data-ttu-id="54c9b-123">使用输入参数字典可将数据传入工作流，其中自变量名作为键，并映射到工作流的输入自变量。</span><span class="sxs-lookup"><span data-stu-id="54c9b-123">Data can be passed into a workflow using a dictionary of input parameters, keyed by argument name, that map to the input arguments of the workflow.</span></span> <span data-ttu-id="54c9b-124">在本示例中，将要调用 <xref:System.Activities.Statements.WriteLine>，并使用输入参数字典指定其 <xref:System.Activities.Statements.WriteLine.Text%2A> 自变量值。</span><span class="sxs-lookup"><span data-stu-id="54c9b-124">In this example, a <xref:System.Activities.Statements.WriteLine> is invoked and the value for its <xref:System.Activities.Statements.WriteLine.Text%2A> argument is specified using the dictionary of input parameters.</span></span>  
  
 [!code-csharp[CFX_WorkflowInvokerExample#3](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowinvokerexample/cs/program.cs#3)]  
  
### <a name="retrieving-output-arguments-of-a-workflow"></a><span data-ttu-id="54c9b-125">检索工作流的输出自变量</span><span class="sxs-lookup"><span data-stu-id="54c9b-125">Retrieving Output Arguments of a Workflow</span></span>  

 <span data-ttu-id="54c9b-126">使用调用 <xref:System.Activities.WorkflowInvoker.Invoke%2A> 所返回的输出字典，可获得工作流的输出形参。</span><span class="sxs-lookup"><span data-stu-id="54c9b-126">The output parameters of a workflow can be obtained using the outputs dictionary that is returned from the call to <xref:System.Activities.WorkflowInvoker.Invoke%2A>.</span></span> <span data-ttu-id="54c9b-127">下面的示例调用一个工作流，该工作流包含有两个输入自变量和两个输出自变量的单个 `Divide` 活动。</span><span class="sxs-lookup"><span data-stu-id="54c9b-127">The following example invokes a workflow consisting of a single `Divide` activity that has two input arguments and two output arguments.</span></span> <span data-ttu-id="54c9b-128">调用工作流时，会传递包含每个输入自变量的值的 `arguments` 字典（由自变量名键控）。</span><span class="sxs-lookup"><span data-stu-id="54c9b-128">When the workflow is invoked, the `arguments` dictionary is passed which contains the values for each input argument, keyed by argument name.</span></span> <span data-ttu-id="54c9b-129">当对 `Invoke` 的调用返回时，将在 `outputs` 字典中返回每个输出参数（也由参数名键控）。</span><span class="sxs-lookup"><span data-stu-id="54c9b-129">When the call to `Invoke` returns, each output argument is returned in the `outputs` dictionary, also keyed by argument name.</span></span>  
  
 [!code-csharp[CFX_WorkflowInvokerExample#120](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowinvokerexample/cs/program.cs#120)]  
  
 [!code-csharp[CFX_WorkflowInvokerExample#20](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowinvokerexample/cs/program.cs#20)]  
  
 <span data-ttu-id="54c9b-130">如果工作流派生自 <xref:System.Activities.ActivityWithResult>（例如 `CodeActivity<TResult>` 或 `Activity<TResult>`），并且除了正确定义的 <xref:System.Activities.Activity%601.Result%2A> 输出自变量之外还有其他输出自变量，则必须使用 `Invoke` 的非泛型重载来检索其他自变量。</span><span class="sxs-lookup"><span data-stu-id="54c9b-130">If the workflow derives from <xref:System.Activities.ActivityWithResult>, such as `CodeActivity<TResult>` or `Activity<TResult>`, and there are output arguments in addition to the well-defined <xref:System.Activities.Activity%601.Result%2A> output argument, a non-generic overload of `Invoke` must be used in order to retrieve the additional arguments.</span></span> <span data-ttu-id="54c9b-131">为此，传递给 `Invoke` 的工作流定义必须为 <xref:System.Activities.Activity> 类型。</span><span class="sxs-lookup"><span data-stu-id="54c9b-131">To do this, the workflow definition passed into `Invoke` must be of type <xref:System.Activities.Activity>.</span></span> <span data-ttu-id="54c9b-132">在此示例中，`Divide` 活动派生自 `CodeActivity<int>`，但被声明为 <xref:System.Activities.Activity>。因此，将使用 `Invoke` 的非泛型重载，并返回参数字典，而不是单个返回值。</span><span class="sxs-lookup"><span data-stu-id="54c9b-132">In this example the `Divide` activity derives from `CodeActivity<int>`, but is declared as <xref:System.Activities.Activity> so that a non-generic overload of `Invoke` is used which returns a dictionary of arguments instead of a single return value.</span></span>  
  
 [!code-csharp[CFX_WorkflowInvokerExample#121](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowinvokerexample/cs/program.cs#121)]  
  
 [!code-csharp[CFX_WorkflowInvokerExample#21](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowinvokerexample/cs/program.cs#21)]  
  
## <a name="using-workflowapplication"></a><span data-ttu-id="54c9b-133">使用 WorkflowApplication</span><span class="sxs-lookup"><span data-stu-id="54c9b-133">Using WorkflowApplication</span></span>  

 <span data-ttu-id="54c9b-134"><xref:System.Activities.WorkflowApplication> 为工作流实例管理提供了丰富的功能集。</span><span class="sxs-lookup"><span data-stu-id="54c9b-134"><xref:System.Activities.WorkflowApplication> provides a rich set of features for workflow instance management.</span></span> <span data-ttu-id="54c9b-135"><xref:System.Activities.WorkflowApplication> 承担实际 <xref:System.Activities.Hosting.WorkflowInstance> 的线程安全代理任务，可封装运行时，并提供若干方法，用于创建和加载工作流实例、暂停与继续、终止和通知生命周期事件。</span><span class="sxs-lookup"><span data-stu-id="54c9b-135"><xref:System.Activities.WorkflowApplication> acts as a thread safe proxy to the actual  <xref:System.Activities.Hosting.WorkflowInstance>, which encapsulates the runtime, and provides methods for creating and loading workflow instances, pausing and resuming, terminating, and notification of lifecycle events.</span></span> <span data-ttu-id="54c9b-136">若要使用 <xref:System.Activities.WorkflowApplication> 运行工作流，应创建 <xref:System.Activities.WorkflowApplication>，订阅所需的所有生命周期事件，启动工作流，然后等待其完成。</span><span class="sxs-lookup"><span data-stu-id="54c9b-136">To run a workflow using <xref:System.Activities.WorkflowApplication> you create the <xref:System.Activities.WorkflowApplication>, subscribe to any desired lifecycle events, start the workflow, and then wait for it to finish.</span></span> <span data-ttu-id="54c9b-137">在本示例中，将要创建由 <xref:System.Activities.Statements.WriteLine> 活动组成定义的工作流，并使用指定工作流定义创建 <xref:System.Activities.WorkflowApplication>。</span><span class="sxs-lookup"><span data-stu-id="54c9b-137">In this example, a workflow definition that consists of a <xref:System.Activities.Statements.WriteLine> activity is created and a <xref:System.Activities.WorkflowApplication> is created using the specified workflow definition.</span></span> <span data-ttu-id="54c9b-138">处理 <xref:System.Activities.WorkflowApplication.Completed%2A> 以便在工作流完成时通知宿主，通过调用 <xref:System.Activities.WorkflowApplication.Run%2A> 启动工作流，然后宿主等待工作流完成。</span><span class="sxs-lookup"><span data-stu-id="54c9b-138"><xref:System.Activities.WorkflowApplication.Completed%2A> is handled so the host is notified when the workflow completes, the workflow is started with a call to <xref:System.Activities.WorkflowApplication.Run%2A>, and then the host waits for the workflow to complete.</span></span> <span data-ttu-id="54c9b-139">工作流完成时，设置 <xref:System.Threading.AutoResetEvent>，并且主机应用程序可以继续执行，如下例所示。</span><span class="sxs-lookup"><span data-stu-id="54c9b-139">When the workflow completes, the <xref:System.Threading.AutoResetEvent> is set and the host application can resume execution, as shown in the following example.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#31](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#31)]  
  
### <a name="workflowapplication-lifecycle-events"></a><span data-ttu-id="54c9b-140">WorkflowApplication 生命周期事件</span><span class="sxs-lookup"><span data-stu-id="54c9b-140">WorkflowApplication Lifecycle Events</span></span>  

 <span data-ttu-id="54c9b-141">除了 <xref:System.Activities.WorkflowApplication.Completed%2A>，当卸载工作流（<xref:System.Activities.WorkflowApplication.Unloaded%2A>）、中止工作流（<xref:System.Activities.WorkflowApplication.Aborted%2A>）、工作流变空闲（<xref:System.Activities.WorkflowApplication.Idle%2A> 和 <xref:System.Activities.WorkflowApplication.PersistableIdle%2A>）或产生未经处理的异常（<xref:System.Activities.WorkflowApplication.OnUnhandledException%2A>）时，宿主作者会收到通知。</span><span class="sxs-lookup"><span data-stu-id="54c9b-141">In addition to <xref:System.Activities.WorkflowApplication.Completed%2A>, host authors can be notified when a workflow is unloaded (<xref:System.Activities.WorkflowApplication.Unloaded%2A>), aborted (<xref:System.Activities.WorkflowApplication.Aborted%2A>), becomes idle (<xref:System.Activities.WorkflowApplication.Idle%2A> and <xref:System.Activities.WorkflowApplication.PersistableIdle%2A>), or an unhandled exception occurs (<xref:System.Activities.WorkflowApplication.OnUnhandledException%2A>).</span></span> <span data-ttu-id="54c9b-142">工作流应用程序开发人员可处理这些通知，并执行适当的操作，如下例所示。</span><span class="sxs-lookup"><span data-stu-id="54c9b-142">Workflow application developers can handle these notifications and take appropriate action, as shown in the following example.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#32](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#32)]  
  
### <a name="setting-input-arguments-of-a-workflow"></a><span data-ttu-id="54c9b-143">设置工作流的输入自变量</span><span class="sxs-lookup"><span data-stu-id="54c9b-143">Setting Input Arguments of a Workflow</span></span>  

 <span data-ttu-id="54c9b-144">启动工作流时可使用形参字典将数据传入工作流，这与使用 <xref:System.Activities.WorkflowInvoker> 时传入数据的方式类似。</span><span class="sxs-lookup"><span data-stu-id="54c9b-144">Data can be passed into a workflow as it is started using a dictionary of parameters, similar to the way data is passed in when using <xref:System.Activities.WorkflowInvoker>.</span></span> <span data-ttu-id="54c9b-145">字典中的每一项都映射到指定工作流的一个输入自变量。</span><span class="sxs-lookup"><span data-stu-id="54c9b-145">Each item in the dictionary maps to an input argument of the specified workflow.</span></span> <span data-ttu-id="54c9b-146">在本示例中，将要调用由 <xref:System.Activities.Statements.WriteLine> 活动组成的工作流，并使用输入参数字典指定其 <xref:System.Activities.Statements.WriteLine.Text%2A> 自变量。</span><span class="sxs-lookup"><span data-stu-id="54c9b-146">In this example, a workflow that consists of a <xref:System.Activities.Statements.WriteLine> activity is invoked and its <xref:System.Activities.Statements.WriteLine.Text%2A> argument is specified using the dictionary of input parameters.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#30](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#30)]  
  
### <a name="retrieving-output-arguments-of-a-workflow"></a><span data-ttu-id="54c9b-147">检索工作流的输出自变量</span><span class="sxs-lookup"><span data-stu-id="54c9b-147">Retrieving Output Arguments of a Workflow</span></span>  

 <span data-ttu-id="54c9b-148">当工作流完成时，可通过访问 <xref:System.Activities.WorkflowApplication.Completed%2A> 字典在 <xref:System.Activities.WorkflowApplicationCompletedEventArgs.Outputs%2A?displayProperty=nameWithType> 处理程序中检索任何输出自变量。</span><span class="sxs-lookup"><span data-stu-id="54c9b-148">When a workflow completes, any output arguments can be retrieved in the <xref:System.Activities.WorkflowApplication.Completed%2A> handler by accessing the <xref:System.Activities.WorkflowApplicationCompletedEventArgs.Outputs%2A?displayProperty=nameWithType> dictionary.</span></span> <span data-ttu-id="54c9b-149">下面的示例使用 <xref:System.Activities.WorkflowApplication> 承载一个工作流。</span><span class="sxs-lookup"><span data-stu-id="54c9b-149">The following example hosts a workflow using <xref:System.Activities.WorkflowApplication>.</span></span> <span data-ttu-id="54c9b-150"><xref:System.Activities.WorkflowApplication>实例是使用由单个活动组成的工作流定义构造的 `DiceRoll` 。</span><span class="sxs-lookup"><span data-stu-id="54c9b-150">A <xref:System.Activities.WorkflowApplication> instance is constructed using a workflow definition consisting of a single `DiceRoll` activity.</span></span> <span data-ttu-id="54c9b-151">`DiceRoll` 活动包含两个表示掷骰子操作结果的输出自变量。</span><span class="sxs-lookup"><span data-stu-id="54c9b-151">The `DiceRoll` activity has two output arguments that represent the results of the dice roll operation.</span></span> <span data-ttu-id="54c9b-152">当工作流完成时，将在 <xref:System.Activities.WorkflowApplication.Completed%2A> 处理程序中检索输出。</span><span class="sxs-lookup"><span data-stu-id="54c9b-152">When the workflow completes, the outputs are retrieved in the <xref:System.Activities.WorkflowApplication.Completed%2A> handler.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#130](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#130)]  
  
 [!code-csharp[CFX_WorkflowApplicationExample#21](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#21)]  
  
> [!NOTE]
> <span data-ttu-id="54c9b-153"><xref:System.Activities.WorkflowApplication> 和 <xref:System.Activities.WorkflowInvoker> 采用输入自变量字典，并返回 `out` 自变量的字典。</span><span class="sxs-lookup"><span data-stu-id="54c9b-153"><xref:System.Activities.WorkflowApplication> and <xref:System.Activities.WorkflowInvoker> take a dictionary of input arguments and return a dictionary of `out` arguments.</span></span> <span data-ttu-id="54c9b-154">这些字典形参、属性及返回值的类型为 `IDictionary<string, object>`。</span><span class="sxs-lookup"><span data-stu-id="54c9b-154">These dictionary parameters, properties, and return values are of type `IDictionary<string, object>`.</span></span> <span data-ttu-id="54c9b-155">传入的字典类的实际实例可以是实现了 `IDictionary<string, object>` 的任何类。</span><span class="sxs-lookup"><span data-stu-id="54c9b-155">The actual instance of the dictionary class that is passed in can be any class that implements `IDictionary<string, object>`.</span></span> <span data-ttu-id="54c9b-156">在这些示例中使用了 `Dictionary<string, object>`。</span><span class="sxs-lookup"><span data-stu-id="54c9b-156">In these examples, `Dictionary<string, object>` is used.</span></span> <span data-ttu-id="54c9b-157">有关字典的详细信息，请参阅 <xref:System.Collections.Generic.IDictionary%602> 和 <xref:System.Collections.Generic.Dictionary%602> 。</span><span class="sxs-lookup"><span data-stu-id="54c9b-157">For more information about dictionaries, see <xref:System.Collections.Generic.IDictionary%602> and <xref:System.Collections.Generic.Dictionary%602>.</span></span>  
  
### <a name="passing-data-into-a-running-workflow-using-bookmarks"></a><span data-ttu-id="54c9b-158">使用书签将数据传入运行中的工作流</span><span class="sxs-lookup"><span data-stu-id="54c9b-158">Passing Data into a Running Workflow Using Bookmarks</span></span>  

 <span data-ttu-id="54c9b-159">书签是使活动能够被动等待继续的机制，也是将数据传入运行中的工作流实例的机制。</span><span class="sxs-lookup"><span data-stu-id="54c9b-159">Bookmarks are the mechanism by which an activity can passively wait to be resumed and are a mechanism for passing data into a running workflow instance.</span></span> <span data-ttu-id="54c9b-160">如果某个活动在等待数据，它可以创建 <xref:System.Activities.Bookmark>，并注册一个在继续 <xref:System.Activities.Bookmark> 时要调用的回调方法，如下例所示。</span><span class="sxs-lookup"><span data-stu-id="54c9b-160">If an activity is waiting for data, it can create a <xref:System.Activities.Bookmark> and register a callback method to be called when the <xref:System.Activities.Bookmark> is resumed, as shown in the following example.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#15](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#15)]  
  
 <span data-ttu-id="54c9b-161">执行时，`ReadLine` 活动创建 <xref:System.Activities.Bookmark>，注册回调，然后等待 <xref:System.Activities.Bookmark> 继续。</span><span class="sxs-lookup"><span data-stu-id="54c9b-161">When executed, the `ReadLine` activity creates a <xref:System.Activities.Bookmark>, registers a callback, and then waits for the <xref:System.Activities.Bookmark> to be resumed.</span></span> <span data-ttu-id="54c9b-162">继续后，`ReadLine` 活动将随 <xref:System.Activities.Bookmark> 传递的数据赋给其 <xref:System.Activities.Activity%601.Result%2A> 实参。</span><span class="sxs-lookup"><span data-stu-id="54c9b-162">When it is resumed, the `ReadLine` activity assigns the data that was passed with the <xref:System.Activities.Bookmark> to its <xref:System.Activities.Activity%601.Result%2A> argument.</span></span> <span data-ttu-id="54c9b-163">在本示例中，将要创建一个工作流，该工作流使用 `ReadLine` 活动来收集用户名称并将其显示在控制台窗口中。</span><span class="sxs-lookup"><span data-stu-id="54c9b-163">In this example, a workflow is created that uses the `ReadLine` activity to gather the user’s name and display it to the console window.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#22](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#22)]  
  
 <span data-ttu-id="54c9b-164">执行 `ReadLine` 活动时，该活动创建一个名为 <xref:System.Activities.Bookmark> 的 `UserName`，然后等待书签继续。</span><span class="sxs-lookup"><span data-stu-id="54c9b-164">When the `ReadLine` activity is executed, it creates a <xref:System.Activities.Bookmark> named `UserName` and then waits for the bookmark to be resumed.</span></span> <span data-ttu-id="54c9b-165">宿主收集所需的数据，然后继续 <xref:System.Activities.Bookmark>。</span><span class="sxs-lookup"><span data-stu-id="54c9b-165">The host collects the desired data and then resumes the <xref:System.Activities.Bookmark>.</span></span> <span data-ttu-id="54c9b-166">工作流继续，显示该名称，然后完成。</span><span class="sxs-lookup"><span data-stu-id="54c9b-166">The workflow resumes, displays the name, and then completes.</span></span>  
  
 <span data-ttu-id="54c9b-167">主机应用程序可以检查工作流，以确定其中是否存在任何活动书签。</span><span class="sxs-lookup"><span data-stu-id="54c9b-167">The host application can inspect the workflow to determine if there are any active bookmarks.</span></span> <span data-ttu-id="54c9b-168">这可以通过以下方式来完成：调用 <xref:System.Activities.WorkflowApplication.GetBookmarks%2A> 实例的 <xref:System.Activities.WorkflowApplication> 方法，或者，在 <xref:System.Activities.WorkflowApplicationIdleEventArgs> 处理程序中检查 <xref:System.Activities.WorkflowApplication.Idle%2A>。</span><span class="sxs-lookup"><span data-stu-id="54c9b-168">It can do this by calling the <xref:System.Activities.WorkflowApplication.GetBookmarks%2A> method of a <xref:System.Activities.WorkflowApplication> instance, or by inspecting the <xref:System.Activities.WorkflowApplicationIdleEventArgs> in the <xref:System.Activities.WorkflowApplication.Idle%2A> handler.</span></span>  
  
 <span data-ttu-id="54c9b-169">下面的代码示例与前一个示例类似，但在继续书签之前会枚举活动书签。</span><span class="sxs-lookup"><span data-stu-id="54c9b-169">The following code example is like the previous example except that the active bookmarks are enumerated before the bookmark is resumed.</span></span> <span data-ttu-id="54c9b-170">该示例启动工作流，一旦创建了 <xref:System.Activities.Bookmark> 并且工作流进入空闲状态，就调用 <xref:System.Activities.WorkflowApplication.GetBookmarks%2A>。</span><span class="sxs-lookup"><span data-stu-id="54c9b-170">The workflow is started, and once the <xref:System.Activities.Bookmark> is created and the workflow goes idle, <xref:System.Activities.WorkflowApplication.GetBookmarks%2A> is called.</span></span> <span data-ttu-id="54c9b-171">完成工作流时，会向控制台显示以下输出。</span><span class="sxs-lookup"><span data-stu-id="54c9b-171">When the workflow is completed, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="54c9b-172">**你叫什么名字？**</span><span class="sxs-lookup"><span data-stu-id="54c9b-172">**What is your name?**</span></span>  
<span data-ttu-id="54c9b-173">**BookmarkName：用户名-OwnerDisplayName： ReadLine** 
**Steve** 
**你好，Steve**</span><span class="sxs-lookup"><span data-stu-id="54c9b-173">**BookmarkName: UserName - OwnerDisplayName: ReadLine**
**Steve**
**Hello, Steve**</span></span>

[!code-csharp[CFX_WorkflowApplicationExample#14](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#14)]  
  
 <span data-ttu-id="54c9b-174">下面的代码示例检查传递给 <xref:System.Activities.WorkflowApplicationIdleEventArgs> 实例的 <xref:System.Activities.WorkflowApplication.Idle%2A>  处理程序的 <xref:System.Activities.WorkflowApplication>。</span><span class="sxs-lookup"><span data-stu-id="54c9b-174">The following code example inspects the <xref:System.Activities.WorkflowApplicationIdleEventArgs> passed into the <xref:System.Activities.WorkflowApplication.Idle%2A> handler of a <xref:System.Activities.WorkflowApplication> instance.</span></span> <span data-ttu-id="54c9b-175">在此示例中，进入空闲状态的工作流包含一个由名为 <xref:System.Activities.Bookmark> 的活动所拥有的名为 `EnterGuess` 的 `ReadInt`。</span><span class="sxs-lookup"><span data-stu-id="54c9b-175">In this example the workflow going idle has one <xref:System.Activities.Bookmark> with a name of `EnterGuess`, owned by an activity named `ReadInt`.</span></span> <span data-ttu-id="54c9b-176">此代码示例基于 [如何：运行工作流，该工作流](how-to-run-a-workflow.md)是 [入门教程](getting-started-tutorial.md)的一部分。</span><span class="sxs-lookup"><span data-stu-id="54c9b-176">This code example is based off of [How to: Run a Workflow](how-to-run-a-workflow.md), which is part of the [Getting Started Tutorial](getting-started-tutorial.md).</span></span> <span data-ttu-id="54c9b-177">如果修改了该阶段中的 <xref:System.Activities.WorkflowApplication.Idle%2A> 处理程序以包含此示例中的代码，则将显示以下输出。</span><span class="sxs-lookup"><span data-stu-id="54c9b-177">If the <xref:System.Activities.WorkflowApplication.Idle%2A> handler in that step is modified to contain the code from this example, the following output is displayed.</span></span>  
  
 <span data-ttu-id="54c9b-178">**BookmarkName: EnterGuess - OwnerDisplayName: ReadInt**</span><span class="sxs-lookup"><span data-stu-id="54c9b-178">**BookmarkName: EnterGuess - OwnerDisplayName: ReadInt**</span></span>

 [!code-csharp[CFX_WorkflowApplicationExample#2](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#2)]  
  
## <a name="summary"></a><span data-ttu-id="54c9b-179">总结</span><span class="sxs-lookup"><span data-stu-id="54c9b-179">Summary</span></span>  

 <span data-ttu-id="54c9b-180"><xref:System.Activities.WorkflowInvoker> 提供了一个简便的方法来调用工作流，尽管提供了在工作流开始时传入数据以及从完成的工作流中提取数据的方法，但不提供使用 <xref:System.Activities.WorkflowApplication> 时可用的更为复杂的方案。</span><span class="sxs-lookup"><span data-stu-id="54c9b-180"><xref:System.Activities.WorkflowInvoker> provides a lightweight way to invoke workflows, and although it provides methods for passing data in at the start of a workflow and extracting data from a completed workflow, it does not provide for more complex scenarios which is where <xref:System.Activities.WorkflowApplication> can be used.</span></span>
