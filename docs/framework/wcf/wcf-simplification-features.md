---
title: WCF 简化功能
ms.date: 03/30/2017
ms.assetid: 4535a511-6064-4da0-b361-80262a891663
ms.openlocfilehash: d582c075377cf53d75ddf1bb9f37764e24e486ec
ms.sourcegitcommit: 27a15a55019f6b5f2733961738babe94aec0def3
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/15/2020
ms.locfileid: "90545072"
---
# <a name="wcf-simplification-features"></a><span data-ttu-id="433aa-102">WCF 简化功能</span><span class="sxs-lookup"><span data-stu-id="433aa-102">WCF Simplification Features</span></span>

<span data-ttu-id="433aa-103">本主题讨论可使编写 WCF 应用程序更简单的新功能。</span><span class="sxs-lookup"><span data-stu-id="433aa-103">This topic discusses new features that make writing WCF applications simpler.</span></span>

## <a name="simplified-generated-configuration-files"></a><span data-ttu-id="433aa-104">简化了生成的配置文件</span><span class="sxs-lookup"><span data-stu-id="433aa-104">Simplified Generated Configuration Files</span></span>

<span data-ttu-id="433aa-105">当您在 Visual Studio 中添加服务引用或使用 SvcUtil.exe工具时，将会生成一个客户端配置文件。</span><span class="sxs-lookup"><span data-stu-id="433aa-105">When you add a service reference in Visual Studio or use the SvcUtil.exe tool a client configuration file is generated.</span></span> <span data-ttu-id="433aa-106">在以前版本的 WCF 中，这些配置文件包含每个绑定属性的值，即使该值是默认值。</span><span class="sxs-lookup"><span data-stu-id="433aa-106">In previous versions of WCF these configuration files contained the value of every binding property even if its value is the default value.</span></span> <span data-ttu-id="433aa-107">在 WCF 4.5 中，生成的配置文件仅包含那些设置为非默认值的绑定属性。</span><span class="sxs-lookup"><span data-stu-id="433aa-107">In WCF 4.5 the generated configuration files contain only those binding properties that are set to a non-default value.</span></span>

<span data-ttu-id="433aa-108">下面是由 WCF 3.0 生成的配置文件的示例。</span><span class="sxs-lookup"><span data-stu-id="433aa-108">The following is an example of a configuration file generated by WCF 3.0.</span></span>

```xml
<?xml version="1.0" encoding="utf-8"?>
<configuration>
    <system.serviceModel>
        <bindings>
            <basicHttpBinding>
                <binding name="BasicHttpBinding_IService1" closeTimeout="00:01:00"
                    openTimeout="00:01:00" receiveTimeout="00:10:00" sendTimeout="00:01:00"
                    allowCookies="false" bypassProxyOnLocal="false"
                    hostNameComparisonMode="StrongWildcard" maxBufferSize="65536"
                    maxBufferPoolSize="524288" maxReceivedMessageSize="65536"
                    messageEncoding="Text" textEncoding="utf-8" transferMode="Buffered"
                    useDefaultWebProxy="true">
                    <readerQuotas maxDepth="32" maxStringContentLength="8192"
                        maxArrayLength="16384" maxBytesPerRead="4096"
                        maxNameTableCharCount="16384" />
                    <security mode="None">
                        <transport clientCredentialType="None" proxyCredentialType="None"
                            realm="" />
                        <message clientCredentialType="UserName" algorithmSuite="Default" />
                    </security>
                </binding>
            </basicHttpBinding>
        </bindings>
        <client>
            <endpoint address="http://localhost:36906/Service1.svc" binding="basicHttpBinding"
                bindingConfiguration="BasicHttpBinding_IService1" contract="IService1"
                name="BasicHttpBinding_IService1" />
        </client>
    </system.serviceModel>
</configuration>
```

<span data-ttu-id="433aa-109">下面是由 WCF 4.5 生成的相同配置文件的示例。</span><span class="sxs-lookup"><span data-stu-id="433aa-109">The following is an example of the same configuration file generated by WCF 4.5.</span></span>

```xml
<?xml version="1.0" encoding="utf-8"?>
<configuration>
    <system.serviceModel>
        <bindings>
            <basicHttpBinding>
                <binding name="BasicHttpBinding_IService1" />
            </basicHttpBinding>
        </bindings>
        <client>
            <endpoint address="http://localhost:36906/Service1.svc" binding="basicHttpBinding"
                bindingConfiguration="BasicHttpBinding_IService1" contract="IService1"
                name="BasicHttpBinding_IService1" />
        </client>
    </system.serviceModel>
</configuration>
```

## <a name="contract-first-development"></a><span data-ttu-id="433aa-110">协定优先开发</span><span class="sxs-lookup"><span data-stu-id="433aa-110">Contract-First Development</span></span>

<span data-ttu-id="433aa-111">WCF 现在支持协定优先开发。</span><span class="sxs-lookup"><span data-stu-id="433aa-111">WCF now has support for contract-first development.</span></span> <span data-ttu-id="433aa-112">svcutil.exe 工具有一个/serviceContract 开关，可用于从 WSDL 文档生成服务和数据协定。</span><span class="sxs-lookup"><span data-stu-id="433aa-112">The svcutil.exe tool has a /serviceContract switch which allows you to generate service and data contracts from a WSDL document.</span></span>

## <a name="add-service-reference-from-a-portable-subset-project"></a><span data-ttu-id="433aa-113">从可移植子集项目添加服务引用</span><span class="sxs-lookup"><span data-stu-id="433aa-113">Add Service Reference From a Portable Subset Project</span></span>

<span data-ttu-id="433aa-114">可移植子集项目使 .NET 程序集编程人员能够维护单个源树和生成系统，同时仍支持 (桌面、Silverlight、Windows Phone 和 Xbox) 的多个 .NET 实现。</span><span class="sxs-lookup"><span data-stu-id="433aa-114">Portable subset projects enable .NET assembly programmers to maintain a single source tree and build system while still supporting multiple .NET implementations (desktop, Silverlight, Windows Phone, and Xbox).</span></span> <span data-ttu-id="433aa-115">可移植子集项目仅引用可以在任何 .NET 实现上使用的程序集的 .NET 可移植库。</span><span class="sxs-lookup"><span data-stu-id="433aa-115">Portable subset projects only reference .NET portable libraries that are assemblies that can be used on any .NET implementation.</span></span> <span data-ttu-id="433aa-116">开发人员的体验与添加任何其他 WCF 客户端应用程序内的服务引用相同。</span><span class="sxs-lookup"><span data-stu-id="433aa-116">The developer experience is the same as adding a service reference within any other WCF client application.</span></span> <span data-ttu-id="433aa-117">有关详细信息，请参阅 [可移植子集项目中的添加服务引用](add-service-reference-in-a-portable-subset-project.md)。</span><span class="sxs-lookup"><span data-stu-id="433aa-117">For more information, see [Add Service Reference in a Portable Subset Project](add-service-reference-in-a-portable-subset-project.md).</span></span>

## <a name="aspnet-compatibility-mode-default-changed"></a><span data-ttu-id="433aa-118">ASP.NET 兼容模式默认值已更改</span><span class="sxs-lookup"><span data-stu-id="433aa-118">ASP.NET Compatibility Mode Default Changed</span></span>

<span data-ttu-id="433aa-119">WCF 提供了 ASP.NET 兼容模式，以向开发人员授予编写 WCF 服务时对 ASP.NET HTTP 管道中的功能的完全访问权限。</span><span class="sxs-lookup"><span data-stu-id="433aa-119">WCF provides ASP.NET compatibility mode to grant developers full access to the features in the ASP.NET HTTP pipeline when writing WCF services.</span></span> <span data-ttu-id="433aa-120">若要使用此模式，你必须 `aspNetCompatibilityEnabled` 在 web.config 的节中将属性设置为 true [\<serviceHostingEnvironment>](../configure-apps/file-schema/wcf/servicehostingenvironment.md) 。此外，此 appDomain 中的任何服务都需要 `RequirementsMode` 将其上的 <xref:System.ServiceModel.Activation.AspNetCompatibilityRequirementsAttribute> 属性设置为 <xref:System.ServiceModel.Activation.AspNetCompatibilityRequirementsMode.Allowed> 或 <xref:System.ServiceModel.Activation.AspNetCompatibilityRequirementsMode.Required> 。</span><span class="sxs-lookup"><span data-stu-id="433aa-120">To use this mode, you must set the `aspNetCompatibilityEnabled` attribute to true in the [\<serviceHostingEnvironment>](../configure-apps/file-schema/wcf/servicehostingenvironment.md) section of web.config. Additionally, any service in this appDomain needs to have the `RequirementsMode` property on its <xref:System.ServiceModel.Activation.AspNetCompatibilityRequirementsAttribute> set to <xref:System.ServiceModel.Activation.AspNetCompatibilityRequirementsMode.Allowed> or <xref:System.ServiceModel.Activation.AspNetCompatibilityRequirementsMode.Required>.</span></span> <span data-ttu-id="433aa-121">默认情况下， <xref:System.ServiceModel.Activation.AspNetCompatibilityRequirementsAttribute> 将设置为 <xref:System.ServiceModel.Activation.AspNetCompatibilityRequirementsMode.Allowed> ，默认的 WCF 服务应用程序模板会将 `aspNetCompatibilityEnabled` 特性设置为 `true` 。</span><span class="sxs-lookup"><span data-stu-id="433aa-121">By default <xref:System.ServiceModel.Activation.AspNetCompatibilityRequirementsAttribute> is now set to <xref:System.ServiceModel.Activation.AspNetCompatibilityRequirementsMode.Allowed> and the default WCF service application template sets the `aspNetCompatibilityEnabled` attribute to `true`.</span></span> <span data-ttu-id="433aa-122">有关详细信息，请参阅 Windows Communication Foundation 4.5 和[WCF 服务和 ASP.NET](./feature-details/wcf-services-and-aspnet.md)[的新增功能](whats-new.md)。</span><span class="sxs-lookup"><span data-stu-id="433aa-122">For more information, see [What's New in Windows Communication Foundation 4.5](whats-new.md) and [WCF Services and ASP.NET](./feature-details/wcf-services-and-aspnet.md).</span></span>

## <a name="streaming-improvements"></a><span data-ttu-id="433aa-123">流改进</span><span class="sxs-lookup"><span data-stu-id="433aa-123">Streaming Improvements</span></span>

- <span data-ttu-id="433aa-124">向 WCF 添加了对异步流的新支持。</span><span class="sxs-lookup"><span data-stu-id="433aa-124">New support for asynchronous streaming has been added to WCF.</span></span> <span data-ttu-id="433aa-125">若要启用异步流，请将 <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior> 终结点行为添加到服务主机，并将其 <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior.AsynchronousSendEnabled%2A> 属性设置为 `true`。</span><span class="sxs-lookup"><span data-stu-id="433aa-125">To enable asynchronous streaming, add the  <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior> endpoint behavior to the service host and set its <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior.AsynchronousSendEnabled%2A> property to `true`.</span></span> <span data-ttu-id="433aa-126">在服务将经过流处理的消息发送到多个正在缓慢读取的客户端时，这样做有益于可伸缩性。</span><span class="sxs-lookup"><span data-stu-id="433aa-126">This can benefit scalability when a service is sending streamed messages to multiple clients which are reading slowly.</span></span> <span data-ttu-id="433aa-127">WCF 不再阻止每个客户端的一个线程，并将释放该线程以便为另一个客户端提供服务。</span><span class="sxs-lookup"><span data-stu-id="433aa-127">WCF does not block one thread per client anymore and will free up the thread to service another client.</span></span>

- <span data-ttu-id="433aa-128">消除了服务由 IIS 承载时缓冲消息方面的限制。</span><span class="sxs-lookup"><span data-stu-id="433aa-128">Removed limitations around buffering of messages when a service is IIS hosted.</span></span> <span data-ttu-id="433aa-129">在以前版本的 WCF 中，在收到关于使用流消息传输的 IIS 承载服务的消息时，ASP.NET 会在将该消息发送到 WCF 之前缓冲整个消息。</span><span class="sxs-lookup"><span data-stu-id="433aa-129">In previous versions of WCF when receiving a message for an IIS-hosted service that used streaming message transfer, ASP.NET would buffer the entire message before sending it to WCF.</span></span> <span data-ttu-id="433aa-130">这将导致消耗大量内存。</span><span class="sxs-lookup"><span data-stu-id="433aa-130">This would cause large memory consumption.</span></span> <span data-ttu-id="433aa-131">在 .NET 4.5 中已取消这种缓冲，现在，IIS 承载的 WCF 服务可以在收到整个消息之前开始处理传入流，从而实现真正的流处理。</span><span class="sxs-lookup"><span data-stu-id="433aa-131">This buffering has been removed in .NET 4.5 and now IIS-hosted WCF services can start processing the incoming stream before the entire message has been received, thereby enabling true streaming.</span></span> <span data-ttu-id="433aa-132">这样，WCF 就可立即对消息作出响应，并可以提高性能。</span><span class="sxs-lookup"><span data-stu-id="433aa-132">This allows WCF to respond immediately to messages and allows improved performance.</span></span> <span data-ttu-id="433aa-133">此外，您不必再指定 `maxRequestLength` 的值，即 ASP.NET 对传入请求的大小限制。</span><span class="sxs-lookup"><span data-stu-id="433aa-133">In addition, you no longer have to specify a value for `maxRequestLength`, the ASP.NET size limit on incoming requests.</span></span> <span data-ttu-id="433aa-134">如果设置了此属性，则会将其忽略。</span><span class="sxs-lookup"><span data-stu-id="433aa-134">If this property is set, it is ignored.</span></span> <span data-ttu-id="433aa-135">有关详细信息， `maxRequestLength` 请参阅[ \<httpRuntime> 配置元素](/previous-versions/dotnet/netframework-1.1/e1f13641(v=vs.71))。</span><span class="sxs-lookup"><span data-stu-id="433aa-135">For more information about `maxRequestLength` see [\<httpRuntime> configuration element](/previous-versions/dotnet/netframework-1.1/e1f13641(v=vs.71)).</span></span> <span data-ttu-id="433aa-136">你仍需要配置 maxAllowedContentLength，有关详细信息，请参阅 [IIS 请求限制](/previous-versions/iis/settings-schema/ms689462(v=vs.90))。</span><span class="sxs-lookup"><span data-stu-id="433aa-136">You will still need to configure the maxAllowedContentLength, For more information, see [IIS Request Limits](/previous-versions/iis/settings-schema/ms689462(v=vs.90)).</span></span>

## <a name="new-transport-default-values"></a><span data-ttu-id="433aa-137">新传输默认值</span><span class="sxs-lookup"><span data-stu-id="433aa-137">New Transport Default Values</span></span>

<span data-ttu-id="433aa-138">下表描述了已更改的设置以及可在何处找到其他信息。</span><span class="sxs-lookup"><span data-stu-id="433aa-138">The following table describes the settings that have changed and where to find additional information.</span></span>

|<span data-ttu-id="433aa-139">properties</span><span class="sxs-lookup"><span data-stu-id="433aa-139">Property</span></span>|<span data-ttu-id="433aa-140">启用</span><span class="sxs-lookup"><span data-stu-id="433aa-140">On</span></span>|<span data-ttu-id="433aa-141">新默认值</span><span class="sxs-lookup"><span data-stu-id="433aa-141">New Default</span></span>|<span data-ttu-id="433aa-142">更多信息</span><span class="sxs-lookup"><span data-stu-id="433aa-142">More Information</span></span>|
|--------------|--------|-----------------|----------------------|
|<span data-ttu-id="433aa-143">channelInitializationTimeout</span><span class="sxs-lookup"><span data-stu-id="433aa-143">channelInitializationTimeout</span></span>|<xref:System.ServiceModel.NetTcpBinding>|<span data-ttu-id="433aa-144">30 秒</span><span class="sxs-lookup"><span data-stu-id="433aa-144">30 seconds</span></span>|<span data-ttu-id="433aa-145">此属性可确定 TCP 连接使用 .NET 组帧协议对自身进行身份验证所需的时间。</span><span class="sxs-lookup"><span data-stu-id="433aa-145">This property determines how long a TCP connection can take to authenticate itself using the .NET Framing protocol.</span></span> <span data-ttu-id="433aa-146">客户端需要发送一些初始数据，然后服务器才有足够的信息来执行身份验证。</span><span class="sxs-lookup"><span data-stu-id="433aa-146">A client needs to send some initial data before the server has enough information to perform authentication.</span></span> <span data-ttu-id="433aa-147">此超时被有意设置为小于 ReceiveTimeout（10 分钟），这样，未经身份验证的恶意客户端就无法长时间保持绑到该服务器的连接。</span><span class="sxs-lookup"><span data-stu-id="433aa-147">This timeout is intentionally made smaller than the ReceiveTimeout (10 min) so that malicious unauthenticated clients do not keep the connections tied up to the server for long.</span></span> <span data-ttu-id="433aa-148">默认值为 30 秒。</span><span class="sxs-lookup"><span data-stu-id="433aa-148">The default value is 30 seconds.</span></span> <span data-ttu-id="433aa-149">有关的详细信息 <xref:System.ServiceModel.Channels.ConnectionOrientedTransportBindingElement.ChannelInitializationTimeout%2A></span><span class="sxs-lookup"><span data-stu-id="433aa-149">For more information about <xref:System.ServiceModel.Channels.ConnectionOrientedTransportBindingElement.ChannelInitializationTimeout%2A></span></span>|
|<span data-ttu-id="433aa-150">listenBacklog</span><span class="sxs-lookup"><span data-stu-id="433aa-150">listenBacklog</span></span>|<xref:System.ServiceModel.NetTcpBinding>|<span data-ttu-id="433aa-151">16 \* 处理器数</span><span class="sxs-lookup"><span data-stu-id="433aa-151">16 \* number of processors</span></span>|<span data-ttu-id="433aa-152">此套接字级别的属性描述了要排队的“挂起接受”请求的数目。</span><span class="sxs-lookup"><span data-stu-id="433aa-152">This socket-level property describes the number of "pending accept" requests to be queued.</span></span> <span data-ttu-id="433aa-153">如果侦听积压工作 (backlog) 队列已满，则会拒绝新的套接字请求。</span><span class="sxs-lookup"><span data-stu-id="433aa-153">If the listen backlog queue fills up, new socket requests will be rejected.</span></span> <span data-ttu-id="433aa-154">有关的详细信息 <xref:System.ServiceModel.NetTcpBinding.ListenBacklog%2A></span><span class="sxs-lookup"><span data-stu-id="433aa-154">For more information about <xref:System.ServiceModel.NetTcpBinding.ListenBacklog%2A></span></span>|
|<span data-ttu-id="433aa-155">maxPendingAccepts</span><span class="sxs-lookup"><span data-stu-id="433aa-155">maxPendingAccepts</span></span>|<span data-ttu-id="433aa-156">ConnectionOrientedTransportBindingElement</span><span class="sxs-lookup"><span data-stu-id="433aa-156">ConnectionOrientedTransportBindingElement</span></span><br /><br /> <span data-ttu-id="433aa-157">SMSvcHost.exe</span><span class="sxs-lookup"><span data-stu-id="433aa-157">SMSvcHost.exe</span></span>|<span data-ttu-id="433aa-158">2 \* 传输处理器的数目</span><span class="sxs-lookup"><span data-stu-id="433aa-158">2 \* number of processors for transport</span></span><br /><br /> <span data-ttu-id="433aa-159">4 \* SMSvcHost.exe 的处理器数</span><span class="sxs-lookup"><span data-stu-id="433aa-159">4 \* number of processors for SMSvcHost.exe</span></span>|<span data-ttu-id="433aa-160">此属性会限制服务器可具有的等待侦听器的通道数目。</span><span class="sxs-lookup"><span data-stu-id="433aa-160">This property limits the number of channels that the server can have waiting on a listener.</span></span> <span data-ttu-id="433aa-161">当 MaxPendingAccepts 太低时，会有一个较小的时间间隔，在此间隔内，所有等待的通道都已开始服务连接，但没有新通道已开始侦听。</span><span class="sxs-lookup"><span data-stu-id="433aa-161">When MaxPendingAccepts is too low, there will be a small interval of time in which all of the waiting channels have started servicing connections, but no new channels have begun listening.</span></span> <span data-ttu-id="433aa-162">连接可在此间隔内到达，但将会因服务器上没有等待它的内容而失败。</span><span class="sxs-lookup"><span data-stu-id="433aa-162">A connection can arrive during this interval and will fail because nothing is waiting for it on the server.</span></span> <span data-ttu-id="433aa-163">可通过将 <xref:System.ServiceModel.Channels.ConnectionOrientedTransportBindingElement.MaxPendingConnections%2A> 属性设置为较大的数字来配置此属性。</span><span class="sxs-lookup"><span data-stu-id="433aa-163">This property can be configured by setting the <xref:System.ServiceModel.Channels.ConnectionOrientedTransportBindingElement.MaxPendingConnections%2A> property to a larger number.</span></span> <span data-ttu-id="433aa-164">有关详细信息，请参阅 <xref:System.ServiceModel.Channels.ConnectionOrientedTransportBindingElement.MaxPendingAccepts%2A> 和 [配置 Net.tcp 端口共享服务](./feature-details/configuring-the-net-tcp-port-sharing-service.md)</span><span class="sxs-lookup"><span data-stu-id="433aa-164">For more information, see <xref:System.ServiceModel.Channels.ConnectionOrientedTransportBindingElement.MaxPendingAccepts%2A> and [Configuring the Net.TCP Port Sharing Service](./feature-details/configuring-the-net-tcp-port-sharing-service.md)</span></span>|
|<span data-ttu-id="433aa-165">maxPendingConnections</span><span class="sxs-lookup"><span data-stu-id="433aa-165">maxPendingConnections</span></span>|<span data-ttu-id="433aa-166">ConnectionOrientedTransportBindingElement</span><span class="sxs-lookup"><span data-stu-id="433aa-166">ConnectionOrientedTransportBindingElement</span></span>|<span data-ttu-id="433aa-167">12 \* 处理器数目</span><span class="sxs-lookup"><span data-stu-id="433aa-167">12 \* number of processors</span></span>|<span data-ttu-id="433aa-168">此属性控制一个传输已接受但 ServiceModel 调度程序尚未选取的连接的数目。</span><span class="sxs-lookup"><span data-stu-id="433aa-168">This property controls how many connections a transport has accepted but have not been picked up by the ServiceModel Dispatcher.</span></span> <span data-ttu-id="433aa-169">若要设置此值，请对该绑定使用 `MaxConnections` 或对该绑定元素使用 `maxOutboundConnectionsPerEndpoint`。</span><span class="sxs-lookup"><span data-stu-id="433aa-169">To set this value, use `MaxConnections` on the binding or `maxOutboundConnectionsPerEndpoint` on the binding element.</span></span> <span data-ttu-id="433aa-170">有关的详细信息 <xref:System.ServiceModel.Channels.ConnectionOrientedTransportBindingElement.MaxPendingConnections%2A></span><span class="sxs-lookup"><span data-stu-id="433aa-170">For more information about <xref:System.ServiceModel.Channels.ConnectionOrientedTransportBindingElement.MaxPendingConnections%2A></span></span>|
|<span data-ttu-id="433aa-171">receiveTimeout</span><span class="sxs-lookup"><span data-stu-id="433aa-171">receiveTimeout</span></span>|<span data-ttu-id="433aa-172">SMSvcHost.exe</span><span class="sxs-lookup"><span data-stu-id="433aa-172">SMSvcHost.exe</span></span>|<span data-ttu-id="433aa-173">30 秒</span><span class="sxs-lookup"><span data-stu-id="433aa-173">30 seconds</span></span>|<span data-ttu-id="433aa-174">此属性为读取 TCP 组帧数据并执行来自基础连接的连接调度指定超时值。</span><span class="sxs-lookup"><span data-stu-id="433aa-174">This property specifies the timeout for reading the TCP framing data and performing connection dispatching from the underlying connections.</span></span> <span data-ttu-id="433aa-175">此超时值用于对该时间段施加一个限制，SMSvcHost.exe 服务将在该时段内保持从传入连接读取前导码数据。</span><span class="sxs-lookup"><span data-stu-id="433aa-175">This exists to put a cap on the amount of time SMSvcHost.exe service is kept engaged to read the preamble data from an incoming connection.</span></span> <span data-ttu-id="433aa-176">有关详细信息，请参阅 [配置 Net.tcp 端口共享服务](./feature-details/configuring-the-net-tcp-port-sharing-service.md)。</span><span class="sxs-lookup"><span data-stu-id="433aa-176">For more information, see [Configuring the Net.TCP Port Sharing Service](./feature-details/configuring-the-net-tcp-port-sharing-service.md).</span></span>|

> [!NOTE]
> <span data-ttu-id="433aa-177">只有在安装有 .NET Framework 4.5 的计算机上部署 WCF 服务时，才会使用这些新默认值。</span><span class="sxs-lookup"><span data-stu-id="433aa-177">These new defaults are used only if you deploy the WCF service on a machine with .NET Framework 4.5.</span></span> <span data-ttu-id="433aa-178">如果在安装有 .NET Framework 4.0 的计算机上部署同一服务，则将使用 .NET Framework 4.0 默认值。</span><span class="sxs-lookup"><span data-stu-id="433aa-178">If you deploy the same service on a machine with .NET Framework 4.0, then the .NET Framework 4.0 defaults are used.</span></span> <span data-ttu-id="433aa-179">在这种情况下，建议显式配置这些设置。</span><span class="sxs-lookup"><span data-stu-id="433aa-179">In such cases it is recommended to configure these settings explicitly.</span></span>

## <a name="xmldictionaryreaderquotas"></a><span data-ttu-id="433aa-180">XmlDictionaryReaderQuotas</span><span class="sxs-lookup"><span data-stu-id="433aa-180">XmlDictionaryReaderQuotas</span></span>

<span data-ttu-id="433aa-181"><xref:System.Xml.XmlDictionaryReaderQuotas> 包含用于 XML 字典读取器的可配置配额值，这些配额值会限制创建消息时由编码器使用的内存量。</span><span class="sxs-lookup"><span data-stu-id="433aa-181"><xref:System.Xml.XmlDictionaryReaderQuotas> contains configurable quota values for XML dictionary readers which limit the amount of memory utilized by an encoder while creating a message.</span></span> <span data-ttu-id="433aa-182">虽然这些配额是可配置的，但默认值已更改，以减小开发人员需要显式设置这些默认值的可能性。</span><span class="sxs-lookup"><span data-stu-id="433aa-182">While these quotas are configurable, the default values have changed to lessen the possibility that a developer will need to set them explicitly.</span></span> <span data-ttu-id="433aa-183">`MaxReceivedMessageSize` 配额未更改，这样它仍可以限制内存消耗，从而您无需处理 <xref:System.Xml.XmlDictionaryReaderQuotas> 的复杂性。</span><span class="sxs-lookup"><span data-stu-id="433aa-183">`MaxReceivedMessageSize` quota has not been changed so that it can still limit memory consumption preventing the need for you to deal with the complexity of the <xref:System.Xml.XmlDictionaryReaderQuotas>.</span></span> <span data-ttu-id="433aa-184">下表显示了配额及其新默认值，并简要说明了每个配额的用途。</span><span class="sxs-lookup"><span data-stu-id="433aa-184">The following table shows the quotas, their new default values and a brief explanation of what each quota is used for.</span></span>

|<span data-ttu-id="433aa-185">配额名称</span><span class="sxs-lookup"><span data-stu-id="433aa-185">Quota Name</span></span>|<span data-ttu-id="433aa-186">默认值</span><span class="sxs-lookup"><span data-stu-id="433aa-186">Default Value</span></span>|<span data-ttu-id="433aa-187">说明</span><span class="sxs-lookup"><span data-stu-id="433aa-187">Description</span></span>|
|----------------|-------------------|-----------------|
|<xref:System.Xml.XmlDictionaryReaderQuotas.MaxArrayLength%2A>|<span data-ttu-id="433aa-188">Int32.MaxValue</span><span class="sxs-lookup"><span data-stu-id="433aa-188">Int32.MaxValue</span></span>|<span data-ttu-id="433aa-189">获取并设置允许的最大数组长度。</span><span class="sxs-lookup"><span data-stu-id="433aa-189">Gets and sets the maximum allowed array length.</span></span> <span data-ttu-id="433aa-190">此配额限制 XML 读取器返回的基元数组（包括字节数组）的最大大小。</span><span class="sxs-lookup"><span data-stu-id="433aa-190">This quota limits the maximum size of an array of primitives that the XML reader returns, including byte arrays.</span></span> <span data-ttu-id="433aa-191">此配额不限制 XML 读取器本身的内存消耗，但限制使用该读取器的所有组件的内存消耗。</span><span class="sxs-lookup"><span data-stu-id="433aa-191">This quota does not limit memory consumption in the XML reader itself, but in whatever component that is using the reader.</span></span> <span data-ttu-id="433aa-192">例如，当 <xref:System.Runtime.Serialization.DataContractSerializer> 使用一个以 <xref:System.Xml.XmlDictionaryReaderQuotas.MaxArrayLength%2A>保护的读取器时，将不会反序列化大于此配额的字节数组。</span><span class="sxs-lookup"><span data-stu-id="433aa-192">For example, when the <xref:System.Runtime.Serialization.DataContractSerializer> uses a reader secured with <xref:System.Xml.XmlDictionaryReaderQuotas.MaxArrayLength%2A>, it does not deserialize byte arrays larger than this quota.</span></span>|
|<xref:System.Xml.XmlDictionaryReaderQuotas.MaxBytesPerRead%2A>|<span data-ttu-id="433aa-193">Int32.MaxValue</span><span class="sxs-lookup"><span data-stu-id="433aa-193">Int32.MaxValue</span></span>|<span data-ttu-id="433aa-194">获取并设置允许每次读取返回的最大字节数。</span><span class="sxs-lookup"><span data-stu-id="433aa-194">Gets and sets the maximum allowed bytes returned for each read.</span></span> <span data-ttu-id="433aa-195">此配额限制在当读取元素开始标记及其属性时在一次 Read 操作中读取的字节数目。</span><span class="sxs-lookup"><span data-stu-id="433aa-195">This quota limits the number of bytes that are read in a single Read operation when reading the element start tag and its attributes.</span></span> <span data-ttu-id="433aa-196">（在非流模式情况下，不会根据配额对元素名称本身进行计数）。</span><span class="sxs-lookup"><span data-stu-id="433aa-196">(In non-streamed cases, the element name itself is not counted against the quota).</span></span> <span data-ttu-id="433aa-197">具有太多的 XML 特性可能会耗用过长的处理时间，因为必须检查特性名称的唯一性。</span><span class="sxs-lookup"><span data-stu-id="433aa-197">Having too many XML attributes may use up disproportionate processing time because attribute names have to be checked for uniqueness.</span></span> <span data-ttu-id="433aa-198"><xref:System.Xml.XmlDictionaryReaderQuotas.MaxBytesPerRead%2A> 可缓解这一威胁。</span><span class="sxs-lookup"><span data-stu-id="433aa-198"><xref:System.Xml.XmlDictionaryReaderQuotas.MaxBytesPerRead%2A> mitigates this threat.</span></span>|
|<xref:System.Xml.XmlDictionaryReaderQuotas.MaxDepth%2A>|<span data-ttu-id="433aa-199">节点深度为 128</span><span class="sxs-lookup"><span data-stu-id="433aa-199">128 nodes deep</span></span>|<span data-ttu-id="433aa-200">此配额限制 XML 元素的最大嵌套深度。</span><span class="sxs-lookup"><span data-stu-id="433aa-200">This quota limits the maximum nesting depth of XML elements.</span></span> <span data-ttu-id="433aa-201"><xref:System.Xml.XmlDictionaryReaderQuotas.MaxDepth%2A> 与 <xref:System.Xml.XmlDictionaryReaderQuotas.MaxBytesPerRead%2A>交互：读取器始终在内存中保留当前元素以及它的所有上级的数据，因此读取器的最大内存消耗与这两个设置的积成比例。</span><span class="sxs-lookup"><span data-stu-id="433aa-201"><xref:System.Xml.XmlDictionaryReaderQuotas.MaxDepth%2A> interacts with <xref:System.Xml.XmlDictionaryReaderQuotas.MaxBytesPerRead%2A>: the reader always keeps data in memory for the current element and all of its ancestors, so the maximum memory consumption of the reader is proportional to the product of these two settings.</span></span> <span data-ttu-id="433aa-202">当反序列化深度嵌套的对象图时，会迫使反序列化程序访问整个堆栈并引发一个不可恢复的 <xref:System.StackOverflowException>。</span><span class="sxs-lookup"><span data-stu-id="433aa-202">When deserializing a deeply-nested object graph, the deserializer is forced to access the entire stack and throw an unrecoverable <xref:System.StackOverflowException>.</span></span> <span data-ttu-id="433aa-203">对于 <xref:System.Runtime.Serialization.DataContractSerializer> 和 <xref:System.Xml.Serialization.XmlSerializer>，XML 嵌套和对象嵌套之间存在直接关联。</span><span class="sxs-lookup"><span data-stu-id="433aa-203">A direct correlation exists between XML nesting and object nesting for both the <xref:System.Runtime.Serialization.DataContractSerializer> and the <xref:System.Xml.Serialization.XmlSerializer>.</span></span> <span data-ttu-id="433aa-204"><xref:System.Xml.XmlDictionaryReaderQuotas.MaxDepth%2A> 用于缓解这一威胁。</span><span class="sxs-lookup"><span data-stu-id="433aa-204"><xref:System.Xml.XmlDictionaryReaderQuotas.MaxDepth%2A> is used to mitigate this threat.</span></span>|
|<xref:System.Xml.XmlDictionaryReaderQuotas.MaxNameTableCharCount%2A>|<span data-ttu-id="433aa-205">Int32.MaxValue</span><span class="sxs-lookup"><span data-stu-id="433aa-205">Int32.MaxValue</span></span>|<span data-ttu-id="433aa-206">此配额限制名称表中所允许的最大字符数。</span><span class="sxs-lookup"><span data-stu-id="433aa-206">This quota limits the maximum number of characters allowed in a nametable.</span></span> <span data-ttu-id="433aa-207">名称表包含在处理 XML 文档时遇到的一些字符串（例如，命名空间和前缀）。</span><span class="sxs-lookup"><span data-stu-id="433aa-207">The nametable contains certain strings (such as namespaces and prefixes) that are encountered when processing an XML document.</span></span> <span data-ttu-id="433aa-208">由于这些字符串在内存中进行缓冲，因此，此配额用于防止在预期使用流处理时进行过度缓冲。</span><span class="sxs-lookup"><span data-stu-id="433aa-208">As these strings are buffered in memory, this quota is used to prevent excessive buffering when streaming is expected.</span></span>|
|<xref:System.Xml.XmlDictionaryReaderQuotas.MaxStringContentLength%2A>|<span data-ttu-id="433aa-209">Int32.MaxValue</span><span class="sxs-lookup"><span data-stu-id="433aa-209">Int32.MaxValue</span></span>|<span data-ttu-id="433aa-210">此配额限制 XML 读取器返回的最大字符串大小。</span><span class="sxs-lookup"><span data-stu-id="433aa-210">This quota limits the maximum string size that the XML reader returns.</span></span> <span data-ttu-id="433aa-211">此配额不限制 XML 读取器本身的内存消耗，但限制使用该读取器的组件中的内存消耗。</span><span class="sxs-lookup"><span data-stu-id="433aa-211">This quota does not limit memory consumption in the XML reader itself, but in the component that is using the reader.</span></span> <span data-ttu-id="433aa-212">例如，当 <xref:System.Runtime.Serialization.DataContractSerializer> 使用一个以 <xref:System.Xml.XmlDictionaryReaderQuotas.MaxStringContentLength%2A>保护的读取器时，将不会反序列化大于此配额的字符串。</span><span class="sxs-lookup"><span data-stu-id="433aa-212">For example, when the <xref:System.Runtime.Serialization.DataContractSerializer> uses a reader secured with <xref:System.Xml.XmlDictionaryReaderQuotas.MaxStringContentLength%2A>, it does not deserialize strings larger than this quota.</span></span>|

> [!IMPORTANT]
> <span data-ttu-id="433aa-213">有关保护数据的详细信息，请参阅 [数据安全注意事项](./feature-details/security-considerations-for-data.md) 下的 "安全地使用 XML"。</span><span class="sxs-lookup"><span data-stu-id="433aa-213">Refer to "Using XML Safely" under [Security Considerations for Data](./feature-details/security-considerations-for-data.md) for more information about securing your data.</span></span>

> [!NOTE]
> <span data-ttu-id="433aa-214">只有在安装有 .NET Framework 4.5 的计算机上部署 WCF 服务时，才会使用这些新默认值。</span><span class="sxs-lookup"><span data-stu-id="433aa-214">These new defaults are used only if you deploy the WCF service on a machine with .NET Framework 4.5.</span></span> <span data-ttu-id="433aa-215">如果在安装有 .NET Framework 4.0 的计算机上部署同一服务，则将使用 .NET Framework 4.0 默认值。</span><span class="sxs-lookup"><span data-stu-id="433aa-215">If you deploy the same service on a machine with .NET Framework 4.0, then the .NET Framework 4.0 defaults are used.</span></span> <span data-ttu-id="433aa-216">在这种情况下，建议显式配置这些设置。</span><span class="sxs-lookup"><span data-stu-id="433aa-216">In such cases it is recommended to configure these settings explicitly.</span></span>

## <a name="wcf-configuration-validation"></a><span data-ttu-id="433aa-217">WCF 配置验证</span><span class="sxs-lookup"><span data-stu-id="433aa-217">WCF Configuration Validation</span></span>

<span data-ttu-id="433aa-218">作为 Visual Studio 中生成过程的一部分，现在将对 WCF 配置文件进行验证。</span><span class="sxs-lookup"><span data-stu-id="433aa-218">As part of the build process within Visual Studio, WCF configuration files are now validated.</span></span> <span data-ttu-id="433aa-219">如果验证失败，则将在 Visual Studio 中显示验证错误或警告的列表。</span><span class="sxs-lookup"><span data-stu-id="433aa-219">A list of validation errors or warnings are displayed in Visual Studio if the validation fails.</span></span>

## <a name="xml-editor-tooltips"></a><span data-ttu-id="433aa-220">XML 编辑器工具提示</span><span class="sxs-lookup"><span data-stu-id="433aa-220">XML Editor Tooltips</span></span>

<span data-ttu-id="433aa-221">为了帮助新的和现有 WCF 服务开发人员配置服务，Visual Studio XML 编辑器现在为属于服务配置文件的每个配置元素及其属性提供了工具提示。</span><span class="sxs-lookup"><span data-stu-id="433aa-221">In order to help new and existing WCF service developers to configure their services, the Visual Studio XML editor now provides tooltips for every configuration element and its properties that is part of the service configuration file.</span></span>

## <a name="basichttpbinding-improvements"></a><span data-ttu-id="433aa-222">BasicHttpBinding 改进</span><span class="sxs-lookup"><span data-stu-id="433aa-222">BasicHttpBinding Improvements</span></span>

1. <span data-ttu-id="433aa-223">使单个 WCF 终结点能够响应不同身份验证模式。</span><span class="sxs-lookup"><span data-stu-id="433aa-223">Enables a single WCF endpoint to respond to different authentication modes.</span></span>

2. <span data-ttu-id="433aa-224">使 WCF 服务的安全性设置能够由 IIS 进行控制</span><span class="sxs-lookup"><span data-stu-id="433aa-224">Enables a WCF service’s security settings to be controlled by IIS</span></span>
