---
title: Windows Communication Foundation 体系结构
description: 了解 Windows Communication Foundation 体系结构的主要层，包括协定、服务运行时、消息传递和 & 托管的激活。
ms.date: 03/30/2017
helpviewer_keywords:
- Windows Communication Foundation [WCF], architecture
- WCF [WCF], architecture
- architecture [WCF]
ms.assetid: a3bcb0a1-56ea-4ba6-9736-d260d90dade5
ms.openlocfilehash: 7cb03ddd7207fbea23577ff18e984e90779333bc
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/26/2020
ms.locfileid: "96294880"
---
# <a name="windows-communication-foundation-architecture"></a><span data-ttu-id="634f9-103">Windows Communication Foundation 体系结构</span><span class="sxs-lookup"><span data-stu-id="634f9-103">Windows Communication Foundation Architecture</span></span>

<span data-ttu-id="634f9-104">下图说明了 Windows Communication Foundation (WCF) 体系结构的主要层。</span><span class="sxs-lookup"><span data-stu-id="634f9-104">The following graphic illustrates the major layers of the Windows Communication Foundation (WCF) architecture.</span></span>  
  
## <a name="wcf-architecture"></a><span data-ttu-id="634f9-105">WCF 体系结构</span><span class="sxs-lookup"><span data-stu-id="634f9-105">WCF Architecture</span></span>  

 <span data-ttu-id="634f9-106">![WCF 体系结构](./media/wcf-architecture.gif "WCF_Architecture")</span><span class="sxs-lookup"><span data-stu-id="634f9-106">![The WCF Architecture](./media/wcf-architecture.gif "WCF_Architecture")</span></span>  
  
### <a name="contracts-and-descriptions"></a><span data-ttu-id="634f9-107">协定和说明</span><span class="sxs-lookup"><span data-stu-id="634f9-107">Contracts and Descriptions</span></span>  

 <span data-ttu-id="634f9-108">协定定义消息系统的各个方面。</span><span class="sxs-lookup"><span data-stu-id="634f9-108">Contracts define various aspects of the message system.</span></span> <span data-ttu-id="634f9-109">数据协定描述组成某一服务可创建或使用的每则消息的每个参数。</span><span class="sxs-lookup"><span data-stu-id="634f9-109">The data contract describes every parameter that makes up every message that a service can create or consume.</span></span> <span data-ttu-id="634f9-110">消息参数由 XML 架构定义语言 (XSD) 文档定义，这使得任何理解 XML 的系统均可处理该文档。</span><span class="sxs-lookup"><span data-stu-id="634f9-110">The message parameters are defined by XML Schema definition language (XSD) documents, enabling any system that understands XML to process the documents.</span></span> <span data-ttu-id="634f9-111">消息协定使用 SOAP 协议定义特定消息部分，当互操作性要求对消息的某些部分进行更精细的控制时，消息协定可实现这种控制。</span><span class="sxs-lookup"><span data-stu-id="634f9-111">The message contract defines specific message parts using SOAP protocols, and allows finer-grained control over parts of the message, when interoperability demands such precision.</span></span> <span data-ttu-id="634f9-112">服务协定指定服务的实际方法签名，并以支持的编程语言之一（例如 Visual Basic 或 Visual C#）作为接口进行分发。</span><span class="sxs-lookup"><span data-stu-id="634f9-112">The service contract specifies the actual method signatures of the service, and is distributed as an interface in one of the supported programming languages, such as Visual Basic or Visual C#.</span></span>  
  
 <span data-ttu-id="634f9-113">策略和绑定规定与某一服务进行通信所需的条件。</span><span class="sxs-lookup"><span data-stu-id="634f9-113">Policies and bindings stipulate the conditions required to communicate with a service.</span></span>  <span data-ttu-id="634f9-114">例如，绑定必须（至少）指定所使用的传输（例如 HTTP 或 TCP）和编码。</span><span class="sxs-lookup"><span data-stu-id="634f9-114">For example, the binding must (at a minimum) specify the transport used (for example, HTTP or TCP), and an encoding.</span></span> <span data-ttu-id="634f9-115">策略包括安全要求和其他条件，必须满足这些要求和条件才能与服务进行通信。</span><span class="sxs-lookup"><span data-stu-id="634f9-115">Policies include security requirements and other conditions that must be met to communicate with a service.</span></span>  
  
### <a name="service-runtime"></a><span data-ttu-id="634f9-116">服务运行时</span><span class="sxs-lookup"><span data-stu-id="634f9-116">Service Runtime</span></span>  

 <span data-ttu-id="634f9-117">服务运行时层包含仅在服务实际运行期间发生的行为，即该服务的运行时行为。</span><span class="sxs-lookup"><span data-stu-id="634f9-117">The service runtime layer contains the behaviors that occur only during the actual operation of the service, that is, the runtime behaviors of the service.</span></span> <span data-ttu-id="634f9-118">遏制控制处理的消息数，如果对服务的需求增长到预设限制，该消息数则会发生变化。</span><span class="sxs-lookup"><span data-stu-id="634f9-118">Throttling controls how many messages are processed, which can be varied if the demand for the service grows to a preset limit.</span></span> <span data-ttu-id="634f9-119">错误行为指定服务出现内部错误时应采取的操作，例如控制传递给客户端的信息</span><span class="sxs-lookup"><span data-stu-id="634f9-119">An error behavior specifies what occurs when an internal error occurs on the service, for example, by controlling what information is communicated to the client.</span></span> <span data-ttu-id="634f9-120"> (太多的信息会使恶意用户有权安装攻击。 ) 元数据行为控制如何以及是否可将元数据提供给外界。</span><span class="sxs-lookup"><span data-stu-id="634f9-120">(Too much information can give a malicious user an advantage in mounting an attack.) Metadata behavior governs how and whether metadata is made available to the outside world.</span></span> <span data-ttu-id="634f9-121">实例行为指定可运行的服务实例的数目（例如，singleton 指定只能用单一实例来处理所有消息）。</span><span class="sxs-lookup"><span data-stu-id="634f9-121">Instance behavior specifies how many instances of the service can be run (for example, a singleton specifies only one instance to process all messages).</span></span> <span data-ttu-id="634f9-122">通过事务行为，可以在失败时回滚已进行事务处理的操作。</span><span class="sxs-lookup"><span data-stu-id="634f9-122">Transaction behavior enables the rollback of transacted operations if a failure occurs.</span></span> <span data-ttu-id="634f9-123">调度行为用于控制 WCF 基础结构处理消息的方式。</span><span class="sxs-lookup"><span data-stu-id="634f9-123">Dispatch behavior is the control of how a message is processed by the WCF infrastructure.</span></span>  
  
 <span data-ttu-id="634f9-124">通过扩展性功能可以自定义运行时进程。</span><span class="sxs-lookup"><span data-stu-id="634f9-124">Extensibility enables customization of runtime processes.</span></span> <span data-ttu-id="634f9-125">例如，消息检查功能用于检查消息的各个部分，使用参数筛选功能可以根据作用于消息头的筛选器来执行预设操作。</span><span class="sxs-lookup"><span data-stu-id="634f9-125">For example, message inspection is the facility to inspect parts of a message, and parameter filtering enables preset actions to occur based on filters acting on message headers.</span></span>  
  
### <a name="messaging"></a><span data-ttu-id="634f9-126">Messaging</span><span class="sxs-lookup"><span data-stu-id="634f9-126">Messaging</span></span>  

 <span data-ttu-id="634f9-127">消息传送层由 *通道* 组成。</span><span class="sxs-lookup"><span data-stu-id="634f9-127">The messaging layer is composed of *channels*.</span></span> <span data-ttu-id="634f9-128">通道是以某种方式对消息进行处理（例如通过对消息进行身份验证）的组件。</span><span class="sxs-lookup"><span data-stu-id="634f9-128">A channel is a component that processes a message in some way, for example, by authenticating a message.</span></span> <span data-ttu-id="634f9-129">一组通道也称为 *通道堆栈*。</span><span class="sxs-lookup"><span data-stu-id="634f9-129">A set of channels is also known as a *channel stack*.</span></span> <span data-ttu-id="634f9-130">通道对消息和消息头进行操作。</span><span class="sxs-lookup"><span data-stu-id="634f9-130">Channels operate on messages and message headers.</span></span> <span data-ttu-id="634f9-131">这与服务运行时层不同，服务运行时层主要涉及对消息正文内容的处理。</span><span class="sxs-lookup"><span data-stu-id="634f9-131">This is different from the service runtime layer, which is primarily concerned about processing the contents of message bodies.</span></span>  
  
 <span data-ttu-id="634f9-132">有两种类型的通道：传输通道和协议通道。</span><span class="sxs-lookup"><span data-stu-id="634f9-132">There are two types of channels: transport channels and protocol channels.</span></span>  
  
 <span data-ttu-id="634f9-133">传输通道读取和写入来自网络（或外部的某些其他通信点）的消息。</span><span class="sxs-lookup"><span data-stu-id="634f9-133">Transport channels read and write messages from the network (or some other communication point with the outside world).</span></span> <span data-ttu-id="634f9-134">某些传输通道使用编码器来将消息（表示为 XML Infoset）转换为网络所使用的字节流的表示形式，或将字节流表示形式转换为消息。</span><span class="sxs-lookup"><span data-stu-id="634f9-134">Some transports use an encoder to convert messages (which are represented as XML Infosets) to and from the byte stream representation used by the network.</span></span> <span data-ttu-id="634f9-135">传输通道的示例包括 HTTP、命名管道、TCP 和 MSMQ。</span><span class="sxs-lookup"><span data-stu-id="634f9-135">Examples of transports are HTTP, named pipes, TCP, and MSMQ.</span></span> <span data-ttu-id="634f9-136">编码的示例包括 XML 和优化的二进制文件。</span><span class="sxs-lookup"><span data-stu-id="634f9-136">Examples of encodings are XML and optimized binary.</span></span>  
  
 <span data-ttu-id="634f9-137">协议通道经常通过读取或写入消息的其他头的方式来实现消息处理协议。</span><span class="sxs-lookup"><span data-stu-id="634f9-137">Protocol channels implement message processing protocols, often by reading or writing additional headers to the message.</span></span> <span data-ttu-id="634f9-138">此类协议的示例包括 WS-Security 和 WS-Reliability。</span><span class="sxs-lookup"><span data-stu-id="634f9-138">Examples of such protocols include WS-Security and WS-Reliability.</span></span>  
  
 <span data-ttu-id="634f9-139">消息传递层说明数据的可能格式和交换模式。</span><span class="sxs-lookup"><span data-stu-id="634f9-139">The messaging layer illustrates the possible formats and exchange patterns of the data.</span></span> <span data-ttu-id="634f9-140">WS-Security 是对在消息层启用安全性的 WS-Security 规范的实现。</span><span class="sxs-lookup"><span data-stu-id="634f9-140">WS-Security is an implementation of the WS-Security specification enabling security at the message layer.</span></span> <span data-ttu-id="634f9-141">通过 WS-Reliable Messaging 通道可以保证消息的传递。</span><span class="sxs-lookup"><span data-stu-id="634f9-141">The WS-Reliable Messaging channel enables the guarantee of message delivery.</span></span> <span data-ttu-id="634f9-142">编码器提供了大量的编码，可使用这些编码来满足消息的需要。</span><span class="sxs-lookup"><span data-stu-id="634f9-142">The encoders present a variety of encodings that can be used to suit the needs of the message.</span></span> <span data-ttu-id="634f9-143">HTTP 通道指定应使用超文本传输协议来传递消息。</span><span class="sxs-lookup"><span data-stu-id="634f9-143">The HTTP channel specifies that the HyperText Transport Protocol is used for message delivery.</span></span> <span data-ttu-id="634f9-144">同理，TCP 通道指定 TCP 协议。</span><span class="sxs-lookup"><span data-stu-id="634f9-144">The TCP channel similarly specifies the TCP protocol.</span></span> <span data-ttu-id="634f9-145">事务流通道控制已经过事务处理的消息模式。</span><span class="sxs-lookup"><span data-stu-id="634f9-145">The Transaction Flow channel governs transacted message patterns.</span></span> <span data-ttu-id="634f9-146">通过命名管道通道可以进行进程间通信。</span><span class="sxs-lookup"><span data-stu-id="634f9-146">The Named Pipe channel enables interprocess communication.</span></span> <span data-ttu-id="634f9-147">使用 MSMQ 通道可以与 MSMQ 应用程序进行互操作。</span><span class="sxs-lookup"><span data-stu-id="634f9-147">The MSMQ channel enables interoperation with MSMQ applications.</span></span>  
  
### <a name="hosting-and-activation"></a><span data-ttu-id="634f9-148">承载和激活</span><span class="sxs-lookup"><span data-stu-id="634f9-148">Hosting and Activation</span></span>  

 <span data-ttu-id="634f9-149">服务的最终形式为程序。</span><span class="sxs-lookup"><span data-stu-id="634f9-149">In its final form, a service is a program.</span></span> <span data-ttu-id="634f9-150">与其他程序类似，服务必须在可执行文件中运行。</span><span class="sxs-lookup"><span data-stu-id="634f9-150">Like other programs, a service must be run in an executable.</span></span> <span data-ttu-id="634f9-151">这称为 *自承载* 服务。</span><span class="sxs-lookup"><span data-stu-id="634f9-151">This is known as a *self-hosted* service.</span></span>  
  
 <span data-ttu-id="634f9-152">服务还可以 *托管*，也可以在由外部代理管理的可执行文件中运行，例如 IIS 或 Windows 激活服务 () 。</span><span class="sxs-lookup"><span data-stu-id="634f9-152">Services can also be *hosted*, or run in an executable managed by an external agent, such as IIS or Windows Activation Service (WAS).</span></span> <span data-ttu-id="634f9-153">已启用的 WCF 应用程序部署到运行 WAS 的计算机上时，它将自动激活。</span><span class="sxs-lookup"><span data-stu-id="634f9-153">WAS enables WCF applications to be activated automatically when deployed on a computer running WAS.</span></span> <span data-ttu-id="634f9-154">还可通过可执行文件（.exe 文件）的形式来手动运行服务。</span><span class="sxs-lookup"><span data-stu-id="634f9-154">Services can also be manually run as executables (.exe files).</span></span> <span data-ttu-id="634f9-155">服务也可作为 Windows 服务自动运行。</span><span class="sxs-lookup"><span data-stu-id="634f9-155">A service can also be run automatically as a Windows service.</span></span> <span data-ttu-id="634f9-156">COM + 组件还可以作为 WCF 服务托管。</span><span class="sxs-lookup"><span data-stu-id="634f9-156">COM+ components can also be hosted as WCF services.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="634f9-157">另请参阅</span><span class="sxs-lookup"><span data-stu-id="634f9-157">See also</span></span>

- [<span data-ttu-id="634f9-158">什么是 Windows Communication Foundation</span><span class="sxs-lookup"><span data-stu-id="634f9-158">What Is Windows Communication Foundation</span></span>](whats-wcf.md)
- [<span data-ttu-id="634f9-159">Windows Communication Foundation 基础概念</span><span class="sxs-lookup"><span data-stu-id="634f9-159">Fundamental Windows Communication Foundation Concepts</span></span>](fundamental-concepts.md)
