---
title: 服务标识和身份验证
description: 了解服务的终结点标识，这是一个从服务 WSDL 生成的值，WCF 使用该值对服务进行身份验证。
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- authentication [WCF], specifying the identity of a service
ms.assetid: a4c8f52c-5b30-45c4-a545-63244aba82be
ms.openlocfilehash: f1c1d41f3d2ebc4482fa7e5f28fcbefe88bb9a02
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/26/2020
ms.locfileid: "96253903"
---
# <a name="service-identity-and-authentication"></a><span data-ttu-id="9cb6a-103">服务标识和身份验证</span><span class="sxs-lookup"><span data-stu-id="9cb6a-103">Service Identity and Authentication</span></span>

<span data-ttu-id="9cb6a-104">服务的 *终结点标识* 是从服务 Web 服务描述语言 (WSDL) 生成的值。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-104">A service's *endpoint identity* is a value generated from the service Web Services Description Language (WSDL).</span></span> <span data-ttu-id="9cb6a-105">此值可传播到任何客户端，用于对服务进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-105">This value, propagated to any client, is used to authenticate the service.</span></span> <span data-ttu-id="9cb6a-106">在客户端启动与终结点的通信并且服务向客户端验证自己的身份之后，客户端将终结点标识值与终结点身份验证过程返回的实际值进行比较。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-106">After the client initiates a communication to an endpoint and the service authenticates itself to the client, the client compares the endpoint identity value with the actual value the endpoint authentication process returned.</span></span> <span data-ttu-id="9cb6a-107">如果二者匹配，则客户端确信其已与预期的服务终结点联系。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-107">If they match, the client is assured it has contacted the expected service endpoint.</span></span> <span data-ttu-id="9cb6a-108">这可以防止将客户端重定向到由恶意服务托管的终结点，从而防范 *网络钓鱼* 。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-108">This functions as a protection against *phishing* by preventing a client from being redirected to an endpoint hosted by a malicious service.</span></span>  
  
 <span data-ttu-id="9cb6a-109">有关演示标识设置的示例应用程序，请参阅 [服务标识示例](../samples/service-identity-sample.md)。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-109">For a sample application that demonstrates identity setting, see [Service Identity Sample](../samples/service-identity-sample.md).</span></span> <span data-ttu-id="9cb6a-110">有关终结点和终结点地址的详细信息，请参阅 [地址](endpoint-addresses.md)。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-110">For more information about endpoints and endpoint addresses, see [Addresses](endpoint-addresses.md).</span></span>  
  
> [!NOTE]
> <span data-ttu-id="9cb6a-111">在使用 NT LanMan (NTLM) 进行身份验证时，将不检查服务标识，这是因为在 NTLM 下客户端无法对服务器进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-111">When you use NT LanMan (NTLM) for authentication, the service identity is not checked because, under NTLM, the client is unable to authenticate the server.</span></span> <span data-ttu-id="9cb6a-112">在计算机是 Windows 工作组的一部分时，或者在运行不支持的 Kerberos 身份验证的 Windows 早期版本时，将使用 NTLM。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-112">NTLM is used when computers are part of a Windows workgroup, or when running an older version of Windows that does not support Kerberos authentication.</span></span>  
  
 <span data-ttu-id="9cb6a-113">当客户端启动安全通道以向服务发送消息时，Windows Communication Foundation (WCF) 基础结构对服务进行身份验证，并且仅当服务标识与客户端使用的终结点地址中指定的标识匹配时才发送消息。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-113">When the client initiates a secure channel to send a message to a service over it, the Windows Communication Foundation (WCF) infrastructure authenticates the service, and only sends the message if the service identity matches the identity specified in the endpoint address the client uses.</span></span>  
  
 <span data-ttu-id="9cb6a-114">标识处理由以下几个阶段组成：</span><span class="sxs-lookup"><span data-stu-id="9cb6a-114">Identity processing consists of the following stages:</span></span>  
  
- <span data-ttu-id="9cb6a-115">在设计时，客户端开发人员确定终结点元数据（通过 WSDL 公开）的服务终结点。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-115">At design time, the client developer determines the service's identity from the endpoint's metadata (exposed through WSDL).</span></span>  
  
- <span data-ttu-id="9cb6a-116">在运行时，客户端应用程序在向服务发送任何消息之前检查服务安全凭据的声明。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-116">At runtime, the client application checks the claims of the service's security credentials before sending any messages to the service.</span></span>  
  
 <span data-ttu-id="9cb6a-117">客户端上的标识处理与服务上的客户端身份验证相似。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-117">Identity processing on the client is analogous to client authentication on the service.</span></span> <span data-ttu-id="9cb6a-118">直到已经对客户端的凭据进行了身份验证，安全服务才会执行代码。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-118">A secure service does not execute code until the client's credentials have been authenticated.</span></span> <span data-ttu-id="9cb6a-119">同样，直到基于事先从服务元数据已知的内容对服务凭据进行了身份验证，客户端才会向服务发送消息。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-119">Likewise, the client does not send messages to the service until the service's credentials have been authenticated based on what is known in advance from the service's metadata.</span></span>  
  
 <span data-ttu-id="9cb6a-120"><xref:System.ServiceModel.EndpointAddress.Identity%2A> 类的 <xref:System.ServiceModel.EndpointAddress> 属性表示由客户端调用的服务的标识。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-120">The <xref:System.ServiceModel.EndpointAddress.Identity%2A> property of the <xref:System.ServiceModel.EndpointAddress> class represents the identity of the service called by the client.</span></span> <span data-ttu-id="9cb6a-121">服务在其元数据中发布 <xref:System.ServiceModel.EndpointAddress.Identity%2A>。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-121">The service publishes the <xref:System.ServiceModel.EndpointAddress.Identity%2A> in its metadata.</span></span> <span data-ttu-id="9cb6a-122">当客户端开发人员运行配置的 [元数据实用工具工具时 ( # A0) ](../servicemodel-metadata-utility-tool-svcutil-exe.md) 针对服务终结点，生成的配置包含服务的属性的值 <xref:System.ServiceModel.EndpointAddress.Identity%2A> 。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-122">When the client developer runs the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md) against the service endpoint, the generated configuration contains the value of the service's <xref:System.ServiceModel.EndpointAddress.Identity%2A> property.</span></span> <span data-ttu-id="9cb6a-123">如果配置了安全) ，WCF 基础结构 (验证该服务是否拥有指定的标识。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-123">The WCF infrastructure (if configured with security) verifies that the service possesses the identity specified.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="9cb6a-124">元数据包含服务的预期标识，因此建议以安全方式公开服务元数据，例如，通过创建服务的 HTTPS 终结点。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-124">The metadata contains the expected identity of the service, so it is recommended that you expose the service metadata through secure means, for example, by creating an HTTPS endpoint for the service.</span></span> <span data-ttu-id="9cb6a-125">有关详细信息，请参阅 [如何：保护元数据终结点](how-to-secure-metadata-endpoints.md)。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-125">For more information, see [How to: Secure Metadata Endpoints](how-to-secure-metadata-endpoints.md).</span></span>  
  
## <a name="identity-types"></a><span data-ttu-id="9cb6a-126">标识类型</span><span class="sxs-lookup"><span data-stu-id="9cb6a-126">Identity Types</span></span>  

 <span data-ttu-id="9cb6a-127">服务可以提供六种类型的标识。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-127">A service can provide six types of identities.</span></span> <span data-ttu-id="9cb6a-128">每种标识类型对应于一个可以包含在配置中的 `<identity>` 元素内的元素。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-128">Each identity type corresponds to an element that can be contained inside the `<identity>` element in configuration.</span></span> <span data-ttu-id="9cb6a-129">使用的类型取决于方案和服务的安全要求。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-129">The type used depends on the scenario and the service's security requirements.</span></span> <span data-ttu-id="9cb6a-130">下表描述每种标识类型。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-130">The following table describes each identity type.</span></span>  
  
|<span data-ttu-id="9cb6a-131">标识类型</span><span class="sxs-lookup"><span data-stu-id="9cb6a-131">Identity type</span></span>|<span data-ttu-id="9cb6a-132">描述</span><span class="sxs-lookup"><span data-stu-id="9cb6a-132">Description</span></span>|<span data-ttu-id="9cb6a-133">典型的方案</span><span class="sxs-lookup"><span data-stu-id="9cb6a-133">Typical scenario</span></span>|  
|-------------------|-----------------|----------------------|  
|<span data-ttu-id="9cb6a-134">域名系统 (DNS)</span><span class="sxs-lookup"><span data-stu-id="9cb6a-134">Domain Name System (DNS)</span></span>|<span data-ttu-id="9cb6a-135">将此元素用于 X.509 证书或 Windows 帐户。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-135">Use this element with X.509 certificates or Windows accounts.</span></span> <span data-ttu-id="9cb6a-136">它将凭据中指定的 DNS 名称与此元素中指定的值进行比较。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-136">It compares the DNS name specified in the credential with the value specified in this element.</span></span>|<span data-ttu-id="9cb6a-137">DNS 检查让您可以通过 DNS 或使用者名称来使用证书。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-137">A DNS check enables you to use certificates with DNS or subject names.</span></span> <span data-ttu-id="9cb6a-138">如果使用同一个 DNS 或使用者名称来重新颁发证书，则标识检查仍然有效。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-138">If a certificate is reissued with the same DNS or subject name, then the identity check is still valid.</span></span> <span data-ttu-id="9cb6a-139">在重新颁发证书时，它会获取新的 RSA 密钥，但保留相同的 DNS 或使用者名称。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-139">When a certificate is reissued, it gets a new RSA key but retains the same DNS or subject name.</span></span> <span data-ttu-id="9cb6a-140">这意味着客户端不必更新其有关服务的标识信息。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-140">This means that clients do not have to update their identity information about the service.</span></span>|  
|<span data-ttu-id="9cb6a-141">证书。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-141">Certificate.</span></span> <span data-ttu-id="9cb6a-142">`ClientCredentialType` 设置为 Certificate 时的默认值。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-142">The default when `ClientCredentialType` is set to Certificate.</span></span>|<span data-ttu-id="9cb6a-143">此元素指定要与客户端进行比较的 Base64 编码的 X.509 证书值。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-143">This element specifies a Base64-encoded X.509 certificate value to compare with the client.</span></span><br /><br /> <span data-ttu-id="9cb6a-144">当使用 CardSpace 作为凭据对服务进行身份验证时，也使用此元素。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-144">Also use this element when using a CardSpace as a credential to authenticate the service.</span></span>|<span data-ttu-id="9cb6a-145">此元素将身份验证限制为单个基于其指纹值的证书。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-145">This element restricts authentication to a single certificate based upon its thumbprint value.</span></span> <span data-ttu-id="9cb6a-146">这样将启用更为严格的身份验证，因为指纹值是唯一的。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-146">This enables stricter authentication because thumbprint values are unique.</span></span> <span data-ttu-id="9cb6a-147">这也带来一个需要注意的问题：如果使用相同使用者名称重新颁发证书，则证书也有一个新的指纹。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-147">This comes with one caveat: If the certificate is reissued with the same Subject name, it also has a new Thumbprint.</span></span> <span data-ttu-id="9cb6a-148">因此，客户端无法验证服务，除非新的指纹是已知的。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-148">Therefore, clients are not able to validate the service unless the new thumbprint is known.</span></span> <span data-ttu-id="9cb6a-149">有关查找证书指纹的详细信息，请参阅 [如何：检索证书的指纹](how-to-retrieve-the-thumbprint-of-a-certificate.md)。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-149">For more information about finding a certificate's thumbprint, see [How to: Retrieve the Thumbprint of a Certificate](how-to-retrieve-the-thumbprint-of-a-certificate.md).</span></span>|  
|<span data-ttu-id="9cb6a-150">证书引用</span><span class="sxs-lookup"><span data-stu-id="9cb6a-150">Certificate Reference</span></span>|<span data-ttu-id="9cb6a-151">与前面描述的“证书”选项完全相同。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-151">Identical to the Certificate option described previously.</span></span> <span data-ttu-id="9cb6a-152">但是，此元素可让您指定证书名称并存储检索证书的位置。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-152">However, this element enables you to specify a certificate name and store location from which to retrieve the certificate.</span></span>|<span data-ttu-id="9cb6a-153">与前面描述的“证书”方案相同。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-153">Same as the Certificate scenario described previously.</span></span><br /><br /> <span data-ttu-id="9cb6a-154">其优点是证书存储位置可以更改。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-154">The benefit is that the certificate store location can change.</span></span>|  
|<span data-ttu-id="9cb6a-155">RSA</span><span class="sxs-lookup"><span data-stu-id="9cb6a-155">RSA</span></span>|<span data-ttu-id="9cb6a-156">此元素指定要与客户端进行比较的 RSA 密钥值。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-156">This element specifies an RSA key value to compare with the client.</span></span> <span data-ttu-id="9cb6a-157">这与“证书”选项类似，但并不使用证书的指纹，而是使用证书的 RSA 密钥。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-157">This is similar to the certificate option but rather than using the certificate's thumbprint, the certificate's RSA key is used instead.</span></span>|<span data-ttu-id="9cb6a-158">RSA 检查可让您明确地将身份验证限制为单个证书（基于其 RSA 证书）。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-158">An RSA check enables you to specifically restrict authentication to a single certificate based upon its RSA key.</span></span> <span data-ttu-id="9cb6a-159">这样将启用更为严格的特定 RSA 密钥身份验证，不过与此对应的代价是，如果更改 RSA 密钥值，则该服务不可再用于现有客户端。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-159">This enables stricter authentication of a specific RSA key at the expense of the service, which no longer works with existing clients if the RSA key value changes.</span></span>|  
|<span data-ttu-id="9cb6a-160">用户主体名称 (UPN)。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-160">User principal name (UPN).</span></span> <span data-ttu-id="9cb6a-161">`ClientCredentialType` 设置为 Windows 时的默认值，并且服务进程不是在一个系统帐户下运行的。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-161">The default when the `ClientCredentialType` is set to Windows and the service process is not running under one of the system accounts.</span></span>|<span data-ttu-id="9cb6a-162">此元素指定运行服务所依据的 UPN。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-162">This element specifies the UPN that the service is running under.</span></span> <span data-ttu-id="9cb6a-163">请参阅 [重写服务标识](../extending/overriding-the-identity-of-a-service-for-authentication.md)的 Kerberos 协议和标识部分进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-163">See the Kerberos Protocol and Identity section of [Overriding the Identity of a Service for Authentication](../extending/overriding-the-identity-of-a-service-for-authentication.md).</span></span>|<span data-ttu-id="9cb6a-164">这将确保服务在特定的 Windows 用户帐户下运行。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-164">This ensures that the service is running under a specific Windows user account.</span></span> <span data-ttu-id="9cb6a-165">用户帐户可以是当前已登录用户，也可以是在特定用户帐户下运行的服务。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-165">The user account can be either the current logged-on user or the service running under a particular user account.</span></span><br /><br /> <span data-ttu-id="9cb6a-166">如果服务是在 Active Directory 环境内的域帐户下运行，则此设置将利用 Windows Kerberos 安全。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-166">This setting takes advantage of Windows Kerberos security if the service is running under a domain account within an Active Directory environment.</span></span>|  
|<span data-ttu-id="9cb6a-167">服务主体名称 (SPN)。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-167">Service principal name (SPN).</span></span> <span data-ttu-id="9cb6a-168">`ClientCredentialType` 设置为 Windows 时的默认值，并且服务进程是在一个系统帐户（LocalService、LocalSystem 或 NetworkService）下运行的。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-168">The default when the `ClientCredentialType` is set to Windows and the service process is running under one of the system accounts—LocalService, LocalSystem, or NetworkService.</span></span>|<span data-ttu-id="9cb6a-169">此元素指定与服务的帐户相关联的 SPN。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-169">This element specifies the SPN associated with the service's account.</span></span> <span data-ttu-id="9cb6a-170">请参阅 [重写服务标识](../extending/overriding-the-identity-of-a-service-for-authentication.md)的 Kerberos 协议和标识部分进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-170">See the Kerberos Protocol and Identity section of [Overriding the Identity of a Service for Authentication](../extending/overriding-the-identity-of-a-service-for-authentication.md).</span></span>|<span data-ttu-id="9cb6a-171">这将确保 SPN 和与 SPN 相关联的特定 Windows 帐户标识服务。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-171">This ensures that the SPN and the specific Windows account associated with the SPN identify the service.</span></span><br /><br /> <span data-ttu-id="9cb6a-172">可以使用 Setspn.exe 工具将计算机帐户与服务的用户帐户进行关联。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-172">You can use the Setspn.exe tool to associate a machine account for the service's user account.</span></span><br /><br /> <span data-ttu-id="9cb6a-173">如果服务是在一个系统帐户下或具有与其关联的 SPN 名称的域帐户下运行的，并且计算机是 Active Directory 环境中的域的一个成员，则此设置将利用 Windows Kerberos 安全。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-173">This setting takes advantage of Windows Kerberos security if the service is running under one of the system accounts or under a domain account that has an associated SPN name with it and the computer is a member of a domain within an Active Directory environment.</span></span>|  
  
## <a name="specifying-identity-at-the-service"></a><span data-ttu-id="9cb6a-174">在服务上指定标识</span><span class="sxs-lookup"><span data-stu-id="9cb6a-174">Specifying Identity at the Service</span></span>  

 <span data-ttu-id="9cb6a-175">通常情况下不需要设置服务上的标识，因为客户端凭据类型的选择即规定了服务元数据中公开的标识的类型。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-175">Typically, you do not have to set the identity on a service because the selection of a client credential type dictates the type of identity exposed in the service metadata.</span></span> <span data-ttu-id="9cb6a-176">有关如何重写或指定服务标识的详细信息，请参阅 [重写服务标识以便进行身份验证](../extending/overriding-the-identity-of-a-service-for-authentication.md)。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-176">For more information about how to override or specify service identity, see [Overriding the Identity of a Service for Authentication](../extending/overriding-the-identity-of-a-service-for-authentication.md).</span></span>  
  
## <a name="using-the-identity-element-in-configuration"></a><span data-ttu-id="9cb6a-177">\<identity>在配置中使用元素</span><span class="sxs-lookup"><span data-stu-id="9cb6a-177">Using the \<identity> Element in Configuration</span></span>  

 <span data-ttu-id="9cb6a-178">如果将前面演示的绑定中的客户端凭据类型更改为 `Certificate,`，则生成的 WSDL 将包含一个 Base64 序列化 X.509 证书作为标识值，如下面的代码所示。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-178">If you change the client credential type in the binding previously shown to `Certificate,` then the generated WSDL contains a Base64 serialized X.509 certificate for the identity value as shown in the following code.</span></span> <span data-ttu-id="9cb6a-179">这是除 Windows 之外的所有客户端凭据类型的默认值。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-179">This is the default for all client credential types other than Windows.</span></span>  

 <span data-ttu-id="9cb6a-180">可以通过 `<identity>` 在配置中使用元素或在代码中设置标识，来更改默认服务标识的值或更改标识的类型。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-180">You can change the value of the default service identity or change the type of the identity by using the `<identity>` element in configuration or by setting the identity in code.</span></span> <span data-ttu-id="9cb6a-181">下面的配置代码使用值 `contoso.com` 设置域名系统 (DNS) 标识。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-181">The following configuration code sets a domain name system (DNS) identity with the value `contoso.com`.</span></span>  

## <a name="setting-identity-programmatically"></a><span data-ttu-id="9cb6a-182">以编程方式设置标识</span><span class="sxs-lookup"><span data-stu-id="9cb6a-182">Setting Identity Programmatically</span></span>  

 <span data-ttu-id="9cb6a-183">服务无需显式指定标识，因为 WCF 会自动确定标识。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-183">Your service does not have to explicitly specify an identity, because WCF automatically determines it.</span></span> <span data-ttu-id="9cb6a-184">不过，WCF 允许你在终结点上指定标识（如果需要）。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-184">However, WCF allows you to specify an identity on an endpoint, if required.</span></span> <span data-ttu-id="9cb6a-185">下面的代码使用特定的 DNS 标识添加了一个新的服务终结点。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-185">The following code adds a new service endpoint with a specific DNS identity.</span></span>  
  
 [!code-csharp[C_Identity#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#5)]
 [!code-vb[C_Identity#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#5)]  
  
## <a name="specifying-identity-at-the-client"></a><span data-ttu-id="9cb6a-186">在客户端上指定标识</span><span class="sxs-lookup"><span data-stu-id="9cb6a-186">Specifying Identity at the Client</span></span>  

 <span data-ttu-id="9cb6a-187">在设计时，客户端开发人员通常使用 " [)  (" 的元数据实用工具工具 ](../servicemodel-metadata-utility-tool-svcutil-exe.md) 来生成客户端配置。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-187">At design time, a client developer typically uses the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md) to generate client configuration.</span></span> <span data-ttu-id="9cb6a-188">生成的配置文件（适用于客户端使用）包含服务器的标识。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-188">The generated configuration file (intended for use by the client) contains the server's identity.</span></span> <span data-ttu-id="9cb6a-189">例如，下面的代码是从指定 DNS 标识的服务生成的，如前面的示例中所示。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-189">For example, the following code is generated from a service that specifies a DNS identity, as shown in the preceding example.</span></span> <span data-ttu-id="9cb6a-190">请注意，客户端的终结点标识值与服务的标识值匹配。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-190">Note that the client's endpoint identity value matches that of the service.</span></span> <span data-ttu-id="9cb6a-191">在此情况下，客户端接收服务的 Windows (Kerberos) 凭据，期望的值为 `contoso.com`。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-191">In this case, when the client receives the Windows (Kerberos) credentials for the service, it expects the value to be `contoso.com`.</span></span>  

 <span data-ttu-id="9cb6a-192">如果接收的不是 Windows 凭据，则服务指定作为客户端凭据类型的证书，然后证书的 DNS 属性的值应为 `contoso.com`。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-192">If, instead of Windows, the service specifies a certificate as the client credential type, then the certificate's DNS property is expected to be the value `contoso.com`.</span></span> <span data-ttu-id="9cb6a-193">（或者，如果 DNS 属性为 `null`，则证书的使用者名称必须是 `contoso.com`。）</span><span class="sxs-lookup"><span data-stu-id="9cb6a-193">(Or if the DNS property is `null`, the certificate's subject name must be `contoso.com`.)</span></span>  
  
#### <a name="using-a-specific-value-for-identity"></a><span data-ttu-id="9cb6a-194">使用特定的标识值</span><span class="sxs-lookup"><span data-stu-id="9cb6a-194">Using a Specific Value for Identity</span></span>  

 <span data-ttu-id="9cb6a-195">下面的客户端配置文件演示了服务的标识如何应为一个特定的值。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-195">The following client configuration file shows how the service's identity is expected to be a specific value.</span></span> <span data-ttu-id="9cb6a-196">在下面的示例中，客户端可以与两个终结点进行通信。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-196">In the following example, the client can communicate with two endpoints.</span></span> <span data-ttu-id="9cb6a-197">第一个终结点使用证书指纹进行标识，第二个终结点使用证书 RSA 密钥进行标识。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-197">The first is identified with a certificate thumbprint and the second with a certificate RSA key.</span></span> <span data-ttu-id="9cb6a-198">即，一个只包含一个公钥/私钥对、但不是由受信任的颁发机构颁发的证书。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-198">That is, a certificate that contains only a public key/private key pair, but is not issued by a trusted authority.</span></span>  

## <a name="identity-checking-at-run-time"></a><span data-ttu-id="9cb6a-199">运行时标识检查</span><span class="sxs-lookup"><span data-stu-id="9cb6a-199">Identity Checking at Run Time</span></span>  

 <span data-ttu-id="9cb6a-200">在设计时，客户端开发人员通过服务的元数据确定其标识。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-200">At design time, a client developer determines the server's identity through its metadata.</span></span> <span data-ttu-id="9cb6a-201">在运行时，在服务上调用任何终结点之前执行标识检查。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-201">At runtime, the identity check is performed before calling any endpoints on the service.</span></span>  
  
 <span data-ttu-id="9cb6a-202">标识值与元数据指定的身份验证类型相关联；换句话说，标识值与用于服务的凭据的类型相关联。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-202">The identity value is tied to the type of authentication specified by metadata; in other words, the type of credentials used for the service.</span></span>  
  
 <span data-ttu-id="9cb6a-203">如果配置通道以将消息级或传输级安全套接字层 (SSL) 与用于身份验证的 X.509 证书一起用来进行身份验证，则下面的标识值是有效的：</span><span class="sxs-lookup"><span data-stu-id="9cb6a-203">If the channel is configured to authenticate using message- or transport-level Secure Sockets Layer (SSL) with X.509 certificates for authentication, the following identity values are valid:</span></span>  
  
- <span data-ttu-id="9cb6a-204">DNS。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-204">DNS.</span></span> <span data-ttu-id="9cb6a-205">WCF 确保 SSL 握手期间提供的证书包含 `CommonName` 与客户端上的 dns 标识中指定的值相等的 DNS 或 (CN) 属性。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-205">WCF ensures that the certificate provided during the SSL handshake contains a DNS or `CommonName` (CN) attribute equal to the value specified in the DNS identity on the client.</span></span> <span data-ttu-id="9cb6a-206">请注意，除了确定服务器证书的有效性之外还执行这些检查。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-206">Note that these checks are done in addition to determining the validity of the server certificate.</span></span> <span data-ttu-id="9cb6a-207">默认情况下，WCF 将验证服务器证书是否由受信任的根证书颁发机构颁发。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-207">By default, WCF validates that the server certificate is issued by a trusted root authority.</span></span>  
  
- <span data-ttu-id="9cb6a-208">证书。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-208">Certificate.</span></span> <span data-ttu-id="9cb6a-209">在 SSL 握手期间，WCF 可确保远程终结点提供标识中指定的确切证书值。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-209">During the SSL handshake, WCF ensures that the remote endpoint provides the exact certificate value specified in the identity.</span></span>  
  
- <span data-ttu-id="9cb6a-210">证书引用。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-210">Certificate Reference.</span></span> <span data-ttu-id="9cb6a-211">与“证书”相同。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-211">Same as Certificate.</span></span>  
  
- <span data-ttu-id="9cb6a-212">RSA。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-212">RSA.</span></span> <span data-ttu-id="9cb6a-213">在 SSL 握手期间，WCF 可确保远程终结点提供标识中指定的确切 RSA 密钥。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-213">During the SSL handshake, WCF ensures that the remote endpoint provides the exact RSA key specified in the identity.</span></span>  
  
 <span data-ttu-id="9cb6a-214">如果服务将消息级或传输级 SSL 与用于身份验证的 Windows 凭据一起用来进行身份验证，并且协商凭据，则下面的标识值是有效的：</span><span class="sxs-lookup"><span data-stu-id="9cb6a-214">If the service authenticates using message- or transport-level SSL with a Windows credential for authentication, and negotiates the credential, the following identity values are valid:</span></span>  
  
- <span data-ttu-id="9cb6a-215">DNS。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-215">DNS.</span></span> <span data-ttu-id="9cb6a-216">协商传递服务的 SPN，因此可以检查 DNS 名称。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-216">The negotiation passes the service's SPN so that the DNS name can be checked.</span></span> <span data-ttu-id="9cb6a-217">SPN 采用 `host/<dns name>` 的格式。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-217">The SPN is in the form `host/<dns name>`.</span></span>  
  
- <span data-ttu-id="9cb6a-218">SPN。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-218">SPN.</span></span> <span data-ttu-id="9cb6a-219">返回显式的服务 SPN，例如 `host/myservice`。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-219">An explicit service SPN is returned, for example, `host/myservice`.</span></span>  
  
- <span data-ttu-id="9cb6a-220">UPN。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-220">UPN.</span></span> <span data-ttu-id="9cb6a-221">服务帐户的 UPN。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-221">The UPN of the service account.</span></span> <span data-ttu-id="9cb6a-222">UPN 的格式为 `username` @ `domain` 。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-222">The UPN is in the form `username`@`domain`.</span></span> <span data-ttu-id="9cb6a-223">例如，当服务在用户帐户中运行时，它可以是 `username@contoso.com`。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-223">For example, when the service is running in a user account, it may be `username@contoso.com`.</span></span>  
  
 <span data-ttu-id="9cb6a-224">以编程的方式指定标识（使用 <xref:System.ServiceModel.EndpointAddress.Identity%2A> 属性）是可选的。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-224">Specifying the identity programmatically (using the <xref:System.ServiceModel.EndpointAddress.Identity%2A> property) is optional.</span></span> <span data-ttu-id="9cb6a-225">如果未指定标识，并且客户端凭据类型是 Windows，则默认使用 SPN 并将其设置为以“host/”文本为前缀的服务终结点地址的主机名部分。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-225">If no identity is specified, and the client credential type is Windows, the default is SPN with the value set to the hostname part of the service endpoint address prefixed with the "host/" literal.</span></span> <span data-ttu-id="9cb6a-226">如果未指定标识，并且客户端凭据类型是证书，则默认使用 `Certificate`。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-226">If no identity is specified, and the client credential type is a certificate, the default is `Certificate`.</span></span> <span data-ttu-id="9cb6a-227">这将应用于消息级安全和传输级安全。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-227">This applies to both message- and transport-level security.</span></span>  
  
## <a name="identity-and-custom-bindings"></a><span data-ttu-id="9cb6a-228">标识和自定义绑定</span><span class="sxs-lookup"><span data-stu-id="9cb6a-228">Identity and Custom Bindings</span></span>  

 <span data-ttu-id="9cb6a-229">因为服务的标识取决于所使用的绑定类型，所以应确保在创建自定义绑定时公开相应的标识。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-229">Because the identity of a service depends on the binding type used, ensure that an appropriate identity is exposed when creating a custom binding.</span></span> <span data-ttu-id="9cb6a-230">例如，在下面的代码示例中，公开的标识与安全类型不兼容，因为安全对话引导绑定的标识与终结点上的绑定标识不匹配。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-230">For example, in the following code example, the identity exposed is not compatible with the security type, because the identity for the secure conversation bootstrap binding does not match the identity for the binding on the endpoint.</span></span> <span data-ttu-id="9cb6a-231">在 <xref:System.ServiceModel.Channels.WindowsStreamSecurityBindingElement> 设置 UPN 或 SPN 标识时，安全对话绑定设置 DNS 标识。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-231">The secure conversation binding sets the DNS identity, while the <xref:System.ServiceModel.Channels.WindowsStreamSecurityBindingElement> sets the UPN or SPN identity.</span></span>  
  
 [!code-csharp[C_Identity#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#8)]
 [!code-vb[C_Identity#8](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#8)]  
  
 <span data-ttu-id="9cb6a-232">有关如何正确地为自定义绑定堆栈绑定元素的详细信息，请参阅 [创建 User-Defined 绑定](../extending/creating-user-defined-bindings.md)。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-232">For more information about how to stack binding elements correctly for a custom binding, see [Creating User-Defined Bindings](../extending/creating-user-defined-bindings.md).</span></span> <span data-ttu-id="9cb6a-233">有关使用创建自定义绑定的详细信息 <xref:System.ServiceModel.Channels.SecurityBindingElement> ，请参阅 [如何：为指定的身份验证模式创建 SecurityBindingElement](how-to-create-a-securitybindingelement-for-a-specified-authentication-mode.md)。</span><span class="sxs-lookup"><span data-stu-id="9cb6a-233">For more information about creating a custom binding with the <xref:System.ServiceModel.Channels.SecurityBindingElement>, see [How to: Create a SecurityBindingElement for a Specified Authentication Mode](how-to-create-a-securitybindingelement-for-a-specified-authentication-mode.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="9cb6a-234">另请参阅</span><span class="sxs-lookup"><span data-stu-id="9cb6a-234">See also</span></span>

- [<span data-ttu-id="9cb6a-235">如何：使用 SecurityBindingElement 创建自定义绑定</span><span class="sxs-lookup"><span data-stu-id="9cb6a-235">How to: Create a Custom Binding Using the SecurityBindingElement</span></span>](how-to-create-a-custom-binding-using-the-securitybindingelement.md)
- [<span data-ttu-id="9cb6a-236">如何：为指定的身份验证模式创建 SecurityBindingElement</span><span class="sxs-lookup"><span data-stu-id="9cb6a-236">How to: Create a SecurityBindingElement for a Specified Authentication Mode</span></span>](how-to-create-a-securitybindingelement-for-a-specified-authentication-mode.md)
- [<span data-ttu-id="9cb6a-237">如何：创建自定义客户端标识验证工具</span><span class="sxs-lookup"><span data-stu-id="9cb6a-237">How to: Create a Custom Client Identity Verifier</span></span>](../extending/how-to-create-a-custom-client-identity-verifier.md)
- [<span data-ttu-id="9cb6a-238">选择凭据类型</span><span class="sxs-lookup"><span data-stu-id="9cb6a-238">Selecting a Credential Type</span></span>](selecting-a-credential-type.md)
- [<span data-ttu-id="9cb6a-239">使用证书</span><span class="sxs-lookup"><span data-stu-id="9cb6a-239">Working with Certificates</span></span>](working-with-certificates.md)
- [<span data-ttu-id="9cb6a-240">ServiceModel 元数据实用工具 (Svcutil.exe)</span><span class="sxs-lookup"><span data-stu-id="9cb6a-240">ServiceModel Metadata Utility Tool (Svcutil.exe)</span></span>](../servicemodel-metadata-utility-tool-svcutil-exe.md)
- [<span data-ttu-id="9cb6a-241">创建用户定义的绑定</span><span class="sxs-lookup"><span data-stu-id="9cb6a-241">Creating User-Defined Bindings</span></span>](../extending/creating-user-defined-bindings.md)
- [<span data-ttu-id="9cb6a-242">如何：检索证书的指纹</span><span class="sxs-lookup"><span data-stu-id="9cb6a-242">How to: Retrieve the Thumbprint of a Certificate</span></span>](how-to-retrieve-the-thumbprint-of-a-certificate.md)
