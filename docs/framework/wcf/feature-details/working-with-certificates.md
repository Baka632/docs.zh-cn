---
title: 使用证书
description: 了解 x.509 数字证书功能以及如何在 WCF 中使用它们。 本文中的资源可以进一步解释这些概念。
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- certificates [WCF]
ms.assetid: 6ffb8682-8f07-4a45-afbb-8d2487e9dbc3
ms.openlocfilehash: a12e723c763cdc3b9cf2105df9d0ee601f8bda1a
ms.sourcegitcommit: 27a15a55019f6b5f2733961738babe94aec0def3
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/15/2020
ms.locfileid: "90559013"
---
# <a name="working-with-certificates"></a><span data-ttu-id="92400-104">使用证书</span><span class="sxs-lookup"><span data-stu-id="92400-104">Working with Certificates</span></span>

<span data-ttu-id="92400-105">对 Windows Communication Foundation (WCF) 安全性进行编程时，通常使用 X.509 数字证书对客户端和服务器进行身份验证，以及对消息进行加密和数字签名。</span><span class="sxs-lookup"><span data-stu-id="92400-105">To program Windows Communication Foundation (WCF) security, X.509 digital certificates are commonly used to authenticate clients and servers, encrypt, and digitally sign messages.</span></span> <span data-ttu-id="92400-106">本主题将简要说明 X.509 数字证书的功能以及如何在 WCF 中使用它们，并提供一些主题的链接，这些主题对这些概念进行了深入说明，或揭示了如何使用 WCF 和证书来完成常见任务。</span><span class="sxs-lookup"><span data-stu-id="92400-106">This topic briefly explains X.509 digital certificate features and how to use them in WCF, and includes links to topics that explain these concepts further or that show how to accomplish common tasks using WCF and certificates.</span></span>

<span data-ttu-id="92400-107">简言之，数字证书是公钥基础结构 (PKI) 的一部分，而公钥基础结构是数字证书、证书颁发机构和其他注册机构的系统，它使用公钥加密对电子事务所涉及的每一方的有效性进行确认和身份验证\*\*。</span><span class="sxs-lookup"><span data-stu-id="92400-107">In brief, a digital certificate is a part of a *public key infrastructure* (PKI), which is a system of digital certificates, certificate authorities, and other registration authorities that verify and authenticate the validity of each party involved in an electronic transaction through the use of public key cryptography.</span></span> <span data-ttu-id="92400-108">证书颁发机构颁发证书，每个证书都具有一组包含数据的字段，例如“使用者”（向其颁发证书的实体）、有效日期（证书的有效日期）、证书颁发者（颁发证书的实体）和公钥\*\*。</span><span class="sxs-lookup"><span data-stu-id="92400-108">A certification authority issues certificates and each certificate has a set of fields that contain data, such as *subject* (the entity to which the certificate is issued), validity dates (when the certificate is valid), issuer (the entity that issued the certificate), and a public key.</span></span> <span data-ttu-id="92400-109">在 WCF 中，这些属性中的每一个都作为 <xref:System.IdentityModel.Claims.Claim> 进行处理，而每个声明又进一步分为两种类型：标识和权限。</span><span class="sxs-lookup"><span data-stu-id="92400-109">In WCF, each of these properties is processed as a <xref:System.IdentityModel.Claims.Claim>, and each claim is further divided into two types: identity and right.</span></span> <span data-ttu-id="92400-110">有关 X.509 证书的详细信息，请参阅 [X.509 公钥证书](/windows/desktop/SecCertEnroll/about-x-509-public-key-certificates)。</span><span class="sxs-lookup"><span data-stu-id="92400-110">For more information about X.509 certificates see [X.509 Public Key Certificates](/windows/desktop/SecCertEnroll/about-x-509-public-key-certificates).</span></span> <span data-ttu-id="92400-111">有关 WCF 中的声明和授权的详细信息，请参阅[使用标识模型管理声明和授权](managing-claims-and-authorization-with-the-identity-model.md)。</span><span class="sxs-lookup"><span data-stu-id="92400-111">For more information about Claims and Authorization in WCF see [Managing Claims and Authorization with the Identity Model](managing-claims-and-authorization-with-the-identity-model.md).</span></span> <span data-ttu-id="92400-112">有关实现 PKI 的详细信息，请参阅 [企业 PKI 和 Windows Server 2012 R2 Active Directory 证书服务](/archive/blogs/yungchou/enterprise-pki-with-windows-server-2012-r2-active-directory-certificate-services-part-1-of-2)。</span><span class="sxs-lookup"><span data-stu-id="92400-112">For more information about implementing a PKI, see [Enterprise PKI with Windows Server 2012 R2 Active Directory Certificate Services](/archive/blogs/yungchou/enterprise-pki-with-windows-server-2012-r2-active-directory-certificate-services-part-1-of-2).</span></span>

<span data-ttu-id="92400-113">证书的主要功能是向其他各方验证证书所有者的身份。</span><span class="sxs-lookup"><span data-stu-id="92400-113">The primary function of a certificate is to authenticate the identity of the owner of the certificate to others.</span></span> <span data-ttu-id="92400-114">证书包含所有者的公钥，所有者保留着私钥\*\*。</span><span class="sxs-lookup"><span data-stu-id="92400-114">A certificate contains the *public key* of the owner, while the owner retains the private key.</span></span> <span data-ttu-id="92400-115">公钥可用来对发送给证书所有者的消息进行加密。</span><span class="sxs-lookup"><span data-stu-id="92400-115">The public key can be used to encrypt messages sent to the owner of the certificate.</span></span> <span data-ttu-id="92400-116">只有所有者才能访问私钥，因此，只有所有者才能解密这些消息。</span><span class="sxs-lookup"><span data-stu-id="92400-116">Only the owner has access to the private key, so only the owner can decrypt those messages.</span></span>

<span data-ttu-id="92400-117">证书必须由证书颁发机构（通常是第三方证书颁发机构）颁发。</span><span class="sxs-lookup"><span data-stu-id="92400-117">Certificates must be issued by a certification authority, which is often a third-party  issuer of certificates.</span></span> <span data-ttu-id="92400-118">在 Windows 域中，包括一个证书颁发机构，可以用来向域中的计算机颁发证书。</span><span class="sxs-lookup"><span data-stu-id="92400-118">On a Windows domain, a certification authority is included that can be used to issue certificates to computers on the domain.</span></span>

## <a name="viewing-certificates"></a><span data-ttu-id="92400-119">查看证书</span><span class="sxs-lookup"><span data-stu-id="92400-119">Viewing Certificates</span></span>

<span data-ttu-id="92400-120">若要使用证书，通常需要查看证书并检查其属性。</span><span class="sxs-lookup"><span data-stu-id="92400-120">To work with certificates, it is often necessary to view them and examine their properties.</span></span> <span data-ttu-id="92400-121">使用 Microsoft 管理控制台 (MMC) 管理单元工具，很容易实现这一任务。</span><span class="sxs-lookup"><span data-stu-id="92400-121">This is easily done with the Microsoft Management Console (MMC) snap-in tool.</span></span> <span data-ttu-id="92400-122">有关详细信息，请参阅[如何：使用 MMC 管理单元查看证书](how-to-view-certificates-with-the-mmc-snap-in.md)。</span><span class="sxs-lookup"><span data-stu-id="92400-122">For more information, see [How to: View Certificates with the MMC Snap-in](how-to-view-certificates-with-the-mmc-snap-in.md).</span></span>

## <a name="certificate-stores"></a><span data-ttu-id="92400-123">证书存储</span><span class="sxs-lookup"><span data-stu-id="92400-123">Certificate Stores</span></span>

<span data-ttu-id="92400-124">证书存放在存储区中。</span><span class="sxs-lookup"><span data-stu-id="92400-124">Certificates are found in stores.</span></span> <span data-ttu-id="92400-125">主要的存储区位置有两个，它们进一步分为子存储区。</span><span class="sxs-lookup"><span data-stu-id="92400-125">Two major store locations exist that are further divided into sub-stores.</span></span> <span data-ttu-id="92400-126">如果您是计算机的管理员，就可以使用 MMC 管理单元工具查看这两个主要存储区。</span><span class="sxs-lookup"><span data-stu-id="92400-126">If you are the administrator on a computer, you can view both major stores by using the MMC snap-in tool.</span></span> <span data-ttu-id="92400-127">非管理员只能查看当前用户存储区。</span><span class="sxs-lookup"><span data-stu-id="92400-127">Non-administrators can view only the current user store.</span></span>

- <span data-ttu-id="92400-128">**本地计算机存储区**。</span><span class="sxs-lookup"><span data-stu-id="92400-128">**The local machine store**.</span></span> <span data-ttu-id="92400-129">这包含由计算机进程（如 ASP.NET）访问的证书。</span><span class="sxs-lookup"><span data-stu-id="92400-129">This contains the certificates accessed by machine processes, such as ASP.NET.</span></span> <span data-ttu-id="92400-130">此位置用于存储向客户端验证服务器身份的证书。</span><span class="sxs-lookup"><span data-stu-id="92400-130">Use this location to store certificates that authenticate the server to clients.</span></span>

- <span data-ttu-id="92400-131">**当前用户存储区**。</span><span class="sxs-lookup"><span data-stu-id="92400-131">**The current user store**.</span></span> <span data-ttu-id="92400-132">交互式应用程序通常将证书放在此位置，供计算机的当前用户使用。</span><span class="sxs-lookup"><span data-stu-id="92400-132">Interactive applications typically place certificates here for the computer's current user.</span></span> <span data-ttu-id="92400-133">如果要创建客户端应用程序，通常会将向服务验证用户身份的证书放在此处。</span><span class="sxs-lookup"><span data-stu-id="92400-133">If you are creating a client application, this is where you typically place certificates that authenticate a user to a service.</span></span>

<span data-ttu-id="92400-134">这两个存储区进一步分为子存储区。</span><span class="sxs-lookup"><span data-stu-id="92400-134">These two stores are further divided into sub-stores.</span></span> <span data-ttu-id="92400-135">使用 WCF 编程时，最重要的子存储区包括：</span><span class="sxs-lookup"><span data-stu-id="92400-135">The most important of these when programming with WCF include:</span></span>

- <span data-ttu-id="92400-136">**受信任的根证书颁发机构**。</span><span class="sxs-lookup"><span data-stu-id="92400-136">**Trusted Root Certification Authorities**.</span></span> <span data-ttu-id="92400-137">使用此存储区中的证书可以创建证书链，通过证书链，可以追溯到此存储区中的证书颁发机构证书。</span><span class="sxs-lookup"><span data-stu-id="92400-137">You can use the certificates in this store to create a chain of certificates, which can be traced back to a certification authority certificate in this store.</span></span>

  > [!IMPORTANT]
  > <span data-ttu-id="92400-138">本地计算机隐式信任放置在此存储区中的任何证书，即使证书不是来自受信任的第三方证书颁发机构，也是如此。</span><span class="sxs-lookup"><span data-stu-id="92400-138">The local computer implicitly trusts any certificate placed in this store, even if the certificate does not come from a trusted third-party certification authority.</span></span> <span data-ttu-id="92400-139">因此，除非完全信任颁发机构并了解后果，否则不要将任何证书放入此存储区。</span><span class="sxs-lookup"><span data-stu-id="92400-139">For this reason, do not place any certificate into this store unless you fully trust the issuer and understand the consequences.</span></span>

- <span data-ttu-id="92400-140">**个人**。</span><span class="sxs-lookup"><span data-stu-id="92400-140">**Personal**.</span></span> <span data-ttu-id="92400-141">此存储区用于放置与计算机用户关联的证书。</span><span class="sxs-lookup"><span data-stu-id="92400-141">This store is used for certificates associated with a user of a computer.</span></span> <span data-ttu-id="92400-142">通常，此存储区用于存放在受信任的根证书颁发机构存储区中找到的证书颁发机构证书之一所颁发的证书。</span><span class="sxs-lookup"><span data-stu-id="92400-142">Typically this store is used for certificates issued by one of the certification authority certificates found in the Trusted Root Certification Authorities store.</span></span> <span data-ttu-id="92400-143">此外，此处还可存放应用程序自行颁发并且信任的证书。</span><span class="sxs-lookup"><span data-stu-id="92400-143">Alternatively, a certificate found here may be self-issued and trusted by an application.</span></span>

<span data-ttu-id="92400-144">有关证书存储的详细信息，请参阅[证书存储](/windows/desktop/secauthn/certificate-stores)。</span><span class="sxs-lookup"><span data-stu-id="92400-144">For more information about certificate stores, see [Certificate Stores](/windows/desktop/secauthn/certificate-stores).</span></span>

### <a name="selecting-a-store"></a><span data-ttu-id="92400-145">选择存储区</span><span class="sxs-lookup"><span data-stu-id="92400-145">Selecting a Store</span></span>

<span data-ttu-id="92400-146">证书存储位置的选择，取决于服务或客户端运行的方式和时间。</span><span class="sxs-lookup"><span data-stu-id="92400-146">Selecting where to store a certificate depends how and when the service or client runs.</span></span> <span data-ttu-id="92400-147">适用以下一般规则：</span><span class="sxs-lookup"><span data-stu-id="92400-147">The following general rules apply:</span></span>

- <span data-ttu-id="92400-148">如果 WCF 服务承载于某个 Windows 服务中，则使用“本地计算机”存储区\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="92400-148">If the WCF service is hosted in a Windows service use the **local machine** store.</span></span> <span data-ttu-id="92400-149">请注意，要将证书安装到本地计算机存储区，需要有管理员权限。</span><span class="sxs-lookup"><span data-stu-id="92400-149">Note that administrator privileges are required to install certificates into the local machine store.</span></span>

- <span data-ttu-id="92400-150">如果服务或客户端是在某个用户帐户下运行的应用程序，则使用“当前用户”存储区\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="92400-150">If the service or client is an application that runs under a user account, then use the **current user** store.</span></span>

### <a name="accessing-stores"></a><span data-ttu-id="92400-151">访问存储区</span><span class="sxs-lookup"><span data-stu-id="92400-151">Accessing Stores</span></span>

<span data-ttu-id="92400-152">与计算机上的文件夹一样，存储区也受访问控制列表 (ACL) 保护。</span><span class="sxs-lookup"><span data-stu-id="92400-152">Stores are protected by access control lists (ACLs), just like folders on a computer.</span></span> <span data-ttu-id="92400-153">创建由 Internet Information Services (IIS) 承载的服务时，ASP.NET 进程将在 ASP.NET 帐户下运行。</span><span class="sxs-lookup"><span data-stu-id="92400-153">When creating a service hosted by Internet Information Services (IIS), the ASP.NET process runs under the ASP.NET account.</span></span> <span data-ttu-id="92400-154">该帐户必须有权访问包含服务所用证书的存储区。</span><span class="sxs-lookup"><span data-stu-id="92400-154">That account must have access to the store that contains the certificates a service uses.</span></span> <span data-ttu-id="92400-155">每个主要存储区都由一个默认访问列表保护，但这些列表是可以修改的。</span><span class="sxs-lookup"><span data-stu-id="92400-155">Each of the major stores is protected with a default access list, but the lists can be modified.</span></span> <span data-ttu-id="92400-156">如果创建一个单独的角色访问存储区，则必须向该角色授予访问权限。</span><span class="sxs-lookup"><span data-stu-id="92400-156">If you create a separate role to access a store, you must grant that role access permission.</span></span> <span data-ttu-id="92400-157">要了解如何使用 WinHttpCertConfig.exe 工具修改访问列表，请参阅[如何：创建开发期间使用的临时证书](how-to-create-temporary-certificates-for-use-during-development.md)。</span><span class="sxs-lookup"><span data-stu-id="92400-157">To learn how to modify the access list using the WinHttpCertConfig.exe tool, see [How to: Create Temporary Certificates for Use During Development](how-to-create-temporary-certificates-for-use-during-development.md).</span></span>

## <a name="chain-trust-and-certificate-authorities"></a><span data-ttu-id="92400-158">链信任和证书颁发机构</span><span class="sxs-lookup"><span data-stu-id="92400-158">Chain Trust and Certificate Authorities</span></span>

<span data-ttu-id="92400-159">证书是在某种层次结构中创建的，其中每个证书都链接到颁发该证书的 CA。</span><span class="sxs-lookup"><span data-stu-id="92400-159">Certificates are created in a hierarchy where each individual certificate is linked to the CA that issued the certificate.</span></span> <span data-ttu-id="92400-160">该链接指向 CA 的证书。</span><span class="sxs-lookup"><span data-stu-id="92400-160">This link is to the CA’s certificate.</span></span> <span data-ttu-id="92400-161">然后，CA 的证书链接到颁发了原始 CA 证书的 CA。</span><span class="sxs-lookup"><span data-stu-id="92400-161">The CA’s certificate then links to the CA that issued the original CA’s certificate.</span></span> <span data-ttu-id="92400-162">这一过程不断重复，直至到达根 CA 的证书。</span><span class="sxs-lookup"><span data-stu-id="92400-162">This process is repeated up until the Root CA’s certificate is reached.</span></span> <span data-ttu-id="92400-163">根 CA 的证书将以继承方式受到信任。</span><span class="sxs-lookup"><span data-stu-id="92400-163">The Root CA’s certificate is inherently trusted.</span></span>

<span data-ttu-id="92400-164">使用数字证书对实体进行身份验证时就依赖这一层次结构，它也称为信任链\*\*。</span><span class="sxs-lookup"><span data-stu-id="92400-164">Digital certificates are used to authenticate an entity by relying on this hierarchy, also called a *chain of trust*.</span></span> <span data-ttu-id="92400-165">通过双击任何证书，然后单击 " **证书路径** " 选项卡，可以使用 MMC 管理单元查看任何证书链。有关导入证书颁发机构的证书链的详细信息，请参阅 [如何：指定用于验证签名的证书颁发机构证书链](specify-the-certificate-authority-chain-verify-signatures-wcf.md)。</span><span class="sxs-lookup"><span data-stu-id="92400-165">You can view any certificate's chain using the MMC snap-in by double-clicking any certificate, then clicking the **Certificate Path** tab. For more information about importing certificate chains for a Certification authority, see [How to: Specify the Certificate Authority Certificate Chain Used to Verify Signatures](specify-the-certificate-authority-chain-verify-signatures-wcf.md).</span></span>

> [!NOTE]
> <span data-ttu-id="92400-166">通过将颁发机构的证书放入受信任的根颁发机构证书存储区中，可以向任何颁发机构指定受信任的根颁发机构。</span><span class="sxs-lookup"><span data-stu-id="92400-166">Any issuer can be designated a trusted root authority by placing the issuer's certificate in the trusted root authority certificate store.</span></span>

### <a name="disabling-chain-trust"></a><span data-ttu-id="92400-167">禁用链信任</span><span class="sxs-lookup"><span data-stu-id="92400-167">Disabling Chain Trust</span></span>

<span data-ttu-id="92400-168">在创建新服务时，可能会使用不是由受信任的根证书颁发的证书，或者颁发证书本身可能不在受信任的根证书颁发机构存储区中。</span><span class="sxs-lookup"><span data-stu-id="92400-168">When creating a new service, you may be using a certificate that is not issued by a trusted root certificate, or the issuing certificate itself may not be in the Trusted Root Certification Authorities store.</span></span> <span data-ttu-id="92400-169">如果仅为了开发目的，可以暂时禁用检查证书信任链的机制。</span><span class="sxs-lookup"><span data-stu-id="92400-169">For development purposes only, you can temporarily disable the mechanism that checks the chain of trust for a certificate.</span></span> <span data-ttu-id="92400-170">为此，需要将 `CertificateValidationMode` 属性设置为 `PeerTrust` 或 `PeerOrChainTrust`。</span><span class="sxs-lookup"><span data-stu-id="92400-170">To do this, set the `CertificateValidationMode` property to either `PeerTrust` or `PeerOrChainTrust`.</span></span> <span data-ttu-id="92400-171">这两种模式都指定，证书可以是自行颁发的（对等信任），也可以是信任链的一部分。</span><span class="sxs-lookup"><span data-stu-id="92400-171">Either mode specifies that the certificate can either be self-issued (peer trust) or part of a chain of trust.</span></span> <span data-ttu-id="92400-172">在下列所有类上，都可以设置此属性。</span><span class="sxs-lookup"><span data-stu-id="92400-172">You can set the property on any of the following classes.</span></span>

|<span data-ttu-id="92400-173">类</span><span class="sxs-lookup"><span data-stu-id="92400-173">Class</span></span>|<span data-ttu-id="92400-174">Property</span><span class="sxs-lookup"><span data-stu-id="92400-174">Property</span></span>|
|-----------|--------------|
|<xref:System.ServiceModel.Security.X509ClientCertificateAuthentication>|<xref:System.ServiceModel.Security.X509ClientCertificateAuthentication.CertificateValidationMode%2A?displayProperty=nameWithType>|
|<xref:System.ServiceModel.Security.X509PeerCertificateAuthentication>|<xref:System.ServiceModel.Security.X509PeerCertificateAuthentication.CertificateValidationMode%2A?displayProperty=nameWithType>|
|<xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication>|<xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CertificateValidationMode%2A?displayProperty=nameWithType>|
|<xref:System.ServiceModel.Security.IssuedTokenServiceCredential>|<xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A?displayProperty=nameWithType>|

<span data-ttu-id="92400-175">此外，也可以通过配置设置此属性。</span><span class="sxs-lookup"><span data-stu-id="92400-175">You can also set the property using configuration.</span></span> <span data-ttu-id="92400-176">下列元素用于指定验证模式：</span><span class="sxs-lookup"><span data-stu-id="92400-176">The following elements are used to specify the validation mode:</span></span>

- [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-servicecertificate-element.md)

- [\<peerAuthentication>](../../configure-apps/file-schema/wcf/peerauthentication-element.md)

- [\<messageSenderAuthentication>](../../configure-apps/file-schema/wcf/messagesenderauthentication-element.md)

## <a name="custom-authentication"></a><span data-ttu-id="92400-177">自定义身份验证</span><span class="sxs-lookup"><span data-stu-id="92400-177">Custom Authentication</span></span>

<span data-ttu-id="92400-178">使用 `CertificateValidationMode` 属性，还可以对证书的身份验证方式进行自定义。</span><span class="sxs-lookup"><span data-stu-id="92400-178">The `CertificateValidationMode` property also enables you to customize how certificates are authenticated.</span></span> <span data-ttu-id="92400-179">默认情况下，级别设置为 `ChainTrust`。</span><span class="sxs-lookup"><span data-stu-id="92400-179">By default, the level is set to `ChainTrust`.</span></span> <span data-ttu-id="92400-180">若要使用 <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom> 值，还必须将 `CustomCertificateValidatorType` 属性设置为程序集和用于验证证书的类型。</span><span class="sxs-lookup"><span data-stu-id="92400-180">To use the <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom> value, you must also set the `CustomCertificateValidatorType` attribute to an assembly and type used to validate the certificate.</span></span> <span data-ttu-id="92400-181">若要创建自定义验证程序，必须从抽象 <xref:System.IdentityModel.Selectors.X509CertificateValidator> 类继承。</span><span class="sxs-lookup"><span data-stu-id="92400-181">To create a custom validator, you must inherit from the abstract <xref:System.IdentityModel.Selectors.X509CertificateValidator> class.</span></span>

<span data-ttu-id="92400-182">在创建自定义身份验证器时，要重写的最重要方法是 <xref:System.IdentityModel.Selectors.X509CertificateValidator.Validate%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="92400-182">When creating a custom authenticator, the most important method to override is the <xref:System.IdentityModel.Selectors.X509CertificateValidator.Validate%2A> method.</span></span> <span data-ttu-id="92400-183">有关自定义身份验证的示例，请参阅 [X.509 证书验证程序](../samples/x-509-certificate-validator.md)示例。</span><span class="sxs-lookup"><span data-stu-id="92400-183">For an example of custom authentication, see the [X.509 Certificate Validator](../samples/x-509-certificate-validator.md) sample.</span></span> <span data-ttu-id="92400-184">有关详细信息，请参阅[自定义凭据和凭据验证](../extending/custom-credential-and-credential-validation.md)。</span><span class="sxs-lookup"><span data-stu-id="92400-184">For more information, see [Custom Credential and Credential Validation](../extending/custom-credential-and-credential-validation.md).</span></span>

## <a name="using-the-powershell-new-selfsignedcertificate-cmdlet-to-build-a-certificate-chain"></a><span data-ttu-id="92400-185">使用 PowerShell New-selfsignedcertificate Cmdlet 构建证书链</span><span class="sxs-lookup"><span data-stu-id="92400-185">Using the PowerShell New-SelfSignedCertificate Cmdlet to Build a Certificate Chain</span></span>

<span data-ttu-id="92400-186">PowerShell New-selfsignedcertificate cmdlet 创建 x.509 证书和私钥/公钥对。</span><span class="sxs-lookup"><span data-stu-id="92400-186">The PowerShell New-SelfSignedCertificate cmdlet creates X.509 certificates and private key/public key pairs.</span></span> <span data-ttu-id="92400-187">可以将私钥保存在磁盘上，然后用它来颁发和签名新证书，从而模拟链状证书的层次结构。</span><span class="sxs-lookup"><span data-stu-id="92400-187">You can save the private key to disk and then use it to issue and sign new certificates, thus simulating a hierarchy of chained certificates.</span></span> <span data-ttu-id="92400-188">此 cmdlet 仅用作开发服务时的辅助手段，不应用于创建用于实际部署的证书。</span><span class="sxs-lookup"><span data-stu-id="92400-188">The cmdlet is intended for use only as an aid when developing services and should never be used to create certificates for actual deployment.</span></span> <span data-ttu-id="92400-189">在开发 WCF 服务时，请使用以下步骤通过 New-selfsignedcertificate cmdlet 生成信任链。</span><span class="sxs-lookup"><span data-stu-id="92400-189">When developing a WCF service, use the following steps to build a chain of trust with the New-SelfSignedCertificate cmdlet.</span></span>

#### <a name="to-build-a-chain-of-trust-with-the-new-selfsignedcertificate-cmdlet"></a><span data-ttu-id="92400-190">使用 New-selfsignedcertificate cmdlet 构建信任链</span><span class="sxs-lookup"><span data-stu-id="92400-190">To build a chain of trust with the New-SelfSignedCertificate cmdlet</span></span>

1. <span data-ttu-id="92400-191">使用 New-selfsignedcertificate cmdlet 创建 (自签名) 证书的临时根证书颁发机构。</span><span class="sxs-lookup"><span data-stu-id="92400-191">Create a temporary root authority (self-signed) certificate using the New-SelfSignedCertificate cmdlet.</span></span> <span data-ttu-id="92400-192">将私钥保存到磁盘上。</span><span class="sxs-lookup"><span data-stu-id="92400-192">Save the private key to the disk.</span></span>

2. <span data-ttu-id="92400-193">使用此新证书颁发另一个包含公钥的证书。</span><span class="sxs-lookup"><span data-stu-id="92400-193">Use the new certificate to issue another certificate that contains the public key.</span></span>

3. <span data-ttu-id="92400-194">将根颁发机构证书导入到受信任的根证书颁发机构存储区中。</span><span class="sxs-lookup"><span data-stu-id="92400-194">Import the root authority certificate into the Trusted Root Certification Authorities store.</span></span>

4. <span data-ttu-id="92400-195">有关分步说明，请参阅[如何：创建开发期间使用的临时证书](how-to-create-temporary-certificates-for-use-during-development.md)。</span><span class="sxs-lookup"><span data-stu-id="92400-195">For step-by-step instructions, see [How to: Create Temporary Certificates for Use During Development](how-to-create-temporary-certificates-for-use-during-development.md).</span></span>

## <a name="which-certificate-to-use"></a><span data-ttu-id="92400-196">要使用哪个证书？</span><span class="sxs-lookup"><span data-stu-id="92400-196">Which Certificate to Use?</span></span>

<span data-ttu-id="92400-197">关于证书的常见问题是要使用哪个证书以及使用它的原因。</span><span class="sxs-lookup"><span data-stu-id="92400-197">Common questions about certificates are which certificate to use, and why.</span></span> <span data-ttu-id="92400-198">答案取决于是对客户端编程还是对服务编程。</span><span class="sxs-lookup"><span data-stu-id="92400-198">The answer depends on whether you are programming a client or service.</span></span> <span data-ttu-id="92400-199">下面的信息提供了一个一般准则，但未对这些问题提供详尽解答。</span><span class="sxs-lookup"><span data-stu-id="92400-199">The following information provides a general guideline and is not an exhaustive answer to these questions.</span></span>

### <a name="service-certificates"></a><span data-ttu-id="92400-200">服务证书</span><span class="sxs-lookup"><span data-stu-id="92400-200">Service Certificates</span></span>

<span data-ttu-id="92400-201">服务证书的主要任务是向客户端验证服务器的身份。</span><span class="sxs-lookup"><span data-stu-id="92400-201">Service certificates have the primary task of authenticating the server to clients.</span></span> <span data-ttu-id="92400-202">客户端对服务器进行身份验证时所进行的初始检查之一是将“使用者”字段的值与用来联系服务的统一资源标识符 (URI) 进行比较：二者的 DNS 必须匹配\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="92400-202">One of the initial checks when a client authenticates a server is to compare the value of the **Subject** field to the Uniform Resource Identifier (URI) used to contact the service: the DNS of both must match.</span></span> <span data-ttu-id="92400-203">例如，如果服务的 URI 为，则 `http://www.contoso.com/endpoint/` " **使用者** " 字段还必须包含值 `www.contoso.com` 。</span><span class="sxs-lookup"><span data-stu-id="92400-203">For example, if the URI of the service is `http://www.contoso.com/endpoint/` then the **Subject** field must also contain the value `www.contoso.com`.</span></span>

<span data-ttu-id="92400-204">请注意，该字段可以包含多个值，每个值都以一个起始值前缀来指示其值。</span><span class="sxs-lookup"><span data-stu-id="92400-204">Note that the field can contain several values, each prefixed with an initialization to indicate the value.</span></span> <span data-ttu-id="92400-205">最常见的情况是，初始化为公用名 "CN"，例如 `CN = www.contoso.com` 。</span><span class="sxs-lookup"><span data-stu-id="92400-205">Most commonly, the initialization is "CN" for common name, for example, `CN = www.contoso.com`.</span></span> <span data-ttu-id="92400-206">“使用者”字段还可能为空白，这种情况下，“使用者可选名称”字段可以包含“DNS 名称”值\*\*\*\*\*\*\*\*\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="92400-206">It is also possible for the **Subject** field to be blank, in which case the **Subject Alternative Name** field can contain the **DNS Name** value.</span></span>

<span data-ttu-id="92400-207">另请注意，证书“预期目的”字段的值应包含一个适当的值，例如“服务器身份验证”或“客户端身份验证”\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="92400-207">Also note the value of the **Intended Purposes** field of the certificate should include an appropriate value, such as "Server Authentication" or "Client Authentication".</span></span>

### <a name="client-certificates"></a><span data-ttu-id="92400-208">客户端证书</span><span class="sxs-lookup"><span data-stu-id="92400-208">Client Certificates</span></span>

<span data-ttu-id="92400-209">客户端证书通常不是由第三方证书颁发机构颁发的。</span><span class="sxs-lookup"><span data-stu-id="92400-209">Client certificates are not typically issued by a third-party certification authority.</span></span> <span data-ttu-id="92400-210">相反，在当前用户位置的个人存储区中，通常包含由根证书颁发机构存放在此的证书，其预期目的为“客户端身份验证”。</span><span class="sxs-lookup"><span data-stu-id="92400-210">Instead, the Personal store of the current user location typically contains certificates placed there by a root authority, with an intended purpose of "Client Authentication".</span></span> <span data-ttu-id="92400-211">客户端可以在需要相互身份验证时使用此类证书。</span><span class="sxs-lookup"><span data-stu-id="92400-211">The client can use such a certificate when mutual authentication is required.</span></span>

## <a name="online-revocation-and-offline-revocation"></a><span data-ttu-id="92400-212">联机吊销和脱机吊销</span><span class="sxs-lookup"><span data-stu-id="92400-212">Online Revocation and Offline Revocation</span></span>

### <a name="certificate-validity"></a><span data-ttu-id="92400-213">证书有效性</span><span class="sxs-lookup"><span data-stu-id="92400-213">Certificate Validity</span></span>

<span data-ttu-id="92400-214">每个证书仅在给定时间段内有效，称为“有效期”\*\*。</span><span class="sxs-lookup"><span data-stu-id="92400-214">Every certificate is valid only for a given period of time, called the *validity period*.</span></span> <span data-ttu-id="92400-215">有效期由 X.509 证书的“有效起始日期”和“有效结束日期”字段定义\*\*\*\*\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="92400-215">The validity period is defined by the **Valid from** and **Valid to** fields of an X.509 certificate.</span></span> <span data-ttu-id="92400-216">在身份验证过程中，将对证书进行检查以确定证书是否仍在有效期内。</span><span class="sxs-lookup"><span data-stu-id="92400-216">During authentication, the certificate is checked to determine whether the certificate is still within the validity period.</span></span>

### <a name="certificate-revocation-list"></a><span data-ttu-id="92400-217">证书吊销列表</span><span class="sxs-lookup"><span data-stu-id="92400-217">Certificate Revocation List</span></span>

<span data-ttu-id="92400-218">在有效期内，证书颁发机构随时可以吊销证书。</span><span class="sxs-lookup"><span data-stu-id="92400-218">At any time during the validity period, the certification authority can revoke a certificate.</span></span> <span data-ttu-id="92400-219">吊销证书有多种原因，例如危及证书私钥的安全。</span><span class="sxs-lookup"><span data-stu-id="92400-219">This can occur for many reasons, such as a compromise of the private key of the certificate.</span></span>

<span data-ttu-id="92400-220">如果证书吊销，则从被吊销证书继承的任何链都将无效，在身份验证过程中也不受信任。</span><span class="sxs-lookup"><span data-stu-id="92400-220">When this occurs, any chains that descend from the revoked certificate are also invalid, and are not trusted during authentication procedures.</span></span> <span data-ttu-id="92400-221">为了查看吊销了哪些证书，每个证书颁发者都发布一个加盖了时间戳和日期戳的证书吊销列表 (CRL)\*\*。</span><span class="sxs-lookup"><span data-stu-id="92400-221">To find out which certificates are revoked, each issuer publishes a time- and date-stamped *certificate revocation list* (CRL).</span></span> <span data-ttu-id="92400-222">可以使用联机吊销或脱机吊销来查看此列表，方法是将以下类的 `RevocationMode` 或 `DefaultRevocationMode` 属性设置为 <xref:System.Security.Cryptography.X509Certificates.X509RevocationMode> 枚举值之一：<xref:System.ServiceModel.Security.X509ClientCertificateAuthentication>、<xref:System.ServiceModel.Security.X509PeerCertificateAuthentication>、<xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication> 和 <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> 类。</span><span class="sxs-lookup"><span data-stu-id="92400-222">The list can be checked using either online revocation or offline revocation by setting the `RevocationMode` or `DefaultRevocationMode` property of the following classes to one of the <xref:System.Security.Cryptography.X509Certificates.X509RevocationMode> enumeration values: <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication>, <xref:System.ServiceModel.Security.X509PeerCertificateAuthentication>, <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication>, and the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> classes.</span></span> <span data-ttu-id="92400-223">所有属性的默认值都是 `Online`。</span><span class="sxs-lookup"><span data-stu-id="92400-223">The default value for all properties is `Online`.</span></span>

<span data-ttu-id="92400-224">你还可以使用 `revocationMode`) 的 (的属性 [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-clientcertificate-element.md) [\<serviceBehaviors>](../../configure-apps/file-schema/wcf/servicebehaviors.md) 和) 的 [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-clientcertificate-element.md) ([\<endpointBehaviors>](../../configure-apps/file-schema/wcf/endpointbehaviors.md) 设置配置模式。</span><span class="sxs-lookup"><span data-stu-id="92400-224">You can also set the mode in configuration using the `revocationMode` attribute of both the [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-clientcertificate-element.md) (of the [\<serviceBehaviors>](../../configure-apps/file-schema/wcf/servicebehaviors.md)) and the [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-clientcertificate-element.md) (of the [\<endpointBehaviors>](../../configure-apps/file-schema/wcf/endpointbehaviors.md)).</span></span>

## <a name="the-setcertificate-method"></a><span data-ttu-id="92400-225">SetCertificate 方法</span><span class="sxs-lookup"><span data-stu-id="92400-225">The SetCertificate Method</span></span>

<span data-ttu-id="92400-226">在 WCF 中，必须经常指定一个或一组证书，供服务或客户端用来对消息进行身份验证、加密或数字签名。</span><span class="sxs-lookup"><span data-stu-id="92400-226">In WCF, you must often specify a certificate or set of certificates a service or client is to use to authenticate, encrypt, or digitally sign a message.</span></span> <span data-ttu-id="92400-227">使用表示 X.509 证书的各个类的 `SetCertificate` 方法，可以以编程方式实现这一操作。</span><span class="sxs-lookup"><span data-stu-id="92400-227">You can do this programmatically by using the `SetCertificate` method of various classes that represent X.509 certificates.</span></span> <span data-ttu-id="92400-228">下面的类使用 `SetCertificate` 方法指定一个证书。</span><span class="sxs-lookup"><span data-stu-id="92400-228">The following classes use the `SetCertificate` method to specify a certificate.</span></span>

|<span data-ttu-id="92400-229">类</span><span class="sxs-lookup"><span data-stu-id="92400-229">Class</span></span>|<span data-ttu-id="92400-230">方法</span><span class="sxs-lookup"><span data-stu-id="92400-230">Method</span></span>|
|-----------|------------|
|<xref:System.ServiceModel.Security.PeerCredential>|<xref:System.ServiceModel.Security.PeerCredential.SetCertificate%2A>|
|<xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential>|<xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential.SetCertificate%2A>|
|<xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential>|<xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential.SetCertificate%2A>|
|<xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential>|
|<xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential.SetCertificate%2A>|

<span data-ttu-id="92400-231">`SetCertificate` 方法通过指定一个存储区位置和存储区、一个指定证书字段的“查找”类型（`x509FindType` 参数）和一个要在字段中查找的值来实现其功能。</span><span class="sxs-lookup"><span data-stu-id="92400-231">The `SetCertificate` method works by designating a store location and store, a "find" type (`x509FindType` parameter) that specifies a field of the certificate, and a value to find in the field.</span></span> <span data-ttu-id="92400-232">例如，下面的代码创建一个 <xref:System.ServiceModel.ServiceHost> 实例，并使用 `SetCertificate` 方法设置用于向客户端验证服务身份的服务证书。</span><span class="sxs-lookup"><span data-stu-id="92400-232">For example, the following code creates a <xref:System.ServiceModel.ServiceHost> instance and sets the service certificate used to authenticate the service to clients with the `SetCertificate` method.</span></span>

[!code-csharp[c_WorkingWithCertificates#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_workingwithcertificates/cs/source.cs#1)]
[!code-vb[c_WorkingWithCertificates#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_workingwithcertificates/vb/source.vb#1)]

### <a name="multiple-certificates-with-the-same-value"></a><span data-ttu-id="92400-233">具有相同值的多个证书</span><span class="sxs-lookup"><span data-stu-id="92400-233">Multiple Certificates with the Same Value</span></span>

<span data-ttu-id="92400-234">一个存储区可以包含多个具有相同主题名称的证书。</span><span class="sxs-lookup"><span data-stu-id="92400-234">A store may contain multiple certificates with the same subject name.</span></span> <span data-ttu-id="92400-235">这意味着如果将 `x509FindType` 指定为 <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindBySubjectName> 或 <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindBySubjectDistinguishedName>，并且多个证书具有相同的值，则会引发异常，因为无法区分需要的是哪个证书。</span><span class="sxs-lookup"><span data-stu-id="92400-235">This means that if you specify that the `x509FindType` is <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindBySubjectName> or <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindBySubjectDistinguishedName>, and more than one certificate has the same value, an exception is thrown because there is no way to distinguish which certificate is required.</span></span> <span data-ttu-id="92400-236">通过将 `x509FindType` 设置为 <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByThumbprint>，可以缓解这一问题。</span><span class="sxs-lookup"><span data-stu-id="92400-236">You can mitigate this by setting the `x509FindType` to <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByThumbprint>.</span></span> <span data-ttu-id="92400-237">指纹字段包含一个唯一值，可以用来查找存储区中的特定证书。</span><span class="sxs-lookup"><span data-stu-id="92400-237">The thumbprint field contains a unique value that can be used to find a specific certificate in a store.</span></span> <span data-ttu-id="92400-238">但是，这种方法也有缺点，如果证书已吊销或续订，则 `SetCertificate` 方法会失败，因为指纹也消失了。</span><span class="sxs-lookup"><span data-stu-id="92400-238">However, this has its own disadvantage: if the certificate is revoked or renewed, the `SetCertificate` method fails because the thumbprint is also gone.</span></span> <span data-ttu-id="92400-239">或者，如果证书不再有效，则身份验证将失败。</span><span class="sxs-lookup"><span data-stu-id="92400-239">Or, if the certificate is no longer valid, authentication fails.</span></span> <span data-ttu-id="92400-240">缓解这一问题的方法是将 `x590FindType` 参数设置为 <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByIssuerName> 并指定颁发机构的名称。</span><span class="sxs-lookup"><span data-stu-id="92400-240">The way to mitigate this is to set the `x590FindType` parameter to <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByIssuerName> and specify the issuer's name.</span></span> <span data-ttu-id="92400-241">如果不需要特定颁发机构，也可以设置一个其他的 <xref:System.Security.Cryptography.X509Certificates.X509FindType> 枚举值，例如 <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByTimeValid>。</span><span class="sxs-lookup"><span data-stu-id="92400-241">If no particular issuer is required, you can also set one of the other <xref:System.Security.Cryptography.X509Certificates.X509FindType> enumeration values, such as <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByTimeValid>.</span></span>

## <a name="certificates-in-configuration"></a><span data-ttu-id="92400-242">配置中的证书</span><span class="sxs-lookup"><span data-stu-id="92400-242">Certificates in Configuration</span></span>

<span data-ttu-id="92400-243">此外，通过配置也可以设置证书。</span><span class="sxs-lookup"><span data-stu-id="92400-243">You can also set certificates by using configuration.</span></span> <span data-ttu-id="92400-244">如果创建的是服务，则会在下指定凭据，包括证书 [\<serviceBehaviors>](../../configure-apps/file-schema/wcf/servicebehaviors.md) 。</span><span class="sxs-lookup"><span data-stu-id="92400-244">If you are creating a service, credentials, including certificates, are specified under the [\<serviceBehaviors>](../../configure-apps/file-schema/wcf/servicebehaviors.md).</span></span> <span data-ttu-id="92400-245">在对客户端进行编程时，将在下指定证书 [\<endpointBehaviors>](../../configure-apps/file-schema/wcf/endpointbehaviors.md) 。</span><span class="sxs-lookup"><span data-stu-id="92400-245">When you are programming a client, certificates are specified under the [\<endpointBehaviors>](../../configure-apps/file-schema/wcf/endpointbehaviors.md).</span></span>

## <a name="mapping-a-certificate-to-a-user-account"></a><span data-ttu-id="92400-246">将证书映射到用户帐户</span><span class="sxs-lookup"><span data-stu-id="92400-246">Mapping a Certificate to a User Account</span></span>

<span data-ttu-id="92400-247">IIS 和 Active Directory 的一个功能是将证书映射到 Windows 用户帐户。</span><span class="sxs-lookup"><span data-stu-id="92400-247">A feature of IIS and Active Directory is the ability to map a certificate to a Windows user account.</span></span> <span data-ttu-id="92400-248">有关此功能的详细信息，请参阅 [Map certificates to user accounts](/previous-versions/windows/it-pro/windows-server-2003/cc736706(v=ws.10))（将证书映射到用户帐户）。</span><span class="sxs-lookup"><span data-stu-id="92400-248">For more information about the feature, see [Map certificates to user accounts](/previous-versions/windows/it-pro/windows-server-2003/cc736706(v=ws.10)).</span></span>

<span data-ttu-id="92400-249">有关使用 Active Directory 映射的详细信息，请参阅 [Mapping Client Certificates with Directory Service Mapping](/previous-versions/windows/it-pro/windows-server-2003/cc758484(v=ws.10))（使用目录服务映射来映射客户端证书）。</span><span class="sxs-lookup"><span data-stu-id="92400-249">For more information about using Active Directory mapping, see [Mapping Client Certificates with Directory Service Mapping](/previous-versions/windows/it-pro/windows-server-2003/cc758484(v=ws.10)).</span></span>

<span data-ttu-id="92400-250">如果启用了这一功能，则可以将 <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication.MapClientCertificateToWindowsAccount%2A> 类的 <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication> 属性设置为 `true`。</span><span class="sxs-lookup"><span data-stu-id="92400-250">With this capability enabled, you can set the <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication.MapClientCertificateToWindowsAccount%2A> property of the <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication> class to `true`.</span></span> <span data-ttu-id="92400-251">在 "配置" 中，可以将 `mapClientCertificateToWindowsAccount` 元素的属性设置 [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-servicecertificate-element.md) 为 `true` ，如下面的代码所示。</span><span class="sxs-lookup"><span data-stu-id="92400-251">In configuration, you can set the `mapClientCertificateToWindowsAccount` attribute of the [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-servicecertificate-element.md) element to `true`, as shown in the following code.</span></span>

```xml
<serviceBehaviors>
 <behavior name="MappingBehavior">
  <serviceCredentials>
   <clientCertificate>
    <authentication certificateValidationMode="None" mapClientCertificateToWindowsAccount="true" />
   </clientCertificate>
  </serviceCredentials>
 </behavior>
</serviceBehaviors>
```

<span data-ttu-id="92400-252">将 X.509 证书映射到表示 Windows 用户帐户的令牌，这一过程视为权限提升，这是因为一旦执行了映射，就可使用 Windows 令牌获得对受保护资源的访问权限。</span><span class="sxs-lookup"><span data-stu-id="92400-252">Mapping an X.509 certificate to the token that represents a Windows user account is considered an elevation of privilege because, once mapped, the Windows token can be used to gain access to protected resources.</span></span> <span data-ttu-id="92400-253">因此，域策略要求 X.509 证书在映射之前符合其策略。</span><span class="sxs-lookup"><span data-stu-id="92400-253">Therefore, domain policy requires the X.509 certificate to comply with its policy prior to mapping.</span></span> <span data-ttu-id="92400-254">SChannel 安全数据包强制执行此要求\*\*。</span><span class="sxs-lookup"><span data-stu-id="92400-254">The *SChannel* security package enforces this requirement.</span></span>

<span data-ttu-id="92400-255">使用 .NET Framework 3.5 或更高版本时，在将证书映射到 Windows 帐户之前，WCF 确保证书符合域策略。</span><span class="sxs-lookup"><span data-stu-id="92400-255">When using .NET Framework 3.5 or later versions, WCF ensures the certificate conforms to domain policy before it is mapped to a Windows account.</span></span>

<span data-ttu-id="92400-256">在 WCF 第一版中，可在无需考虑域策略的情况下，执行映射。</span><span class="sxs-lookup"><span data-stu-id="92400-256">In the first release of WCF, mapping is done without consulting the domain policy.</span></span> <span data-ttu-id="92400-257">因此，如果启用了映射，而 X.509 证书不满足域策略，则在第一版下运行正常的早期应用程序，可能会失败。</span><span class="sxs-lookup"><span data-stu-id="92400-257">Therefore it is possible that older applications that used to work when running under the first release, fails if the mapping is enabled and the X.509 certificate does not satisfy the domain policy.</span></span>

## <a name="see-also"></a><span data-ttu-id="92400-258">请参阅</span><span class="sxs-lookup"><span data-stu-id="92400-258">See also</span></span>

- <xref:System.ServiceModel.Channels>
- <xref:System.ServiceModel.Security>
- <xref:System.ServiceModel>
- <xref:System.Security.Cryptography.X509Certificates.X509FindType>
- [<span data-ttu-id="92400-259">保护服务和客户端的安全</span><span class="sxs-lookup"><span data-stu-id="92400-259">Securing Services and Clients</span></span>](securing-services-and-clients.md)
