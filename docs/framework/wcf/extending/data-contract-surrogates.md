---
title: 数据协定代理项
ms.date: 03/30/2017
helpviewer_keywords:
- data contracts [WCF], surrogates
ms.assetid: 8c31134c-46c5-4ed7-94af-bab0ac0dfce5
ms.openlocfilehash: e33a487c03bbf87666d517040e00131f5482be6f
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/26/2020
ms.locfileid: "96251511"
---
# <a name="data-contract-surrogates"></a><span data-ttu-id="31689-102">数据协定代理项</span><span class="sxs-lookup"><span data-stu-id="31689-102">Data Contract Surrogates</span></span>

<span data-ttu-id="31689-103">数据协定 *代理项* 是一种基于数据协定模型构建的高级功能。</span><span class="sxs-lookup"><span data-stu-id="31689-103">The data contract *surrogate* is an advanced feature built upon the Data Contract model.</span></span> <span data-ttu-id="31689-104">在设计上，此功能用于在用户希望更改对类型进行序列化、反序列化或将其设计成元数据的方式时，进行类型自定义和替换。</span><span class="sxs-lookup"><span data-stu-id="31689-104">This feature is designed to be used for type customization and substitution in situations where users want to change how a type is serialized, deserialized or projected into metadata.</span></span> <span data-ttu-id="31689-105">在以下情况下可以使用代理项：还没有为类型指定数据协定；字段和属性 (Property) 没有用 <xref:System.Runtime.Serialization.DataMemberAttribute> 属性 (Attribute) 进行标记；用户希望动态创建架构变体。</span><span class="sxs-lookup"><span data-stu-id="31689-105">Some scenarios where a surrogate may be used is when a data contract has not been specified for the type, fields and properties are not marked with the <xref:System.Runtime.Serialization.DataMemberAttribute> attribute or users wish to dynamically create schema variations.</span></span>  
  
 <span data-ttu-id="31689-106">序列化和反序列化是在使用 <xref:System.Runtime.Serialization.DataContractSerializer> 将 .NET Framework 转换为合适的格式（如 XML）时，借助于数据协定代理项来完成的。</span><span class="sxs-lookup"><span data-stu-id="31689-106">Serialization and deserialization are accomplished with the data contract surrogate when using <xref:System.Runtime.Serialization.DataContractSerializer> to convert from .NET Framework to a suitable format, such as XML.</span></span> <span data-ttu-id="31689-107">在生成元数据表示形式（如 XML 架构文档 (XSD)）时，也可以使用数据协定代理项来修改为类型导出的元数据。</span><span class="sxs-lookup"><span data-stu-id="31689-107">Data contract surrogate can also be used to modify the metadata exported for types, when producing metadata representations such as XML Schema Documents (XSD).</span></span> <span data-ttu-id="31689-108">在导入时将从元数据创建代码，在这种情况下也可以使用代理项来自定义所生成的代码。</span><span class="sxs-lookup"><span data-stu-id="31689-108">Upon import, code is created from metadata and the surrogate can be used in this case to customize the generated code as well.</span></span>  
  
## <a name="how-the-surrogate-works"></a><span data-ttu-id="31689-109">代理项的工作方式</span><span class="sxs-lookup"><span data-stu-id="31689-109">How the Surrogate Works</span></span>  

 <span data-ttu-id="31689-110">代理项通过将一个类型（“原始”类型）映射到另一个类型（“代理项”类型）来工作。</span><span class="sxs-lookup"><span data-stu-id="31689-110">A surrogate works by mapping one type (the "original" type) to another type (the "surrogated" type).</span></span> <span data-ttu-id="31689-111">下面的示例演示了原始类型 `Inventory` 和一个新代理项类型 `InventorySurrogated`。</span><span class="sxs-lookup"><span data-stu-id="31689-111">The following example shows the original type `Inventory` and a new surrogate `InventorySurrogated` type.</span></span> <span data-ttu-id="31689-112">`Inventory` 类型是不可序列化的，但是 `InventorySurrogated` 类型是可序列化的：</span><span class="sxs-lookup"><span data-stu-id="31689-112">The `Inventory` type is not serializable but the `InventorySurrogated` type is:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#1)]  
  
 <span data-ttu-id="31689-113">由于尚未针对该类定义数据协定，因此请使用数据协定将该类转换为代理项类。</span><span class="sxs-lookup"><span data-stu-id="31689-113">Because a data contract has not been defined for this class, convert the class to a surrogate class with a data contract.</span></span> <span data-ttu-id="31689-114">下面的示例演示了这个代理项类：</span><span class="sxs-lookup"><span data-stu-id="31689-114">The surrogated class is shown in the following example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#2)]  
  
## <a name="implementing-the-idatacontractsurrogate"></a><span data-ttu-id="31689-115">实现 IDataContractSurrogate</span><span class="sxs-lookup"><span data-stu-id="31689-115">Implementing the IDataContractSurrogate</span></span>  

 <span data-ttu-id="31689-116">若要使用数据协定代理项，请实现 <xref:System.Runtime.Serialization.IDataContractSurrogate> 接口。</span><span class="sxs-lookup"><span data-stu-id="31689-116">To use the data contract surrogate, implement the <xref:System.Runtime.Serialization.IDataContractSurrogate> interface.</span></span>  
  
 <span data-ttu-id="31689-117">下面概述了 <xref:System.Runtime.Serialization.IDataContractSurrogate> 的每种方法及其可能的实现。</span><span class="sxs-lookup"><span data-stu-id="31689-117">The following is an overview of each method of <xref:System.Runtime.Serialization.IDataContractSurrogate> with a possible implementation.</span></span>  
  
### <a name="getdatacontracttype"></a><span data-ttu-id="31689-118">GetDataContractType</span><span class="sxs-lookup"><span data-stu-id="31689-118">GetDataContractType</span></span>  

 <span data-ttu-id="31689-119"><xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> 方法将一种类型映射到另一种类型。</span><span class="sxs-lookup"><span data-stu-id="31689-119">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method maps one type to another.</span></span> <span data-ttu-id="31689-120">此方法是序列化、反序列化、导入和导出所必需的。</span><span class="sxs-lookup"><span data-stu-id="31689-120">This method is required for serialization, deserialization, import, and export.</span></span>  
  
 <span data-ttu-id="31689-121">第一项任务是定义要将哪些类型映射到其他类型。</span><span class="sxs-lookup"><span data-stu-id="31689-121">The first task is defining what types will be mapped to other types.</span></span> <span data-ttu-id="31689-122">例如：</span><span class="sxs-lookup"><span data-stu-id="31689-122">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#3)]  
  
- <span data-ttu-id="31689-123">在序列化时，随后将使用 GetDataContractType 方法所返回的映射，通过调用 <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> 方法来将原始实例转换为代理项实例。</span><span class="sxs-lookup"><span data-stu-id="31689-123">On serialization, the mapping returned by this method is subsequently used to transform the original instance to a surrogated instance by calling the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method.</span></span>  
  
- <span data-ttu-id="31689-124">在反序列化时，序列化程序将使用 GetDataContractType 方法所返回的映射来反序列化为代理项类型的实例。</span><span class="sxs-lookup"><span data-stu-id="31689-124">On deserialization, the mapping returned by this method is used by the serializer to deserialize into an instance of the surrogate type.</span></span> <span data-ttu-id="31689-125">序列化程序随后将通过调用 <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> 来将代理项实例转换为原始类型的实例。</span><span class="sxs-lookup"><span data-stu-id="31689-125">It subsequently calls <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> to transform the surrogated instance into an instance of the original type.</span></span>  
  
- <span data-ttu-id="31689-126">在导出时，将反射 GetDataContractType 方法所返回的代理项类型以获得要用于生成元数据的数据协定。</span><span class="sxs-lookup"><span data-stu-id="31689-126">On export, the surrogate type returned by this method is reflected to get the data contract to use for generating metadata.</span></span>  
  
- <span data-ttu-id="31689-127">在导入时，原始类型会更改为代理项类型，代理项类型将进行反射以获得要用于各种目的（如引用支持）的数据协定。</span><span class="sxs-lookup"><span data-stu-id="31689-127">On import, the initial type is changed to a surrogate type that is reflected to get the data contract to use for purposes like referencing support.</span></span>  
  
 <span data-ttu-id="31689-128"><xref:System.Type> 参数是正在序列化、反序列化、导入或导出的对象的类型。</span><span class="sxs-lookup"><span data-stu-id="31689-128">The <xref:System.Type> parameter is the type of the object that is being serialized, deserialized, imported, or exported.</span></span> <span data-ttu-id="31689-129">如果该类型没有由代理项处理，则 <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> 方法必须返回输入类型；</span><span class="sxs-lookup"><span data-stu-id="31689-129">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method must return the input type if the surrogate does not handle the type.</span></span> <span data-ttu-id="31689-130">否则将返回相应的代理项类型。</span><span class="sxs-lookup"><span data-stu-id="31689-130">Otherwise, return the appropriate surrogated type.</span></span> <span data-ttu-id="31689-131">如果存在多个代理项类型，则可以在该方法中定义许多映射。</span><span class="sxs-lookup"><span data-stu-id="31689-131">If several surrogate types exist, numerous mappings can be defined in this method.</span></span>  
  
 <span data-ttu-id="31689-132"><xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> 方法不是针对内置的数据协定基元（如 <xref:System.Int32> 或 <xref:System.String>）调用的。</span><span class="sxs-lookup"><span data-stu-id="31689-132">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method is not called for built-in data contract primitives, such as <xref:System.Int32> or <xref:System.String>.</span></span> <span data-ttu-id="31689-133">对于其他类型（如数组、用户定义的类型）和其他数据结构，将针对每种类型调用此方法。</span><span class="sxs-lookup"><span data-stu-id="31689-133">For other types, such as arrays, user-defined types, and other data structures, this method will be called for each type.</span></span>  
  
 <span data-ttu-id="31689-134">在上面的示例中，此方法检查 `type` 参数与 `Inventory` 是否具有可比性。</span><span class="sxs-lookup"><span data-stu-id="31689-134">In the previous example, the method checks if the `type` parameter and `Inventory` are comparable.</span></span> <span data-ttu-id="31689-135">如果具有可比性，此方法会将该参数映射到 `InventorySurrogated`。</span><span class="sxs-lookup"><span data-stu-id="31689-135">If so, the method maps it to `InventorySurrogated`.</span></span> <span data-ttu-id="31689-136">每当调用序列化、反序列化、导入架构或导出架构时，都会首先调用此函数来确定类型之间的映射。</span><span class="sxs-lookup"><span data-stu-id="31689-136">Whenever a serialization, deserialization, import schema, or export schema is called, this function is called first to determine the mapping between types.</span></span>  
  
### <a name="getobjecttoserialize-method"></a><span data-ttu-id="31689-137">GetObjectToSerialize 方法</span><span class="sxs-lookup"><span data-stu-id="31689-137">GetObjectToSerialize Method</span></span>  

 <span data-ttu-id="31689-138"><xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> 方法用来将原始类型的实例转换为代理项类型的实例。</span><span class="sxs-lookup"><span data-stu-id="31689-138">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method converts the original type instance to the surrogated type instance.</span></span> <span data-ttu-id="31689-139">此方法是序列化所必需的。</span><span class="sxs-lookup"><span data-stu-id="31689-139">The method is required for serialization.</span></span>  
  
 <span data-ttu-id="31689-140">下一步是定义如何通过实现 <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> 方法来将物理数据从原始实例映射到代理项。</span><span class="sxs-lookup"><span data-stu-id="31689-140">The next step is to define the way the physical data will be mapped from the original instance to the surrogate by implementing the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method.</span></span> <span data-ttu-id="31689-141">例如：</span><span class="sxs-lookup"><span data-stu-id="31689-141">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#4)]  
  
 <span data-ttu-id="31689-142">当对对象进行序列化时，会调用 <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="31689-142">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method is called when an object is serialized.</span></span> <span data-ttu-id="31689-143">此方法会将数据从原始类型传输到代理项类型的字段。</span><span class="sxs-lookup"><span data-stu-id="31689-143">This method transfers data from the original type to the fields of the surrogated type.</span></span> <span data-ttu-id="31689-144">可以直接将字段映射到代理项字段，也可以将对原始数据的操作存储在代理项中。</span><span class="sxs-lookup"><span data-stu-id="31689-144">Fields can be directly mapped to surrogate fields, or manipulations of the original data may be stored in the surrogate.</span></span> <span data-ttu-id="31689-145">下面是一些可能的用法：直接映射字段；针对存储在代理项字段中的数据执行操作；将原始类型的 XML 存储在代理项字段中。</span><span class="sxs-lookup"><span data-stu-id="31689-145">Some possible uses include: directly mapping the fields, performing operations on the data to be stored in the surrogated fields, or storing the XML of the original type in the surrogated field.</span></span>  
  
 <span data-ttu-id="31689-146">`targetType` 参数指的是成员的声明类型。</span><span class="sxs-lookup"><span data-stu-id="31689-146">The `targetType` parameter refers to the declared type of the member.</span></span> <span data-ttu-id="31689-147">此参数是由 <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> 方法返回的代理项类型。</span><span class="sxs-lookup"><span data-stu-id="31689-147">This parameter is the surrogated type returned by the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method.</span></span> <span data-ttu-id="31689-148">序列化程序不强求使所返回的对象可对该类型赋值。</span><span class="sxs-lookup"><span data-stu-id="31689-148">The serializer does not enforce that the object returned is assignable to this type.</span></span> <span data-ttu-id="31689-149">`obj`参数是要序列化的对象，并将在必要时转换为其代理项。</span><span class="sxs-lookup"><span data-stu-id="31689-149">The `obj` parameter is the object to serialize, and will be converted to its surrogate if necessary.</span></span> <span data-ttu-id="31689-150">如果该对象没有由代理项处理，则此方法必须返回输入对象；</span><span class="sxs-lookup"><span data-stu-id="31689-150">This method must return the input object if the surrogated does not handle the object.</span></span> <span data-ttu-id="31689-151">否则，将返回新的代理项对象。</span><span class="sxs-lookup"><span data-stu-id="31689-151">Otherwise, the new surrogate object will be returned.</span></span> <span data-ttu-id="31689-152">如果此对象为 Null，则将不调用该代理项。</span><span class="sxs-lookup"><span data-stu-id="31689-152">The surrogate is not called if the object is null.</span></span> <span data-ttu-id="31689-153">可以在该方法中为不同的实例定义许多代理项映射。</span><span class="sxs-lookup"><span data-stu-id="31689-153">Numerous surrogate mappings for different instances may be defined within this method.</span></span>  
  
 <span data-ttu-id="31689-154">在创建 <xref:System.Runtime.Serialization.DataContractSerializer> 时，可以命令它保留对象引用。</span><span class="sxs-lookup"><span data-stu-id="31689-154">When creating a <xref:System.Runtime.Serialization.DataContractSerializer>, you can instruct it to preserve object references.</span></span> <span data-ttu-id="31689-155"> (有关详细信息，请参阅 [序列化和反序列化](../feature-details/serialization-and-deserialization.md)。 ) 这是通过将 `preserveObjectReferences` 其构造函数中的参数设置为来完成 `true` 的。</span><span class="sxs-lookup"><span data-stu-id="31689-155">(For more information, see [Serialization and Deserialization](../feature-details/serialization-and-deserialization.md).) This is done by setting the `preserveObjectReferences` parameter in its constructor to `true`.</span></span> <span data-ttu-id="31689-156">在这种情况下，只对每个对象调用一次该代理项，因为以后所有的序列化都只是将引用写入相应的流中。</span><span class="sxs-lookup"><span data-stu-id="31689-156">In that case, the surrogate is called only once for an object since all subsequent serializations just write the reference into the stream.</span></span> <span data-ttu-id="31689-157">如果 `preserveObjectReferences` 设置为 `false`，那么，每遇到一个实例，都会调用该代理项。</span><span class="sxs-lookup"><span data-stu-id="31689-157">If `preserveObjectReferences` is set to `false`, then the surrogate is called every time an instance is encountered.</span></span>  
  
 <span data-ttu-id="31689-158">如果已序列化实例的类型不同于所声明的类型，则类型信息（例如，`xsi:type`）将写入相应的流中，以便允许在另一端对该实例进行反序列化。</span><span class="sxs-lookup"><span data-stu-id="31689-158">If the type of the instance serialized differs from the declared type, type information is written into the stream, for example, `xsi:type` to allow the instance to be deserialized at the other end.</span></span> <span data-ttu-id="31689-159">无论该对象是否为代理项对象，都会发生此过程。</span><span class="sxs-lookup"><span data-stu-id="31689-159">This process occurs whether the object is surrogated or not.</span></span>  
  
 <span data-ttu-id="31689-160">上面的示例将 `Inventory` 实例的数据转换为 `InventorySurrogated` 的数据。</span><span class="sxs-lookup"><span data-stu-id="31689-160">The example above converts the data of the `Inventory` instance to that of `InventorySurrogated`.</span></span> <span data-ttu-id="31689-161">它检查对象的类型并对其执行必要的操作，以便将它转换为代理项类型。</span><span class="sxs-lookup"><span data-stu-id="31689-161">It checks the type of the object and performs the necessary manipulations to convert to the surrogated type.</span></span> <span data-ttu-id="31689-162">在本例中是用 `Inventory` 类的字段直接覆盖 `InventorySurrogated` 类的字段。</span><span class="sxs-lookup"><span data-stu-id="31689-162">In this case, the fields of the `Inventory` class are directly copied over to the `InventorySurrogated` class fields.</span></span>  
  
### <a name="getdeserializedobject-method"></a><span data-ttu-id="31689-163">GetDeserializedObject 方法</span><span class="sxs-lookup"><span data-stu-id="31689-163">GetDeserializedObject Method</span></span>  

 <span data-ttu-id="31689-164"><xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> 方法用来将代理项类型的实例转换为原始类型的实例。</span><span class="sxs-lookup"><span data-stu-id="31689-164">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> method converts the surrogated type instance to the original type instance.</span></span> <span data-ttu-id="31689-165">它是反序列化所必需的。</span><span class="sxs-lookup"><span data-stu-id="31689-165">It is required for deserialization.</span></span>  
  
 <span data-ttu-id="31689-166">下一项任务是定义如何将物理数据从代理项实例映射到原始实例。</span><span class="sxs-lookup"><span data-stu-id="31689-166">The next task is to define the way the physical data will be mapped from the surrogate instance to the original.</span></span> <span data-ttu-id="31689-167">例如：</span><span class="sxs-lookup"><span data-stu-id="31689-167">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#5)]  
  
 <span data-ttu-id="31689-168">只有在对对象进行反序列化时才调用此方法。</span><span class="sxs-lookup"><span data-stu-id="31689-168">This method is called only during the deserialization of an object.</span></span> <span data-ttu-id="31689-169">此方法提供了用来从代理项类型反序列化到其原始类型的反向数据映射。</span><span class="sxs-lookup"><span data-stu-id="31689-169">It provides reverse data mapping for the deserialization from the surrogate type back to its original type.</span></span> <span data-ttu-id="31689-170">此方法与 `GetObjectToSerialize` 方法的可能用法相似：直接交换字段数据、针对数据执行操作以及存储 XML 数据。</span><span class="sxs-lookup"><span data-stu-id="31689-170">Similar to the `GetObjectToSerialize` method, some possible uses may be to directly exchange field data, perform operations on the data, and store XML data.</span></span> <span data-ttu-id="31689-171">在反序列化时，由于数据转换中的一些操作，您可能无法始终从原始实例获取确切的数据值。</span><span class="sxs-lookup"><span data-stu-id="31689-171">When  deserializing, you may not always obtain the exact data values from original due to manipulations in the data conversion.</span></span>  
  
 <span data-ttu-id="31689-172">`targetType` 参数指的是成员的声明类型。</span><span class="sxs-lookup"><span data-stu-id="31689-172">The `targetType` parameter refers to the declared type of the member.</span></span> <span data-ttu-id="31689-173">此参数是由 `GetDataContractType` 方法返回的代理项类型。</span><span class="sxs-lookup"><span data-stu-id="31689-173">This parameter is the surrogated type returned by the `GetDataContractType` method.</span></span> <span data-ttu-id="31689-174">`obj`参数引用已反序列化的对象。</span><span class="sxs-lookup"><span data-stu-id="31689-174">The `obj` parameter refers to the object that has been deserialized.</span></span> <span data-ttu-id="31689-175">如果这是代理项对象，则可以将其重新转换为其原始类型。</span><span class="sxs-lookup"><span data-stu-id="31689-175">The object can be converted back to its original type if it is surrogated.</span></span> <span data-ttu-id="31689-176">如果该对象没有由代理项处理，则此方法将返回输入对象；</span><span class="sxs-lookup"><span data-stu-id="31689-176">This method returns the input object if the surrogate does not handle the object.</span></span> <span data-ttu-id="31689-177">否则，将在转换完成之后立即返回反序列化的对象。</span><span class="sxs-lookup"><span data-stu-id="31689-177">Otherwise, the deserialized object will be returned once its conversion has been completed.</span></span> <span data-ttu-id="31689-178">如果存在多个代理项类型，则可以通过指示每个类型及其转换来提供从代理项到主类型的数据转换。</span><span class="sxs-lookup"><span data-stu-id="31689-178">If several surrogate types exist, you may provide data conversion from surrogate to primary type for each by indicating each type and its conversion.</span></span>  
  
 <span data-ttu-id="31689-179">在返回对象时，内部对象表会用该代理项所返回的对象进行更新。</span><span class="sxs-lookup"><span data-stu-id="31689-179">When returning an object, the internal object tables are updated with the object returned by this surrogate.</span></span> <span data-ttu-id="31689-180">以后无论何时引用实例，都将从内部对象表中获取其代理项实例。</span><span class="sxs-lookup"><span data-stu-id="31689-180">Any subsequent references to an instance will obtain the surrogated instance from the object tables.</span></span>  
  
 <span data-ttu-id="31689-181">上面的示例将 `InventorySurrogated` 类型的对象重新转换为其初始类型 `Inventory`。</span><span class="sxs-lookup"><span data-stu-id="31689-181">The previous example converts objects of type `InventorySurrogated` back to the initial type `Inventory`.</span></span> <span data-ttu-id="31689-182">在该例中，数据直接从 `InventorySurrogated` 传输到其在 `Inventory` 中的相应字段。</span><span class="sxs-lookup"><span data-stu-id="31689-182">In this case, data is directly transferred back from `InventorySurrogated` to its corresponding fields in `Inventory`.</span></span> <span data-ttu-id="31689-183">由于没有对数据执行任何操作，因此每个成员字段所包含的值与序列化之前相同。</span><span class="sxs-lookup"><span data-stu-id="31689-183">Because there are no data manipulations, the each of the member fields will contain the same values as before the serialization.</span></span>  
  
### <a name="getcustomdatatoexport-method"></a><span data-ttu-id="31689-184">GetCustomDataToExport 方法</span><span class="sxs-lookup"><span data-stu-id="31689-184">GetCustomDataToExport Method</span></span>  

 <span data-ttu-id="31689-185">在导出架构时，<xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A> 方法是可选的。</span><span class="sxs-lookup"><span data-stu-id="31689-185">When exporting a schema, the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A> method is optional.</span></span> <span data-ttu-id="31689-186">此方法用来在所导出的架构中插入其他数据或提示。</span><span class="sxs-lookup"><span data-stu-id="31689-186">It is used to insert additional data or hints into the exported schema.</span></span> <span data-ttu-id="31689-187">可以在成员级别或类型级别插入其他数据。</span><span class="sxs-lookup"><span data-stu-id="31689-187">Additional data can be inserted at the member level or type level.</span></span> <span data-ttu-id="31689-188">例如：</span><span class="sxs-lookup"><span data-stu-id="31689-188">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#6)]  
  
 <span data-ttu-id="31689-189">此方法（连同两个重载）允许在成员级别或类型级别将额外的信息包括到元数据中。</span><span class="sxs-lookup"><span data-stu-id="31689-189">This method (with two overloads) enables the inclusion of extra information into the metadata either at the member or type level.</span></span> <span data-ttu-id="31689-190">可以包括有关某个成员是公共成员还是私有成员的提示，以及将在导出和导入架构的整个过程中保留的注释。</span><span class="sxs-lookup"><span data-stu-id="31689-190">It is possible to include hints about whether a member is public or private, and comments which would be preserved throughout the export and import of the schema.</span></span> <span data-ttu-id="31689-191">如果没有此方法，类似的信息将会丢失。</span><span class="sxs-lookup"><span data-stu-id="31689-191">Such information would be lost without this method.</span></span> <span data-ttu-id="31689-192">此方法不会导致插入或删除成员或类型，而是会在成员级别或类型级别向架构中添加额外的数据。</span><span class="sxs-lookup"><span data-stu-id="31689-192">This method does not cause the insertion or deletion of members or types, but rather adds additional data to the schemas at either of these levels.</span></span>  
  
 <span data-ttu-id="31689-193">此方法是重载方法，可以采用 `Type`（`clrtype` 参数）或 <xref:System.Reflection.MemberInfo>（`memberInfo` 参数）。</span><span class="sxs-lookup"><span data-stu-id="31689-193">The method is overloaded and can take either a `Type` (`clrtype` parameter) or <xref:System.Reflection.MemberInfo> (`memberInfo` parameter).</span></span> <span data-ttu-id="31689-194">第二个参数始终为 `Type`（`dataContractType` 参数）。</span><span class="sxs-lookup"><span data-stu-id="31689-194">The second parameter is always a `Type` (`dataContractType` parameter).</span></span> <span data-ttu-id="31689-195">将针对代理类型 `dataContractType` 的每个成员和类型调用此方法。</span><span class="sxs-lookup"><span data-stu-id="31689-195">This method is called for every member and type of the surrogated `dataContractType` type.</span></span>  
  
 <span data-ttu-id="31689-196">其中的任一重载都必须返回 `null` 或一个可序列化的对象。</span><span class="sxs-lookup"><span data-stu-id="31689-196">Either of these overloads must return either `null` or a serializable object.</span></span> <span data-ttu-id="31689-197">非 Null 对象将作为批注序列化到导出的架构中。</span><span class="sxs-lookup"><span data-stu-id="31689-197">A non-null object will be serialized as annotation into the exported schema.</span></span> <span data-ttu-id="31689-198">对于 `Type` 重载，导出到架构的每个类型都会通过第一个参数，连同作为 `dataContractType` 参数的代理项类型一起发送到此方法。</span><span class="sxs-lookup"><span data-stu-id="31689-198">For the `Type` overload, each type that is exported to schema is sent to this method in the first parameter along with the surrogated type as the `dataContractType` parameter.</span></span> <span data-ttu-id="31689-199">对于 `MemberInfo` 重载，导出到架构的每个成员的成员信息都会连同第二个参数中的代理项类型，作为 `memberInfo` 参数来发送。</span><span class="sxs-lookup"><span data-stu-id="31689-199">For the `MemberInfo` overload, each member that is exported to schema sends its information as the `memberInfo` parameter with the surrogated type in the second parameter.</span></span>  
  
#### <a name="getcustomdatatoexport-method-type-type"></a><span data-ttu-id="31689-200">GetCustomDataToExport 方法 (Type, Type)</span><span class="sxs-lookup"><span data-stu-id="31689-200">GetCustomDataToExport Method (Type, Type)</span></span>  

 <span data-ttu-id="31689-201">在针对每个类型定义导出架构的过程中，会调用 <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Type%2CSystem.Type%29?displayProperty=nameWithType> 方法。</span><span class="sxs-lookup"><span data-stu-id="31689-201">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Type%2CSystem.Type%29?displayProperty=nameWithType> method is called during schema export for every type definition.</span></span> <span data-ttu-id="31689-202">在导出时，此方法会向架构中的类型添加信息。</span><span class="sxs-lookup"><span data-stu-id="31689-202">The method adds information to the types within the schema when exporting.</span></span> <span data-ttu-id="31689-203">所定义的每个类型都发送到此方法，以便确定是否需要在架构中包括任何额外的数据。</span><span class="sxs-lookup"><span data-stu-id="31689-203">Each type defined is sent to this method to determine whether there is any additional data that needs to be included in the schema.</span></span>  
  
#### <a name="getcustomdatatoexport-method-memberinfo-type"></a><span data-ttu-id="31689-204">GetCustomDataToExport 方法 (MemberInfo, Type)</span><span class="sxs-lookup"><span data-stu-id="31689-204">GetCustomDataToExport Method (MemberInfo, Type)</span></span>  

 <span data-ttu-id="31689-205">在针对已导出类型中的每个成员导出架构的过程中，会调用 <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Reflection.MemberInfo%2CSystem.Type%29?displayProperty=nameWithType>。</span><span class="sxs-lookup"><span data-stu-id="31689-205">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Reflection.MemberInfo%2CSystem.Type%29?displayProperty=nameWithType> is called during export for every member in the types that are exported.</span></span> <span data-ttu-id="31689-206">使用此函数，可以针对在导出时将要包括在架构中的成员自定义任何注释。</span><span class="sxs-lookup"><span data-stu-id="31689-206">This function enables you to customize any comments for the members that will be included in the schema upon export.</span></span> <span data-ttu-id="31689-207">该类中每个成员的信息都发送到此方法，以便检查是否需要在架构中添加任何额外的数据。</span><span class="sxs-lookup"><span data-stu-id="31689-207">The information for every member within the class is sent to this method to check whether any additional data need to be added in the schema.</span></span>  
  
 <span data-ttu-id="31689-208">上面的示例通过每个代理项成员的 `dataContractType` 进行搜索。</span><span class="sxs-lookup"><span data-stu-id="31689-208">The example above searches through the `dataContractType` for each member of the surrogate.</span></span> <span data-ttu-id="31689-209">它返回与每个字段相对应的访问修饰符。</span><span class="sxs-lookup"><span data-stu-id="31689-209">It then returns the appropriate access modifier for each field.</span></span> <span data-ttu-id="31689-210">如果没有该自定义项，则访问修饰符的默认值为 public（公共）。</span><span class="sxs-lookup"><span data-stu-id="31689-210">Without this customization, the default value for access modifiers is public.</span></span> <span data-ttu-id="31689-211">因此，在借助于所导出的架构生成的代码中，所有的成员都将定义为 public（公共），而与它们的实际访问限制无关。</span><span class="sxs-lookup"><span data-stu-id="31689-211">Therefore, all members would be defined as public in the code generated using the exported schema no matter what their actual access restrictions are.</span></span> <span data-ttu-id="31689-212">在未使用该实现时，成员 `numpens` 将在导出的架构中为 public（公共），即使它在代理项中定义为 private（私有）也是如此。</span><span class="sxs-lookup"><span data-stu-id="31689-212">When not using this implementation, the member `numpens` would be public in the exported schema even though it was defined in the surrogate as private.</span></span> <span data-ttu-id="31689-213">通过使用此方法，可以将所导出架构中的访问修饰符生成为 private（私有）。</span><span class="sxs-lookup"><span data-stu-id="31689-213">Through the use of this method, in the exported schema, the access modifier can be generated as private.</span></span>  
  
### <a name="getreferencedtypeonimport-method"></a><span data-ttu-id="31689-214">GetReferencedTypeOnImport 方法</span><span class="sxs-lookup"><span data-stu-id="31689-214">GetReferencedTypeOnImport Method</span></span>  

 <span data-ttu-id="31689-215">此方法将代理项的 <xref:System.Type> 映射到原始类型。</span><span class="sxs-lookup"><span data-stu-id="31689-215">This method maps the <xref:System.Type> of the surrogate to the original type.</span></span> <span data-ttu-id="31689-216">此方法对于架构导入是可选的。</span><span class="sxs-lookup"><span data-stu-id="31689-216">This method is optional for schema importation.</span></span>  
  
 <span data-ttu-id="31689-217">在创建用来导入架构并为其生成代码的代理项时，下一项任务就是将代理项实例的类型定义为其原始类型。</span><span class="sxs-lookup"><span data-stu-id="31689-217">When creating a surrogate that imports a schema and generates code for it, the next task is to define the type of a surrogate instance to its original type.</span></span>  
  
 <span data-ttu-id="31689-218">如果所生成的代码需要引用现有的用户类型，则这可以通过实现 <xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A> 方法来完成。</span><span class="sxs-lookup"><span data-stu-id="31689-218">If the generated code needs to reference an existing user type, this is done by implementing the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A> method.</span></span>  
  
 <span data-ttu-id="31689-219">在导入架构时，会针对每个类型声明都调用此方法，以便将代理项数据协定映射到某个类型。</span><span class="sxs-lookup"><span data-stu-id="31689-219">When importing a schema, this method is called for every type declaration to map the surrogated data contract to a type.</span></span> <span data-ttu-id="31689-220">字符串参数 `typeName` 和 `typeNamespace` 用来定义代理项类型的名称和命名空间。</span><span class="sxs-lookup"><span data-stu-id="31689-220">The string parameters `typeName` and `typeNamespace` define the name and namespace of the surrogated type.</span></span> <span data-ttu-id="31689-221"><xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A> 的返回值用来确定是否需要生成新类型。</span><span class="sxs-lookup"><span data-stu-id="31689-221">The return value for <xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A> is used to determine whether a new type needs to be generated.</span></span> <span data-ttu-id="31689-222">此方法必须返回一个有效类型或 Null。</span><span class="sxs-lookup"><span data-stu-id="31689-222">This method must return either a valid type or null.</span></span> <span data-ttu-id="31689-223">如果返回的是有效类型，所返回的类型将用作在生成的代码中引用的类型。</span><span class="sxs-lookup"><span data-stu-id="31689-223">For valid types, the type returned will be used as a referenced type in the generated code.</span></span> <span data-ttu-id="31689-224">如果返回的是 Null，则将不引用任何类型，而且必须创建一个新类型。</span><span class="sxs-lookup"><span data-stu-id="31689-224">If null is returned, no type will be referenced and a new type must be created.</span></span> <span data-ttu-id="31689-225">如果存在多个代理项，则可以执行映射，使每个代理项类型重新转换为其初始类型。</span><span class="sxs-lookup"><span data-stu-id="31689-225">If several surrogates exist, it is possible to perform the mapping for each surrogate type back to its initial type.</span></span>  
  
 <span data-ttu-id="31689-226">`customData` 参数是最初从 <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A> 返回的对象。</span><span class="sxs-lookup"><span data-stu-id="31689-226">The `customData` parameter is the object originally returned from <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A>.</span></span> <span data-ttu-id="31689-227">当代理项作者希望向导入过程中用来生成代码的元数据中插入额外的数据/提示时，可以使用这个 `customData` 参数。</span><span class="sxs-lookup"><span data-stu-id="31689-227">This `customData` is used when surrogate authors want to insert extra data/hints into the metadata to use during import to generate code.</span></span>  
  
### <a name="processimportedtype-method"></a><span data-ttu-id="31689-228">ProcessImportedType 方法</span><span class="sxs-lookup"><span data-stu-id="31689-228">ProcessImportedType Method</span></span>  

 <span data-ttu-id="31689-229"><xref:System.Runtime.Serialization.IDataContractSurrogate.ProcessImportedType%2A> 方法对架构导入过程中创建的任何类型进行自定义。</span><span class="sxs-lookup"><span data-stu-id="31689-229">The <xref:System.Runtime.Serialization.IDataContractSurrogate.ProcessImportedType%2A> method customizes any type created from schema importation.</span></span> <span data-ttu-id="31689-230">此方法是可选的。</span><span class="sxs-lookup"><span data-stu-id="31689-230">This method is optional.</span></span>  
  
 <span data-ttu-id="31689-231">在导入架构时，此方法允许对所导入的任何类型和编译信息进行自定义。</span><span class="sxs-lookup"><span data-stu-id="31689-231">When importing a schema, this method allows for any imported type and compilation information to be customized.</span></span> <span data-ttu-id="31689-232">例如：</span><span class="sxs-lookup"><span data-stu-id="31689-232">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#7)]  
  
 <span data-ttu-id="31689-233">在导入过程中，会针对所生成的每个类型调用此方法。</span><span class="sxs-lookup"><span data-stu-id="31689-233">During import, this method is called for every type generated.</span></span> <span data-ttu-id="31689-234">更改指定的 <xref:System.CodeDom.CodeTypeDeclaration> 或者修改 <xref:System.CodeDom.CodeCompileUnit>。</span><span class="sxs-lookup"><span data-stu-id="31689-234">Change the specified <xref:System.CodeDom.CodeTypeDeclaration> or modify the <xref:System.CodeDom.CodeCompileUnit>.</span></span> <span data-ttu-id="31689-235">这包括更改 `CodeTypeDeclaration` 的名称、成员、属性 (Attribute) 以及许多其他属性 (Property)。</span><span class="sxs-lookup"><span data-stu-id="31689-235">This includes changing the name, members, attributes, and many other properties of the `CodeTypeDeclaration`.</span></span> <span data-ttu-id="31689-236">通过处理 `CodeCompileUnit`，可以修改指令、命名空间、所引用的程序集以及几个其他方面的内容。</span><span class="sxs-lookup"><span data-stu-id="31689-236">By processing the `CodeCompileUnit`, it is possible to modify the directives, namespaces, referenced assemblies, and several other aspects.</span></span>  
  
 <span data-ttu-id="31689-237">`CodeTypeDeclaration` 参数包含对代码 DOM 类型的声明。</span><span class="sxs-lookup"><span data-stu-id="31689-237">The `CodeTypeDeclaration` parameter contains the code DOM type declaration.</span></span> <span data-ttu-id="31689-238">`CodeCompileUnit` 参数允许为了处理代码而进行修改。</span><span class="sxs-lookup"><span data-stu-id="31689-238">The `CodeCompileUnit` parameter allows for modification for processing the code.</span></span>  <span data-ttu-id="31689-239">如果返回的是 `null`，则将导致丢弃类型声明。</span><span class="sxs-lookup"><span data-stu-id="31689-239">Returning `null` results in the type declaration being discarded.</span></span> <span data-ttu-id="31689-240">相反，如果返回的是 `CodeTypeDeclaration`，则将保留所做的修改。</span><span class="sxs-lookup"><span data-stu-id="31689-240">Conversely, when returning a `CodeTypeDeclaration`, the modifications are preserved.</span></span>  
  
 <span data-ttu-id="31689-241">如果在导出元数据的过程中插入了自定义数据，则需要在导入过程中将自定义数据提供给用户，使其可供用户使用。</span><span class="sxs-lookup"><span data-stu-id="31689-241">If custom data is inserted during metadata export, it needs to be provided to the user during import so that it can be used.</span></span> <span data-ttu-id="31689-242">使用这个自定义数据可以对模型提示或其他注释进行编程。</span><span class="sxs-lookup"><span data-stu-id="31689-242">This custom data can be used for programming model hints, or other comments.</span></span> <span data-ttu-id="31689-243">每个 `CodeTypeDeclaration` 和 <xref:System.CodeDom.CodeTypeMember> 实例都包括 <xref:System.CodeDom.CodeObject.UserData%2A> 属性形式的自定义数据，以及到 `IDataContractSurrogate` 类型的强制转换。</span><span class="sxs-lookup"><span data-stu-id="31689-243">Each `CodeTypeDeclaration` and <xref:System.CodeDom.CodeTypeMember> instance includes custom data as the <xref:System.CodeDom.CodeObject.UserData%2A> property, cast to the `IDataContractSurrogate` type.</span></span>  
  
 <span data-ttu-id="31689-244">上面的示例针对导入的架构执行了一些更改。</span><span class="sxs-lookup"><span data-stu-id="31689-244">The example above performs some changes on the schema imported.</span></span> <span data-ttu-id="31689-245">该代码通过使用一个代理项保留了原始类型的私有成员。</span><span class="sxs-lookup"><span data-stu-id="31689-245">The code preserves private members of the original type by using a surrogate.</span></span> <span data-ttu-id="31689-246">在导入架构时，默认的访问修饰符为 `public`。</span><span class="sxs-lookup"><span data-stu-id="31689-246">The default access modifier when importing a schema is `public`.</span></span> <span data-ttu-id="31689-247">因此，除非进行过修改，否则该代理项架构的所有成员都将是公共成员，如上面的示例中所示。</span><span class="sxs-lookup"><span data-stu-id="31689-247">Therefore, all members of the surrogate schema will be public unless modified, as in this example.</span></span> <span data-ttu-id="31689-248">在导出过程中，会在元数据中插入有关哪些成员是私有成员的自定义数据。</span><span class="sxs-lookup"><span data-stu-id="31689-248">During export, custom data is inserted into the metadata about which members are private.</span></span> <span data-ttu-id="31689-249">上面的示例查找自定义数据，检查访问修饰符是否为 private（私有），然后通过设置属性将相应的成员修改为 private（私有）。</span><span class="sxs-lookup"><span data-stu-id="31689-249">The example looks up the custom data, checks whether the access modifier is private, and then modifies the appropriate member to be private by setting its attributes.</span></span> <span data-ttu-id="31689-250">如果没有这个自定义项，`numpens` 成员将定义为 public（公共），而不是 private（私有）。</span><span class="sxs-lookup"><span data-stu-id="31689-250">Without this customization, the `numpens` member would be defined as public instead of private.</span></span>  
  
### <a name="getknowncustomdatatypes-method"></a><span data-ttu-id="31689-251">GetKnownCustomDataTypes 方法</span><span class="sxs-lookup"><span data-stu-id="31689-251">GetKnownCustomDataTypes Method</span></span>  

 <span data-ttu-id="31689-252">此方法从架构中获取定义的自定义数据类型。</span><span class="sxs-lookup"><span data-stu-id="31689-252">This method obtains custom data types defined from the schema.</span></span> <span data-ttu-id="31689-253">此方法对于架构导入是可选的。</span><span class="sxs-lookup"><span data-stu-id="31689-253">The method is optional for schema importation.</span></span>  
  
 <span data-ttu-id="31689-254">此方法是在开始导出和导入架构时调用的。</span><span class="sxs-lookup"><span data-stu-id="31689-254">The method is called at the beginning of schema export and import.</span></span> <span data-ttu-id="31689-255">此方法返回用在导出/导入架构中的自定义数据类型。</span><span class="sxs-lookup"><span data-stu-id="31689-255">The method returns the custom data types used in the schema exported or imported.</span></span> <span data-ttu-id="31689-256">系统会向此方法传递一个 <xref:System.Collections.ObjectModel.Collection%601>（`customDataTypes` 参数），该参数是一个类型集合。</span><span class="sxs-lookup"><span data-stu-id="31689-256">The method is passed a <xref:System.Collections.ObjectModel.Collection%601> (the `customDataTypes` parameter), which is a collection of types.</span></span> <span data-ttu-id="31689-257">此方法应当向该集合中添加其他已知类型。</span><span class="sxs-lookup"><span data-stu-id="31689-257">The method should add additional known types to this collection.</span></span> <span data-ttu-id="31689-258">已知的自定义数据类型是借助于 <xref:System.Runtime.Serialization.DataContractSerializer> 来启用对自定义数据的序列化和反序列化所必需的。</span><span class="sxs-lookup"><span data-stu-id="31689-258">The known custom data types are needed to enable serialization and deserialization of custom data using the <xref:System.Runtime.Serialization.DataContractSerializer>.</span></span> <span data-ttu-id="31689-259">有关详细信息，请参阅 [数据协定已知类型](../feature-details/data-contract-known-types.md)。</span><span class="sxs-lookup"><span data-stu-id="31689-259">For more information, see [Data Contract Known Types](../feature-details/data-contract-known-types.md).</span></span>  
  
## <a name="implementing-a-surrogate"></a><span data-ttu-id="31689-260">实现代理项</span><span class="sxs-lookup"><span data-stu-id="31689-260">Implementing a Surrogate</span></span>  

 <span data-ttu-id="31689-261">若要在 WCF 中使用数据协定代理项，必须执行一些特殊的过程。</span><span class="sxs-lookup"><span data-stu-id="31689-261">To use the data contract surrogate within WCF, you must follow a few special procedures.</span></span>  
  
### <a name="to-use-a-surrogate-for-serialization-and-deserialization"></a><span data-ttu-id="31689-262">使用代理项进行序列化和反序列化</span><span class="sxs-lookup"><span data-stu-id="31689-262">To Use a Surrogate for Serialization and Deserialization</span></span>  

 <span data-ttu-id="31689-263">使用 <xref:System.Runtime.Serialization.DataContractSerializer> 可以通过代理项对数据执行序列化和反序列化。</span><span class="sxs-lookup"><span data-stu-id="31689-263">Use the <xref:System.Runtime.Serialization.DataContractSerializer> to perform serialization and deserialization of data with the surrogate.</span></span> <span data-ttu-id="31689-264"><xref:System.Runtime.Serialization.DataContractSerializer> 是由 <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> 创建的。</span><span class="sxs-lookup"><span data-stu-id="31689-264">The <xref:System.Runtime.Serialization.DataContractSerializer> is created by the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior>.</span></span> <span data-ttu-id="31689-265">还必须指定代理项。</span><span class="sxs-lookup"><span data-stu-id="31689-265">The surrogate must also be specified.</span></span>  
  
##### <a name="to-implement-serialization-and-deserialization"></a><span data-ttu-id="31689-266">实现序列化和反序列化</span><span class="sxs-lookup"><span data-stu-id="31689-266">To implement serialization and deserialization</span></span>  
  
1. <span data-ttu-id="31689-267">为您的服务创建一个 <xref:System.ServiceModel.ServiceHost> 实例。</span><span class="sxs-lookup"><span data-stu-id="31689-267">Create an instance of the <xref:System.ServiceModel.ServiceHost> for your service.</span></span> <span data-ttu-id="31689-268">有关完整说明，请参阅 [基本 WCF 编程](../basic-wcf-programming.md)。</span><span class="sxs-lookup"><span data-stu-id="31689-268">For complete instructions, see [Basic WCF Programming](../basic-wcf-programming.md).</span></span>  
  
2. <span data-ttu-id="31689-269">对于指定服务主机的每个 <xref:System.ServiceModel.Description.ServiceEndpoint>，查找它的 <xref:System.ServiceModel.Description.OperationDescription>。</span><span class="sxs-lookup"><span data-stu-id="31689-269">For every <xref:System.ServiceModel.Description.ServiceEndpoint> of the specified service host, find its <xref:System.ServiceModel.Description.OperationDescription>.</span></span>  
  
3. <span data-ttu-id="31689-270">通过操作行为进行搜索，确定是否找到了 <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> 的实例。</span><span class="sxs-lookup"><span data-stu-id="31689-270">Search through the operation behaviors to determine if an instance of the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> is found.</span></span>  
  
4. <span data-ttu-id="31689-271">如果找到了一个 <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior>，请将它的 <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> 属性设置为该代理项的新实例。</span><span class="sxs-lookup"><span data-stu-id="31689-271">If a <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> is found, set its <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> property to a new instance of the surrogate.</span></span> <span data-ttu-id="31689-272">如果没有找到 <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior>，请创建一个新实例，并将新行为的 <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> 成员设置为该代理项的新实例。</span><span class="sxs-lookup"><span data-stu-id="31689-272">If no <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> is found, then create a new instance and set the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> member of the new behavior to a new instance of the surrogate.</span></span>  
  
5. <span data-ttu-id="31689-273">最后，将这个新行为添加到当前的操作行为中，如下面的示例中所示：</span><span class="sxs-lookup"><span data-stu-id="31689-273">Finally, add this new behavior to the current operation behaviors, as shown in the following example:</span></span>  
  
     [!code-csharp[C_IDataContractSurrogate#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#8)]  
  
### <a name="to-use-a-surrogate-for-metadata-import"></a><span data-ttu-id="31689-274">使用代理项来导入元数据</span><span class="sxs-lookup"><span data-stu-id="31689-274">To Use a Surrogate for Metadata Import</span></span>  

 <span data-ttu-id="31689-275">在导入元数据（如 WSDL 和 XSD）以生成客户端代码时，需要将该代理项添加到负责从 XSD 架构生成代码的组件 <xref:System.Runtime.Serialization.XsdDataContractImporter> 中。</span><span class="sxs-lookup"><span data-stu-id="31689-275">When importing metadata like WSDL and XSD to generate client-side code, the surrogate needs to be added to the component responsible for generating code from XSD schema, <xref:System.Runtime.Serialization.XsdDataContractImporter>.</span></span> <span data-ttu-id="31689-276">为此，请直接修改用来导入元数据的 <xref:System.ServiceModel.Description.WsdlImporter>。</span><span class="sxs-lookup"><span data-stu-id="31689-276">To do this, directly modify the <xref:System.ServiceModel.Description.WsdlImporter> used to import metadata.</span></span>  
  
##### <a name="to-implement-a-surrogate-for-metadata-importation"></a><span data-ttu-id="31689-277">实现用来导入元数据的代理项</span><span class="sxs-lookup"><span data-stu-id="31689-277">To implement a surrogate for metadata importation</span></span>  
  
1. <span data-ttu-id="31689-278">使用 <xref:System.ServiceModel.Description.WsdlImporter> 类导入元数据。</span><span class="sxs-lookup"><span data-stu-id="31689-278">Import the metadata using the <xref:System.ServiceModel.Description.WsdlImporter> class.</span></span>  
  
2. <span data-ttu-id="31689-279">使用 <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> 方法检查是否已经定义了 <xref:System.Runtime.Serialization.XsdDataContractImporter>。</span><span class="sxs-lookup"><span data-stu-id="31689-279">Use the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method to check whether an <xref:System.Runtime.Serialization.XsdDataContractImporter> has been defined.</span></span>  
  
3. <span data-ttu-id="31689-280">如果 <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> 方法返回 `false`，请创建一个新的 <xref:System.Runtime.Serialization.XsdDataContractImporter> 并将它的 <xref:System.Runtime.Serialization.XsdDataContractImporter.Options%2A> 属性设置为 <xref:System.Runtime.Serialization.ImportOptions> 类的新实例。</span><span class="sxs-lookup"><span data-stu-id="31689-280">If the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method returns `false`, create a new <xref:System.Runtime.Serialization.XsdDataContractImporter> and set its <xref:System.Runtime.Serialization.XsdDataContractImporter.Options%2A> property to a new instance of the <xref:System.Runtime.Serialization.ImportOptions> class.</span></span> <span data-ttu-id="31689-281">否则，请使用由 `out` 方法的 <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> 参数所返回的导入程序。</span><span class="sxs-lookup"><span data-stu-id="31689-281">Otherwise, use the importer returned by the `out` parameter of the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method.</span></span>  
  
4. <span data-ttu-id="31689-282">如果没有为 <xref:System.Runtime.Serialization.XsdDataContractImporter> 定义 <xref:System.Runtime.Serialization.ImportOptions>，请将该属性设置为 <xref:System.Runtime.Serialization.ImportOptions> 类的新实例。</span><span class="sxs-lookup"><span data-stu-id="31689-282">If the <xref:System.Runtime.Serialization.XsdDataContractImporter> has no <xref:System.Runtime.Serialization.ImportOptions> defined, then set the property to be a new instance of the <xref:System.Runtime.Serialization.ImportOptions> class.</span></span>  
  
5. <span data-ttu-id="31689-283">对于 <xref:System.Runtime.Serialization.ImportOptions.DataContractSurrogate%2A> 的 <xref:System.Runtime.Serialization.ImportOptions>，请将 <xref:System.Runtime.Serialization.XsdDataContractImporter> 属性设置为该代理项的新实例。</span><span class="sxs-lookup"><span data-stu-id="31689-283">Set the <xref:System.Runtime.Serialization.ImportOptions.DataContractSurrogate%2A> property of the <xref:System.Runtime.Serialization.ImportOptions> of the <xref:System.Runtime.Serialization.XsdDataContractImporter> to a new instance of the surrogate.</span></span>  
  
6. <span data-ttu-id="31689-284">将 <xref:System.Runtime.Serialization.XsdDataContractImporter> 添加到由 <xref:System.ServiceModel.Description.MetadataExporter.State%2A>（继承自 <xref:System.ServiceModel.Description.WsdlImporter> 类）的 <xref:System.ServiceModel.Description.MetadataExporter> 属性返回的集合中。</span><span class="sxs-lookup"><span data-stu-id="31689-284">Add the <xref:System.Runtime.Serialization.XsdDataContractImporter> to the collection returned by the <xref:System.ServiceModel.Description.MetadataExporter.State%2A> property of the <xref:System.ServiceModel.Description.WsdlImporter> (inherited from the <xref:System.ServiceModel.Description.MetadataExporter> class.)</span></span>  
  
7. <span data-ttu-id="31689-285">使用 <xref:System.ServiceModel.Description.WsdlImporter.ImportAllContracts%2A> 的 <xref:System.ServiceModel.Description.WsdlImporter> 方法导入架构中所有的数据协定。</span><span class="sxs-lookup"><span data-stu-id="31689-285">Use the <xref:System.ServiceModel.Description.WsdlImporter.ImportAllContracts%2A> method of the <xref:System.ServiceModel.Description.WsdlImporter> to import all of the data contracts within the schema.</span></span> <span data-ttu-id="31689-286">在最后一步中，将从通过调用该代理项而加载的架构中生成代码。</span><span class="sxs-lookup"><span data-stu-id="31689-286">During the last step, code is generated from the schemas loaded by calling into the surrogate.</span></span>  
  
     [!code-csharp[C_IDataContractSurrogate#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#9)]  
  
### <a name="to-use-a-surrogate-for-metadata-export"></a><span data-ttu-id="31689-287">使用代理项来导出元数据</span><span class="sxs-lookup"><span data-stu-id="31689-287">To Use a surrogate for Metadata Export</span></span>  

 <span data-ttu-id="31689-288">默认情况下，当从服务的 WCF 中导出元数据时，需要生成 WSDL 和 XSD 架构。</span><span class="sxs-lookup"><span data-stu-id="31689-288">By default, when exporting metadata from WCF for a service, both WSDL and XSD schema needs to be generated.</span></span> <span data-ttu-id="31689-289">该代理项需要添加到负责为数据协定类型生成 XSD 架构的组件 <xref:System.Runtime.Serialization.XsdDataContractExporter> 中。</span><span class="sxs-lookup"><span data-stu-id="31689-289">The surrogate needs to be added to the component responsible for generating XSD schema for data contract types, <xref:System.Runtime.Serialization.XsdDataContractExporter>.</span></span> <span data-ttu-id="31689-290">为此，要么使用可实现 <xref:System.ServiceModel.Description.IWsdlExportExtension> 的行为来修改 <xref:System.ServiceModel.Description.WsdlExporter>，要么直接修改用来导出元数据的 <xref:System.ServiceModel.Description.WsdlExporter>。</span><span class="sxs-lookup"><span data-stu-id="31689-290">To do this, either use a behavior that implements <xref:System.ServiceModel.Description.IWsdlExportExtension> to modify the <xref:System.ServiceModel.Description.WsdlExporter>, or directly modify the <xref:System.ServiceModel.Description.WsdlExporter> used to export metadata.</span></span>  
  
##### <a name="to-use-a-surrogate-for-metadata-export"></a><span data-ttu-id="31689-291">使用代理项来导出元数据</span><span class="sxs-lookup"><span data-stu-id="31689-291">To use a surrogate for metadata export</span></span>  
  
1. <span data-ttu-id="31689-292">创建一个新的 <xref:System.ServiceModel.Description.WsdlExporter>，或者使用传递到 `wsdlExporter` 方法的 <xref:System.ServiceModel.Description.IWsdlExportExtension.ExportContract%2A> 参数。</span><span class="sxs-lookup"><span data-stu-id="31689-292">Create a new <xref:System.ServiceModel.Description.WsdlExporter> or use the `wsdlExporter` parameter passed to the <xref:System.ServiceModel.Description.IWsdlExportExtension.ExportContract%2A> method.</span></span>  
  
2. <span data-ttu-id="31689-293">使用 <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> 函数来检查是否已经定义了 <xref:System.Runtime.Serialization.XsdDataContractExporter>。</span><span class="sxs-lookup"><span data-stu-id="31689-293">Use the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> function to check whether an <xref:System.Runtime.Serialization.XsdDataContractExporter> has been defined.</span></span>  
  
3. <span data-ttu-id="31689-294">如果 <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> 返回 `false`，请使用从 <xref:System.Runtime.Serialization.XsdDataContractExporter> 生成的 XML 架构创建一个新的 <xref:System.ServiceModel.Description.WsdlExporter>，并将它添加到由 <xref:System.ServiceModel.Description.MetadataExporter.State%2A> 的 <xref:System.ServiceModel.Description.WsdlExporter> 属性返回的集合中。</span><span class="sxs-lookup"><span data-stu-id="31689-294">If <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> returns `false`, create a new <xref:System.Runtime.Serialization.XsdDataContractExporter> with the generated XML schemas from the <xref:System.ServiceModel.Description.WsdlExporter>, and add it to the collection returned by the <xref:System.ServiceModel.Description.MetadataExporter.State%2A> property of the <xref:System.ServiceModel.Description.WsdlExporter>.</span></span> <span data-ttu-id="31689-295">否则，请使用由 `out` 方法的 <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> 参数返回的导出程序。</span><span class="sxs-lookup"><span data-stu-id="31689-295">Otherwise, use the exporter returned by the `out` parameter of the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method.</span></span>  
  
4. <span data-ttu-id="31689-296">如果没有为 <xref:System.Runtime.Serialization.XsdDataContractExporter> 定义 <xref:System.Runtime.Serialization.ExportOptions>，请将 <xref:System.Runtime.Serialization.XsdDataContractExporter.Options%2A> 属性设置为 <xref:System.Runtime.Serialization.ExportOptions> 类的新实例。</span><span class="sxs-lookup"><span data-stu-id="31689-296">If the <xref:System.Runtime.Serialization.XsdDataContractExporter> has no <xref:System.Runtime.Serialization.ExportOptions> defined, then set the <xref:System.Runtime.Serialization.XsdDataContractExporter.Options%2A> property to a new instance of the <xref:System.Runtime.Serialization.ExportOptions> class.</span></span>  
  
5. <span data-ttu-id="31689-297">对于 <xref:System.Runtime.Serialization.ExportOptions.DataContractSurrogate%2A> 的 <xref:System.Runtime.Serialization.ExportOptions>，请将 <xref:System.Runtime.Serialization.XsdDataContractExporter> 属性设置为该代理项的新实例。</span><span class="sxs-lookup"><span data-stu-id="31689-297">Set the <xref:System.Runtime.Serialization.ExportOptions.DataContractSurrogate%2A> property of the <xref:System.Runtime.Serialization.ExportOptions> of the <xref:System.Runtime.Serialization.XsdDataContractExporter> to a new instance of the surrogate.</span></span> <span data-ttu-id="31689-298">在以后的元数据导出步骤中，将不需要进行任何更改。</span><span class="sxs-lookup"><span data-stu-id="31689-298">Subsequent steps for exporting metadata do not require any changes.</span></span>  
  
     [!code-csharp[C_IDataContractSurrogate#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#10)]  
  
## <a name="see-also"></a><span data-ttu-id="31689-299">请参阅</span><span class="sxs-lookup"><span data-stu-id="31689-299">See also</span></span>

- <xref:System.Runtime.Serialization.DataContractSerializer>
- <xref:System.Runtime.Serialization.IDataContractSurrogate>
- <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior>
- <xref:System.Runtime.Serialization.ImportOptions>
- <xref:System.Runtime.Serialization.ExportOptions>
- [<span data-ttu-id="31689-300">使用数据协定</span><span class="sxs-lookup"><span data-stu-id="31689-300">Using Data Contracts</span></span>](../feature-details/using-data-contracts.md)
