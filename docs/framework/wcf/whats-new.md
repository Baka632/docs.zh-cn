---
title: Windows Communication Foundation 4.5 中的新增功能
description: 本文介绍 Windows Communication Foundation (WCF) 版本4.5 的新增功能，并提供指向其他资源的链接。
ms.date: 03/30/2017
helpviewer_keywords:
- WCF [WCF], what's new
- Windows Communication Foundation [WCF], what's new
ms.assetid: 7e93fe73-af93-46b5-9f63-32f761ee40cf
ms.openlocfilehash: 76b52cedd1e2e64805e2ad47e582d07ca70415cc
ms.sourcegitcommit: d8020797a6657d0fbbdff362b80300815f682f94
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/24/2020
ms.locfileid: "95731548"
---
# <a name="whats-new-in-windows-communication-foundation-45"></a><span data-ttu-id="b7eca-103">Windows Communication Foundation 4.5 中的新增功能</span><span class="sxs-lookup"><span data-stu-id="b7eca-103">What's New in Windows Communication Foundation 4.5</span></span>

<span data-ttu-id="b7eca-104">本主题讨论 Windows Communication Foundation (WCF) 版本4.5 的新增功能。</span><span class="sxs-lookup"><span data-stu-id="b7eca-104">This topic discusses features new to Windows Communication Foundation (WCF) version 4.5.</span></span>

## <a name="wcf-simplification-features"></a><span data-ttu-id="b7eca-105">WCF 简化功能</span><span class="sxs-lookup"><span data-stu-id="b7eca-105">WCF Simplification Features</span></span>

<span data-ttu-id="b7eca-106">人们已进行了大量工作，以便更加方便地开发和维护 WCF 4.5 应用程序。</span><span class="sxs-lookup"><span data-stu-id="b7eca-106">Much work has been done to make WCF 4.5 applications easier to develop and maintain.</span></span> <span data-ttu-id="b7eca-107">有关详细信息，请参阅 [WCF 简化功能](wcf-simplification-features.md)。</span><span class="sxs-lookup"><span data-stu-id="b7eca-107">For more information, see [WCF Simplification Features](wcf-simplification-features.md).</span></span>

### <a name="task-based-async-support"></a><span data-ttu-id="b7eca-108">基于任务的异步支持</span><span class="sxs-lookup"><span data-stu-id="b7eca-108">Task-based Async Support</span></span>

<span data-ttu-id="b7eca-109">默认情况下，“添加服务应用”会生成返回任务的异步服务操作方法。</span><span class="sxs-lookup"><span data-stu-id="b7eca-109">By default, Add Service Reference generates Task-returning async service operation methods.</span></span> <span data-ttu-id="b7eca-110">此操作是针对同步和异步方法执行的。</span><span class="sxs-lookup"><span data-stu-id="b7eca-110">This is done for both synchronous and asynchronous methods.</span></span> <span data-ttu-id="b7eca-111">通过此操作，你可以使用新的基于任务的异步编程模型来异步调用服务操作。</span><span class="sxs-lookup"><span data-stu-id="b7eca-111">This allows you to call the service operations asynchronously using the new Task based async programming model.</span></span> <span data-ttu-id="b7eca-112">在你调用生成的代理方法时，WCF 会构造一个 Task 对象以表示异步操作并返回该任务。</span><span class="sxs-lookup"><span data-stu-id="b7eca-112">When you call the generated proxy method, WCF constructs a Task object to represent the asynchronous operation and returns that Task to you.</span></span> <span data-ttu-id="b7eca-113">该任务在操作完成时完成。</span><span class="sxs-lookup"><span data-stu-id="b7eca-113">The Task completes when the operation completes.</span></span> <span data-ttu-id="b7eca-114">实现异步操作时，可以将其实现为基于任务的异步操作。</span><span class="sxs-lookup"><span data-stu-id="b7eca-114">When implementing an async operation you can implement it as a task-based async operation.</span></span> <span data-ttu-id="b7eca-115">有关详细信息，请参阅 [同步和异步操作](synchronous-and-asynchronous-operations.md)。</span><span class="sxs-lookup"><span data-stu-id="b7eca-115">For more information see, [Synchronous and Asynchronous Operations](synchronous-and-asynchronous-operations.md).</span></span>

### <a name="simplified-generated-configuration-files"></a><span data-ttu-id="b7eca-116">简化了生成的配置文件</span><span class="sxs-lookup"><span data-stu-id="b7eca-116">Simplified Generated Configuration Files</span></span>

<span data-ttu-id="b7eca-117">当您在 Visual Studio 中添加服务引用或使用 SvcUtil.exe工具时，将会生成一个客户端配置文件。</span><span class="sxs-lookup"><span data-stu-id="b7eca-117">When you add a service reference in Visual Studio or use the SvcUtil.exe tool, a client configuration file is generated.</span></span> <span data-ttu-id="b7eca-118">在以前版本的 WCF 中，这些配置文件包含每个绑定属性的值，即使该值是默认值。</span><span class="sxs-lookup"><span data-stu-id="b7eca-118">In previous versions of WCF these configuration files contained the value of every binding property even if its value is the default value.</span></span> <span data-ttu-id="b7eca-119">在 WCF 4.5 中，生成的配置文件仅包含那些设置为非默认值的绑定属性。</span><span class="sxs-lookup"><span data-stu-id="b7eca-119">In WCF 4.5 the generated configuration files contain only those binding properties that are set to a non-default value.</span></span>

<span data-ttu-id="b7eca-120">有关详细信息，请参阅 [WCF 简化功能](wcf-simplification-features.md)。</span><span class="sxs-lookup"><span data-stu-id="b7eca-120">For more information, see [WCF Simplification Features](wcf-simplification-features.md).</span></span>

### <a name="contract-first-development"></a><span data-ttu-id="b7eca-121">协定优先开发</span><span class="sxs-lookup"><span data-stu-id="b7eca-121">Contract-First Development</span></span>

<span data-ttu-id="b7eca-122">WCF 现在支持协定优先开发。</span><span class="sxs-lookup"><span data-stu-id="b7eca-122">WCF now has support for contract-first development.</span></span> <span data-ttu-id="b7eca-123">svcutil.exe 提供了/serviceContract 开关，使你可以从 WSDL 文档生成服务和数据协定。</span><span class="sxs-lookup"><span data-stu-id="b7eca-123">The svcutil.exe has a /serviceContract switch which allows you to generate service and data contracts from a WSDL document.</span></span>

### <a name="add-service-reference-from-a-portable-subset-project"></a><span data-ttu-id="b7eca-124">从可移植子集项目添加服务引用</span><span class="sxs-lookup"><span data-stu-id="b7eca-124">Add Service Reference from a Portable Subset Project</span></span>

<span data-ttu-id="b7eca-125">可移植子集项目使 .NET 程序集编程人员能够维护单个源树和生成系统，同时仍支持 (桌面、Silverlight、Windows Phone 和 Xbox) 的多个 .NET 平台。</span><span class="sxs-lookup"><span data-stu-id="b7eca-125">Portable subset projects enable .NET assembly programmers to maintain a single source tree and build system while still supporting multiple .NET platforms (desktop, Silverlight, Windows Phone, and Xbox).</span></span> <span data-ttu-id="b7eca-126">可移植子集项目仅引用可以在任何 .NET 平台上使用的程序集的 .NET 可移植库。</span><span class="sxs-lookup"><span data-stu-id="b7eca-126">Portable subset projects only reference .NET portable libraries that are assemblies that can be used on any .NET platform.</span></span> <span data-ttu-id="b7eca-127">开发人员的体验与添加任何其他 WCF 客户端应用程序内的服务引用相同。</span><span class="sxs-lookup"><span data-stu-id="b7eca-127">The developer experience is the same as adding a service reference within any other WCF client application.</span></span> <span data-ttu-id="b7eca-128">有关详细信息，请参阅 [可移植子集项目中的添加服务引用](add-service-reference-in-a-portable-subset-project.md)。</span><span class="sxs-lookup"><span data-stu-id="b7eca-128">For more information, see [Add Service Reference in a Portable Subset Project](add-service-reference-in-a-portable-subset-project.md).</span></span>

### <a name="aspnet-compatibility-mode-default-changed"></a><span data-ttu-id="b7eca-129">ASP.NET 兼容模式默认值已更改</span><span class="sxs-lookup"><span data-stu-id="b7eca-129">ASP.NET Compatibility Mode Default Changed</span></span>

<span data-ttu-id="b7eca-130">WCF 提供了 ASP.NET 兼容模式，以向开发人员授予编写 WCF 服务时对 ASP.NET HTTP 管道中的功能的完全访问权限。</span><span class="sxs-lookup"><span data-stu-id="b7eca-130">WCF provides ASP.NET compatibility mode to grant developers full access to the features in the ASP.NET HTTP pipeline when writing WCF services.</span></span> <span data-ttu-id="b7eca-131">若要使用此模式，你必须 `aspNetCompatibilityEnabled` 在 web.config 的节中将属性设置为 true [\<serviceHostingEnvironment>](../configure-apps/file-schema/wcf/servicehostingenvironment.md) 。此外，此 appDomain 中的任何服务都需要 `RequirementsMode` 将其上的 <xref:System.ServiceModel.Activation.AspNetCompatibilityRequirementsAttribute> 属性设置为 <xref:System.ServiceModel.Activation.AspNetCompatibilityRequirementsMode.Allowed> 或 <xref:System.ServiceModel.Activation.AspNetCompatibilityRequirementsMode.Required> 。</span><span class="sxs-lookup"><span data-stu-id="b7eca-131">To use this mode, you must set the `aspNetCompatibilityEnabled` attribute to true in the [\<serviceHostingEnvironment>](../configure-apps/file-schema/wcf/servicehostingenvironment.md) section of web.config. Additionally, any service in this appDomain needs to have the `RequirementsMode` property on its <xref:System.ServiceModel.Activation.AspNetCompatibilityRequirementsAttribute> set to <xref:System.ServiceModel.Activation.AspNetCompatibilityRequirementsMode.Allowed> or <xref:System.ServiceModel.Activation.AspNetCompatibilityRequirementsMode.Required>.</span></span> <span data-ttu-id="b7eca-132">默认情况下， <xref:System.ServiceModel.Activation.AspNetCompatibilityRequirementsAttribute> 设置为 <xref:System.ServiceModel.Activation.AspNetCompatibilityRequirementsMode.Allowed> 。</span><span class="sxs-lookup"><span data-stu-id="b7eca-132">By default <xref:System.ServiceModel.Activation.AspNetCompatibilityRequirementsAttribute> is now set to <xref:System.ServiceModel.Activation.AspNetCompatibilityRequirementsMode.Allowed>.</span></span> <span data-ttu-id="b7eca-133">有关详细信息，请参阅 [WCF 服务和 ASP.NET](./feature-details/wcf-services-and-aspnet.md)。</span><span class="sxs-lookup"><span data-stu-id="b7eca-133">For more information, see [WCF Services and ASP.NET](./feature-details/wcf-services-and-aspnet.md).</span></span>

### <a name="new-transport-default-values"></a><span data-ttu-id="b7eca-134">新传输默认值</span><span class="sxs-lookup"><span data-stu-id="b7eca-134">New Transport Default Values</span></span>

<span data-ttu-id="b7eca-135">为了简化配置，更改了多个传输属性默认值。</span><span class="sxs-lookup"><span data-stu-id="b7eca-135">In order to simplify configuration a number of transport property default values have changed.</span></span> <span data-ttu-id="b7eca-136">有关详细信息，请参阅 [WCF 简化功能](wcf-simplification-features.md)。</span><span class="sxs-lookup"><span data-stu-id="b7eca-136">For more information, see [WCF Simplification Features](wcf-simplification-features.md).</span></span>

### <a name="xmldictionaryreaderquotas"></a><span data-ttu-id="b7eca-137">XmlDictionaryReaderQuotas</span><span class="sxs-lookup"><span data-stu-id="b7eca-137">XmlDictionaryReaderQuotas</span></span>

<span data-ttu-id="b7eca-138"><xref:System.Xml.XmlDictionaryReaderQuotas> 包含用于 XML 字典读取器的可配置配额值，这些配额值会限制创建消息时由编码器使用的内存量。</span><span class="sxs-lookup"><span data-stu-id="b7eca-138"><xref:System.Xml.XmlDictionaryReaderQuotas> contains configurable quota values for XML dictionary readers which limit the amount of memory utilized by an encoder while creating a message.</span></span> <span data-ttu-id="b7eca-139">虽然这些配额是可配置的，但默认值已更改，以减小开发人员必须显式设置这些默认值的可能性。</span><span class="sxs-lookup"><span data-stu-id="b7eca-139">While these quotas are configurable, the default values have changed to lessen the possibility that a developer will have to set them explicitly.</span></span> <span data-ttu-id="b7eca-140">有关详细信息，请参阅 [WCF 简化功能](wcf-simplification-features.md)。</span><span class="sxs-lookup"><span data-stu-id="b7eca-140">For more information, see [WCF Simplification Features](wcf-simplification-features.md).</span></span>

### <a name="wcf-configuration-validation"></a><span data-ttu-id="b7eca-141">WCF 配置验证</span><span class="sxs-lookup"><span data-stu-id="b7eca-141">WCF Configuration Validation</span></span>

<span data-ttu-id="b7eca-142">作为 Visual Studio 中生成过程的一部分，现在将针对项目中定义的特性来验证 WCF 配置文件。</span><span class="sxs-lookup"><span data-stu-id="b7eca-142">As part of the build process within Visual Studio, WCF configuration files are now validated for attributes defined within the project.</span></span> <span data-ttu-id="b7eca-143">如果验证失败，则将在 Visual Studio 中显示验证错误或警告的列表。</span><span class="sxs-lookup"><span data-stu-id="b7eca-143">A list of validation errors or warnings is displayed in Visual Studio if the validation fails.</span></span>

### <a name="xml-editor-tooltips"></a><span data-ttu-id="b7eca-144">XML 编辑器工具提示</span><span class="sxs-lookup"><span data-stu-id="b7eca-144">XML Editor Tooltips</span></span>

<span data-ttu-id="b7eca-145">为了帮助新的和现有 WCF 服务开发人员配置服务，Visual Studio XML 编辑器现在为属于服务配置文件的每个配置元素及其属性提供了工具提示。</span><span class="sxs-lookup"><span data-stu-id="b7eca-145">In order to help new and existing WCF service developers to configure their services, the Visual Studio XML editor now provides tooltips for every configuration element and its properties that is part of the service configuration file.</span></span>

## <a name="streaming-improvements"></a><span data-ttu-id="b7eca-146">流改进</span><span class="sxs-lookup"><span data-stu-id="b7eca-146">Streaming Improvements</span></span>

<span data-ttu-id="b7eca-147">添加了对真实异步流的支持，在这种流中，如果接收方没有读取或者读取速度较慢，则发送方现在不会阻止线程，从而提高了可伸缩性。</span><span class="sxs-lookup"><span data-stu-id="b7eca-147">Added support for true asynchronous streaming where the send side now does not block threads if the receive side is not reading or slow in reading thereby increasing scalability.</span></span> <span data-ttu-id="b7eca-148">消除了客户端向 IIS 承载的 WCF 服务发送流消息时对消息缓冲的限制。</span><span class="sxs-lookup"><span data-stu-id="b7eca-148">Removed the limitation of message buffering when a client sends a streamed message to an IIS hosted WCF service.</span></span> <span data-ttu-id="b7eca-149">有关详细信息，请参阅 [WCF 简化功能](wcf-simplification-features.md)。</span><span class="sxs-lookup"><span data-stu-id="b7eca-149">For more information, see [WCF Simplification Features](wcf-simplification-features.md).</span></span>

## <a name="simplifying-exposing-an-endpoint-over-https-with-iis"></a><span data-ttu-id="b7eca-150">简化通过 HTTPS 与 IIS 公开终结点</span><span class="sxs-lookup"><span data-stu-id="b7eca-150">Simplifying Exposing an Endpoint Over HTTPS with IIS</span></span>

<span data-ttu-id="b7eca-151">为了简化通过 HTTPS 来公开终结点，添加了一个 HTTPS 协议映射。</span><span class="sxs-lookup"><span data-stu-id="b7eca-151">An HTTPS protocol mapping has been added to simplify exposing an endpoint over HTTPS.</span></span> <span data-ttu-id="b7eca-152">若要启用 HTTPS 终结点，请确保你的网站已配置 HTTPS 绑定和 SSL 证书，然后，只需为承载该服务的虚拟目录启用 HTTPS。</span><span class="sxs-lookup"><span data-stu-id="b7eca-152">To enable an HTTPS endpoint, ensure your website has an HTTPS binding and SSL certificate configured, and then simply enable HTTPS for the virtual directory that hosts the service.</span></span> <span data-ttu-id="b7eca-153">如果为服务启用了元数据，则也会通过 HTTPS 公开该元数据。</span><span class="sxs-lookup"><span data-stu-id="b7eca-153">If metadata is enabled for the service, it will be exposed over HTTPS as well.</span></span>

## <a name="generating-a-single-wsdl-document"></a><span data-ttu-id="b7eca-154">生成单个 WSDL 文档</span><span class="sxs-lookup"><span data-stu-id="b7eca-154">Generating a Single WSDL Document</span></span>

<span data-ttu-id="b7eca-155">某些第三方 WSDL 处理堆栈不能通过 xsd:import 来处理对其他文档有依赖关系的 WSDL 文档。</span><span class="sxs-lookup"><span data-stu-id="b7eca-155">Some third-party WSDL processing stacks are not able to process WSDL documents that have dependencies on other documents through a xsd:import.</span></span> <span data-ttu-id="b7eca-156">您现在可通过 WCF 来指定在单个文档中返回的所有 WSDL 信息。</span><span class="sxs-lookup"><span data-stu-id="b7eca-156">WCF now allows you to specify that all WSDL information be returned in a single document.</span></span> <span data-ttu-id="b7eca-157">若要请求单个 WSDL 文档，请在从服务请求元数据时将 "？ singleWSDL" 追加到 URI。</span><span class="sxs-lookup"><span data-stu-id="b7eca-157">To request a single WSDL document append "?singleWSDL" to the URI when requesting metadata from the service.</span></span>

## <a name="websocket-support"></a><span data-ttu-id="b7eca-158">WebSocket 支持</span><span class="sxs-lookup"><span data-stu-id="b7eca-158">WebSocket Support</span></span>

<span data-ttu-id="b7eca-159">WebSocket 是一种通过端口 80 和 443 提供真正双向通信的技术，其性能特性与 TCP 类似。</span><span class="sxs-lookup"><span data-stu-id="b7eca-159">WebSockets is a technology that provides true bidirectional communication over ports 80 and 443 with performance characteristics similar to TCP.</span></span> <span data-ttu-id="b7eca-160">添加了两个新的绑定以支持通过 WebSocket 传输进行通信。</span><span class="sxs-lookup"><span data-stu-id="b7eca-160">Two new bindings have been added to support communication over a WebSocket transport.</span></span> <span data-ttu-id="b7eca-161"><xref:System.ServiceModel.NetHttpBinding> 和 <xref:System.ServiceModel.NetHttpsBinding>。</span><span class="sxs-lookup"><span data-stu-id="b7eca-161"><xref:System.ServiceModel.NetHttpBinding> and <xref:System.ServiceModel.NetHttpsBinding>.</span></span> <span data-ttu-id="b7eca-162">有关详细信息，请参阅： [系统提供的绑定](system-provided-bindings.md)。</span><span class="sxs-lookup"><span data-stu-id="b7eca-162">For more information see: [System-Provided Bindings](system-provided-bindings.md).</span></span>

## <a name="new-transport-default-values"></a><span data-ttu-id="b7eca-163">新传输默认值</span><span class="sxs-lookup"><span data-stu-id="b7eca-163">New Transport Default Values</span></span>

<span data-ttu-id="b7eca-164">下表描述了已更改的设置以及可在何处找到其他信息。</span><span class="sxs-lookup"><span data-stu-id="b7eca-164">The following table describes the settings that have changed and where to find additional information.</span></span>

|<span data-ttu-id="b7eca-165">properties</span><span class="sxs-lookup"><span data-stu-id="b7eca-165">Property</span></span>|<span data-ttu-id="b7eca-166">开</span><span class="sxs-lookup"><span data-stu-id="b7eca-166">On</span></span>|<span data-ttu-id="b7eca-167">新默认值</span><span class="sxs-lookup"><span data-stu-id="b7eca-167">New Default</span></span>|<span data-ttu-id="b7eca-168">有关详细信息，请参阅</span><span class="sxs-lookup"><span data-stu-id="b7eca-168">For more information see</span></span>|
|--------------|--------|-----------------|------------------------------|
|<span data-ttu-id="b7eca-169">channelInitializationTimeout</span><span class="sxs-lookup"><span data-stu-id="b7eca-169">channelInitializationTimeout</span></span>|<xref:System.ServiceModel.NetTcpBinding>|<span data-ttu-id="b7eca-170">30 秒</span><span class="sxs-lookup"><span data-stu-id="b7eca-170">30 seconds</span></span>|<xref:System.ServiceModel.Channels.ConnectionOrientedTransportBindingElement.ChannelInitializationTimeout%2A>|
|<span data-ttu-id="b7eca-171">listenBacklog</span><span class="sxs-lookup"><span data-stu-id="b7eca-171">listenBacklog</span></span>|<xref:System.ServiceModel.NetTcpBinding>|<span data-ttu-id="b7eca-172">12 \* 处理器数目</span><span class="sxs-lookup"><span data-stu-id="b7eca-172">12 \* number of processors</span></span>|<xref:System.ServiceModel.NetTcpBinding.ListenBacklog%2A>|
|<span data-ttu-id="b7eca-173">maxPendingAccepts</span><span class="sxs-lookup"><span data-stu-id="b7eca-173">maxPendingAccepts</span></span>|<span data-ttu-id="b7eca-174">ConnectionOrientedTransportBindingElement</span><span class="sxs-lookup"><span data-stu-id="b7eca-174">ConnectionOrientedTransportBindingElement</span></span><br /><br /> <span data-ttu-id="b7eca-175">SMSvcHost.exe</span><span class="sxs-lookup"><span data-stu-id="b7eca-175">SMSvcHost.exe</span></span>|<span data-ttu-id="b7eca-176">2 \* 传输处理器的数目</span><span class="sxs-lookup"><span data-stu-id="b7eca-176">2 \* number of processors for transport</span></span><br /><br /> <span data-ttu-id="b7eca-177">4 \* SMSvcHost.exe 的处理器数</span><span class="sxs-lookup"><span data-stu-id="b7eca-177">4 \* number of processors for SMSvcHost.exe</span></span>|<span data-ttu-id="b7eca-178"><xref:System.ServiceModel.Channels.ConnectionOrientedTransportBindingElement.MaxPendingAccepts%2A> [配置 Net.TCP 端口共享服务](./feature-details/configuring-the-net-tcp-port-sharing-service.md)</span><span class="sxs-lookup"><span data-stu-id="b7eca-178"><xref:System.ServiceModel.Channels.ConnectionOrientedTransportBindingElement.MaxPendingAccepts%2A> [Configuring the Net.TCP Port Sharing Service](./feature-details/configuring-the-net-tcp-port-sharing-service.md)</span></span>|
|<span data-ttu-id="b7eca-179">maxPendingConnections</span><span class="sxs-lookup"><span data-stu-id="b7eca-179">maxPendingConnections</span></span>|<span data-ttu-id="b7eca-180">ConnectionOrientedTransportBindingElement</span><span class="sxs-lookup"><span data-stu-id="b7eca-180">ConnectionOrientedTransportBindingElement</span></span>|<span data-ttu-id="b7eca-181">12 \* 处理器数目</span><span class="sxs-lookup"><span data-stu-id="b7eca-181">12 \* number of processors</span></span>|<xref:System.ServiceModel.Channels.ConnectionOrientedTransportBindingElement.MaxPendingConnections%2A>|
|<span data-ttu-id="b7eca-182">receiveTimeout</span><span class="sxs-lookup"><span data-stu-id="b7eca-182">receiveTimeout</span></span>|<span data-ttu-id="b7eca-183">SMSvcHost.exe</span><span class="sxs-lookup"><span data-stu-id="b7eca-183">SMSvcHost.exe</span></span>|<span data-ttu-id="b7eca-184">30 秒</span><span class="sxs-lookup"><span data-stu-id="b7eca-184">30 seconds</span></span>|[<span data-ttu-id="b7eca-185">配置 Net.TCP 端口共享服务</span><span class="sxs-lookup"><span data-stu-id="b7eca-185">Configuring the Net.TCP Port Sharing Service</span></span>](./feature-details/configuring-the-net-tcp-port-sharing-service.md)|

## <a name="xml-editor-tooltips"></a><span data-ttu-id="b7eca-186">XML 编辑器工具提示</span><span class="sxs-lookup"><span data-stu-id="b7eca-186">XML Editor Tooltips</span></span>

<span data-ttu-id="b7eca-187">为了帮助新的和现有 WCF 服务开发人员配置服务，Visual Studio XML 编辑器现在为属于服务配置文件的每个配置元素及其属性提供了工具提示。</span><span class="sxs-lookup"><span data-stu-id="b7eca-187">In order to help new and existing WCF service developers to configure their services, the Visual Studio XML editor now provides tooltips for every configuration element and its properties that is part of the service configuration file.</span></span>

## <a name="configuring-wcf-services-in-code"></a><span data-ttu-id="b7eca-188">在代码中配置 WCF 服务</span><span class="sxs-lookup"><span data-stu-id="b7eca-188">Configuring WCF Services in Code</span></span>

<span data-ttu-id="b7eca-189">Windows Communication Foundation (WCF) 允许开发人员使用配置文件或代码来配置服务。</span><span class="sxs-lookup"><span data-stu-id="b7eca-189">Windows Communication Foundation (WCF) allows developers to configure services using configuration files or code.</span></span> <span data-ttu-id="b7eca-190">当部署之后需要对服务进行配置时，配置文件十分有用。</span><span class="sxs-lookup"><span data-stu-id="b7eca-190">Configuration files are useful when a service needs to be configured after being deployed.</span></span> <span data-ttu-id="b7eca-191">在使用配置文件时，IT 专业人员只需要更新配置文件，无需重新编译。</span><span class="sxs-lookup"><span data-stu-id="b7eca-191">When using configuration files, an IT professional only needs to update the configuration file, no recompilation is required.</span></span> <span data-ttu-id="b7eca-192">不过，配置文件可能十分复杂，难以维护。</span><span class="sxs-lookup"><span data-stu-id="b7eca-192">Configuration files, however, can be complex and difficult to maintain.</span></span> <span data-ttu-id="b7eca-193">不支持对配置文件进行调试，并且将按名称来引用配置元素，这使得配置文件的创作易于出错且较为困难。</span><span class="sxs-lookup"><span data-stu-id="b7eca-193">There is no support for debugging configuration files and configuration elements are referenced by names which makes authoring configuration files error-prone and difficult.</span></span> <span data-ttu-id="b7eca-194">WCF 还允许您在代码中配置服务。</span><span class="sxs-lookup"><span data-stu-id="b7eca-194">WCF also allows you to configure services in code.</span></span> <span data-ttu-id="b7eca-195">在早期版本的 WCF (4.0 及更早版本中) 在代码中配置服务是很容易的自承载方案， <xref:System.ServiceModel.ServiceHost> 类允许你在调用 ServiceHost 之前配置终结点和行为。</span><span class="sxs-lookup"><span data-stu-id="b7eca-195">In earlier versions of WCF (4.0 and earlier) configuring services in code was easy in self-hosted scenarios, the <xref:System.ServiceModel.ServiceHost> class allowed you to configure endpoints and behaviors prior to calling ServiceHost.Open.</span></span> <span data-ttu-id="b7eca-196">但是，在 Web 承载方案中，您没有访问 <xref:System.ServiceModel.ServiceHost> 类的权限。</span><span class="sxs-lookup"><span data-stu-id="b7eca-196">In web hosted scenarios, however, you don’t have access to the <xref:System.ServiceModel.ServiceHost> class.</span></span> <span data-ttu-id="b7eca-197">若要配置 Web 承载的服务，你需要创建 `System.ServiceModel.ServiceHostFactory`，后者会创建 <xref:System.ServiceModel.Activation.ServiceHostFactory> 并执行任何所需的配置。</span><span class="sxs-lookup"><span data-stu-id="b7eca-197">To configure a web hosted service you were required to create a `System.ServiceModel.ServiceHostFactory` that created the <xref:System.ServiceModel.Activation.ServiceHostFactory> and performed any needed configuration.</span></span> <span data-ttu-id="b7eca-198">从 .NET Framework 4.5 开始，WCF 提供了一种更简单的方法来在代码中配置自承载服务和 web 托管服务。</span><span class="sxs-lookup"><span data-stu-id="b7eca-198">Starting with .NET Framework 4.5, WCF provides an easier way to configure both self-hosted and web hosted services in code.</span></span> <span data-ttu-id="b7eca-199">有关详细信息，请参阅 [在代码中配置 WCF 服务](configuring-wcf-services-in-code.md)。</span><span class="sxs-lookup"><span data-stu-id="b7eca-199">For more information, see [Configuring WCF Services in Code](configuring-wcf-services-in-code.md).</span></span>

## <a name="channelfactory-caching"></a><span data-ttu-id="b7eca-200">ChannelFactory 缓存</span><span class="sxs-lookup"><span data-stu-id="b7eca-200">ChannelFactory Caching</span></span>

<span data-ttu-id="b7eca-201">WCF 客户端应用程序使用 <xref:System.ServiceModel.ChannelFactory%601> 类来创建 WCF 服务的通信通道。</span><span class="sxs-lookup"><span data-stu-id="b7eca-201">WCF client applications use the <xref:System.ServiceModel.ChannelFactory%601> class to create a communication channel with a WCF service.</span></span> <span data-ttu-id="b7eca-202">创建 <xref:System.ServiceModel.ChannelFactory%601> 实例会带来一定的开销，因为这涉及以下操作：</span><span class="sxs-lookup"><span data-stu-id="b7eca-202">Creating <xref:System.ServiceModel.ChannelFactory%601> instances incurs some overhead because it involves the following operations:</span></span>

1. <span data-ttu-id="b7eca-203">构造 <xref:System.ServiceModel.Description.ContractDescription> 树</span><span class="sxs-lookup"><span data-stu-id="b7eca-203">Constructing the <xref:System.ServiceModel.Description.ContractDescription> tree</span></span>

2. <span data-ttu-id="b7eca-204">反映所有所需的 CLR 类型</span><span class="sxs-lookup"><span data-stu-id="b7eca-204">Reflecting all of the required CLR types</span></span>

3. <span data-ttu-id="b7eca-205">构造通道堆栈</span><span class="sxs-lookup"><span data-stu-id="b7eca-205">Constructing the channel stack</span></span>

4. <span data-ttu-id="b7eca-206">资源的释放</span><span class="sxs-lookup"><span data-stu-id="b7eca-206">Disposing of resources</span></span>

<span data-ttu-id="b7eca-207">为了尽量减少这种开销，WCF 可以缓存使用 WCF 客户端代理时的通道工厂。</span><span class="sxs-lookup"><span data-stu-id="b7eca-207">To help minimize this overhead, WCF can cache channel factories when you are using a WCF client proxy.</span></span> <span data-ttu-id="b7eca-208">有关详细信息，请参阅 [通道工厂和缓存](./feature-details/channel-factory-and-caching.md)。</span><span class="sxs-lookup"><span data-stu-id="b7eca-208">For more information, see [Channel Factory and Caching](./feature-details/channel-factory-and-caching.md).</span></span>

## <a name="compression-and-the-binary-encoder"></a><span data-ttu-id="b7eca-209">压缩和二进制编码器</span><span class="sxs-lookup"><span data-stu-id="b7eca-209">Compression and the Binary Encoder</span></span>

<span data-ttu-id="b7eca-210">从 WCF 4.5 开始，WCF 二进制编码器添加了对压缩的支持。</span><span class="sxs-lookup"><span data-stu-id="b7eca-210">Beginning with WCF 4.5 the WCF binary encoder adds support for compression.</span></span> <span data-ttu-id="b7eca-211">可使用 <xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement.CompressionFormat%2A> 属性来配置压缩类型。</span><span class="sxs-lookup"><span data-stu-id="b7eca-211">The type of compression is configured with the <xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement.CompressionFormat%2A> property.</span></span> <span data-ttu-id="b7eca-212">客户端和服务都必须配置 <xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement.CompressionFormat%2A> 属性。</span><span class="sxs-lookup"><span data-stu-id="b7eca-212">Both the client and the service must configure the <xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement.CompressionFormat%2A> property.</span></span> <span data-ttu-id="b7eca-213">压缩对 HTTP、HTTPS 和 TCP 协议有效。</span><span class="sxs-lookup"><span data-stu-id="b7eca-213">Compression will work for HTTP, HTTPS, and TCP protocols.</span></span> <span data-ttu-id="b7eca-214">如果客户端指定要使用压缩，但服务不支持，则会引发协议异常，指示协议不匹配。</span><span class="sxs-lookup"><span data-stu-id="b7eca-214">If a client specifies to use compression but the service does not support it a protocol exception is thrown indicating a protocol mismatch.</span></span> <span data-ttu-id="b7eca-215">有关详细信息，请参阅 [选择消息编码器](./feature-details/choosing-a-message-encoder.md)。</span><span class="sxs-lookup"><span data-stu-id="b7eca-215">For more information, see [Choosing a Message Encoder](./feature-details/choosing-a-message-encoder.md).</span></span>

## <a name="udp"></a><span data-ttu-id="b7eca-216">UDP</span><span class="sxs-lookup"><span data-stu-id="b7eca-216">UDP</span></span>

<span data-ttu-id="b7eca-217">添加了对 UDP 传输的支持，使开发人员能够编写使用 "火灾和遗忘" 消息传送的服务。</span><span class="sxs-lookup"><span data-stu-id="b7eca-217">Support has been added for a UDP transport which allows developers to write services that use "fire and forget" messaging.</span></span> <span data-ttu-id="b7eca-218">客户端向服务发送消息，且不希望从该服务获得响应。</span><span class="sxs-lookup"><span data-stu-id="b7eca-218">A client sends a message to a service and expects no response from the service.</span></span>

## <a name="multiple-authentication-support"></a><span data-ttu-id="b7eca-219">多个身份验证支持</span><span class="sxs-lookup"><span data-stu-id="b7eca-219">Multiple Authentication Support</span></span>

<span data-ttu-id="b7eca-220">添加了在使用 HTTP 传输和传输安全性时对单个 WCF 终结点上多个 IIS 支持的身份验证模式的支持。</span><span class="sxs-lookup"><span data-stu-id="b7eca-220">Support has been added to support multiple authentication modes, as supported by IIS, on a single WCF endpoint when using the HTTP transport and transport security.</span></span> <span data-ttu-id="b7eca-221">通过 IIS，您可以在虚拟目录上启用多个身份验证模式，此功能可使单个 WCF 终结点支持为承载该 WCF 服务的虚拟目录启用的多个身份验证模式。</span><span class="sxs-lookup"><span data-stu-id="b7eca-221">IIS allows you to enable multiple authentication modes on a virtual directory, this feature allows a single WCF endpoint to support the multiple authentication modes enabled for the virtual directory where the WCF service is hosted.</span></span>

## <a name="idn-support"></a><span data-ttu-id="b7eca-222">IDN 支持</span><span class="sxs-lookup"><span data-stu-id="b7eca-222">IDN Support</span></span>

<span data-ttu-id="b7eca-223">添加了允许使用带有国际化域名的 WCF 服务的支持。</span><span class="sxs-lookup"><span data-stu-id="b7eca-223">Support has been added to allow for WCF services with Internationalized Domain Names.</span></span> <span data-ttu-id="b7eca-224">有关详细信息，请参阅 [WCF 和国际化域名](./feature-details/wcf-and-internationalized-domain-names.md)。</span><span class="sxs-lookup"><span data-stu-id="b7eca-224">For more information see [WCF and Internationalized Domain Names](./feature-details/wcf-and-internationalized-domain-names.md).</span></span>

## <a name="httpclient"></a><span data-ttu-id="b7eca-225">HttpClient</span><span class="sxs-lookup"><span data-stu-id="b7eca-225">HttpClient</span></span>

<span data-ttu-id="b7eca-226">添加了一个名为 <xref:System.Net.Http.HttpClient> 的新类，以便更加方便地与 HTTP 请求结合使用。</span><span class="sxs-lookup"><span data-stu-id="b7eca-226">A new class called <xref:System.Net.Http.HttpClient> has been added to make working with HTTP requests much easier.</span></span> <span data-ttu-id="b7eca-227">有关详细信息，请参阅 [使应用社交并连接到 http 服务](https://channel9.msdn.com/Events/BUILD/BUILD2011/PLAT-581T) 和 [Http 客户端示例](https://code.msdn.microsoft.com/windowsapps/HttpClient-sample-55700664)。</span><span class="sxs-lookup"><span data-stu-id="b7eca-227">For more info, see [Making apps social and connected with HTTP services](https://channel9.msdn.com/Events/BUILD/BUILD2011/PLAT-581T) and the [HTTP Client Sample](https://code.msdn.microsoft.com/windowsapps/HttpClient-sample-55700664).</span></span>

## <a name="configuration-intellisense"></a><span data-ttu-id="b7eca-228">配置 Intellisense</span><span class="sxs-lookup"><span data-stu-id="b7eca-228">Configuration Intellisense</span></span>

<span data-ttu-id="b7eca-229">项目中定义的自定义特定的配置文件中的特性值现在支持 Intellisense，以便快速、准确地使用配置。</span><span class="sxs-lookup"><span data-stu-id="b7eca-229">Attribute values in configuration files for custom attributes defined in the project now support intellisense to facilitate working with configurations quickly and accurately.</span></span>

## <a name="configuration-tooltips"></a><span data-ttu-id="b7eca-230">配置工具提示</span><span class="sxs-lookup"><span data-stu-id="b7eca-230">Configuration tooltips</span></span>

<span data-ttu-id="b7eca-231">WCF 元素和属性现在在 "XML 编辑器" 中具有工具提示，以便更轻松、更准确地标识元素或属性的用途。</span><span class="sxs-lookup"><span data-stu-id="b7eca-231">WCF elements and attributes now have tooltips in the XML editor, to more easily and accurately identify the purpose of the element or attribute.</span></span>

## <a name="paste-data-as-classes"></a><span data-ttu-id="b7eca-232">将数据作为类进行粘贴</span><span class="sxs-lookup"><span data-stu-id="b7eca-232">Paste Data as Classes</span></span>

<span data-ttu-id="b7eca-233">在 WCF 项目中，在 XML 中定义的数据类型（在服务中公开的类型）可以粘贴直接到代码页中。</span><span class="sxs-lookup"><span data-stu-id="b7eca-233">In a WCF project, data types defined in XML (such as are exposed in a service) can be pasted directly into a code page.</span></span> <span data-ttu-id="b7eca-234">XML 类型将作为 CLR 类型进行粘贴。</span><span class="sxs-lookup"><span data-stu-id="b7eca-234">The XML type will be pasted as a CLR type.</span></span> <span data-ttu-id="b7eca-235">有关更多详细信息，请参阅 [从 XML 生成数据类型类](generating-data-type-classes-from-xml.md) 。</span><span class="sxs-lookup"><span data-stu-id="b7eca-235">See [Generating Data Type Classes from XML](generating-data-type-classes-from-xml.md) for more details.</span></span>

## <a name="webservicehost-and-default-endpoints"></a><span data-ttu-id="b7eca-236">WebServiceHost 和默认终结点</span><span class="sxs-lookup"><span data-stu-id="b7eca-236">WebServiceHost and default endpoints</span></span>

<span data-ttu-id="b7eca-237">在 Visual Studio 2010 中，WebServiceHost 会自动创建默认终结点，而无论你是否显式指定了终结点。</span><span class="sxs-lookup"><span data-stu-id="b7eca-237">In Visual Studio 2010, WebServiceHost automatically created a default endpoint whether you explicitly specified an endpoint or not.</span></span> <span data-ttu-id="b7eca-238">在 Visual Studio 2012 及更高版本中，如果未显式添加任何终结点，则 WebServiceHost 仅创建默认终结点。</span><span class="sxs-lookup"><span data-stu-id="b7eca-238">In Visual Studio 2012 and later, WebServiceHost only creates a default endpoint if no endpoints are explicitly added.</span></span> <span data-ttu-id="b7eca-239">如果客户端预期为默认终结点，则可以显式添加终结点，并将客户端指向该终结点。</span><span class="sxs-lookup"><span data-stu-id="b7eca-239">If your client is expecting the default endpoint you can explicitly add an endpoint and point the client to it.</span></span> <span data-ttu-id="b7eca-240">或者，您可以通过向应用程序的配置文件添加以下设置来告诉 WCF 恢复到上一个行为。</span><span class="sxs-lookup"><span data-stu-id="b7eca-240">Alternatively, you can tell WCF to revert back to the previous behavior by adding the following setting to you application’s configuration file</span></span>

```xml
<appSettings>
    <add key="wcf:webservicehost:enableautomaticendpointscompatability" value="true"/>
  </appSettings>
```

## <a name="ihttpcookiecontainermanager"></a><span data-ttu-id="b7eca-241">IHttpCookieContainerManager</span><span class="sxs-lookup"><span data-stu-id="b7eca-241">IHttpCookieContainerManager</span></span>

<span data-ttu-id="b7eca-242">由 <xref:System.ServiceModel.Channels.IChannelFactory%601> 公开的此接口可使在客户端上使用 Cookie 变得十分容易。</span><span class="sxs-lookup"><span data-stu-id="b7eca-242">This interface, exposed by <xref:System.ServiceModel.Channels.IChannelFactory%601>, makes working with cookies on the client side much easier.</span></span> <span data-ttu-id="b7eca-243">在针对该绑定将 AllowCookies 设置为 true 之后，你可使用以下代码来访问 Cookie：</span><span class="sxs-lookup"><span data-stu-id="b7eca-243">When AllowCookies is set to true on the binding, you can access cookies by using the following code:</span></span>

```csharp
IHttpCookieContainerManager cookieManager = factory.GetProperty<IHttpCookieContainerManager>();
System.Net.CookieContainer container = cookieManager.CookieContainer;
```

<span data-ttu-id="b7eca-244">然后，您可以从 <xref:System.Net.CookieContainer> 来检索或设置 Cookie。</span><span class="sxs-lookup"><span data-stu-id="b7eca-244">You can then retrieve or set the cookies from the <xref:System.Net.CookieContainer>.</span></span> <span data-ttu-id="b7eca-245">若将 AllowCookies 设置为 false，则您可以使用 <xref:System.ServiceModel.OperationContext> 来检索 Cookie，并使用其他 <xref:System.ServiceModel.OperationContext> 或消息检查器，在其他请求中将其发送。</span><span class="sxs-lookup"><span data-stu-id="b7eca-245">When AllowCookies is set to false, you can manually retrieve the cookies using <xref:System.ServiceModel.OperationContext> and send it in other requests using another <xref:System.ServiceModel.OperationContext> or message inspector.</span></span> <span data-ttu-id="b7eca-246">通过 IHttpCookieContainerManager 接口，您可以在一个服务中对用户进行身份验证，并使用由该服务返回的身份验证 Cookie，在其他服务中进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="b7eca-246">The IHttpCookieContainerManager interface allows you to authenticate a user with a service and use the authentication cookie returned by that service to authenticate with other services.</span></span>
