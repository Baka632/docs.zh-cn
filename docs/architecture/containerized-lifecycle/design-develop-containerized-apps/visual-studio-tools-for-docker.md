---
title: Windows 上的 Visual Studio Tools for Docker
description: 了解 Visual Studio 2017 15.7 版及更高版本中可用的 Docker 工具。
ms.date: 01/06/2021
ms.custom: vs-dotnet
ms.openlocfilehash: 0f6a0ca0e90021f5d374cfacc5c498f257ab5422
ms.sourcegitcommit: 7ef96827b161ef3fcde75f79d839885632e26ef1
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/07/2021
ms.locfileid: "97970496"
---
# <a name="use-docker-tools-in-visual-studio-on-windows"></a><span data-ttu-id="ced2b-103">在 Windows 上的 Visual Studio 中使用 Docker 工具</span><span class="sxs-lookup"><span data-stu-id="ced2b-103">Use Docker Tools in Visual Studio on Windows</span></span>

<span data-ttu-id="ced2b-104">使用 Visual Studio 2017 15.7 版及更高版本中附带的 Docker 工具的开发人员工作流与使用 Visual Studio Code 和 Docker CLI（事实上，它在同一 Docker CLI 基础上构建）类似，但前者更容易上手，因为它简化了流程并提高了构建、运行和创建任务的工作效率。</span><span class="sxs-lookup"><span data-stu-id="ced2b-104">The developer workflow when using the Docker Tools included in Visual Studio 2017 version 15.7 and later, is similar to using Visual Studio Code and Docker CLI (in fact, it's based on the same Docker CLI), but it's easier to get started, simplifies the process, and provides greater productivity for the build, run, and compose tasks.</span></span> <span data-ttu-id="ced2b-105">还可以通过 Visual Studio 中常用的 `F5` 和 `Ctrl+F5` 键运行和调试容器。</span><span class="sxs-lookup"><span data-stu-id="ced2b-105">It can also run and debug your containers via the usual `F5` and `Ctrl+F5` keys from Visual Studio.</span></span> <span data-ttu-id="ced2b-106">如果在解决方案级别的同一 `docker-compose.yml` 文件中定义其容器，甚至可以调试整个解决方案。</span><span class="sxs-lookup"><span data-stu-id="ced2b-106">You can even debug a whole solution if its containers are defined in the same `docker-compose.yml` file at the solution level.</span></span>

## <a name="configure-your-local-environment"></a><span data-ttu-id="ced2b-107">配置本地环境</span><span class="sxs-lookup"><span data-stu-id="ced2b-107">Configure your local environment</span></span>

<span data-ttu-id="ced2b-108">使用最新版本的用于 Windows 的 Docker，开发 Docker 应用程序容易得多，因为设置非常简单，如以下参考资料中所述。</span><span class="sxs-lookup"><span data-stu-id="ced2b-108">With the latest versions of Docker for Windows, it's easier than ever to develop Docker applications because the setup is straightforward, as explained in the following references.</span></span>

> [!TIP]
> <span data-ttu-id="ced2b-109">要了解有关安装用于 Windows 的 Docker 的详细信息，请转到 (<https://docs.docker.com/docker-for-windows/>)。</span><span class="sxs-lookup"><span data-stu-id="ced2b-109">To learn more about installing Docker for Windows, go to (<https://docs.docker.com/docker-for-windows/>).</span></span>

## <a name="docker-support-in-visual-studio"></a><span data-ttu-id="ced2b-110">Visual Studio 中的 Docker 支持</span><span class="sxs-lookup"><span data-stu-id="ced2b-110">Docker support in Visual Studio</span></span>

<span data-ttu-id="ced2b-111">可以将两个级别的 Docker 支持添加到项目中。</span><span class="sxs-lookup"><span data-stu-id="ced2b-111">There are two levels of Docker support you can add to a project.</span></span> <span data-ttu-id="ced2b-112">在 ASP.NET Core 项目中，启用 Docker 支持，即可将 `Dockerfile` 文件添加项目中。</span><span class="sxs-lookup"><span data-stu-id="ced2b-112">In ASP.NET Core projects, you can just add a `Dockerfile` file to the project by enabling Docker support.</span></span> <span data-ttu-id="ced2b-113">下一级是容器业务流程支持，它会向项目添加解决方案级别的 `Dockerfile`（如果它尚不存在）和 `docker-compose.yml` 文件。</span><span class="sxs-lookup"><span data-stu-id="ced2b-113">The next level is container orchestration support, which adds a `Dockerfile` to the project (if it doesn't already exist) and a `docker-compose.yml` file at the solution level.</span></span> <span data-ttu-id="ced2b-114">默认情况下，在 Visual Studio 2017 15.0 到 15.7 版中添加了通过 Docker Compose 支持的容器业务流程支持。</span><span class="sxs-lookup"><span data-stu-id="ced2b-114">Container orchestration support, via Docker Compose, is added by default in Visual Studio 2017 versions 15.0 to 15.7.</span></span> <span data-ttu-id="ced2b-115">容器业务流程支持是 Visual Studio 2017 15.8 版或更高版本中的一个可选功能。</span><span class="sxs-lookup"><span data-stu-id="ced2b-115">Container orchestration support is an opt-in feature in Visual Studio 2017 versions 15.8 or later.</span></span> <span data-ttu-id="ced2b-116">Visual Studio 2019 及更高版本也支持 Kubernetes/Helm 部署。</span><span class="sxs-lookup"><span data-stu-id="ced2b-116">Visual Studio 2019 and later supports **Kubernetes/Helm** deployment as well.</span></span>

<span data-ttu-id="ced2b-117">“添加”>“Docker 支持”和“添加”>“容器业务流程协调程序支持”命令位于“解决方案资源管理器”中 ASP.NET Core 项目的项目节点的右键单击菜单（或上下文菜单）上，如图 4-31 所示：</span><span class="sxs-lookup"><span data-stu-id="ced2b-117">The **Add > Docker Support** and **Add > Container Orchestrator Support** commands are located on the right-click menu (or context menu) of the project node for an ASP.NET Core project in **Solution Explorer**, as shown in Figure 4-31:</span></span>

![Visual Studio 中的“添加 Docker 支持”菜单选项](media/add-docker-support-menu.png)

<span data-ttu-id="ced2b-119">**图 4-31**。</span><span class="sxs-lookup"><span data-stu-id="ced2b-119">**Figure 4-31**.</span></span> <span data-ttu-id="ced2b-120">向 Visual Studio 2019 项目添加 Docker 支持</span><span class="sxs-lookup"><span data-stu-id="ced2b-120">Adding Docker support to a Visual Studio 2019 project</span></span>

### <a name="add-docker-support"></a><span data-ttu-id="ced2b-121">添加 Docker 支持</span><span class="sxs-lookup"><span data-stu-id="ced2b-121">Add Docker support</span></span>

<span data-ttu-id="ced2b-122">除了上一节中所示的向现有应用程序添加 Docker 支持的选项之外，你也可以通过以下方法启用 Docker 支持：在项目创建期间，在“新建项目”对话框中单击“确定”后打开的“新建 ASP.NET Core Web 应用程序”对话框中选择“启用 Docker 支持”（如图 4-32 所示）   。</span><span class="sxs-lookup"><span data-stu-id="ced2b-122">Besides the option to add Docker support to an existing application, as shown in the previous section, you can also enable Docker support during project creation by selecting **Enable Docker Support** in the **New ASP.NET Core Web Application** dialog box that opens after you click **OK** in the **New Project** dialog box, as shown in Figure 4-32.</span></span>

![在 Visual Studio 中为新的 ASP.NET Core Web 应用启用 Docker 支持](media/enable-docker-support-visual-studio.png)

<span data-ttu-id="ced2b-124">**图 4-32**。</span><span class="sxs-lookup"><span data-stu-id="ced2b-124">**Figure 4-32**.</span></span> <span data-ttu-id="ced2b-125">在 Visual Studio 2019 中创建项目期间启用 Docker 支持</span><span class="sxs-lookup"><span data-stu-id="ced2b-125">Enable Docker support during project creation in Visual Studio 2019</span></span>

<span data-ttu-id="ced2b-126">添加或启用 Docker 支持时，Visual Studio 将向项目添加 Dockerfile 文件，其中包括对解决方案中所有必需项目的引用。</span><span class="sxs-lookup"><span data-stu-id="ced2b-126">When you add or enable Docker support, Visual Studio adds a _Dockerfile_ file to the project, that includes references to all required project from the solution.</span></span>

### <a name="add-container-orchestration-support"></a><span data-ttu-id="ced2b-127">添加容器业务流程支持</span><span class="sxs-lookup"><span data-stu-id="ced2b-127">Add container orchestration support</span></span>

<span data-ttu-id="ced2b-128">想要构建多容器解决方案时，请为项目添加容器业务流程支持。</span><span class="sxs-lookup"><span data-stu-id="ced2b-128">When you want to compose a multi-container solution, add container orchestration support to your projects.</span></span> <span data-ttu-id="ced2b-129">这样就可以同时运行和调试一组容器（整个解决方案）（如果已在同一个 docker-compose.yml 文件中定义这些容器）。</span><span class="sxs-lookup"><span data-stu-id="ced2b-129">This lets you run and debug a group of containers (a whole solution) at the same time if they're defined in the same _docker-compose.yml_ file.</span></span>

<span data-ttu-id="ced2b-130">要添加容器业务流程支持，请右键单击“解决方案资源管理器”中的解决方案或项目节点，然后选择“添加”>“容器业务流程支持”。</span><span class="sxs-lookup"><span data-stu-id="ced2b-130">To add container orchestration support, right-click on the solution or project node in **Solution Explorer**, and choose **Add > Container Orchestration Support**.</span></span> <span data-ttu-id="ced2b-131">然后选择“Kubernetes/Helm”或“Docker Compose”以管理容器 。</span><span class="sxs-lookup"><span data-stu-id="ced2b-131">Then choose **Kubernetes/Helm** or **Docker Compose** to manage the containers.</span></span>

<span data-ttu-id="ced2b-132">向项目添加容器业务流程支持后，会看到添加到项目的 Dockerfile 文件以及添加到“解决方案资源管理器”中的某个解决方案的 docker-compose 文件夹，如图 4-33 所示 ：</span><span class="sxs-lookup"><span data-stu-id="ced2b-132">After you add container orchestration support to your project, you see a Dockerfile added to the project and a **docker-compose** folder added to the solution in **Solution Explorer**, as shown in Figure 4-33:</span></span>

![Visual Studio 解决方案资源管理器中的 Docker 文件](media/docker-support-solution-explorer.png)

<span data-ttu-id="ced2b-134">**图 4-33**。</span><span class="sxs-lookup"><span data-stu-id="ced2b-134">**Figure 4-33**.</span></span> <span data-ttu-id="ced2b-135">Visual Studio 2019 解决方案资源管理器中的 Docker 文件</span><span class="sxs-lookup"><span data-stu-id="ced2b-135">Docker files in Solution Explorer in Visual Studio 2019</span></span>

<span data-ttu-id="ced2b-136">如果 docker-compose.yml 已存在，Visual Studio 只需向其添加配置代码所需的行。</span><span class="sxs-lookup"><span data-stu-id="ced2b-136">If _docker-compose.yml_ already exists, Visual Studio just adds the required lines of configuration code to it.</span></span>

## <a name="configure-docker-tools"></a><span data-ttu-id="ced2b-137">配置 Docker 工具</span><span class="sxs-lookup"><span data-stu-id="ced2b-137">Configure Docker tools</span></span>

<span data-ttu-id="ced2b-138">从主菜单中，选择“工具”>“选项”，然后展开“容器工具”>“设置”。</span><span class="sxs-lookup"><span data-stu-id="ced2b-138">From the main menu, choose **Tools > Options**, and expand **Container Tools > Settings**.</span></span> <span data-ttu-id="ced2b-139">随即出现容器工具设置。</span><span class="sxs-lookup"><span data-stu-id="ced2b-139">The container tools settings appear.</span></span>

![Visual Studio Docker 工具选项，其中显示三个页面：文章文本中详细介绍的“常规”、“单个项目”和“Docker Compose”。](media/visual-studio-docker-tools-options.png)

<span data-ttu-id="ced2b-141">**图 4-34**。</span><span class="sxs-lookup"><span data-stu-id="ced2b-141">**Figure 4-34**.</span></span> <span data-ttu-id="ced2b-142">Docker 工具选项</span><span class="sxs-lookup"><span data-stu-id="ced2b-142">Docker Tools Options</span></span>

<span data-ttu-id="ced2b-143">下表可帮助确定如何设置这些选项。</span><span class="sxs-lookup"><span data-stu-id="ced2b-143">The following table might help you decide how to set these options.</span></span>

| <span data-ttu-id="ced2b-144">页面/设置</span><span class="sxs-lookup"><span data-stu-id="ced2b-144">Page/Setting</span></span>                                |  <span data-ttu-id="ced2b-145">默认设置</span><span class="sxs-lookup"><span data-stu-id="ced2b-145">Default Setting</span></span>   | <span data-ttu-id="ced2b-146">说明</span><span class="sxs-lookup"><span data-stu-id="ced2b-146">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                           |
| ------------------------------------------- | :----------------: | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <span data-ttu-id="ced2b-147">**常规页**</span><span class="sxs-lookup"><span data-stu-id="ced2b-147">**General page**</span></span>                            |
| <span data-ttu-id="ced2b-148">根据需要安装 Docker Desktop</span><span class="sxs-lookup"><span data-stu-id="ced2b-148">Install Docker Desktop if needed</span></span>            |     <span data-ttu-id="ced2b-149">提示我</span><span class="sxs-lookup"><span data-stu-id="ced2b-149">Prompt me</span></span>      |
| <span data-ttu-id="ced2b-150">根据需要启动 Docker Desktop</span><span class="sxs-lookup"><span data-stu-id="ced2b-150">Start Docker Desktop if needed</span></span>              |     <span data-ttu-id="ced2b-151">提示我</span><span class="sxs-lookup"><span data-stu-id="ced2b-151">Prompt me</span></span>      |
| <span data-ttu-id="ced2b-152">信任 ASP.NET Core SSL 证书</span><span class="sxs-lookup"><span data-stu-id="ced2b-152">Trust ASP.NET Core SSL certificate</span></span>          |     <span data-ttu-id="ced2b-153">提示我</span><span class="sxs-lookup"><span data-stu-id="ced2b-153">Prompt me</span></span>      | <span data-ttu-id="ced2b-154">如果没有（使用 `dotnet dev-certs https --trust`）将 localhost SSL 证书标记为受信任，则 Visual Studio 将在每次运行项目时提示你。</span><span class="sxs-lookup"><span data-stu-id="ced2b-154">If the localhost SSL certificate hasn't been marked as trusted (with `dotnet dev-certs https --trust`), Visual Studio will prompt every time you run your project.</span></span>                                                                                                                                                                                                                                                    |
| <span data-ttu-id="ced2b-155">**单个项目页**</span><span class="sxs-lookup"><span data-stu-id="ced2b-155">**Single Project page**</span></span>                     |
| <span data-ttu-id="ced2b-156">在项目打开时拉取所需的 Docker 映像</span><span class="sxs-lookup"><span data-stu-id="ced2b-156">Pull required Docker images on project open</span></span> |        <span data-ttu-id="ced2b-157">True</span><span class="sxs-lookup"><span data-stu-id="ced2b-157">True</span></span>        | <span data-ttu-id="ced2b-158">为了在运行项目时提高性能，Visual Studio 将在后台启动 Docker 拉取操作，以便在准备好运行代码时，映像已下载或正在下载。</span><span class="sxs-lookup"><span data-stu-id="ced2b-158">For increased performance when running the project, Visual Studio will start a Docker pull operation in the background so that when you're ready to run your code, the image is already downloaded or in the process of downloading.</span></span> <span data-ttu-id="ced2b-159">如果只需加载项目和浏览代码，可以将其关闭，以避免下载不需要的容器映像。</span><span class="sxs-lookup"><span data-stu-id="ced2b-159">If you're just loading projects and browsing code, you can turn this off to avoid downloading container images you don't need.</span></span> <span data-ttu-id="ced2b-160">这可能会降低打开项目的用户体验。</span><span class="sxs-lookup"><span data-stu-id="ced2b-160">This could slow the open project user experience.</span></span> |
| <span data-ttu-id="ced2b-161">在项目加载时拉取更新后的 Docker 映像</span><span class="sxs-lookup"><span data-stu-id="ced2b-161">Pull updated Docker images on project load</span></span>  | <span data-ttu-id="ced2b-162">.NET Core 项目</span><span class="sxs-lookup"><span data-stu-id="ced2b-162">.NET Core projects</span></span> | <span data-ttu-id="ced2b-163">将更新拉到现有映像，以获取项目打开时的最新更新。</span><span class="sxs-lookup"><span data-stu-id="ced2b-163">Pull updates to existing images to get the latest updates on project open.</span></span> <span data-ttu-id="ced2b-164">这可能会降低打开项目的用户体验。</span><span class="sxs-lookup"><span data-stu-id="ced2b-164">This could slow the open project user experience.</span></span>                                                                                                                                                                                                                                                                                          |
| <span data-ttu-id="ced2b-165">在项目关闭时删除容器</span><span class="sxs-lookup"><span data-stu-id="ced2b-165">Remove containers on project close</span></span>          |        <span data-ttu-id="ced2b-166">True</span><span class="sxs-lookup"><span data-stu-id="ced2b-166">True</span></span>        | <span data-ttu-id="ced2b-167">在关闭项目时进行清理，这可能会减慢关闭项目的用户体验，但是无论如何通常都是很快的。</span><span class="sxs-lookup"><span data-stu-id="ced2b-167">Clean up on project close, This could slow the close project user experience but it's usually fast anyway.</span></span>                                                                                                                                                                                                                                                                                                            |
| <span data-ttu-id="ced2b-168">在项目打开时运行容器</span><span class="sxs-lookup"><span data-stu-id="ced2b-168">Run containers on project open</span></span>              |        <span data-ttu-id="ced2b-169">True</span><span class="sxs-lookup"><span data-stu-id="ced2b-169">True</span></span>        | <span data-ttu-id="ced2b-170">为了在运行项目时提高性能，Visual Studio 将启动解决方案中的所有容器。</span><span class="sxs-lookup"><span data-stu-id="ced2b-170">For increased performance when running the project, Visual Studio will start all containers in the solution.</span></span> <span data-ttu-id="ced2b-171">这可能会降低打开项目的用户体验。</span><span class="sxs-lookup"><span data-stu-id="ced2b-171">This could slow the open project user experience.</span></span>                                                                                                                                                                                                                                                        |
| <span data-ttu-id="ced2b-172">**Docker Compose**</span><span class="sxs-lookup"><span data-stu-id="ced2b-172">**Docker Compose**</span></span>                          |                    | <span data-ttu-id="ced2b-173">Docker Compose 页包含与单个项目页相同的设置，但它们适用于多容器解决方案。</span><span class="sxs-lookup"><span data-stu-id="ced2b-173">The Docker Compose page contains the same settings as the Single Project page, but they apply to multi-container solutions.</span></span>                                                                                                                                                                                                                                                                                           |

> [!WARNING]
> <span data-ttu-id="ced2b-174">如果 localhost SSL 证书不受信任，并且你将选项设置为“绝不”，则 HTTPS Web 请求可能会在运行时在应用或服务中失败。</span><span class="sxs-lookup"><span data-stu-id="ced2b-174">If the localhost SSL certificate is not trusted, and you set the option to **Never**, then HTTPS web requests might fail at runtime in your app or service.</span></span> <span data-ttu-id="ced2b-175">在这种情况下，请将值重新设置为“提示我”，或最好使用命令 `dotnet dev-certs https --trust` 信任开发计算机中的证书。</span><span class="sxs-lookup"><span data-stu-id="ced2b-175">In that case, set the value back again to **Prompt me** or, better again, trust the certificates in your dev machine using the command `dotnet dev-certs https --trust`.</span></span>

> [!TIP]
> <span data-ttu-id="ced2b-176">有关服务实现以及 Visual Studio Tools for Docker 用法的更多详细信息，请阅读以下文章：</span><span class="sxs-lookup"><span data-stu-id="ced2b-176">For further details on the services implementation and use of Visual Studio Tools for Docker, read the following articles:</span></span>
>
> <span data-ttu-id="ced2b-177">在本地 Docker 容器中调试应用：<https://docs.microsoft.com/visualstudio/containers/edit-and-refresh></span><span class="sxs-lookup"><span data-stu-id="ced2b-177">Debug apps in a local Docker container: <https://docs.microsoft.com/visualstudio/containers/edit-and-refresh></span></span>
>
> <span data-ttu-id="ced2b-178">使用 Visual Studio 将 ASP.NET 容器部署到容器注册表：<https://docs.microsoft.com/visualstudio/containers/hosting-web-apps-in-docker></span><span class="sxs-lookup"><span data-stu-id="ced2b-178">Deploy an ASP.NET container to a container registry using Visual Studio: <https://docs.microsoft.com/visualstudio/containers/hosting-web-apps-in-docker></span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="ced2b-179">[上一页](docker-apps-inner-loop-workflow.md)
> [下一页](set-up-windows-containers-with-powershell.md)</span><span class="sxs-lookup"><span data-stu-id="ced2b-179">[Previous](docker-apps-inner-loop-workflow.md)
[Next](set-up-windows-containers-with-powershell.md)</span></span>
