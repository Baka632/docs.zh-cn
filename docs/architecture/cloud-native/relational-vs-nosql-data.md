---
title: 关系与NoSQL 数据
description: 了解云本机应用程序中的关系数据和 NoSQL 数据
author: robvet
ms.date: 05/17/2020
ms.openlocfilehash: 11db5cdca06b9c2c8ce12598456c4b147ac379ba
ms.sourcegitcommit: 98d20cb038669dca4a195eb39af37d22ea9d008e
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 10/22/2020
ms.locfileid: "92434869"
---
# <a name="relational-vs-nosql-data"></a><span data-ttu-id="a73f0-103">关系与NoSQL 数据</span><span class="sxs-lookup"><span data-stu-id="a73f0-103">Relational vs. NoSQL data</span></span>

<span data-ttu-id="a73f0-104">关系型和 NoSQL 是通常在云本机应用程序中实现的两种类型的数据库系统。</span><span class="sxs-lookup"><span data-stu-id="a73f0-104">Relational and NoSQL are two types of database systems commonly implemented in cloud-native apps.</span></span> <span data-ttu-id="a73f0-105">它们的构建方式不同，以不同的方式存储数据，并以不同的方式进行访问。</span><span class="sxs-lookup"><span data-stu-id="a73f0-105">They're built differently, store data differently, and accessed differently.</span></span> <span data-ttu-id="a73f0-106">在本部分中，我们将介绍这两种情况。</span><span class="sxs-lookup"><span data-stu-id="a73f0-106">In this section, we'll look at both.</span></span> <span data-ttu-id="a73f0-107">本章稍后将介绍一种名为 *NewSQL*的新兴数据库技术。</span><span class="sxs-lookup"><span data-stu-id="a73f0-107">Later in this chapter, we'll look at an emerging database technology called *NewSQL*.</span></span>

<span data-ttu-id="a73f0-108">*关系数据库* 是数十年的普遍技术。</span><span class="sxs-lookup"><span data-stu-id="a73f0-108">*Relational databases* have been a prevalent technology for decades.</span></span> <span data-ttu-id="a73f0-109">它们是成熟、经过验证且广泛实现的。</span><span class="sxs-lookup"><span data-stu-id="a73f0-109">They're mature, proven, and widely implemented.</span></span> <span data-ttu-id="a73f0-110">竞争的数据库产品、工具和专业知识 abound。</span><span class="sxs-lookup"><span data-stu-id="a73f0-110">Competing database products, tooling, and expertise abound.</span></span> <span data-ttu-id="a73f0-111">关系数据库提供相关数据表的存储区。</span><span class="sxs-lookup"><span data-stu-id="a73f0-111">Relational databases provide a store of related data tables.</span></span> <span data-ttu-id="a73f0-112">这些表具有固定架构，使用 SQL (结构化查询语言) 管理数据，并支持 ACID 保证。</span><span class="sxs-lookup"><span data-stu-id="a73f0-112">These tables have a fixed schema, use SQL (Structured Query Language) to manage data, and support ACID guarantees.</span></span>

<span data-ttu-id="a73f0-113">非*SQL 数据库指的*是高性能、非关系型数据存储。</span><span class="sxs-lookup"><span data-stu-id="a73f0-113">*No-SQL databases* refer to high-performance, non-relational data stores.</span></span> <span data-ttu-id="a73f0-114">它们采用易用性、可伸缩性、复原能力和可用性特征提供了方便。</span><span class="sxs-lookup"><span data-stu-id="a73f0-114">They excel in their ease-of-use, scalability, resilience, and availability characteristics.</span></span> <span data-ttu-id="a73f0-115">NoSQL 存储非结构化或半结构化数据，而不是联接规范化数据的表，通常在键值对或 JSON 文档中。</span><span class="sxs-lookup"><span data-stu-id="a73f0-115">Instead of joining tables of normalized data, NoSQL stores unstructured or semi-structured data, often in key-value pairs or JSON documents.</span></span> <span data-ttu-id="a73f0-116">非 SQL 数据库通常不会提供超出单一数据库分区范围的 ACID 保证。</span><span class="sxs-lookup"><span data-stu-id="a73f0-116">No-SQL databases typically don't provide ACID guarantees beyond the scope of a single database partition.</span></span> <span data-ttu-id="a73f0-117">需要第二次响应时间的高容量服务倾向于 NoSQL 数据存储。</span><span class="sxs-lookup"><span data-stu-id="a73f0-117">High volume services that require sub second response time favor NoSQL datastores.</span></span>

<span data-ttu-id="a73f0-118">[NoSQL](https://www.geeksforgeeks.org/introduction-to-nosql/)技术对于分布式云本机系统的影响不能言过其实。</span><span class="sxs-lookup"><span data-stu-id="a73f0-118">The impact of [NoSQL](https://www.geeksforgeeks.org/introduction-to-nosql/) technologies for distributed cloud-native systems can't be overstated.</span></span> <span data-ttu-id="a73f0-119">这一领域新数据技术的激增导致了只依赖于关系数据库的解决方案。</span><span class="sxs-lookup"><span data-stu-id="a73f0-119">The proliferation of new data technologies in this space has disrupted solutions that once exclusively relied on relational databases.</span></span>

<span data-ttu-id="a73f0-120">NoSQL 数据库包含用于访问和管理数据的多个不同的模型，每个模型都适用于特定用例。</span><span class="sxs-lookup"><span data-stu-id="a73f0-120">NoSQL databases include several different models for accessing and managing data, each suited to specific use cases.</span></span> <span data-ttu-id="a73f0-121">图5-9 显示了四个通用模型。</span><span class="sxs-lookup"><span data-stu-id="a73f0-121">Figure 5-9 presents four common models.</span></span>

![NoSQL 数据模型](./media/types-of-nosql-datastores.png)

<span data-ttu-id="a73f0-123">**图 5-9**： NoSQL 数据库的数据模型</span><span class="sxs-lookup"><span data-stu-id="a73f0-123">**Figure 5-9**: Data models for NoSQL databases</span></span>

| <span data-ttu-id="a73f0-124">型号</span><span class="sxs-lookup"><span data-stu-id="a73f0-124">Model</span></span> | <span data-ttu-id="a73f0-125">特征</span><span class="sxs-lookup"><span data-stu-id="a73f0-125">Characteristics</span></span> |
| :-------- | :-------- |
| <span data-ttu-id="a73f0-126">文档存储</span><span class="sxs-lookup"><span data-stu-id="a73f0-126">Document Store</span></span> | <span data-ttu-id="a73f0-127">数据和元数据以分层形式存储在数据库中基于 JSON 的文档中。</span><span class="sxs-lookup"><span data-stu-id="a73f0-127">Data and metadata are stored hierarchically in JSON-based documents inside the database.</span></span> |
| <span data-ttu-id="a73f0-128">键值存储</span><span class="sxs-lookup"><span data-stu-id="a73f0-128">Key Value Store</span></span> | <span data-ttu-id="a73f0-129">最简单的 NoSQL 数据库数据以键值对的集合表示。</span><span class="sxs-lookup"><span data-stu-id="a73f0-129">The simplest of the NoSQL databases, data is represented as a collection of key-value pairs.</span></span> |
| <span data-ttu-id="a73f0-130">Wide-Column 存储</span><span class="sxs-lookup"><span data-stu-id="a73f0-130">Wide-Column Store</span></span> | <span data-ttu-id="a73f0-131">相关数据以一组嵌套键/值对的形式存储在单个列中。</span><span class="sxs-lookup"><span data-stu-id="a73f0-131">Related data is stored as a set of nested-key/value pairs within a single column.</span></span> |
| <span data-ttu-id="a73f0-132">图形存储</span><span class="sxs-lookup"><span data-stu-id="a73f0-132">Graph Store</span></span> | <span data-ttu-id="a73f0-133">数据作为节点、边缘和数据属性存储在图形结构中。</span><span class="sxs-lookup"><span data-stu-id="a73f0-133">Data is stored in a graph structure as node, edge, and data properties.</span></span> |

## <a name="the-cap-theorem"></a><span data-ttu-id="a73f0-134">CAP 定理</span><span class="sxs-lookup"><span data-stu-id="a73f0-134">The CAP theorem</span></span>

<span data-ttu-id="a73f0-135">要了解这两种类型的数据库之间的差异，请考虑使用 CAP 定理，这组原则适用于存储状态的分布式系统。</span><span class="sxs-lookup"><span data-stu-id="a73f0-135">As a way to understand the differences between these types of databases, consider the CAP theorem, a set of principles applied to distributed systems that store state.</span></span> <span data-ttu-id="a73f0-136">图5-10 显示了 CAP 定理的三个属性。</span><span class="sxs-lookup"><span data-stu-id="a73f0-136">Figure 5-10 shows the three properties of the CAP theorem.</span></span>

![The CAP Theorem（CAP 定理）](./media/cap-theorem.png)

<span data-ttu-id="a73f0-138">**图 5-10**。</span><span class="sxs-lookup"><span data-stu-id="a73f0-138">**Figure 5-10**.</span></span> <span data-ttu-id="a73f0-139">CAP 定理</span><span class="sxs-lookup"><span data-stu-id="a73f0-139">The CAP theorem</span></span>

<span data-ttu-id="a73f0-140">定理指出，分布式数据系统将在一致性、可用性和分区容差之间提供权衡。</span><span class="sxs-lookup"><span data-stu-id="a73f0-140">The theorem states that distributed data systems will offer a trade-off between consistency, availability, and partition tolerance.</span></span> <span data-ttu-id="a73f0-141">而且，任何数据库只能保证三个属性中的 *两个* ：</span><span class="sxs-lookup"><span data-stu-id="a73f0-141">And, that any database can only guarantee *two* of the three properties:</span></span>

- <span data-ttu-id="a73f0-142">*起见.*</span><span class="sxs-lookup"><span data-stu-id="a73f0-142">*Consistency.*</span></span> <span data-ttu-id="a73f0-143">群集中的每个节点都将使用最新的数据做出响应，即使在所有副本更新之前，系统都必须阻止请求。</span><span class="sxs-lookup"><span data-stu-id="a73f0-143">Every node in the cluster responds with the most recent data, even if the system must block the request until all replicas update.</span></span> <span data-ttu-id="a73f0-144">如果查询当前正在更新的项的 "一致性系统"，则将等待该响应，直到所有副本都成功更新。</span><span class="sxs-lookup"><span data-stu-id="a73f0-144">If you query a "consistent system" for an item that is currently updating, you'll wait for that response until all replicas successfully update.</span></span> <span data-ttu-id="a73f0-145">不过，您将收到最新的数据。</span><span class="sxs-lookup"><span data-stu-id="a73f0-145">However, you'll receive the most current data.</span></span>

- <span data-ttu-id="a73f0-146">*有.*</span><span class="sxs-lookup"><span data-stu-id="a73f0-146">*Availability.*</span></span> <span data-ttu-id="a73f0-147">即使该响应不是最新的数据，每个节点都将返回立即响应。</span><span class="sxs-lookup"><span data-stu-id="a73f0-147">Every node returns an immediate response, even if that response isn't the most recent data.</span></span> <span data-ttu-id="a73f0-148">如果您在 "可用系统" 中查询正在更新的项，则您将获得该服务在此时可以提供的最佳可能的答案。</span><span class="sxs-lookup"><span data-stu-id="a73f0-148">If you query an "available system" for an item that is updating, you'll get the best possible answer the service can provide at that moment.</span></span>

- <span data-ttu-id="a73f0-149">*分区容差。*</span><span class="sxs-lookup"><span data-stu-id="a73f0-149">*Partition Tolerance.*</span></span> <span data-ttu-id="a73f0-150">即使复制的数据节点发生故障或失去与其他复制的数据节点的连接，保证系统仍可继续运行。</span><span class="sxs-lookup"><span data-stu-id="a73f0-150">Guarantees the system continues to operate even if a replicated data node fails or loses connectivity with other replicated data nodes.</span></span>

<span data-ttu-id="a73f0-151">关系数据库通常提供一致性和可用性，但不提供分区容差。</span><span class="sxs-lookup"><span data-stu-id="a73f0-151">Relational databases typically provide consistency and availability, but not partition tolerance.</span></span> <span data-ttu-id="a73f0-152">通常会将它们预配到单台服务器，并通过将更多资源添加到计算机来进行垂直缩放。</span><span class="sxs-lookup"><span data-stu-id="a73f0-152">They're typically provisioned to a single server and scale vertically by adding more resources to the machine.</span></span>

<span data-ttu-id="a73f0-153">许多关系数据库系统都支持内置的复制功能，在这种情况下，可以将主数据库的副本创建到其他辅助服务器实例。</span><span class="sxs-lookup"><span data-stu-id="a73f0-153">Many relational database systems support built-in replication features where copies of the primary database can be made to other secondary server instances.</span></span> <span data-ttu-id="a73f0-154">对主实例进行写入操作，并将其复制到每个辅助数据库。</span><span class="sxs-lookup"><span data-stu-id="a73f0-154">Write operations are made to the primary instance and replicated to each of the secondaries.</span></span> <span data-ttu-id="a73f0-155">发生故障时，主实例可以故障转移到辅助数据库，以提供高可用性。</span><span class="sxs-lookup"><span data-stu-id="a73f0-155">Upon a failure, the primary instance can fail over to a secondary to provide high availability.</span></span> <span data-ttu-id="a73f0-156">辅助副本也可以用于分发读取操作。</span><span class="sxs-lookup"><span data-stu-id="a73f0-156">Secondaries can also be used to distribute read operations.</span></span> <span data-ttu-id="a73f0-157">尽管写入操作始终针对主副本进行，但读取操作可路由到任何辅助副本以减少系统负载。</span><span class="sxs-lookup"><span data-stu-id="a73f0-157">While writes operations always go against the primary replica, read operations can be routed to any of the secondaries to reduce system load.</span></span>

<span data-ttu-id="a73f0-158">数据还可以在多个节点之间水平分区，例如 with [分片](/azure/sql-database/sql-database-elastic-scale-introduction)。</span><span class="sxs-lookup"><span data-stu-id="a73f0-158">Data can also be horizontally partitioned across multiple nodes, such as with [sharding](/azure/sql-database/sql-database-elastic-scale-introduction).</span></span> <span data-ttu-id="a73f0-159">但是，分片通过 spitting 不能轻松通信的多个部分中的数据来显著提高运营开销。</span><span class="sxs-lookup"><span data-stu-id="a73f0-159">But, sharding dramatically increases operational overhead by spitting data across many pieces that cannot easily communicate.</span></span> <span data-ttu-id="a73f0-160">管理成本高昂且耗时很高。</span><span class="sxs-lookup"><span data-stu-id="a73f0-160">It can be costly and time consuming to manage.</span></span> <span data-ttu-id="a73f0-161">最终可能会影响性能、表联接和引用完整性。</span><span class="sxs-lookup"><span data-stu-id="a73f0-161">It can end up impacting performance, table joins, and referential integrity.</span></span>

<span data-ttu-id="a73f0-162">如果数据副本在 "高度一致" 关系数据库群集中丢失网络连接，则无法写入数据库。</span><span class="sxs-lookup"><span data-stu-id="a73f0-162">If data replicas were to lose network connectivity in a "highly consistent" relational database cluster, you wouldn't be able to write to the database.</span></span> <span data-ttu-id="a73f0-163">系统将拒绝写入操作，因为它不能将更改复制到其他数据副本。</span><span class="sxs-lookup"><span data-stu-id="a73f0-163">The system would reject the write operation as it can't replicate that change to the other data replica.</span></span> <span data-ttu-id="a73f0-164">必须先更新每个数据副本，然后才能完成该事务。</span><span class="sxs-lookup"><span data-stu-id="a73f0-164">Every data replica has to update before the transaction can complete.</span></span>

<span data-ttu-id="a73f0-165">NoSQL 数据库通常支持高可用性和分区容差。</span><span class="sxs-lookup"><span data-stu-id="a73f0-165">NoSQL databases typically support high availability and partition tolerance.</span></span> <span data-ttu-id="a73f0-166">它们通常跨商用服务器横向扩展。</span><span class="sxs-lookup"><span data-stu-id="a73f0-166">They scale out horizontally, often across commodity servers.</span></span> <span data-ttu-id="a73f0-167">此方法在地理区域内和跨地理区域提供巨大的可用性，同时降低成本。</span><span class="sxs-lookup"><span data-stu-id="a73f0-167">This approach provides tremendous availability, both within and across geographical regions at a reduced cost.</span></span> <span data-ttu-id="a73f0-168">在这些计算机或节点上对数据进行分区和复制，提供冗余和容错能力。</span><span class="sxs-lookup"><span data-stu-id="a73f0-168">You partition and replicate data across these machines, or nodes, providing redundancy and fault tolerance.</span></span> <span data-ttu-id="a73f0-169">缺点是一致性。</span><span class="sxs-lookup"><span data-stu-id="a73f0-169">The downside is consistency.</span></span> <span data-ttu-id="a73f0-170">对一个 NoSQL 节点上的数据所做的更改可能需要一段时间才能传播到其他节点。</span><span class="sxs-lookup"><span data-stu-id="a73f0-170">A change to data on one NoSQL node can take some time to propagate to other nodes.</span></span> <span data-ttu-id="a73f0-171">通常，NoSQL 数据库节点会立即提供对查询的响应，即使显示的数据已过时并且尚未更新。</span><span class="sxs-lookup"><span data-stu-id="a73f0-171">Typically, a NoSQL database node will provide an immediate response to a query - even if the data that is presented is stale and hasn't updated yet.</span></span>

<span data-ttu-id="a73f0-172">如果数据副本在 "高度可用" NoSQL 数据库群集中丢失连接，你仍可以完成对数据库的写操作。</span><span class="sxs-lookup"><span data-stu-id="a73f0-172">If data replicas were to lose connectivity in a "highly available" NoSQL database cluster, you could still complete a write operation to the database.</span></span> <span data-ttu-id="a73f0-173">数据库群集将允许写入操作，并在数据副本可用时更新每个数据副本。</span><span class="sxs-lookup"><span data-stu-id="a73f0-173">The database cluster would allow the write operation and update each data replica as it becomes available.</span></span>

<span data-ttu-id="a73f0-174">这种结果称为最终一致性，即不支持 ACID 事务的分布式数据系统的特征。</span><span class="sxs-lookup"><span data-stu-id="a73f0-174">This kind of result is known as eventual consistency, a characteristic of distributed data systems where ACID transactions aren't supported.</span></span> <span data-ttu-id="a73f0-175">在更新数据项目和将更新传播到每个副本节点所用的时间之间，会有短暂的延迟。</span><span class="sxs-lookup"><span data-stu-id="a73f0-175">It's a brief delay between the update of a data item and time that it takes to propagate that update to each of the replica nodes.</span></span> <span data-ttu-id="a73f0-176">正常情况下，滞后时间通常较短，但当出现问题时可能会增加。</span><span class="sxs-lookup"><span data-stu-id="a73f0-176">Under normal conditions, the lag is typically short, but can increase when problems arise.</span></span> <span data-ttu-id="a73f0-177">例如，如果要更新美国中的 NoSQL 数据库中的产品项，并从欧洲的副本节点中查询同一数据项，会发生什么情况呢？</span><span class="sxs-lookup"><span data-stu-id="a73f0-177">For example, what would happen if you were to update a product item in a NoSQL database in the United States and query that same data item from a replica node in Europe?</span></span> <span data-ttu-id="a73f0-178">在群集用产品更改更新欧盟节点之前，您会收到以前的产品信息。</span><span class="sxs-lookup"><span data-stu-id="a73f0-178">You would receive the earlier product information, until the cluster updates the European node with the product change.</span></span> <span data-ttu-id="a73f0-179">通过立即返回查询结果而不是等待所有副本节点进行更新，可以获得巨大的规模和量，但可能会显示较旧的数据。</span><span class="sxs-lookup"><span data-stu-id="a73f0-179">By immediately returning a query result and not waiting for all replica nodes to update, you gain enormous scale and volume, but with the possibility of presenting older data.</span></span>

<span data-ttu-id="a73f0-180">高可用性和巨大的可伸缩性通常比强一致性更为重要。</span><span class="sxs-lookup"><span data-stu-id="a73f0-180">High availability and massive scalability are often more critical to the business than strong consistency.</span></span> <span data-ttu-id="a73f0-181">开发人员可以实现多种方法和模式，如 Sagas、CQRS 和异步消息传递，以实现最终一致性。</span><span class="sxs-lookup"><span data-stu-id="a73f0-181">Developers can implement techniques and patterns such as Sagas, CQRS, and asynchronous messaging to embrace eventual consistency.</span></span>

> <span data-ttu-id="a73f0-182">如今，在考虑 CAP 定理约束时必须小心谨慎。</span><span class="sxs-lookup"><span data-stu-id="a73f0-182">Nowadays, care must be taken when considering the CAP theorem constraints.</span></span> <span data-ttu-id="a73f0-183">新类型的数据库（称为 NewSQL）已发生，它扩展了关系数据库引擎，以支持 NoSQL 系统的水平可扩展性和可缩放的性能。</span><span class="sxs-lookup"><span data-stu-id="a73f0-183">A new type of database, called NewSQL, has emerged which extends the relational database engine to support both horizontal scalability and the scalable performance of NoSQL systems.</span></span>

## <a name="considerations-for-relational-vs-nosql-systems"></a><span data-ttu-id="a73f0-184">关系与 NoSQL 系统的注意事项</span><span class="sxs-lookup"><span data-stu-id="a73f0-184">Considerations for relational vs. NoSQL systems</span></span>

<span data-ttu-id="a73f0-185">基于特定的数据要求，基于云的本机微服务可以实现关系、NoSQL 数据存储或两者。</span><span class="sxs-lookup"><span data-stu-id="a73f0-185">Based upon specific data requirements, a cloud-native-based microservice can implement a relational, NoSQL datastore or both.</span></span>

|  <span data-ttu-id="a73f0-186">在以下情况时，请考虑 NoSQL 数据存储：</span><span class="sxs-lookup"><span data-stu-id="a73f0-186">Consider a NoSQL datastore when:</span></span> | <span data-ttu-id="a73f0-187">在以下情况时，请考虑关系数据库：</span><span class="sxs-lookup"><span data-stu-id="a73f0-187">Consider a relational database when:</span></span> |
| :-------- | :-------- |
| <span data-ttu-id="a73f0-188">具有大量需要大规模的工作负荷</span><span class="sxs-lookup"><span data-stu-id="a73f0-188">You have high volume workloads that require large scale</span></span> | <span data-ttu-id="a73f0-189">工作负荷量一致，需要大中型</span><span class="sxs-lookup"><span data-stu-id="a73f0-189">Your workload volume is consistent and requires medium to large scale</span></span> |
| <span data-ttu-id="a73f0-190">工作负载不需要 ACID 保证</span><span class="sxs-lookup"><span data-stu-id="a73f0-190">Your workloads don't require ACID guarantees</span></span> |  <span data-ttu-id="a73f0-191">需要 ACID 保障</span><span class="sxs-lookup"><span data-stu-id="a73f0-191">ACID guarantees are required</span></span> |
| <span data-ttu-id="a73f0-192">你的数据是动态的，并且经常更改</span><span class="sxs-lookup"><span data-stu-id="a73f0-192">Your data is dynamic and frequently changes</span></span> | <span data-ttu-id="a73f0-193">你的数据是可预测的且具有高结构</span><span class="sxs-lookup"><span data-stu-id="a73f0-193">Your data is predictable and highly structured</span></span> |
| <span data-ttu-id="a73f0-194">无需关系即可表达数据</span><span class="sxs-lookup"><span data-stu-id="a73f0-194">Data can be expressed without relationships</span></span> | <span data-ttu-id="a73f0-195">最 relationally 的数据</span><span class="sxs-lookup"><span data-stu-id="a73f0-195">Data is best expressed relationally</span></span> |  
| <span data-ttu-id="a73f0-196">你需要快速写入并且写入安全并不重要</span><span class="sxs-lookup"><span data-stu-id="a73f0-196">You need fast writes and write safety isn't critical</span></span> | <span data-ttu-id="a73f0-197">需要编写安全</span><span class="sxs-lookup"><span data-stu-id="a73f0-197">Write safety is a requirement</span></span> |  
| <span data-ttu-id="a73f0-198">数据检索很简单，往往是平面的</span><span class="sxs-lookup"><span data-stu-id="a73f0-198">Data retrieval is simple and tends to be flat</span></span> | <span data-ttu-id="a73f0-199">使用复杂的查询和报表</span><span class="sxs-lookup"><span data-stu-id="a73f0-199">You work with complex queries and reports</span></span>|
| <span data-ttu-id="a73f0-200">你的数据需要广泛的地理分布</span><span class="sxs-lookup"><span data-stu-id="a73f0-200">Your data requires a wide geographic distribution</span></span> | <span data-ttu-id="a73f0-201">用户是更集中的</span><span class="sxs-lookup"><span data-stu-id="a73f0-201">Your users are more centralized</span></span> |
| <span data-ttu-id="a73f0-202">你的应用程序将部署到商用硬件上，如公有云</span><span class="sxs-lookup"><span data-stu-id="a73f0-202">Your application will be deployed to commodity hardware, such as with public clouds</span></span> | <span data-ttu-id="a73f0-203">你的应用程序将部署到大型高端硬件</span><span class="sxs-lookup"><span data-stu-id="a73f0-203">Your application will be deployed to large, high-end hardware</span></span> |

<span data-ttu-id="a73f0-204">在接下来的部分中，我们将探讨 Azure 云中提供的用于存储和管理云本机数据的选项。</span><span class="sxs-lookup"><span data-stu-id="a73f0-204">In the next sections, we'll explore the options available in the Azure cloud for storing and managing your cloud-native data.</span></span>

## <a name="database-as-a-service"></a><span data-ttu-id="a73f0-205">数据库即服务</span><span class="sxs-lookup"><span data-stu-id="a73f0-205">Database as a Service</span></span>

<span data-ttu-id="a73f0-206">若要开始，可以预配 Azure 虚拟机，并为每个服务安装所选数据库。</span><span class="sxs-lookup"><span data-stu-id="a73f0-206">To start, you could provision an Azure virtual machine and install your database of choice for each service.</span></span> <span data-ttu-id="a73f0-207">尽管对环境具有完全控制，但放弃云平台的许多内置功能。</span><span class="sxs-lookup"><span data-stu-id="a73f0-207">While you'd have full control over the environment, you'd forgo many built-in features of the cloud platform.</span></span> <span data-ttu-id="a73f0-208">你还负责管理每个服务的虚拟机和数据库。</span><span class="sxs-lookup"><span data-stu-id="a73f0-208">You'd also be responsible for managing the virtual machine and database for each service.</span></span> <span data-ttu-id="a73f0-209">这种方法很快就会变得非常耗时和昂贵。</span><span class="sxs-lookup"><span data-stu-id="a73f0-209">This approach could quickly become time-consuming and expensive.</span></span>

<span data-ttu-id="a73f0-210">取而代之的是，云本机应用程序倾向于以数据库即服务形式公开的数据服务 [ (DBaaS) ](https://www.stratoscale.com/blog/dbaas/what-is-database-as-a-service/)。</span><span class="sxs-lookup"><span data-stu-id="a73f0-210">Instead, cloud-native applications favor data services exposed as a [Database as a Service (DBaaS)](https://www.stratoscale.com/blog/dbaas/what-is-database-as-a-service/).</span></span> <span data-ttu-id="a73f0-211">这些服务由云供应商完全托管，提供内置的安全性、可伸缩性和监视。</span><span class="sxs-lookup"><span data-stu-id="a73f0-211">Fully managed by a cloud vendor, these services provide built-in security, scalability, and monitoring.</span></span> <span data-ttu-id="a73f0-212">只需将其用作 [后备服务](./definition.md#backing-services)，而不是拥有该服务。</span><span class="sxs-lookup"><span data-stu-id="a73f0-212">Instead of owning the service, you simply consume it as a [backing service](./definition.md#backing-services).</span></span> <span data-ttu-id="a73f0-213">提供程序以大规模方式操作资源，并承担性能和维护责任。</span><span class="sxs-lookup"><span data-stu-id="a73f0-213">The provider operates the resource at scale and bears the responsibility for performance and maintenance.</span></span>

<span data-ttu-id="a73f0-214">可以跨云可用性区域和区域对其进行配置，以实现高可用性。</span><span class="sxs-lookup"><span data-stu-id="a73f0-214">They can be configured across cloud availability zones and regions to achieve high availability.</span></span> <span data-ttu-id="a73f0-215">它们都支持实时容量和即用即付模型。</span><span class="sxs-lookup"><span data-stu-id="a73f0-215">They all support just-in-time capacity and a pay-as-you-go model.</span></span> <span data-ttu-id="a73f0-216">Azure 具有不同类型的托管数据服务选项，每个选项都有特定的优点。</span><span class="sxs-lookup"><span data-stu-id="a73f0-216">Azure features different kinds of managed data service options, each with specific benefits.</span></span>

<span data-ttu-id="a73f0-217">首先，我们将了解 Azure 中提供的关系 DBaaS 服务。</span><span class="sxs-lookup"><span data-stu-id="a73f0-217">We'll first look at relational DBaaS services available in Azure.</span></span> <span data-ttu-id="a73f0-218">你将看到，Microsoft 的旗舰 SQL Server 数据库与多个开源选项一起提供。</span><span class="sxs-lookup"><span data-stu-id="a73f0-218">You'll see that Microsoft's flagship SQL Server database is available along with several open-source options.</span></span> <span data-ttu-id="a73f0-219">接下来，我们将讨论 Azure 中的 NoSQL 数据服务。</span><span class="sxs-lookup"><span data-stu-id="a73f0-219">Then, we'll talk about the NoSQL data services in Azure.</span></span>

## <a name="azure-relational-databases"></a><span data-ttu-id="a73f0-220">Azure 关系数据库</span><span class="sxs-lookup"><span data-stu-id="a73f0-220">Azure relational databases</span></span>

<span data-ttu-id="a73f0-221">对于需要关系数据的云本地微服务，Azure 提供了四个托管的关系数据库即服务 (DBaaS) 产品/服务，如图5-11 所示。</span><span class="sxs-lookup"><span data-stu-id="a73f0-221">For cloud-native microservices that require relational data, Azure offers four managed relational databases as a service (DBaaS) offerings, shown in Figure 5-11.</span></span>

![Azure 中的托管关系数据库](./media/azure-managed-databases.png)

<span data-ttu-id="a73f0-223">**图 5-11**。</span><span class="sxs-lookup"><span data-stu-id="a73f0-223">**Figure 5-11**.</span></span> <span data-ttu-id="a73f0-224">Azure 中提供的托管关系数据库</span><span class="sxs-lookup"><span data-stu-id="a73f0-224">Managed relational databases available in Azure</span></span>

<span data-ttu-id="a73f0-225">在上图中，请注意每个 DBaaS 基础结构的功能，该基础结构具有关键功能，无需额外付费。</span><span class="sxs-lookup"><span data-stu-id="a73f0-225">In the previous figure, note how each sits upon a common DBaaS infrastructure which features key capabilities at no additional cost.</span></span>

<span data-ttu-id="a73f0-226">这些功能对于预配大量数据库的组织尤其重要，但对于管理这些数据库的资源有限。</span><span class="sxs-lookup"><span data-stu-id="a73f0-226">These features are especially important to organizations who provision large numbers of databases, but have limited resources to administer them.</span></span>
<span data-ttu-id="a73f0-227">通过选择处理核心、内存和基础存储量，你可以在数分钟内预配 Azure 数据库。</span><span class="sxs-lookup"><span data-stu-id="a73f0-227">You can provision an Azure database in minutes by selecting the amount of processing cores, memory, and underlying storage.</span></span> <span data-ttu-id="a73f0-228">你可以动态缩放数据库，并动态调整资源，只需很少的停机时间。</span><span class="sxs-lookup"><span data-stu-id="a73f0-228">You can scale the database on-the-fly and dynamically adjust resources with little to no downtime.</span></span>

## <a name="azure-sql-database"></a><span data-ttu-id="a73f0-229">Azure SQL 数据库</span><span class="sxs-lookup"><span data-stu-id="a73f0-229">Azure SQL Database</span></span>

<span data-ttu-id="a73f0-230">Microsoft SQL Server 的专业技能的开发团队应考虑 [AZURE SQL 数据库](/azure/sql-database/)。</span><span class="sxs-lookup"><span data-stu-id="a73f0-230">Development teams with expertise in Microsoft SQL Server should consider [Azure SQL Database](/azure/sql-database/).</span></span> <span data-ttu-id="a73f0-231">这是一种完全托管的关系数据库即服务 (DBaaS) 基于 Microsoft SQL Server 的数据库引擎。</span><span class="sxs-lookup"><span data-stu-id="a73f0-231">It's a fully managed relational database-as-a-service (DBaaS) based on the Microsoft SQL Server Database Engine.</span></span> <span data-ttu-id="a73f0-232">该服务共享 SQL Server 的本地版本中发现的许多功能，并运行 SQL Server 数据库引擎的最新稳定版本。</span><span class="sxs-lookup"><span data-stu-id="a73f0-232">The service shares many features found in the on-premises version of SQL Server and runs the latest stable version of the SQL Server Database Engine.</span></span>

<span data-ttu-id="a73f0-233">若要与云本机微服务一起使用，可通过三种部署选项使用 Azure SQL 数据库：</span><span class="sxs-lookup"><span data-stu-id="a73f0-233">For use with a cloud-native microservice, Azure SQL Database is available with three deployment options:</span></span>

- <span data-ttu-id="a73f0-234">单一数据库表示在 Azure 云中的 [AZURE SQL 数据库服务器](/azure/sql-database/sql-database-servers) 上运行的完全托管的 sql 数据库。</span><span class="sxs-lookup"><span data-stu-id="a73f0-234">A Single Database represents a fully managed SQL Database running on an [Azure SQL Database server](/azure/sql-database/sql-database-servers) in the Azure cloud.</span></span> <span data-ttu-id="a73f0-235">该数据库被视为 [*包含*](/sql/relational-databases/databases/contained-databases) ，因为它在基础数据库服务器上没有配置依赖关系。</span><span class="sxs-lookup"><span data-stu-id="a73f0-235">The database is considered [*contained*](/sql/relational-databases/databases/contained-databases) as it has no configuration dependencies on the underlying database server.</span></span>
  
- <span data-ttu-id="a73f0-236">[托管实例](/azure/sql-database/sql-database-managed-instance)是 Microsoft SQL Server 数据库引擎的完全托管实例，提供与本地 SQL Server 近乎100% 的兼容性。</span><span class="sxs-lookup"><span data-stu-id="a73f0-236">A [Managed Instance](/azure/sql-database/sql-database-managed-instance) is a fully managed instance of the Microsoft SQL Server Database Engine that provides near-100% compatibility with an on-premises SQL Server.</span></span> <span data-ttu-id="a73f0-237">此选项支持较大的数据库，最大可达 35 TB，并将其放在 [Azure 虚拟网络](/azure/virtual-network/virtual-networks-overview) 中，以便更好地进行隔离。</span><span class="sxs-lookup"><span data-stu-id="a73f0-237">This option supports larger databases, up to 35 TB and is placed in an [Azure Virtual Network](/azure/virtual-network/virtual-networks-overview) for better isolation.</span></span>

- <span data-ttu-id="a73f0-238">[AZURE SQL 数据库无服务器](/azure/sql-database/sql-database-serverless) 是单个数据库的计算层，可根据工作负荷需求自动缩放。</span><span class="sxs-lookup"><span data-stu-id="a73f0-238">[Azure SQL Database serverless](/azure/sql-database/sql-database-serverless) is a compute tier for a single database that automatically scales based on workload demand.</span></span> <span data-ttu-id="a73f0-239">它仅计费每秒使用的计算量。</span><span class="sxs-lookup"><span data-stu-id="a73f0-239">It bills only for the amount of compute used per second.</span></span> <span data-ttu-id="a73f0-240">该服务非常适用于具有间歇、不可预测的使用模式的工作负荷，并与不活动状态发生了一段时间。</span><span class="sxs-lookup"><span data-stu-id="a73f0-240">The service is well suited for workloads with intermittent, unpredictable usage patterns, interspersed with periods of inactivity.</span></span> <span data-ttu-id="a73f0-241">无服务器计算层还会在非活动期间自动暂停数据库，以便只对存储费用收费。</span><span class="sxs-lookup"><span data-stu-id="a73f0-241">The serverless compute tier also automatically pauses databases during inactive periods so that only storage charges are billed.</span></span> <span data-ttu-id="a73f0-242">当活动返回时，它将自动恢复。</span><span class="sxs-lookup"><span data-stu-id="a73f0-242">It automatically resumes when activity returns.</span></span>

<span data-ttu-id="a73f0-243">除了传统的 Microsoft SQL Server 堆栈以外，Azure 还提供三个常用开源数据库的托管版本。</span><span class="sxs-lookup"><span data-stu-id="a73f0-243">Beyond the traditional Microsoft SQL Server stack, Azure also features managed versions of three popular open-source databases.</span></span>

## <a name="open-source-databases-in-azure"></a><span data-ttu-id="a73f0-244">Azure 中的开源数据库</span><span class="sxs-lookup"><span data-stu-id="a73f0-244">Open-source databases in Azure</span></span>

<span data-ttu-id="a73f0-245">开源关系数据库已成为云本机应用程序的常用选择。</span><span class="sxs-lookup"><span data-stu-id="a73f0-245">Open-source relational databases have become a popular choice for cloud-native applications.</span></span> <span data-ttu-id="a73f0-246">许多企业都倾向于通过商业数据库产品，尤其是为了节省成本。</span><span class="sxs-lookup"><span data-stu-id="a73f0-246">Many enterprises favor them over commercial database products, especially for cost savings.</span></span> <span data-ttu-id="a73f0-247">许多开发团队喜欢其灵活性、支持社区的开发以及工具和扩展的生态系统。</span><span class="sxs-lookup"><span data-stu-id="a73f0-247">Many development teams enjoy their flexibility, community-backed development, and ecosystem of tools and extensions.</span></span> <span data-ttu-id="a73f0-248">开源数据库可以跨多个云提供商进行部署，有助于最大程度地减少 "供应商锁定" 这一问题。</span><span class="sxs-lookup"><span data-stu-id="a73f0-248">Open-source databases can be deployed across multiple cloud providers, helping minimize the concern of "vendor lock-in."</span></span>

<span data-ttu-id="a73f0-249">开发人员可以轻松地在 Azure VM 上自行托管任何开放源代码数据库。</span><span class="sxs-lookup"><span data-stu-id="a73f0-249">Developers can easily self-host any open-source database on an Azure VM.</span></span> <span data-ttu-id="a73f0-250">尽管提供完全控制，但这种方法可让你了解如何管理、监视和维护数据库和 VM。</span><span class="sxs-lookup"><span data-stu-id="a73f0-250">While providing full control, this approach puts you on the hook for the management, monitoring, and maintenance of the database and VM.</span></span>

<span data-ttu-id="a73f0-251">但是，Microsoft 通过提供几个常用的开源数据库作为 *完全托管* 的 DBaaS 服务，继续致力于使 Azure 成为 "开放平台"。</span><span class="sxs-lookup"><span data-stu-id="a73f0-251">However, Microsoft continues its commitment to keeping Azure an “open platform” by offering several popular open-source databases as *fully managed* DBaaS services.</span></span>

### <a name="azure-database-for-mysql"></a><span data-ttu-id="a73f0-252">Azure Database for MySQL</span><span class="sxs-lookup"><span data-stu-id="a73f0-252">Azure Database for MySQL</span></span>

<span data-ttu-id="a73f0-253">[MySQL](https://en.wikipedia.org/wiki/MySQL) 是一种开源关系数据库，是针对 [灯泡软件堆栈](https://en.wikipedia.org/wiki/LAMP_(software_bundle))构建的应用程序的支柱。</span><span class="sxs-lookup"><span data-stu-id="a73f0-253">[MySQL](https://en.wikipedia.org/wiki/MySQL) is an open-source relational database and a pillar for applications built on the [LAMP software stack](https://en.wikipedia.org/wiki/LAMP_(software_bundle)).</span></span> <span data-ttu-id="a73f0-254">广泛地选择用于 *读取繁重* 的工作负荷，许多大型组织（包括 Facebook、Twitter 和 YouTube）都将使用它。</span><span class="sxs-lookup"><span data-stu-id="a73f0-254">Widely chosen for *read heavy* workloads, it's used by many large organizations, including Facebook, Twitter, and YouTube.</span></span> <span data-ttu-id="a73f0-255">社区版免费提供，而 enterprise edition 需要购买许可证。</span><span class="sxs-lookup"><span data-stu-id="a73f0-255">The community edition is available for free, while the enterprise edition requires a license purchase.</span></span> <span data-ttu-id="a73f0-256">最初在1995中创建，该产品由的 Sun 2008 Microsystems 购买。</span><span class="sxs-lookup"><span data-stu-id="a73f0-256">Originally created in 1995, the product was purchased by Sun Microsystems in 2008.</span></span> <span data-ttu-id="a73f0-257">Oracle 在2010中获取 Sun 和 MySQL。</span><span class="sxs-lookup"><span data-stu-id="a73f0-257">Oracle acquired Sun and MySQL in 2010.</span></span>

<span data-ttu-id="a73f0-258">[Azure Database for MySQL](https://azure.microsoft.com/services/mysql/) 是基于开源 MySQL Server 引擎的托管关系数据库服务。</span><span class="sxs-lookup"><span data-stu-id="a73f0-258">[Azure Database for MySQL](https://azure.microsoft.com/services/mysql/) is a managed relational database service based on the open-source MySQL Server engine.</span></span> <span data-ttu-id="a73f0-259">它使用 MySQL 社区版。</span><span class="sxs-lookup"><span data-stu-id="a73f0-259">It uses the MySQL Community edition.</span></span> <span data-ttu-id="a73f0-260">Azure MySQL 服务器是服务的管理点。</span><span class="sxs-lookup"><span data-stu-id="a73f0-260">The Azure MySQL server is the administrative point for the service.</span></span> <span data-ttu-id="a73f0-261">它是用于本地部署的相同 MySQL 服务器引擎。</span><span class="sxs-lookup"><span data-stu-id="a73f0-261">It's the same MySQL server engine used for on-premises deployments.</span></span> <span data-ttu-id="a73f0-262">引擎可以为每个服务器创建一个数据库，也可以为每个共享资源的服务器创建多个数据库。</span><span class="sxs-lookup"><span data-stu-id="a73f0-262">The engine can create a single database per server or multiple databases per server that share resources.</span></span> <span data-ttu-id="a73f0-263">您可以使用相同的开源工具继续管理数据，而不必学习新技能或管理虚拟机。</span><span class="sxs-lookup"><span data-stu-id="a73f0-263">You can continue to manage data using the same open-source tools without having to learn new skills or manage virtual machines.</span></span>

### <a name="azure-database-for-mariadb"></a><span data-ttu-id="a73f0-264">Azure Database for MariaDB</span><span class="sxs-lookup"><span data-stu-id="a73f0-264">Azure Database for MariaDB</span></span>

<span data-ttu-id="a73f0-265">[MariaDB](https://mariadb.com/) 服务器是另一个受欢迎的开源数据库服务器。</span><span class="sxs-lookup"><span data-stu-id="a73f0-265">[MariaDB](https://mariadb.com/) Server is another popular open-source database server.</span></span> <span data-ttu-id="a73f0-266">当 Oracle 购买 Sun Microsystems （拥有 MySQL）时，它是 MySQL 的 *分叉* 。</span><span class="sxs-lookup"><span data-stu-id="a73f0-266">It was created as a *fork* of MySQL when Oracle purchased Sun Microsystems, who owned MySQL.</span></span> <span data-ttu-id="a73f0-267">目的是确保 MariaDB 保持开源。</span><span class="sxs-lookup"><span data-stu-id="a73f0-267">The intent was to ensure that MariaDB remained open-source.</span></span> <span data-ttu-id="a73f0-268">由于 MariaDB 是 MySQL 的分叉，数据和表定义是兼容的，客户端协议、结构和 Api 是编织的。</span><span class="sxs-lookup"><span data-stu-id="a73f0-268">As MariaDB is a fork of MySQL, the data and table definitions are compatible, and the client protocols, structures, and APIs, are close-knit.</span></span>

<span data-ttu-id="a73f0-269">MariaDB 具有强大的社区，由许多大型企业使用。</span><span class="sxs-lookup"><span data-stu-id="a73f0-269">MariaDB has a strong community and is used by many large enterprises.</span></span> <span data-ttu-id="a73f0-270">尽管 Oracle 继续维护、增强和支持 MySQL，但 MariaDB foundation 管理 MariaDB，允许对产品和文档进行公开贡献。</span><span class="sxs-lookup"><span data-stu-id="a73f0-270">While Oracle continues to maintain, enhance, and support MySQL, the MariaDB foundation manages MariaDB, allowing public contributions to the product and documentation.</span></span>

<span data-ttu-id="a73f0-271">[Azure Database for MariaDB](https://azure.microsoft.com/services/mariadb/) 是 Azure 云中完全托管的关系数据库即服务。</span><span class="sxs-lookup"><span data-stu-id="a73f0-271">[Azure Database for MariaDB](https://azure.microsoft.com/services/mariadb/) is a fully managed relational database as a service in the Azure cloud.</span></span> <span data-ttu-id="a73f0-272">此服务基于 MariaDB 社区版服务器引擎。</span><span class="sxs-lookup"><span data-stu-id="a73f0-272">The service is based on the MariaDB community edition server engine.</span></span> <span data-ttu-id="a73f0-273">它可以处理具有可预测性能和动态可伸缩性的任务关键型工作负荷。</span><span class="sxs-lookup"><span data-stu-id="a73f0-273">It can handle mission-critical workloads with predictable performance and dynamic scalability.</span></span>

### <a name="azure-database-for-postgresql"></a><span data-ttu-id="a73f0-274">Azure Database for PostgreSQL</span><span class="sxs-lookup"><span data-stu-id="a73f0-274">Azure Database for PostgreSQL</span></span>

<span data-ttu-id="a73f0-275">[PostgreSQL](https://www.postgresql.org/) 是一种开源关系数据库，其活动开发超过30年。</span><span class="sxs-lookup"><span data-stu-id="a73f0-275">[PostgreSQL](https://www.postgresql.org/) is an open-source relational database with over 30 years of active development.</span></span> <span data-ttu-id="a73f0-276">PostgresSQL 具有可靠性和数据完整性的强大信誉。</span><span class="sxs-lookup"><span data-stu-id="a73f0-276">PostgresSQL has a strong reputation for reliability and data integrity.</span></span> <span data-ttu-id="a73f0-277">它的功能丰富、兼容 SQL 并且被视为比 MySQL 更高的性能，尤其适用于具有复杂查询和繁重写入的工作负荷。</span><span class="sxs-lookup"><span data-stu-id="a73f0-277">It’s feature rich, SQL compliant, and considered more performant than MySQL - especially for workloads with complex queries and heavy writes.</span></span> <span data-ttu-id="a73f0-278">许多大型企业（包括 Apple、Red Hat 和 Fujitsu）都使用 PostgreSQL 构建了产品。</span><span class="sxs-lookup"><span data-stu-id="a73f0-278">Many large enterprises including Apple, Red Hat, and Fujitsu have built products using PostgreSQL.</span></span>

<span data-ttu-id="a73f0-279">[Azure Database for PostgreSQL](https://azure.microsoft.com/services/postgresql/) 是一项完全托管的关系数据库服务，它基于开源 Postgres 数据库引擎。</span><span class="sxs-lookup"><span data-stu-id="a73f0-279">[Azure Database for PostgreSQL](https://azure.microsoft.com/services/postgresql/) is a fully managed relational database service, based on the open-source Postgres database engine.</span></span> <span data-ttu-id="a73f0-280">该服务支持许多开发平台，包括 c + +、Java、Python、Node、C \# 和 PHP。</span><span class="sxs-lookup"><span data-stu-id="a73f0-280">The service supports many development platforms, including C++, Java, Python, Node, C\#, and PHP.</span></span> <span data-ttu-id="a73f0-281">你可以使用 [命令行接口](https://datamigration.microsoft.com/scenario/postgresql-to-azurepostgresql?step=1) 工具或 Azure 数据迁移服务将 PostgreSQL 数据库迁移到它。</span><span class="sxs-lookup"><span data-stu-id="a73f0-281">You can migrate PostgreSQL databases to it using the [command-line interface](https://datamigration.microsoft.com/scenario/postgresql-to-azurepostgresql?step=1) tool or Azure Data Migration Service.</span></span>

<span data-ttu-id="a73f0-282">Azure Database for PostgreSQL 提供了两个部署选项：</span><span class="sxs-lookup"><span data-stu-id="a73f0-282">Azure Database for PostgreSQL is available with two deployment options:</span></span>

- <span data-ttu-id="a73f0-283">[单服务器](/azure/postgresql/concepts-servers)部署选项是多个数据库的中心管理点，你可以将多个数据库部署到这些数据库中。</span><span class="sxs-lookup"><span data-stu-id="a73f0-283">The [Single Server](/azure/postgresql/concepts-servers) deployment option is a central administrative point for multiple databases to which you can deploy many databases.</span></span> <span data-ttu-id="a73f0-284">根据内核和存储，定价按服务器进行组织。</span><span class="sxs-lookup"><span data-stu-id="a73f0-284">The pricing is structured per-server based upon cores and storage.</span></span>

- <span data-ttu-id="a73f0-285">[超大规模 (Citus) 选项](https://azure.microsoft.com/blog/get-high-performance-scaling-for-your-azure-database-workloads-with-hyperscale/)由 Citus 数据技术提供支持。</span><span class="sxs-lookup"><span data-stu-id="a73f0-285">The [Hyperscale (Citus) option](https://azure.microsoft.com/blog/get-high-performance-scaling-for-your-azure-database-workloads-with-hyperscale/) is powered by Citus Data technology.</span></span> <span data-ttu-id="a73f0-286">它通过 *水平缩放* 数百个节点上的单个数据库来实现高性能，从而提供更快的性能和规模。</span><span class="sxs-lookup"><span data-stu-id="a73f0-286">It enables high performance by *horizontally scaling* a single database across hundreds of nodes to deliver fast performance and scale.</span></span> <span data-ttu-id="a73f0-287">此选项允许引擎在内存中容纳更多数据、跨数百个节点进行并行化查询，并更快地为数据编制索引。</span><span class="sxs-lookup"><span data-stu-id="a73f0-287">This option allows the engine to fit more data in memory, parallelize queries across hundreds of nodes, and index data faster.</span></span>

## <a name="nosql-data-in-azure"></a><span data-ttu-id="a73f0-288">Azure 中的 NoSQL 数据</span><span class="sxs-lookup"><span data-stu-id="a73f0-288">NoSQL data in Azure</span></span>

<span data-ttu-id="a73f0-289">Cosmos DB 是 Azure 云中完全托管的全球分布式 NoSQL 数据库服务。</span><span class="sxs-lookup"><span data-stu-id="a73f0-289">Cosmos DB is a fully managed, globally distributed NoSQL database service in the Azure cloud.</span></span> <span data-ttu-id="a73f0-290">它已由世界各地的许多大型公司采用，包括可口可乐-可乐配方、Skype、ExxonMobil 和自由双向企业。</span><span class="sxs-lookup"><span data-stu-id="a73f0-290">It has been adopted by many large companies across the world,  including Coca-Cola, Skype, ExxonMobil, and Liberty Mutual.</span></span>

<span data-ttu-id="a73f0-291">如果你的服务需要从世界上的任何地方快速响应，则 Cosmos DB 是一个不错的选择。</span><span class="sxs-lookup"><span data-stu-id="a73f0-291">If your services require fast response from anywhere in the world, high availability, or elastic scalability, Cosmos DB is a great choice.</span></span> <span data-ttu-id="a73f0-292">图5-12 显示 Cosmos DB。</span><span class="sxs-lookup"><span data-stu-id="a73f0-292">Figure 5-12 shows Cosmos DB.</span></span>

![Cosmos DB 概述](./media/cosmos-db-overview.png)

<span data-ttu-id="a73f0-294">**图 5-12**： Cosmos DB 概述</span><span class="sxs-lookup"><span data-stu-id="a73f0-294">**Figure 5-12**: Overview of Cosmos DB</span></span>

<span data-ttu-id="a73f0-295">上图显示了 Cosmos DB 中提供的许多内置云本机功能。</span><span class="sxs-lookup"><span data-stu-id="a73f0-295">The previous figure presents many of the built-in cloud-native capabilities available in Cosmos DB.</span></span> <span data-ttu-id="a73f0-296">在本部分中，我们将详细介绍它们。</span><span class="sxs-lookup"><span data-stu-id="a73f0-296">In this section, we’ll take a closer look at them.</span></span>

### <a name="global-support"></a><span data-ttu-id="a73f0-297">全球支持</span><span class="sxs-lookup"><span data-stu-id="a73f0-297">Global support</span></span>

<span data-ttu-id="a73f0-298">云本机应用程序通常具有全球性受众，并需要全局规模。</span><span class="sxs-lookup"><span data-stu-id="a73f0-298">Cloud-native applications often have a global audience and require global scale.</span></span>

<span data-ttu-id="a73f0-299">您可以在区域之间或世界各地分布 Cosmos 数据库，将数据放置到用户附近，缩短响应时间并减少延迟。</span><span class="sxs-lookup"><span data-stu-id="a73f0-299">You can distribute Cosmos databases across regions or around the world, placing data close to your users, improving response time, and reducing latency.</span></span> <span data-ttu-id="a73f0-300">无需暂停或重新部署服务，即可在区域中添加或删除数据库。</span><span class="sxs-lookup"><span data-stu-id="a73f0-300">You can add or remove a database from a region without pausing or redeploying your services.</span></span> <span data-ttu-id="a73f0-301">在后台，Cosmos DB 以透明方式将数据复制到每个已配置的区域。</span><span class="sxs-lookup"><span data-stu-id="a73f0-301">In the background, Cosmos DB transparently replicates the data to each of the configured regions.</span></span>

<span data-ttu-id="a73f0-302">Cosmos DB 支持全局级别的 [主动/主动](https://kemptechnologies.com/white-papers/unfog-confusion-active-passive-activeactive-load-balancing/) 群集，使你能够配置任何数据库区域以支持 *写入和读取*。</span><span class="sxs-lookup"><span data-stu-id="a73f0-302">Cosmos DB supports [active/active](https://kemptechnologies.com/white-papers/unfog-confusion-active-passive-activeactive-load-balancing/) clustering at the global level, enabling you to configure any of your database regions to support *both writes and reads*.</span></span>

<span data-ttu-id="a73f0-303">[多主机](/azure/cosmos-db/multi-master-benefits)协议是 Cosmos DB 中的一项重要功能，可实现以下功能：</span><span class="sxs-lookup"><span data-stu-id="a73f0-303">The [Multi-Master](/azure/cosmos-db/multi-master-benefits) protocol is an important feature in Cosmos DB that enables the following functionality:</span></span>

- <span data-ttu-id="a73f0-304">无限弹性写入和读取可伸缩性。</span><span class="sxs-lookup"><span data-stu-id="a73f0-304">Unlimited elastic write and read scalability.</span></span>

- <span data-ttu-id="a73f0-305">在全球 99.999% 的读写可用性。</span><span class="sxs-lookup"><span data-stu-id="a73f0-305">99.999% read and write availability all around the world.</span></span>

- <span data-ttu-id="a73f0-306">在 99% 的时间内，在 10 毫秒内为读写提供服务。</span><span class="sxs-lookup"><span data-stu-id="a73f0-306">Guaranteed reads and writes served in less than 10 milliseconds at the 99th percentile.</span></span>

<span data-ttu-id="a73f0-307">利用 Cosmos DB [多宿主 api](/azure/cosmos-db/distribute-data-globally)，微服务会自动识别最近的 Azure 区域并向其发送请求。</span><span class="sxs-lookup"><span data-stu-id="a73f0-307">With the Cosmos DB [Multi-Homing APIs](/azure/cosmos-db/distribute-data-globally), your microservice is automatically aware of the nearest Azure region and sends requests to it.</span></span> <span data-ttu-id="a73f0-308">最近的区域由 Cosmos DB 标识，无需进行任何配置更改。</span><span class="sxs-lookup"><span data-stu-id="a73f0-308">The nearest region is identified by Cosmos DB without any configuration changes.</span></span> <span data-ttu-id="a73f0-309">如果某个区域变得不可用，则多宿主功能会自动将请求路由到下一个最近的可用区域。</span><span class="sxs-lookup"><span data-stu-id="a73f0-309">Should a region become unavailable, the Multi-Homing feature will automatically route requests to the next nearest available region.</span></span>

### <a name="multi-model-support"></a><span data-ttu-id="a73f0-310">多模型支持</span><span class="sxs-lookup"><span data-stu-id="a73f0-310">Multi-model support</span></span>

<span data-ttu-id="a73f0-311">将单一应用程序 replatforming 到云本机体系结构时，开发团队有时必须迁移开源的 NoSQL 数据存储。</span><span class="sxs-lookup"><span data-stu-id="a73f0-311">When replatforming monolithic applications to a cloud-native architecture, development teams sometimes have to migrate open-source, NoSQL data stores.</span></span> <span data-ttu-id="a73f0-312">Cosmos DB 可以帮助你在这些 NoSQL 数据存储中保留投资，并将其用于 *多模型* 数据平台。</span><span class="sxs-lookup"><span data-stu-id="a73f0-312">Cosmos DB can help you preserve your investment in these NoSQL datastores with its *multi-model* data platform.</span></span> <span data-ttu-id="a73f0-313">下表显示了支持的 NoSQL [兼容性 api](https://www.wikiwand.com/en/Cosmos_DB)。</span><span class="sxs-lookup"><span data-stu-id="a73f0-313">The following table shows the supported NoSQL [compatibility APIs](https://www.wikiwand.com/en/Cosmos_DB).</span></span>

| <span data-ttu-id="a73f0-314">提供程序</span><span class="sxs-lookup"><span data-stu-id="a73f0-314">Provider</span></span> | <span data-ttu-id="a73f0-315">描述</span><span class="sxs-lookup"><span data-stu-id="a73f0-315">Description</span></span>  |
| :-------- | :-------- |
| <span data-ttu-id="a73f0-316">SQL API</span><span class="sxs-lookup"><span data-stu-id="a73f0-316">SQL API</span></span> | <span data-ttu-id="a73f0-317">支持 JSON 文档和基于 SQL 的查询的专有 API</span><span class="sxs-lookup"><span data-stu-id="a73f0-317">Proprietary API that supports JSON documents and SQL-based queries</span></span> |
| <span data-ttu-id="a73f0-318">Mongo DB API</span><span class="sxs-lookup"><span data-stu-id="a73f0-318">Mongo DB API</span></span> | <span data-ttu-id="a73f0-319">支持 Mongo DB Api 和 JSON 文档</span><span class="sxs-lookup"><span data-stu-id="a73f0-319">Supports Mongo DB APIs and JSON documents</span></span>|
| <span data-ttu-id="a73f0-320">Gremlin API</span><span class="sxs-lookup"><span data-stu-id="a73f0-320">Gremlin API</span></span> | <span data-ttu-id="a73f0-321">支持具有基于图形的节点和边缘数据表示形式的 Gremlin API</span><span class="sxs-lookup"><span data-stu-id="a73f0-321">Supports Gremlin API with graph-based nodes and edge data representations</span></span> |
| <span data-ttu-id="a73f0-322">Cassandra API</span><span class="sxs-lookup"><span data-stu-id="a73f0-322">Cassandra API</span></span> | <span data-ttu-id="a73f0-323">支持用于宽列数据表示形式的 Casandra API</span><span class="sxs-lookup"><span data-stu-id="a73f0-323">Supports Casandra API for wide-column data representations</span></span> |  
| <span data-ttu-id="a73f0-324">表 API</span><span class="sxs-lookup"><span data-stu-id="a73f0-324">Table API</span></span>  | <span data-ttu-id="a73f0-325">支持具有高级增强功能的 Azure 表存储</span><span class="sxs-lookup"><span data-stu-id="a73f0-325">Supports Azure Table Storage with premium enhancements</span></span> |  
| <span data-ttu-id="a73f0-326">etcd API</span><span class="sxs-lookup"><span data-stu-id="a73f0-326">etcd API</span></span> | <span data-ttu-id="a73f0-327">启用 Cosmos DB 作为 Azure Kubernetes 服务群集的后备存储</span><span class="sxs-lookup"><span data-stu-id="a73f0-327">Enables Cosmos DB as a backing store for Azure Kubernetes Service clusters</span></span> |

<span data-ttu-id="a73f0-328">开发团队可以将现有的 Mongo、Gremlin 或 Cassandra 数据库迁移到 Cosmos DB 对数据或代码进行少量更改。</span><span class="sxs-lookup"><span data-stu-id="a73f0-328">Development teams can migrate existing Mongo, Gremlin, or Cassandra databases into Cosmos DB with minimal changes to data or code.</span></span> <span data-ttu-id="a73f0-329">对于新应用程序，开发团队可以在开源选项或内置 SQL API 模型中进行选择。</span><span class="sxs-lookup"><span data-stu-id="a73f0-329">For new apps, development teams can choose among open-source options or the built-in SQL API model.</span></span>

> <span data-ttu-id="a73f0-330">在内部，Cosmos 将数据存储为由基元数据类型组成的简单结构格式。</span><span class="sxs-lookup"><span data-stu-id="a73f0-330">Internally, Cosmos stores the data in a simple struct format made up of primitive data types.</span></span> <span data-ttu-id="a73f0-331">对于每个请求，数据库引擎将基元数据转换为您选择的模型表示形式。</span><span class="sxs-lookup"><span data-stu-id="a73f0-331">For each request, the database engine translates the primitive data into the model representation you've selected.</span></span>

<span data-ttu-id="a73f0-332">在上表中，请记下 [表 API](/azure/cosmos-db/table-introduction) 选项。</span><span class="sxs-lookup"><span data-stu-id="a73f0-332">In the previous table, note the [Table API](/azure/cosmos-db/table-introduction) option.</span></span> <span data-ttu-id="a73f0-333">此 API 是 Azure 表存储的演变。</span><span class="sxs-lookup"><span data-stu-id="a73f0-333">This API is an evolution of Azure Table Storage.</span></span> <span data-ttu-id="a73f0-334">两者共享同一个基础表模型，但 Cosmos DB 表 API 添加 Azure 存储 API 中未提供的高级增强功能。</span><span class="sxs-lookup"><span data-stu-id="a73f0-334">Both share the same underlying table model, but the Cosmos DB Table API adds premium enhancements not available in the Azure Storage API.</span></span> <span data-ttu-id="a73f0-335">下表对这些功能进行了比较。</span><span class="sxs-lookup"><span data-stu-id="a73f0-335">The following table contrasts the features.</span></span>

|  | <span data-ttu-id="a73f0-336">Azure 表存储</span><span class="sxs-lookup"><span data-stu-id="a73f0-336">Azure Table Storage</span></span>  | <span data-ttu-id="a73f0-337">Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="a73f0-337">Azure Cosmos DB</span></span>  |
| :-------- | :-------- |:-------- |
| <span data-ttu-id="a73f0-338">延迟</span><span class="sxs-lookup"><span data-stu-id="a73f0-338">Latency</span></span> | <span data-ttu-id="a73f0-339">Fast</span><span class="sxs-lookup"><span data-stu-id="a73f0-339">Fast</span></span> | <span data-ttu-id="a73f0-340">在世界各地的任何位置进行读取和写入的一位数毫秒延迟</span><span class="sxs-lookup"><span data-stu-id="a73f0-340">Single-digit millisecond latency for reads and writes anywhere in the world</span></span> |
| <span data-ttu-id="a73f0-341">吞吐量</span><span class="sxs-lookup"><span data-stu-id="a73f0-341">Throughput</span></span> | <span data-ttu-id="a73f0-342">每个表的20000操作数限制</span><span class="sxs-lookup"><span data-stu-id="a73f0-342">Limit of 20,000 operations per table</span></span> | <span data-ttu-id="a73f0-343">10000000每个表的操作</span><span class="sxs-lookup"><span data-stu-id="a73f0-343">10 Million operations per table</span></span> |
| <span data-ttu-id="a73f0-344">全局分发</span><span class="sxs-lookup"><span data-stu-id="a73f0-344">Global Distribution</span></span> | <span data-ttu-id="a73f0-345">具有可选的单个辅助读取区域的单个区域</span><span class="sxs-lookup"><span data-stu-id="a73f0-345">Single region with optional single secondary read region</span></span> | <span data-ttu-id="a73f0-346">具有自动故障转移功能的所有区域的全包式分布</span><span class="sxs-lookup"><span data-stu-id="a73f0-346">Turnkey distributions to all regions with automatic failover</span></span> |
| <span data-ttu-id="a73f0-347">索引</span><span class="sxs-lookup"><span data-stu-id="a73f0-347">Indexing</span></span> | <span data-ttu-id="a73f0-348">仅适用于分区和行键属性</span><span class="sxs-lookup"><span data-stu-id="a73f0-348">Available for partition and row key properties only</span></span> | <span data-ttu-id="a73f0-349">所有属性的自动索引</span><span class="sxs-lookup"><span data-stu-id="a73f0-349">Automatic indexing of all properties</span></span> |
| <span data-ttu-id="a73f0-350">定价</span><span class="sxs-lookup"><span data-stu-id="a73f0-350">Pricing</span></span> | <span data-ttu-id="a73f0-351">基于存储</span><span class="sxs-lookup"><span data-stu-id="a73f0-351">Based on storage</span></span> | <span data-ttu-id="a73f0-352">基于吞吐量</span><span class="sxs-lookup"><span data-stu-id="a73f0-352">Based on throughput</span></span> |

<span data-ttu-id="a73f0-353">使用 Azure 表存储的微服务可以轻松地迁移到 Cosmos DB 表 API。</span><span class="sxs-lookup"><span data-stu-id="a73f0-353">Microservices that consume Azure Table storage can easily migrate to the Cosmos DB Table API.</span></span> <span data-ttu-id="a73f0-354">不需更改代码。</span><span class="sxs-lookup"><span data-stu-id="a73f0-354">No code changes are required.</span></span>

### <a name="tunable-consistency"></a><span data-ttu-id="a73f0-355">可调整的一致性</span><span class="sxs-lookup"><span data-stu-id="a73f0-355">Tunable consistency</span></span>

<span data-ttu-id="a73f0-356">在 *关系与 NoSQL* 部分的前面部分中，我们讨论了 *数据一致性*。</span><span class="sxs-lookup"><span data-stu-id="a73f0-356">Earlier in the *Relational vs. NoSQL* section, we discussed the subject of *data consistency*.</span></span> <span data-ttu-id="a73f0-357">数据一致性是指数据的 *完整性* 。</span><span class="sxs-lookup"><span data-stu-id="a73f0-357">Data consistency refers to the *integrity* of your data.</span></span> <span data-ttu-id="a73f0-358">使用分布式数据的云本机服务依赖于复制，并且必须在读取一致性、可用性和延迟之间做出根本性的权衡。</span><span class="sxs-lookup"><span data-stu-id="a73f0-358">Cloud-native services with distributed data rely on replication and must make a fundamental tradeoff between read consistency, availability, and latency.</span></span>

<span data-ttu-id="a73f0-359">大多数分布式数据库允许开发人员在两种一致性模型之间进行选择：强一致性和最终一致性。</span><span class="sxs-lookup"><span data-stu-id="a73f0-359">Most distributed databases allow developers to choose between two consistency models: strong consistency and eventual consistency.</span></span> <span data-ttu-id="a73f0-360">*强一致性* 是数据可编程性的黄金标准。</span><span class="sxs-lookup"><span data-stu-id="a73f0-360">*Strong consistency* is the gold standard of data programmability.</span></span> <span data-ttu-id="a73f0-361">它可以保证查询始终返回最新的数据，即使系统必须在等待更新复制到所有数据库副本时产生延迟。</span><span class="sxs-lookup"><span data-stu-id="a73f0-361">It guarantees that a query will always return the most current data - even if the system must incur latency waiting for an update to replicate across all database copies.</span></span> <span data-ttu-id="a73f0-362">虽然配置为 *最终一致性* 的数据库将立即返回数据，即使该数据不是最新的副本。</span><span class="sxs-lookup"><span data-stu-id="a73f0-362">While a database configured for *eventual consistency* will return data immediately, even if that data isn't the most current copy.</span></span> <span data-ttu-id="a73f0-363">后一种方法可实现更高的可用性、更高的规模和更高的性能。</span><span class="sxs-lookup"><span data-stu-id="a73f0-363">The latter option enables higher availability, greater scale, and increased performance.</span></span>

<span data-ttu-id="a73f0-364">Azure Cosmos DB 提供了五个明确定义的 [一致性模型](/azure/cosmos-db/consistency-levels) ，如图5-13 所示。</span><span class="sxs-lookup"><span data-stu-id="a73f0-364">Azure Cosmos DB offers five well-defined [consistency models](/azure/cosmos-db/consistency-levels) shown in Figure 5-13.</span></span>

![Cosmos DB 一致性图形](./media/cosmos-consistency-level-graph.png)

<span data-ttu-id="a73f0-366">**图 5-13**： Cosmos DB 一致性级别</span><span class="sxs-lookup"><span data-stu-id="a73f0-366">**Figure 5-13**: Cosmos DB Consistency Levels</span></span>

 <span data-ttu-id="a73f0-367">利用这些选项，您可以针对数据的一致性、可用性和性能做出精确的选择和细化的权衡。</span><span class="sxs-lookup"><span data-stu-id="a73f0-367">These options enable you to make precise choices and granular tradeoffs for consistency, availability, and the performance for your data.</span></span> <span data-ttu-id="a73f0-368">下表中显示了这些级别。</span><span class="sxs-lookup"><span data-stu-id="a73f0-368">The levels are presented in the following table.</span></span>

| <span data-ttu-id="a73f0-369">一致性级别</span><span class="sxs-lookup"><span data-stu-id="a73f0-369">Consistency Level</span></span> | <span data-ttu-id="a73f0-370">说明</span><span class="sxs-lookup"><span data-stu-id="a73f0-370">Description</span></span>  |
| :-------- | :-------- |
| <span data-ttu-id="a73f0-371">最终</span><span class="sxs-lookup"><span data-stu-id="a73f0-371">Eventual</span></span> | <span data-ttu-id="a73f0-372">不保证读取的顺序。</span><span class="sxs-lookup"><span data-stu-id="a73f0-372">No ordering guarantee for reads.</span></span> <span data-ttu-id="a73f0-373">副本最终将聚合。</span><span class="sxs-lookup"><span data-stu-id="a73f0-373">Replicas will eventually converge.</span></span> |
| <span data-ttu-id="a73f0-374">常量前缀</span><span class="sxs-lookup"><span data-stu-id="a73f0-374">Constant Prefix</span></span> | <span data-ttu-id="a73f0-375">读取仍是最终的，但会按写入数据的顺序返回数据。</span><span class="sxs-lookup"><span data-stu-id="a73f0-375">Reads are still eventual, but data is returned in the ordering in which it is written.</span></span> |
| <span data-ttu-id="a73f0-376">会话</span><span class="sxs-lookup"><span data-stu-id="a73f0-376">Session</span></span> | <span data-ttu-id="a73f0-377">保证您可以读取在当前会话期间写入的任何数据。</span><span class="sxs-lookup"><span data-stu-id="a73f0-377">Guarantees you can read any data written during the current session.</span></span> <span data-ttu-id="a73f0-378">它是默认的一致性级别。</span><span class="sxs-lookup"><span data-stu-id="a73f0-378">It is the default consistency level.</span></span> |
| <span data-ttu-id="a73f0-379">有限过期</span><span class="sxs-lookup"><span data-stu-id="a73f0-379">Bounded Staleness</span></span> | <span data-ttu-id="a73f0-380">按指定的间隔读取跟踪写入。</span><span class="sxs-lookup"><span data-stu-id="a73f0-380">Reads trail writes by interval that you specify.</span></span> |  
| <span data-ttu-id="a73f0-381">强</span><span class="sxs-lookup"><span data-stu-id="a73f0-381">Strong</span></span>  | <span data-ttu-id="a73f0-382">读取可保证返回项的最新提交版本。</span><span class="sxs-lookup"><span data-stu-id="a73f0-382">Reads are guaranteed to return most recent committed version of an item.</span></span> <span data-ttu-id="a73f0-383">客户端不会看到未提交或部分读取。</span><span class="sxs-lookup"><span data-stu-id="a73f0-383">A client never sees an uncommitted or partial read.</span></span> |  

<span data-ttu-id="a73f0-384">在下面 [的文章9球： Cosmos DB 一致性级别介绍](https://blog.jeremylikness.com/blog/2018-03-23_getting-behind-the-9ball-cosmosdb-consistency-levels/)的文章中，Microsoft Program Manager Jeremy Likness 提供了五种模型的出色说明。</span><span class="sxs-lookup"><span data-stu-id="a73f0-384">In the article [Getting Behind the 9-Ball: Cosmos DB Consistency Levels Explained](https://blog.jeremylikness.com/blog/2018-03-23_getting-behind-the-9ball-cosmosdb-consistency-levels/), Microsoft Program Manager Jeremy Likness provides an excellent explanation of the five models.</span></span>

### <a name="partitioning"></a><span data-ttu-id="a73f0-385">分区</span><span class="sxs-lookup"><span data-stu-id="a73f0-385">Partitioning</span></span>

<span data-ttu-id="a73f0-386">Azure Cosmos DB 采用自动 [分区](/azure/cosmos-db/partitioning-overview) 来缩放数据库，以满足云本地服务的性能需求。</span><span class="sxs-lookup"><span data-stu-id="a73f0-386">Azure Cosmos DB embraces automatic [partitioning](/azure/cosmos-db/partitioning-overview) to scale a database to meet the performance needs of your cloud-native services.</span></span>

<span data-ttu-id="a73f0-387">通过创建数据库、容器和项来管理 Cosmos DB 数据中的数据。</span><span class="sxs-lookup"><span data-stu-id="a73f0-387">You manage data in Cosmos DB data by creating databases, containers, and items.</span></span>

<span data-ttu-id="a73f0-388">容器位于 Cosmos DB 数据库中，表示项的架构无关分组。</span><span class="sxs-lookup"><span data-stu-id="a73f0-388">Containers live in a Cosmos DB database and represent a schema-agnostic grouping of items.</span></span> <span data-ttu-id="a73f0-389">项是添加到容器中的数据。</span><span class="sxs-lookup"><span data-stu-id="a73f0-389">Items are the data that you add to the container.</span></span> <span data-ttu-id="a73f0-390">它们表示为文档、行、节点或边缘。</span><span class="sxs-lookup"><span data-stu-id="a73f0-390">They're represented as documents, rows, nodes, or edges.</span></span> <span data-ttu-id="a73f0-391">添加到容器中的所有项都自动编制索引。</span><span class="sxs-lookup"><span data-stu-id="a73f0-391">All items added to a container are automatically indexed.</span></span>

<span data-ttu-id="a73f0-392">若要将容器分区，项被分为称为逻辑分区的不同子集。</span><span class="sxs-lookup"><span data-stu-id="a73f0-392">To partition the container, items are divided into distinct subsets called logical partitions.</span></span> <span data-ttu-id="a73f0-393">逻辑分区基于与容器中每一项关联的分区键的值进行填充。</span><span class="sxs-lookup"><span data-stu-id="a73f0-393">Logical partitions are populated based on the value of a partition key that is associated with each item in a container.</span></span> <span data-ttu-id="a73f0-394">图5-14 显示了两个容器，每个容器都有一个基于分区键值的逻辑分区。</span><span class="sxs-lookup"><span data-stu-id="a73f0-394">Figure 5-14 shows two containers each with a logical partition based on a partition key value.</span></span>

![Cosmos DB 分区机制](./media/cosmos-db-partitioning.png)

<span data-ttu-id="a73f0-396">**图 5-14**： Cosmos DB 分区机制</span><span class="sxs-lookup"><span data-stu-id="a73f0-396">**Figure 5-14**: Cosmos DB partitioning mechanics</span></span>

<span data-ttu-id="a73f0-397">请注意，上图中的每一项都包含 "city" 或 "机场" 的分区键。</span><span class="sxs-lookup"><span data-stu-id="a73f0-397">Note in the  previous figure how each item includes a partition key of either ‘city’ or ‘airport’.</span></span> <span data-ttu-id="a73f0-398">键确定项的逻辑分区。</span><span class="sxs-lookup"><span data-stu-id="a73f0-398">The key determines the item’s logical partition.</span></span> <span data-ttu-id="a73f0-399">带有城市代码的项将分配给左侧的容器，将带机场代码的项分配给右侧的容器。</span><span class="sxs-lookup"><span data-stu-id="a73f0-399">Items with a city code are assigned to the container on the left, and items with an airport code, to the container on the right.</span></span> <span data-ttu-id="a73f0-400">将分区键值与 ID 值组合会创建一个项的索引，该索引将唯一标识该项。</span><span class="sxs-lookup"><span data-stu-id="a73f0-400">Combining the partition key value with the ID value creates an item's index, which uniquely identifies the item.</span></span>

<span data-ttu-id="a73f0-401">在内部，Cosmos DB 自动管理物理分区上的 [逻辑分区](/azure/cosmos-db/partition-data) 位置，以满足容器的可伸缩性和性能需求。</span><span class="sxs-lookup"><span data-stu-id="a73f0-401">Internally, Cosmos DB automatically manages the placement of [logical partitions](/azure/cosmos-db/partition-data) on physical partitions to satisfy the scalability and performance needs of the container.</span></span> <span data-ttu-id="a73f0-402">随着应用程序吞吐量和存储要求的增加，Azure Cosmos DB 将逻辑分区重新分配到更多的服务器。</span><span class="sxs-lookup"><span data-stu-id="a73f0-402">As application throughput and storage requirements  increase, Azure Cosmos DB redistributes logical partitions across a greater number of servers.</span></span> <span data-ttu-id="a73f0-403">再分发操作由 Cosmos DB 管理，并在不中断或停机的情况下调用。</span><span class="sxs-lookup"><span data-stu-id="a73f0-403">Redistribution operations are managed by Cosmos DB and invoked without interruption or downtime.</span></span>

## <a name="newsql-databases"></a><span data-ttu-id="a73f0-404">NewSQL 数据库</span><span class="sxs-lookup"><span data-stu-id="a73f0-404">NewSQL databases</span></span>

<span data-ttu-id="a73f0-405">*NewSQL* 是一种新兴的数据库技术，它结合了 NoSQL 的分布式可扩展性与关系型数据库的 ACID 保证。</span><span class="sxs-lookup"><span data-stu-id="a73f0-405">*NewSQL* is an emerging database technology that combines the distributed scalability of NoSQL with the ACID guarantees of a relational database.</span></span> <span data-ttu-id="a73f0-406">NewSQL 数据库对于必须在跨分布式环境中处理大量数据的业务系统非常重要，具有完整的事务性支持和 ACID 遵从性。</span><span class="sxs-lookup"><span data-stu-id="a73f0-406">NewSQL databases are important for business systems that must process high-volumes of data, across distributed environments, with full transactional support and ACID compliance.</span></span> <span data-ttu-id="a73f0-407">虽然 NoSQL 数据库可以提供巨大的可伸缩性，但它不保证数据一致性。</span><span class="sxs-lookup"><span data-stu-id="a73f0-407">While a NoSQL database can provide massive scalability, it does not guarantee data consistency.</span></span> <span data-ttu-id="a73f0-408">不一致数据的间歇问题会给开发团队带来负担。</span><span class="sxs-lookup"><span data-stu-id="a73f0-408">Intermittent problems from inconsistent data can place a burden on the development team.</span></span> <span data-ttu-id="a73f0-409">开发人员必须在其微服务代码中构建安全措施，以管理由不一致数据导致的问题。</span><span class="sxs-lookup"><span data-stu-id="a73f0-409">Developers must construct safeguards into their microservice code to manage problems caused by inconsistent data.</span></span>

<span data-ttu-id="a73f0-410">云本机计算基础 (CNCF) 功能 NewSQL 多个数据库项目。</span><span class="sxs-lookup"><span data-stu-id="a73f0-410">The Cloud Native Computing Foundation (CNCF) features several NewSQL database projects.</span></span>

| <span data-ttu-id="a73f0-411">Project</span><span class="sxs-lookup"><span data-stu-id="a73f0-411">Project</span></span> | <span data-ttu-id="a73f0-412">特征</span><span class="sxs-lookup"><span data-stu-id="a73f0-412">Characteristics</span></span> |
| :-------- | :-------- |
| <span data-ttu-id="a73f0-413">蟑螂 DB</span><span class="sxs-lookup"><span data-stu-id="a73f0-413">Cockroach DB</span></span> |<span data-ttu-id="a73f0-414">全局缩放的 ACID 兼容的关系数据库。</span><span class="sxs-lookup"><span data-stu-id="a73f0-414">An ACID-compliant, relational database that scales globally.</span></span> <span data-ttu-id="a73f0-415">将新节点添加到群集，CockroachDB 负责跨实例和地理区域平衡数据。</span><span class="sxs-lookup"><span data-stu-id="a73f0-415">Add a new node to a cluster and CockroachDB takes care of balancing the data across instances and geographies.</span></span> <span data-ttu-id="a73f0-416">它创建、管理和分发副本以确保可靠性。</span><span class="sxs-lookup"><span data-stu-id="a73f0-416">It creates, manages, and distributes replicas to ensure reliability.</span></span> <span data-ttu-id="a73f0-417">它是开源的，免费提供。</span><span class="sxs-lookup"><span data-stu-id="a73f0-417">It’s open source and freely available.</span></span>  |
| <span data-ttu-id="a73f0-418">TiDB</span><span class="sxs-lookup"><span data-stu-id="a73f0-418">TiDB</span></span> | <span data-ttu-id="a73f0-419">支持混合事务和分析处理的开源数据库 (HTAP) 工作负荷。</span><span class="sxs-lookup"><span data-stu-id="a73f0-419">An open-source database that supports Hybrid Transactional and Analytical Processing (HTAP) workloads.</span></span> <span data-ttu-id="a73f0-420">它是与 MySQL 兼容的功能，可提供水平伸缩性、强一致性和高可用性。</span><span class="sxs-lookup"><span data-stu-id="a73f0-420">It is MySQL-compatible and features horizontal scalability, strong consistency, and high availability.</span></span>  <span data-ttu-id="a73f0-421">TiDB 的作用类似于 MySQL 服务器。</span><span class="sxs-lookup"><span data-stu-id="a73f0-421">TiDB acts like a MySQL server.</span></span> <span data-ttu-id="a73f0-422">你可以继续使用现有 MySQL 客户端库，而无需对应用程序进行大量代码更改。</span><span class="sxs-lookup"><span data-stu-id="a73f0-422">You can continue to use existing MySQL client libraries, without requiring extensive code changes to your application.</span></span> |
| <span data-ttu-id="a73f0-423">YugabyteDB</span><span class="sxs-lookup"><span data-stu-id="a73f0-423">YugabyteDB</span></span> | <span data-ttu-id="a73f0-424">开源、高性能分布式 SQL 数据库。</span><span class="sxs-lookup"><span data-stu-id="a73f0-424">An open source, high-performance, distributed SQL database.</span></span> <span data-ttu-id="a73f0-425">它支持较低的查询延迟、针对故障的恢复能力和全局数据分布。</span><span class="sxs-lookup"><span data-stu-id="a73f0-425">It supports low query latency, resilience against failures, and global data distribution.</span></span> <span data-ttu-id="a73f0-426">YugabyteDB 是 PostgressSQL 兼容的，可处理横向扩展 RDBMS 和 internet 缩放 OLTP 工作负载。</span><span class="sxs-lookup"><span data-stu-id="a73f0-426">YugabyteDB is PostgressSQL-compatible and handles scale-out RDBMS and internet-scale OLTP workloads.</span></span> <span data-ttu-id="a73f0-427">该产品还支持 NoSQL，并与 Cassandra 兼容。</span><span class="sxs-lookup"><span data-stu-id="a73f0-427">The product also supports NoSQL and is compatible with Cassandra.</span></span> |
|<span data-ttu-id="a73f0-428">Vitess</span><span class="sxs-lookup"><span data-stu-id="a73f0-428">Vitess</span></span> | <span data-ttu-id="a73f0-429">Vitess 是用于部署、缩放和管理 MySQL 实例的大型群集的数据库解决方案。</span><span class="sxs-lookup"><span data-stu-id="a73f0-429">Vitess is a database solution for deploying, scaling, and managing large clusters of MySQL instances.</span></span> <span data-ttu-id="a73f0-430">它可以在公共或私有云体系结构中运行。</span><span class="sxs-lookup"><span data-stu-id="a73f0-430">It can run in a public or private cloud architecture.</span></span> <span data-ttu-id="a73f0-431">Vitess 结合了许多重要的 MySQL 功能和功能，同时提供了垂直和水平分片支持。</span><span class="sxs-lookup"><span data-stu-id="a73f0-431">Vitess combines and extends many important MySQL features and features both vertical and horizontal sharding support.</span></span> <span data-ttu-id="a73f0-432">源自 YouTube，Vitess 一直在为所有 YouTube 数据库流量提供服务，2011。</span><span class="sxs-lookup"><span data-stu-id="a73f0-432">Originated by YouTube, Vitess has been serving all YouTube database traffic since 2011.</span></span> |

<span data-ttu-id="a73f0-433">可从云本机计算基础获取上图中的开源项目。</span><span class="sxs-lookup"><span data-stu-id="a73f0-433">The open-source projects in the previous figure are available from the Cloud Native Computing Foundation.</span></span> <span data-ttu-id="a73f0-434">其中三个产品是完整的数据库产品，其中包括 .NET Core 支持。</span><span class="sxs-lookup"><span data-stu-id="a73f0-434">Three of the offerings are full database products, which include .NET Core support.</span></span> <span data-ttu-id="a73f0-435">另一种是 Vitess，它是一种数据库群集系统，可用于水平缩放 MySQL 实例的大型群集。</span><span class="sxs-lookup"><span data-stu-id="a73f0-435">The other, Vitess, is a database clustering system that horizontally scales large clusters of MySQL instances.</span></span>

<span data-ttu-id="a73f0-436">NewSQL 数据库的关键设计目标是在 Kubernetes 中以本机方式工作，利用平台的复原能力和可伸缩性。</span><span class="sxs-lookup"><span data-stu-id="a73f0-436">A key design goal for NewSQL databases is to work natively in Kubernetes, taking advantage of the platform's resiliency and scalability.</span></span>

<span data-ttu-id="a73f0-437">NewSQL 数据库旨在应对暂时的云环境，在该环境中，基础虚拟机随时可以重新启动或重新计划。</span><span class="sxs-lookup"><span data-stu-id="a73f0-437">NewSQL databases are designed to thrive in ephemeral cloud environments where underlying virtual machines can be restarted or rescheduled at a moment’s notice.</span></span> <span data-ttu-id="a73f0-438">数据库旨在使节点出现故障，而不会丢失数据和停机。</span><span class="sxs-lookup"><span data-stu-id="a73f0-438">The databases are designed to survive node failures without data loss nor downtime.</span></span> <span data-ttu-id="a73f0-439">例如，CockroachDB 可以通过在群集中的节点之间维护所有数据的三个一致副本，来经受计算机丢失。</span><span class="sxs-lookup"><span data-stu-id="a73f0-439">CockroachDB, for example, is able to survive a machine loss by maintaining three consistent replicas of any data across the nodes in a cluster.</span></span>

<span data-ttu-id="a73f0-440">Kubernetes 使用 *服务构造* 来允许客户端从单个 DNS 条目寻址一组完全相同的 NewSQL 数据库进程。</span><span class="sxs-lookup"><span data-stu-id="a73f0-440">Kubernetes uses a *Services construct* to allow a client to address a group of identical NewSQL databases processes from a single DNS entry.</span></span> <span data-ttu-id="a73f0-441">通过将数据库实例与相关联的服务地址进行分隔，可以扩展，而不会中断现有的应用程序实例。</span><span class="sxs-lookup"><span data-stu-id="a73f0-441">By decoupling the database instances from the address of the service with which it's associated, we can scale without disrupting existing application instances.</span></span> <span data-ttu-id="a73f0-442">在给定时间向任何服务发送请求将始终产生相同的结果。</span><span class="sxs-lookup"><span data-stu-id="a73f0-442">Sending a request to any service at a given time will always yield the same result.</span></span>

<span data-ttu-id="a73f0-443">在这种情况下，所有数据库实例都相等。</span><span class="sxs-lookup"><span data-stu-id="a73f0-443">In this scenario, all database instances are equal.</span></span> <span data-ttu-id="a73f0-444">没有主要关系或次要关系。</span><span class="sxs-lookup"><span data-stu-id="a73f0-444">There are no primary or secondary relationships.</span></span> <span data-ttu-id="a73f0-445">CockroachDB 中的 *共识复制* 等技术允许任何数据库节点处理任何请求。</span><span class="sxs-lookup"><span data-stu-id="a73f0-445">Techniques like *consensus replication* found in CockroachDB allow any database node to handle any request.</span></span> <span data-ttu-id="a73f0-446">如果接收负载平衡请求的节点在本地具有所需的数据，则该节点会立即响应。</span><span class="sxs-lookup"><span data-stu-id="a73f0-446">If the node that receives a load-balanced request has the data it needs locally, it responds immediately.</span></span> <span data-ttu-id="a73f0-447">如果不是，则该节点将成为网关，并将请求转发到相应的节点以获得正确的答案。</span><span class="sxs-lookup"><span data-stu-id="a73f0-447">If not, the node becomes a gateway and forwards the request to the appropriate nodes to get the correct answer.</span></span> <span data-ttu-id="a73f0-448">从客户端的角度来看，每个数据库节点都是相同的：它们显示为单一的 *逻辑* 数据库，具有单计算机系统的一致性保证，尽管在幕后甚至有数百个节点在幕后工作。</span><span class="sxs-lookup"><span data-stu-id="a73f0-448">From the client's perspective, every database node is the same: They appear as a single *logical* database with the consistency guarantees of a single-machine system, despite having dozens or even hundreds of nodes that are working behind the scenes.</span></span>

<span data-ttu-id="a73f0-449">有关 NewSQL 数据库背后的机制的详细信息，请参阅 " [Kubernetes-Native 数据库的四个属性" 一](https://thenewstack.io/dash-four-properties-of-kubernetes-native-databases/) 文。</span><span class="sxs-lookup"><span data-stu-id="a73f0-449">For a detailed look at the mechanics behind NewSQL databases, see the [DASH: Four Properties of Kubernetes-Native Databases](https://thenewstack.io/dash-four-properties-of-kubernetes-native-databases/) article.</span></span>

## <a name="data-migration-to-the-cloud"></a><span data-ttu-id="a73f0-450">数据迁移到云</span><span class="sxs-lookup"><span data-stu-id="a73f0-450">Data migration to the cloud</span></span>

<span data-ttu-id="a73f0-451">一个耗时的任务就是将数据从一个数据平台迁移到另一个数据平台。</span><span class="sxs-lookup"><span data-stu-id="a73f0-451">One of the more time-consuming tasks is migrating data from one data platform to another.</span></span> <span data-ttu-id="a73f0-452">[Azure 数据迁移服务](https://azure.microsoft.com/services/database-migration/)可帮助加快此类工作。</span><span class="sxs-lookup"><span data-stu-id="a73f0-452">The [Azure Data Migration Service](https://azure.microsoft.com/services/database-migration/) can help expedite such efforts.</span></span> <span data-ttu-id="a73f0-453">它可以将数据从多个外部数据库源迁移到 Azure 数据平台，并且停机时间最短。</span><span class="sxs-lookup"><span data-stu-id="a73f0-453">It can migrate data from several external database sources into Azure Data platforms with minimal downtime.</span></span> <span data-ttu-id="a73f0-454">目标平台包括以下服务：</span><span class="sxs-lookup"><span data-stu-id="a73f0-454">Target platforms include the following services:</span></span>

- <span data-ttu-id="a73f0-455">Azure SQL 数据库</span><span class="sxs-lookup"><span data-stu-id="a73f0-455">Azure SQL Database</span></span>
- <span data-ttu-id="a73f0-456">Azure Database for MySQL</span><span class="sxs-lookup"><span data-stu-id="a73f0-456">Azure Database for MySQL</span></span>
- <span data-ttu-id="a73f0-457">Azure Database for MariaDB</span><span class="sxs-lookup"><span data-stu-id="a73f0-457">Azure Database for MariaDB</span></span>
- <span data-ttu-id="a73f0-458">Azure Database for PostgreSQL</span><span class="sxs-lookup"><span data-stu-id="a73f0-458">Azure Database for PostgreSQL</span></span>
- <span data-ttu-id="a73f0-459">CosmosDB</span><span class="sxs-lookup"><span data-stu-id="a73f0-459">CosmosDB</span></span>
  
<span data-ttu-id="a73f0-460">该服务提供了一些建议，指导你完成执行迁移所需的更改，即小型或大型迁移。</span><span class="sxs-lookup"><span data-stu-id="a73f0-460">The service provides recommendations to guide you through the changes required to execute a migration, both small or large.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="a73f0-461">[上一页](distributed-data.md)
>[下一页](azure-caching.md)</span><span class="sxs-lookup"><span data-stu-id="a73f0-461">[Previous](distributed-data.md)
[Next](azure-caching.md)</span></span>
