---
title: 被动回收
ms.date: 03/30/2017
helpviewer_keywords:
- garbage collection, forced
ms.assetid: 019008fe-4708-4e65-bebf-04fd9941e149
ms.openlocfilehash: 637ba9b3b73d685ee2263315a08f982d862efb35
ms.sourcegitcommit: 965a5af7918acb0a3fd3baf342e15d511ef75188
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/18/2020
ms.locfileid: "94827719"
---
# <a name="induced-collections"></a><span data-ttu-id="db8c1-102">被动回收</span><span class="sxs-lookup"><span data-stu-id="db8c1-102">Induced Collections</span></span>
<span data-ttu-id="db8c1-103">在大多数情况下，垃圾回收器可以确定执行回收的最佳时间，应让其独立运行。</span><span class="sxs-lookup"><span data-stu-id="db8c1-103">In most cases, the garbage collector can determine the best time to perform a collection, and you should let it run independently.</span></span> <span data-ttu-id="db8c1-104">在某些不常见的情况下，强制回收可以提高应用程序的性能。</span><span class="sxs-lookup"><span data-stu-id="db8c1-104">There are rare situations when a forced collection might improve your application's performance.</span></span> <span data-ttu-id="db8c1-105">在这种情况下，可以使用 <xref:System.GC.Collect%2A?displayProperty=nameWithType> 方法强制执行垃圾回收，从而诱导垃圾回收。</span><span class="sxs-lookup"><span data-stu-id="db8c1-105">In these cases, you can induce garbage collection by using the <xref:System.GC.Collect%2A?displayProperty=nameWithType> method to force a garbage collection.</span></span>  
  
 <span data-ttu-id="db8c1-106">如果应用代码中特定点使用的内存量大量减少，请使用 <xref:System.GC.Collect%2A?displayProperty=nameWithType> 方法。</span><span class="sxs-lookup"><span data-stu-id="db8c1-106">Use the <xref:System.GC.Collect%2A?displayProperty=nameWithType> method when there is a significant reduction in the amount of memory being used at a specific point in your application's code.</span></span> <span data-ttu-id="db8c1-107">例如，如果应用使用包含多个控件的复杂对话框，那么在对话框关闭时调用 <xref:System.GC.Collect%2A> 可以立即回收对话框占用的内存，从而提升性能。</span><span class="sxs-lookup"><span data-stu-id="db8c1-107">For example, if your application uses a complex dialog box that has several controls, calling <xref:System.GC.Collect%2A> when the dialog box is closed could improve performance by immediately reclaiming the memory used by the dialog box.</span></span> <span data-ttu-id="db8c1-108">请确保应用程序不会过于频繁地引发垃圾回收，否则当垃圾回收器无效率地尝试回收对象时，可能会使性能降低。</span><span class="sxs-lookup"><span data-stu-id="db8c1-108">Be sure that your application is not inducing garbage collection too frequently, because that can decrease performance if the garbage collector is trying to reclaim objects at non-optimal times.</span></span> <span data-ttu-id="db8c1-109">可以向 <xref:System.GC.Collect%2A> 方法提供 <xref:System.GCCollectionMode.Optimized?displayProperty=nameWithType> 枚举值，以便仅在回收能够提高效率时才进行回收，如下一部分所述。</span><span class="sxs-lookup"><span data-stu-id="db8c1-109">You can supply a <xref:System.GCCollectionMode.Optimized?displayProperty=nameWithType> enumeration value to the <xref:System.GC.Collect%2A> method to collect only when collection would be productive, as discussed in the next section.</span></span>  
  
## <a name="gc-collection-mode"></a><span data-ttu-id="db8c1-110">GC 回收模式</span><span class="sxs-lookup"><span data-stu-id="db8c1-110">GC collection mode</span></span>  
 <span data-ttu-id="db8c1-111">可以使用包含 <xref:System.GCCollectionMode> 值的 <xref:System.GC.Collect%2A?displayProperty=nameWithType> 方法重载之一，指定强制回收的行为，如下所示。</span><span class="sxs-lookup"><span data-stu-id="db8c1-111">You can use one of the <xref:System.GC.Collect%2A?displayProperty=nameWithType> method overloads that includes a <xref:System.GCCollectionMode> value to specify the behavior for a forced collection as follows.</span></span>  
  
|<span data-ttu-id="db8c1-112">`GCCollectionMode` 值</span><span class="sxs-lookup"><span data-stu-id="db8c1-112">`GCCollectionMode` value</span></span>|<span data-ttu-id="db8c1-113">说明</span><span class="sxs-lookup"><span data-stu-id="db8c1-113">Description</span></span>|  
|------------------------------|-----------------|  
|<xref:System.GCCollectionMode.Default>|<span data-ttu-id="db8c1-114">对正在运行的 .NET 版本使用默认的垃圾回收设置。</span><span class="sxs-lookup"><span data-stu-id="db8c1-114">Uses the default garbage collection setting for the running version of .NET.</span></span>|  
|<xref:System.GCCollectionMode.Forced>|<span data-ttu-id="db8c1-115">强制立即执行垃圾回收。</span><span class="sxs-lookup"><span data-stu-id="db8c1-115">Forces garbage collection to occur immediately.</span></span> <span data-ttu-id="db8c1-116">这相当于调用 <xref:System.GC.Collect?displayProperty=nameWithType> 重载。</span><span class="sxs-lookup"><span data-stu-id="db8c1-116">This is equivalent to calling the <xref:System.GC.Collect?displayProperty=nameWithType> overload.</span></span> <span data-ttu-id="db8c1-117">它会导致对所有分代进行完全阻塞回收。</span><span class="sxs-lookup"><span data-stu-id="db8c1-117">It results in a full blocking collection of all generations.</span></span><br /><br /> <span data-ttu-id="db8c1-118">强制执行即时完全阻止式垃圾回收前，还可以将 <xref:System.Runtime.GCSettings.LargeObjectHeapCompactionMode%2A?displayProperty=nameWithType> 属性设置为 <xref:System.Runtime.GCLargeObjectHeapCompactionMode.CompactOnce?displayProperty=nameWithType>，从而压缩大型对象堆。</span><span class="sxs-lookup"><span data-stu-id="db8c1-118">You can also compact the large object heap by setting the <xref:System.Runtime.GCSettings.LargeObjectHeapCompactionMode%2A?displayProperty=nameWithType> property to <xref:System.Runtime.GCLargeObjectHeapCompactionMode.CompactOnce?displayProperty=nameWithType> before forcing an immediate full blocking garbage collection.</span></span>|  
|<xref:System.GCCollectionMode.Optimized>|<span data-ttu-id="db8c1-119">使垃圾回收器可以确定当前时间是否是回收对象的最佳时间。</span><span class="sxs-lookup"><span data-stu-id="db8c1-119">Enables the garbage collector to determine whether the current time is optimal to reclaim objects.</span></span><br /><br /> <span data-ttu-id="db8c1-120">垃圾回收器可能判定回收效率不够高，因此回收不合理，在这种情况下将返回而不回收对象。</span><span class="sxs-lookup"><span data-stu-id="db8c1-120">The garbage collector could determine that a collection would not be productive enough to be justified, in which case it will return without reclaiming objects.</span></span>|  
  
## <a name="background-or-blocking-collections"></a><span data-ttu-id="db8c1-121">后台回收或阻塞回收</span><span class="sxs-lookup"><span data-stu-id="db8c1-121">Background or blocking collections</span></span>  
 <span data-ttu-id="db8c1-122">可以调用 <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29?displayProperty=nameWithType> 方法重载，指定诱导回收是否是阻止式。</span><span class="sxs-lookup"><span data-stu-id="db8c1-122">You can call the <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29?displayProperty=nameWithType> method overload to specify whether an induced collection is blocking or not.</span></span> <span data-ttu-id="db8c1-123">执行的回收类型取决于此方法的 `mode` 和 `blocking` 参数组合。</span><span class="sxs-lookup"><span data-stu-id="db8c1-123">The type of collection performed depends on a combination of the method's `mode` and `blocking` parameters.</span></span> <span data-ttu-id="db8c1-124">`mode` 是 <xref:System.GCCollectionMode> 枚举的成员，且 `blocking` 值为 <xref:System.Boolean>。</span><span class="sxs-lookup"><span data-stu-id="db8c1-124">`mode` is a member of the <xref:System.GCCollectionMode> enumeration, and `blocking` is a <xref:System.Boolean> value.</span></span> <span data-ttu-id="db8c1-125">下表汇总了 `mode` 和 `blocking` 参数的交互。</span><span class="sxs-lookup"><span data-stu-id="db8c1-125">The following table summarizes the interaction of the `mode` and `blocking` arguments.</span></span>  
  
|`mode`|`blocking` = `true`|`blocking` = `false`|  
|------------|--------------------------|---------------------------|  
|<span data-ttu-id="db8c1-126"><xref:System.GCCollectionMode.Forced> 或 <xref:System.GCCollectionMode.Default></span><span class="sxs-lookup"><span data-stu-id="db8c1-126"><xref:System.GCCollectionMode.Forced> or <xref:System.GCCollectionMode.Default></span></span>|<span data-ttu-id="db8c1-127">尽快执行阻塞回收。</span><span class="sxs-lookup"><span data-stu-id="db8c1-127">A blocking collection is performed as soon as possible.</span></span> <span data-ttu-id="db8c1-128">如果后台回收正在进行且分代为 0 或 1，<xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29> 方法会立即触发阻止式回收，并在回收完成后返回结果。</span><span class="sxs-lookup"><span data-stu-id="db8c1-128">If a background collection is in progress and generation is 0 or 1, the <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29> method immediately triggers a blocking collection and returns when the collection is finished.</span></span> <span data-ttu-id="db8c1-129">如果后台回收正在进行且 `generation` 参数为 2，此方法会等到后台回收完成，再触发第 2 代阻止式回收，然后返回结果。</span><span class="sxs-lookup"><span data-stu-id="db8c1-129">If a background collection is in progress and the `generation` parameter is 2, the method waits until the background collection is finished, triggers a blocking generation 2 collection, and then returns.</span></span>|<span data-ttu-id="db8c1-130">尽快执行回收。</span><span class="sxs-lookup"><span data-stu-id="db8c1-130">A collection is performed as soon as possible.</span></span> <span data-ttu-id="db8c1-131"><xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29> 方法请求执行后台回收，但这并没有保证；阻止式回收仍可执行，具体视环境而定。</span><span class="sxs-lookup"><span data-stu-id="db8c1-131">The <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29> method requests a background collection, but this is not guaranteed; depending on the circumstances, a blocking collection may still be performed.</span></span> <span data-ttu-id="db8c1-132">如果后台回收正在进行，该方法将立即返回。</span><span class="sxs-lookup"><span data-stu-id="db8c1-132">If a background collection is already in progress, the method returns immediately.</span></span>|  
|<xref:System.GCCollectionMode.Optimized>|<span data-ttu-id="db8c1-133">可能会执行阻止式回收，具体视垃圾回收器的状态和 `generation` 参数而定。</span><span class="sxs-lookup"><span data-stu-id="db8c1-133">A blocking collection may be performed, depending on the state of the garbage collector and the `generation` parameter.</span></span> <span data-ttu-id="db8c1-134">垃圾回收器会尽量提供最佳性能。</span><span class="sxs-lookup"><span data-stu-id="db8c1-134">The garbage collector tries to provide optimal performance.</span></span>|<span data-ttu-id="db8c1-135">根据垃圾回收器的状态，有时可执行回收。</span><span class="sxs-lookup"><span data-stu-id="db8c1-135">A collection may be performed, depending on the state of the garbage collector.</span></span> <span data-ttu-id="db8c1-136"><xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29> 方法请求执行后台回收，但这并没有保证；阻止式回收仍可执行，具体视环境而定。</span><span class="sxs-lookup"><span data-stu-id="db8c1-136">The <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29> method requests a background collection, but this is not guaranteed; depending on the circumstances, a blocking collection may still be performed.</span></span> <span data-ttu-id="db8c1-137">垃圾回收器会尽量提供最佳性能。</span><span class="sxs-lookup"><span data-stu-id="db8c1-137">The garbage collector tries to provide optimal performance.</span></span> <span data-ttu-id="db8c1-138">如果后台回收正在进行，该方法将立即返回。</span><span class="sxs-lookup"><span data-stu-id="db8c1-138">If a background collection is already in progress, the method returns immediately.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="db8c1-139">另请参阅</span><span class="sxs-lookup"><span data-stu-id="db8c1-139">See also</span></span>

- [<span data-ttu-id="db8c1-140">延迟模式</span><span class="sxs-lookup"><span data-stu-id="db8c1-140">Latency Modes</span></span>](latency.md)
- [<span data-ttu-id="db8c1-141">垃圾回收</span><span class="sxs-lookup"><span data-stu-id="db8c1-141">Garbage Collection</span></span>](index.md)
