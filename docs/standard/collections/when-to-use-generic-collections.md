---
title: 何时使用泛型集合
ms.date: 04/30/2020
helpviewer_keywords:
- collections [.NET], generic
- generic collections [.NET]
ms.assetid: e7b868b1-11fe-4ac5-bed3-de68aca47739
ms.openlocfilehash: 7b8b7b458a1667a1d3239ef378c729929678e8aa
ms.sourcegitcommit: d8020797a6657d0fbbdff362b80300815f682f94
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/24/2020
ms.locfileid: "95733069"
---
# <a name="when-to-use-generic-collections"></a><span data-ttu-id="2c546-102">何时使用泛型集合</span><span class="sxs-lookup"><span data-stu-id="2c546-102">When to use generic collections</span></span>

<span data-ttu-id="2c546-103">使用泛型集合可获得类型安全的自动化优点而无需从基集合类型派生和实现特定类型的成员。</span><span class="sxs-lookup"><span data-stu-id="2c546-103">Using generic collections gives you the automatic benefit of type safety without having to derive from a base collection type and implement type-specific members.</span></span> <span data-ttu-id="2c546-104">当集合元素为值类型时，泛型集合类型也通常优于对应的非泛型集合类型（比从非泛型基集合类型派生的类型好），因为使用泛型时不必对元素进行装箱。</span><span class="sxs-lookup"><span data-stu-id="2c546-104">Generic collection types also generally perform better than the corresponding nongeneric collection types (and better than types that are derived from nongeneric base collection types) when the collection elements are value types, because with generics, there's no need to box the elements.</span></span>

<span data-ttu-id="2c546-105">对于面向 .NET Standard 1.0 或更高版本的程序，请在多个线程可能会同时向集合添加项或从集合中删除项时使用 <xref:System.Collections.Concurrent> 命名空间中的泛型集合。</span><span class="sxs-lookup"><span data-stu-id="2c546-105">For programs that target .NET Standard 1.0 or later, use the generic collection classes in the <xref:System.Collections.Concurrent> namespace when multiple threads might be adding or removing items from the collection concurrently.</span></span> <span data-ttu-id="2c546-106">此外，当需要不可变性时，请考虑 <xref:System.Collections.Immutable> 命名空间中的泛型集合类。</span><span class="sxs-lookup"><span data-stu-id="2c546-106">Additionally, when immutability is desired, consider the generic collection classes in the <xref:System.Collections.Immutable> namespace.</span></span>

<span data-ttu-id="2c546-107">以下泛型类型对应于现有集合类型：</span><span class="sxs-lookup"><span data-stu-id="2c546-107">The following generic types correspond to existing collection types:</span></span>

- <span data-ttu-id="2c546-108"><xref:System.Collections.Generic.List%601> 泛型类对应于 <xref:System.Collections.ArrayList>。</span><span class="sxs-lookup"><span data-stu-id="2c546-108"><xref:System.Collections.Generic.List%601> is the generic class that corresponds to <xref:System.Collections.ArrayList>.</span></span>

- <span data-ttu-id="2c546-109"><xref:System.Collections.Generic.Dictionary%602> 和 <xref:System.Collections.Concurrent.ConcurrentDictionary%602> 泛型类对应 <xref:System.Collections.Hashtable>。</span><span class="sxs-lookup"><span data-stu-id="2c546-109"><xref:System.Collections.Generic.Dictionary%602> and <xref:System.Collections.Concurrent.ConcurrentDictionary%602> are the generic classes that correspond to <xref:System.Collections.Hashtable>.</span></span>

- <span data-ttu-id="2c546-110"><xref:System.Collections.ObjectModel.Collection%601> 泛型类对应于 <xref:System.Collections.CollectionBase>。</span><span class="sxs-lookup"><span data-stu-id="2c546-110"><xref:System.Collections.ObjectModel.Collection%601> is the generic class that corresponds to <xref:System.Collections.CollectionBase>.</span></span> <span data-ttu-id="2c546-111"><xref:System.Collections.ObjectModel.Collection%601> 可以用作基类，但是与 <xref:System.Collections.CollectionBase> 不同，它不抽象，这大大降低了其使用难度。</span><span class="sxs-lookup"><span data-stu-id="2c546-111"><xref:System.Collections.ObjectModel.Collection%601> can be used as a base class, but unlike <xref:System.Collections.CollectionBase>, it is not abstract, which makes it much easier to use.</span></span>

- <span data-ttu-id="2c546-112"><xref:System.Collections.ObjectModel.ReadOnlyCollection%601> 泛型类对应于 <xref:System.Collections.ReadOnlyCollectionBase>。</span><span class="sxs-lookup"><span data-stu-id="2c546-112"><xref:System.Collections.ObjectModel.ReadOnlyCollection%601> is the generic class that corresponds to <xref:System.Collections.ReadOnlyCollectionBase>.</span></span> <span data-ttu-id="2c546-113"><xref:System.Collections.ObjectModel.ReadOnlyCollection%601> 不是抽象的并且拥有可以轻松地公开现有的 <xref:System.Collections.Generic.List%601> 为只读集合的构造函数。</span><span class="sxs-lookup"><span data-stu-id="2c546-113"><xref:System.Collections.ObjectModel.ReadOnlyCollection%601> is not abstract and has a constructor that makes it easy to expose an existing <xref:System.Collections.Generic.List%601> as a read-only collection.</span></span>

- <span data-ttu-id="2c546-114"><xref:System.Collections.Generic.Queue%601>、 <xref:System.Collections.Concurrent.ConcurrentQueue%601>、 <xref:System.Collections.Immutable.ImmutableQueue%601>、 <xref:System.Collections.Immutable.ImmutableArray%601>、<xref:System.Collections.Generic.SortedList%602> 和 <xref:System.Collections.Immutable.ImmutableSortedSet%601> 泛型类对应有着相应的相同名称的非泛型类。</span><span class="sxs-lookup"><span data-stu-id="2c546-114">The <xref:System.Collections.Generic.Queue%601>, <xref:System.Collections.Concurrent.ConcurrentQueue%601>, <xref:System.Collections.Immutable.ImmutableQueue%601>, <xref:System.Collections.Immutable.ImmutableArray%601>, <xref:System.Collections.Generic.SortedList%602>, and <xref:System.Collections.Immutable.ImmutableSortedSet%601> generic classes correspond to the respective nongeneric classes with the same names.</span></span>

## <a name="additional-types"></a><span data-ttu-id="2c546-115">其他类型</span><span class="sxs-lookup"><span data-stu-id="2c546-115">Additional Types</span></span>

<span data-ttu-id="2c546-116">几种泛型集合类型没有对应的非泛型集合类型。</span><span class="sxs-lookup"><span data-stu-id="2c546-116">Several generic collection types do not have nongeneric counterparts.</span></span> <span data-ttu-id="2c546-117">它们包括以下类型：</span><span class="sxs-lookup"><span data-stu-id="2c546-117">They include the following:</span></span>

- <span data-ttu-id="2c546-118"><xref:System.Collections.Generic.LinkedList%601> 是一个通用的链接列表，该列表提供 O(1) 插入和删除操作。</span><span class="sxs-lookup"><span data-stu-id="2c546-118"><xref:System.Collections.Generic.LinkedList%601> is a general-purpose linked list that provides O(1) insertion and removal operations.</span></span>

- <span data-ttu-id="2c546-119"><xref:System.Collections.Generic.SortedDictionary%602> 是一个有 O(log `n`) 插入和检索操作的已排序字典，这使它有效代替了 <xref:System.Collections.Generic.SortedList%602>。</span><span class="sxs-lookup"><span data-stu-id="2c546-119"><xref:System.Collections.Generic.SortedDictionary%602> is a sorted dictionary with O(log `n`) insertion and retrieval operations, which makes it a useful alternative to <xref:System.Collections.Generic.SortedList%602>.</span></span>

- <span data-ttu-id="2c546-120"><xref:System.Collections.ObjectModel.KeyedCollection%602> 是列表和字典的结合，它提供了一种方法来存储包含自己的键的对象。</span><span class="sxs-lookup"><span data-stu-id="2c546-120"><xref:System.Collections.ObjectModel.KeyedCollection%602> is a hybrid between a list and a dictionary, which provides a way to store objects that contain their own keys.</span></span>

- <span data-ttu-id="2c546-121"><xref:System.Collections.Concurrent.BlockingCollection%601> 通过限制和阻止功能实现集合类。</span><span class="sxs-lookup"><span data-stu-id="2c546-121"><xref:System.Collections.Concurrent.BlockingCollection%601> implements a collection class with bounding and blocking functionality.</span></span>

- <span data-ttu-id="2c546-122"><xref:System.Collections.Concurrent.ConcurrentBag%601> 能快速插入和移除未排序元素。</span><span class="sxs-lookup"><span data-stu-id="2c546-122"><xref:System.Collections.Concurrent.ConcurrentBag%601> provides fast insertion and removal of unordered elements.</span></span>

### <a name="immutable-builders"></a><span data-ttu-id="2c546-123">不可变生成器</span><span class="sxs-lookup"><span data-stu-id="2c546-123">Immutable builders</span></span>

<span data-ttu-id="2c546-124">如果需要在应用中使用不可变性功能，<xref:System.Collections.Immutable> 命名空间提供了可使用的泛型集合类型。</span><span class="sxs-lookup"><span data-stu-id="2c546-124">When you desire immutability functionality in your app, the <xref:System.Collections.Immutable> namespace offers generic collection types you can use.</span></span> <span data-ttu-id="2c546-125">所有不可变的集合类型都提供 `Builder` 类，此类在执行多个突变时可以优化性能。</span><span class="sxs-lookup"><span data-stu-id="2c546-125">All of the immutable collection types offer `Builder` classes that can optimize performance when you're performing multiple mutations.</span></span> <span data-ttu-id="2c546-126">`Builder` 类在不可变状态下批处理操作。</span><span class="sxs-lookup"><span data-stu-id="2c546-126">The `Builder` class batches operations in a mutable state.</span></span> <span data-ttu-id="2c546-127">所有突变都完成后，调用 `ToImmutable` 方法来“冻结”所有节点并创建一个不可变的泛型集合，例如 <xref:System.Collections.Immutable.ImmutableList%601>。</span><span class="sxs-lookup"><span data-stu-id="2c546-127">When all mutations have been completed, call the `ToImmutable` method to "freeze" all nodes and create an immutable generic collection, for example, an <xref:System.Collections.Immutable.ImmutableList%601>.</span></span>

<span data-ttu-id="2c546-128">可以通过调用非泛型 `CreateBuilder()` 方法来创建 `Builder` 对象。</span><span class="sxs-lookup"><span data-stu-id="2c546-128">The `Builder` object can be created by calling the nongeneric `CreateBuilder()` method.</span></span> <span data-ttu-id="2c546-129">通过 `Builder` 实例，可以调用 `ToImmutable()`。</span><span class="sxs-lookup"><span data-stu-id="2c546-129">From a `Builder` instance, you can call `ToImmutable()`.</span></span> <span data-ttu-id="2c546-130">同样，通过 `Immutable*` 集合中，可以调用 `ToBuilder()` 从泛型不可变集合创建生成器实例。</span><span class="sxs-lookup"><span data-stu-id="2c546-130">Likewise, from the `Immutable*` collection, you can call `ToBuilder()` to create a builder instance from the generic immutable collection.</span></span> <span data-ttu-id="2c546-131">以下是各种 `Builder` 类型。</span><span class="sxs-lookup"><span data-stu-id="2c546-131">The following are the various `Builder` types.</span></span>

- <xref:System.Collections.Immutable.ImmutableArray%601.Builder>
- <xref:System.Collections.Immutable.ImmutableDictionary%602.Builder>
- <xref:System.Collections.Immutable.ImmutableHashSet%601.Builder>
- <xref:System.Collections.Immutable.ImmutableList%601.Builder>
- <xref:System.Collections.Immutable.ImmutableSortedDictionary%602.Builder>
- <xref:System.Collections.Immutable.ImmutableSortedSet%601.Builder>

## <a name="linq-to-objects"></a><span data-ttu-id="2c546-132">LINQ to Objects</span><span class="sxs-lookup"><span data-stu-id="2c546-132">LINQ to Objects</span></span>

<span data-ttu-id="2c546-133">你可以通过 LINQ to Objects 功能使用 LINQ 查询来访问内存中的对象，但条件是该对象类型要实现 <xref:System.Collections.IEnumerable?displayProperty=nameWithType> 或 <xref:System.Collections.Generic.IEnumerable%601?displayProperty=nameWithType> 接口。</span><span class="sxs-lookup"><span data-stu-id="2c546-133">The LINQ to Objects feature enables you to use LINQ queries to access in-memory objects as long as the object type implements the <xref:System.Collections.IEnumerable?displayProperty=nameWithType> or <xref:System.Collections.Generic.IEnumerable%601?displayProperty=nameWithType> interface.</span></span> <span data-ttu-id="2c546-134">LINQ 查询提供了一种通用的数据访问模式；与标准 `foreach` 循环相比，它通常更加简洁；可读性更高，并且可提供筛选、排序和分组功能。</span><span class="sxs-lookup"><span data-stu-id="2c546-134">LINQ queries provide a common pattern for accessing data; are typically more concise and readable than standard `foreach` loops; and provide filtering, ordering, and grouping capabilities.</span></span> <span data-ttu-id="2c546-135">LINQ 查询还可提高性能。</span><span class="sxs-lookup"><span data-stu-id="2c546-135">LINQ queries can also improve performance.</span></span> <span data-ttu-id="2c546-136">有关详细信息，请参阅 “[LINQ to Objects (C#)](../../csharp/programming-guide/concepts/linq/linq-to-objects.md)”、“[LINQ to Objects (Visual Basic)](../../visual-basic/programming-guide/concepts/linq/linq-to-objects.md)” 和 “[并行 LINQ (PLINQ)](../parallel-programming/introduction-to-plinq.md)”。</span><span class="sxs-lookup"><span data-stu-id="2c546-136">For more information, see [LINQ to Objects (C#)](../../csharp/programming-guide/concepts/linq/linq-to-objects.md), [LINQ to Objects (Visual Basic)](../../visual-basic/programming-guide/concepts/linq/linq-to-objects.md), and [Parallel LINQ (PLINQ)](../parallel-programming/introduction-to-plinq.md).</span></span>

## <a name="additional-functionality"></a><span data-ttu-id="2c546-137">其他功能</span><span class="sxs-lookup"><span data-stu-id="2c546-137">Additional Functionality</span></span>

<span data-ttu-id="2c546-138">一些泛型类型具有非泛型集合类型中找不到的功能。</span><span class="sxs-lookup"><span data-stu-id="2c546-138">Some of the generic types have functionality that is not found in the nongeneric collection types.</span></span> <span data-ttu-id="2c546-139">比如与非泛型 <xref:System.Collections.Generic.List%601> 类相对的 <xref:System.Collections.ArrayList> 类有大量接受泛型委托的方法，例如允许你指定搜索列表的方法的 <xref:System.Predicate%601> 委托、代表对列表中每个元素发挥作用的 <xref:System.Action%601> 委托和在类型间定义对话的 <xref:System.Converter%602> 委托。</span><span class="sxs-lookup"><span data-stu-id="2c546-139">For example, the <xref:System.Collections.Generic.List%601> class, which corresponds to the nongeneric <xref:System.Collections.ArrayList> class, has a number of methods that accept generic delegates, such as the <xref:System.Predicate%601> delegate that allows you to specify methods for searching the list, the <xref:System.Action%601> delegate that represents methods that act on each element of the list, and the <xref:System.Converter%602> delegate that lets you define conversions between types.</span></span>

<span data-ttu-id="2c546-140"><xref:System.Collections.Generic.List%601> 类使你可以指定你自己的用于排序和搜索列表的 <xref:System.Collections.Generic.IComparer%601> 泛型接口实现。</span><span class="sxs-lookup"><span data-stu-id="2c546-140">The <xref:System.Collections.Generic.List%601> class allows you to specify your own <xref:System.Collections.Generic.IComparer%601> generic interface implementations for sorting and searching the list.</span></span> <span data-ttu-id="2c546-141"><xref:System.Collections.Generic.SortedDictionary%602> 和 <xref:System.Collections.Generic.SortedList%602> 类也有这个功能。</span><span class="sxs-lookup"><span data-stu-id="2c546-141">The <xref:System.Collections.Generic.SortedDictionary%602> and <xref:System.Collections.Generic.SortedList%602> classes also have this capability.</span></span> <span data-ttu-id="2c546-142">另外，这些类使你可以在创建集合时指定比较器。</span><span class="sxs-lookup"><span data-stu-id="2c546-142">In addition, these classes let you specify comparers when the collection is created.</span></span> <span data-ttu-id="2c546-143">同样地，<xref:System.Collections.Generic.Dictionary%602> 和 <xref:System.Collections.ObjectModel.KeyedCollection%602> 类让你指定自己的相等比较器。</span><span class="sxs-lookup"><span data-stu-id="2c546-143">In similar fashion, the <xref:System.Collections.Generic.Dictionary%602> and <xref:System.Collections.ObjectModel.KeyedCollection%602> classes let you specify your own equality comparers.</span></span>

## <a name="see-also"></a><span data-ttu-id="2c546-144">请参阅</span><span class="sxs-lookup"><span data-stu-id="2c546-144">See also</span></span>

- [<span data-ttu-id="2c546-145">集合和数据结构</span><span class="sxs-lookup"><span data-stu-id="2c546-145">Collections and Data Structures</span></span>](index.md)
- [<span data-ttu-id="2c546-146">常用的集合类型</span><span class="sxs-lookup"><span data-stu-id="2c546-146">Commonly Used Collection Types</span></span>](commonly-used-collection-types.md)
- [<span data-ttu-id="2c546-147">泛型</span><span class="sxs-lookup"><span data-stu-id="2c546-147">Generics</span></span>](../generics/index.md)
