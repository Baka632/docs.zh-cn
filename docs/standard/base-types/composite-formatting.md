---
title: 复合格式设置
description: 了解 .NET 复合格式设置，它使用对象列表和复合格式字符串作为输入，其中包含带有索引占位符的固定文本。
ms.date: 10/26/2018
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- parameter specifiers
- strings [.NET], alignment
- format specifiers, composite formatting
- strings [.NET], composite
- composite formatting
- objects [.NET], formatting multiple objects
ms.assetid: 87b7d528-73f6-43c6-b71a-f23043039a49
ms.openlocfilehash: e15452016aa61cf44950e8b9e7fca58f23471ae7
ms.sourcegitcommit: 4a938327bad8b2e20cabd0f46a9dc50882596f13
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 10/28/2020
ms.locfileid: "92889460"
---
# <a name="composite-formatting"></a><span data-ttu-id="43906-103">复合格式设置</span><span class="sxs-lookup"><span data-stu-id="43906-103">Composite formatting</span></span>

<span data-ttu-id="43906-104">.NET 复合格式设置功能使用对象列表和复合格式字符串作为输入。</span><span class="sxs-lookup"><span data-stu-id="43906-104">The .NET composite formatting feature takes a list of objects and a composite format string as input.</span></span> <span data-ttu-id="43906-105">复合格式字符串由固定文本和索引占位符混和组成，其中索引占位符称为格式项，对应于列表中的对象。</span><span class="sxs-lookup"><span data-stu-id="43906-105">A composite format string consists of fixed text intermixed with indexed placeholders, called format items, that correspond to the objects in the list.</span></span> <span data-ttu-id="43906-106">格式设置操作产生的结果字符串由原始固定文本和列表中对象的字符串表示形式混和组成。</span><span class="sxs-lookup"><span data-stu-id="43906-106">The formatting operation yields a result string that consists of the original fixed text intermixed with the string representation of the objects in the list.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="43906-107">相较使用复合格式字符串，如果正在使用的语言和语言版本支持，则可使用 *内插字符串* 。</span><span class="sxs-lookup"><span data-stu-id="43906-107">Instead of using composite format strings, you can use *interpolated strings* if the language and language version that you're using support them.</span></span> <span data-ttu-id="43906-108">内插字符串是包含内插表达式的字符串。</span><span class="sxs-lookup"><span data-stu-id="43906-108">An interpolated string is a string that contains *interpolated expressions*.</span></span> <span data-ttu-id="43906-109">每个内插表达式都使用表达式的值进行解析，并在分配字符串时包含在结果字符串中。</span><span class="sxs-lookup"><span data-stu-id="43906-109">Each interpolated expression is resolved with the expression's value and included in the result string when the string is assigned.</span></span> <span data-ttu-id="43906-110">有关详细信息，请参阅[字符串内插（C# 参考）](../../csharp/language-reference/tokens/interpolated.md)和[内插字符串（Visual Basic 参考）](../../visual-basic/programming-guide/language-features/strings/interpolated-strings.md)。</span><span class="sxs-lookup"><span data-stu-id="43906-110">For more information, see [String interpolation (C# Reference)](../../csharp/language-reference/tokens/interpolated.md) and [Interpolated strings (Visual Basic Reference)](../../visual-basic/programming-guide/language-features/strings/interpolated-strings.md).</span></span>

<span data-ttu-id="43906-111">复合格式设置功能受诸如以下方法的支持：</span><span class="sxs-lookup"><span data-stu-id="43906-111">The composite formatting feature is supported by methods such as the following:</span></span>  
  
- <span data-ttu-id="43906-112"><xref:System.String.Format%2A?displayProperty=nameWithType>，它返回格式化的结果字符串。</span><span class="sxs-lookup"><span data-stu-id="43906-112"><xref:System.String.Format%2A?displayProperty=nameWithType>, which returns a formatted result string.</span></span>  
  
- <span data-ttu-id="43906-113"><xref:System.Text.StringBuilder.AppendFormat%2A?displayProperty=nameWithType>，它将格式化的结果字符串追加到 <xref:System.Text.StringBuilder> 对象。</span><span class="sxs-lookup"><span data-stu-id="43906-113"><xref:System.Text.StringBuilder.AppendFormat%2A?displayProperty=nameWithType>, which appends a formatted result string to a <xref:System.Text.StringBuilder> object.</span></span>
- <span data-ttu-id="43906-114"><xref:System.Console.WriteLine%2A?displayProperty=nameWithType> 方法的某些重载，它将格式化的结果字符串显示到控制台上。</span><span class="sxs-lookup"><span data-stu-id="43906-114">Some overloads of the <xref:System.Console.WriteLine%2A?displayProperty=nameWithType> method, which display a formatted result string to the console.</span></span>  
  
- <span data-ttu-id="43906-115"><xref:System.IO.TextWriter.WriteLine%2A?displayProperty=nameWithType> 方法的某些重载，它将格式化的结果字符串写入流或文件中。</span><span class="sxs-lookup"><span data-stu-id="43906-115">Some overloads of the <xref:System.IO.TextWriter.WriteLine%2A?displayProperty=nameWithType> method, which write the formatted result string to a stream or file.</span></span> <span data-ttu-id="43906-116">派生自 <xref:System.IO.TextWriter> 的类（如 <xref:System.IO.StreamWriter> 和 <xref:System.Web.UI.HtmlTextWriter>）也共享此功能。</span><span class="sxs-lookup"><span data-stu-id="43906-116">The classes derived from <xref:System.IO.TextWriter>, such as <xref:System.IO.StreamWriter> and <xref:System.Web.UI.HtmlTextWriter>, also share this functionality.</span></span>  
  
- <span data-ttu-id="43906-117"><xref:System.Diagnostics.Debug.WriteLine%28System.String%2CSystem.Object%5B%5D%29?displayProperty=nameWithType>，它将格式化消息输出到跟踪侦听器。</span><span class="sxs-lookup"><span data-stu-id="43906-117"><xref:System.Diagnostics.Debug.WriteLine%28System.String%2CSystem.Object%5B%5D%29?displayProperty=nameWithType>, which outputs a formatted message to trace listeners.</span></span>  
  
- <span data-ttu-id="43906-118"><xref:System.Diagnostics.Trace.TraceError%28System.String%2CSystem.Object%5B%5D%29?displayProperty=nameWithType>、<xref:System.Diagnostics.Trace.TraceInformation%28System.String%2CSystem.Object%5B%5D%29?displayProperty=nameWithType> 和 <xref:System.Diagnostics.Trace.TraceWarning%28System.String%2CSystem.Object%5B%5D%29?displayProperty=nameWithType> 方法，它们将格式化消息输出到跟踪侦听器。</span><span class="sxs-lookup"><span data-stu-id="43906-118">The <xref:System.Diagnostics.Trace.TraceError%28System.String%2CSystem.Object%5B%5D%29?displayProperty=nameWithType>, <xref:System.Diagnostics.Trace.TraceInformation%28System.String%2CSystem.Object%5B%5D%29?displayProperty=nameWithType>, and <xref:System.Diagnostics.Trace.TraceWarning%28System.String%2CSystem.Object%5B%5D%29?displayProperty=nameWithType> methods, which output formatted messages to trace listeners.</span></span>  
  
- <span data-ttu-id="43906-119"><xref:System.Diagnostics.TraceSource.TraceInformation%28System.String%2CSystem.Object%5B%5D%29?displayProperty=nameWithType> 方法，它将信息性方法写入跟踪侦听器中。</span><span class="sxs-lookup"><span data-stu-id="43906-119">The <xref:System.Diagnostics.TraceSource.TraceInformation%28System.String%2CSystem.Object%5B%5D%29?displayProperty=nameWithType> method, which writes an informational method to trace listeners.</span></span>  
  
## <a name="composite-format-string"></a><span data-ttu-id="43906-120">复合格式字符串</span><span class="sxs-lookup"><span data-stu-id="43906-120">Composite Format String</span></span>  
 <span data-ttu-id="43906-121">复合格式字符串和对象列表将用作支持复合格式设置功能的方法的参数。</span><span class="sxs-lookup"><span data-stu-id="43906-121">A composite format string and object list are used as arguments of methods that support the composite formatting feature.</span></span> <span data-ttu-id="43906-122">复合格式字符串由零个或多个固定文本段与一个或多个格式项混和组成。</span><span class="sxs-lookup"><span data-stu-id="43906-122">A composite format string consists of zero or more runs of fixed text intermixed with one or more format items.</span></span> <span data-ttu-id="43906-123">固定文本是所选择的任何字符串，并且每个格式项对应于列表中的一个对象或装箱的结构。</span><span class="sxs-lookup"><span data-stu-id="43906-123">The fixed text is any string that you choose, and each format item corresponds to an object or boxed structure in the list.</span></span> <span data-ttu-id="43906-124">复合格式设置功能返回新的结果字符串，其中每个格式项都被列表中相应对象的字符串表示形式取代。</span><span class="sxs-lookup"><span data-stu-id="43906-124">The composite formatting feature returns a new result string where each format item is replaced by the string representation of the corresponding object in the list.</span></span>  
  
 <span data-ttu-id="43906-125">可考虑使用以下 <xref:System.String.Format%2A> 代码段。</span><span class="sxs-lookup"><span data-stu-id="43906-125">Consider the following <xref:System.String.Format%2A> code fragment.</span></span>  
  
 [!code-csharp[Formatting.Composite#1](../../../samples/snippets/csharp/VS_Snippets_CLR/Formatting.Composite/cs/Composite1.cs#1)]
 [!code-vb[Formatting.Composite#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/Formatting.Composite/vb/Composite1.vb#1)]  
  
 <span data-ttu-id="43906-126">固定文本为“`Name =`”和“`, hours =`”。</span><span class="sxs-lookup"><span data-stu-id="43906-126">The fixed text is "`Name =` " and "`, hours =` ".</span></span> <span data-ttu-id="43906-127">格式项为“`{0}`”和“`{1:hh}`”，前者的索引为 0，对应于对象 `name`，后者的索引为 1，对应于对象 `DateTime.Now`。</span><span class="sxs-lookup"><span data-stu-id="43906-127">The format items are "`{0}`", whose index is 0, which corresponds to the object `name`, and "`{1:hh}`", whose index is 1, which corresponds to the object `DateTime.Now`.</span></span>  
  
## <a name="format-item-syntax"></a><span data-ttu-id="43906-128">格式项语法</span><span class="sxs-lookup"><span data-stu-id="43906-128">Format Item Syntax</span></span>  
 <span data-ttu-id="43906-129">每个格式项都采用下面的形式并包含以下组件：</span><span class="sxs-lookup"><span data-stu-id="43906-129">Each format item takes the following form and consists of the following components:</span></span>  
  
 <span data-ttu-id="43906-130">`{` *index* [`,`*alignment* ][`:`*formatString* ]`}`</span><span class="sxs-lookup"><span data-stu-id="43906-130">`{` *index* [`,`*alignment* ][`:`*formatString* ]`}`</span></span>  
  
 <span data-ttu-id="43906-131">必须使用成对的大括号（“{”和“}”）。</span><span class="sxs-lookup"><span data-stu-id="43906-131">The matching braces ("{" and "}") are required.</span></span>  
  
### <a name="index-component"></a><span data-ttu-id="43906-132">索引组件</span><span class="sxs-lookup"><span data-stu-id="43906-132">Index Component</span></span>  
 <span data-ttu-id="43906-133">必需的 *索引* 组件（也叫参数说明符）是一个从 0 开始的数字，可标识对象列表中对应的项。</span><span class="sxs-lookup"><span data-stu-id="43906-133">The mandatory *index* component, also called a parameter specifier, is a number starting from 0 that identifies a corresponding item in the list of objects.</span></span> <span data-ttu-id="43906-134">也就是说，参数说明符为 0 的格式项列表中的第一个对象，参数说明符为 1 的格式项列表中的第二个对象，依次类推。</span><span class="sxs-lookup"><span data-stu-id="43906-134">That is, the format item whose parameter specifier is 0 formats the first object in the list, the format item whose parameter specifier is 1 formats the second object in the list, and so on.</span></span> <span data-ttu-id="43906-135">下面的示例包括四个参数说明符，编号为 0 到 3，用于表示小于 10 的质数：</span><span class="sxs-lookup"><span data-stu-id="43906-135">The following example includes four parameter specifiers, numbered zero through three,  to represent prime numbers less than ten:</span></span>  
  
 [!code-csharp[Formatting.Composite#7](../../../samples/snippets/csharp/VS_Snippets_CLR/Formatting.Composite/cs/index1.cs#7)]
 [!code-vb[Formatting.Composite#7](../../../samples/snippets/visualbasic/VS_Snippets_CLR/Formatting.Composite/vb/index1.vb#7)]  
  
 <span data-ttu-id="43906-136">通过指定相同的参数说明符，多个格式项可以引用对象列表中的同一个元素。</span><span class="sxs-lookup"><span data-stu-id="43906-136">Multiple format items can refer to the same element in the list of objects by specifying the same parameter specifier.</span></span> <span data-ttu-id="43906-137">例如，可以将同一个数值设置为十六进制、科学记数法和数字格式，方法是通过指定复合格式字符串（例如：“0x{0:X} {0:E} {0:N}”），如以下示例所示。</span><span class="sxs-lookup"><span data-stu-id="43906-137">For example, you can format the same numeric value in hexadecimal, scientific, and number format by specifying a composite format string such as : "0x{0:X} {0:E} {0:N}", as the following example shows.</span></span>  
  
 [!code-csharp[Formatting.Composite#10](../../../samples/snippets/csharp/VS_Snippets_CLR/Formatting.Composite/cs/index1.cs#10)]
 [!code-vb[Formatting.Composite#10](../../../samples/snippets/visualbasic/VS_Snippets_CLR/Formatting.Composite/vb/index1.vb#10)]  
  
 <span data-ttu-id="43906-138">每个格式项都可以引用列表中的任一对象。</span><span class="sxs-lookup"><span data-stu-id="43906-138">Each format item can refer to any object in the list.</span></span> <span data-ttu-id="43906-139">例如，如果有三个对象，可以指定“{1} {0} {2}”等复合格式字符串，以设置第二个、第一个和第三个对象的格式。</span><span class="sxs-lookup"><span data-stu-id="43906-139">For example, if there are three objects, you can format the second, first, and third object by specifying a composite format string like this: "{1} {0} {2}".</span></span> <span data-ttu-id="43906-140">格式项未引用的对象会被忽略。</span><span class="sxs-lookup"><span data-stu-id="43906-140">An object that is not referenced by a format item is ignored.</span></span> <span data-ttu-id="43906-141">如果参数说明符指定了超出对象列表范围的项，将引发运行时 <xref:System.FormatException>。</span><span class="sxs-lookup"><span data-stu-id="43906-141">A <xref:System.FormatException> is thrown at run time if a parameter specifier designates an item outside the bounds of the list of objects.</span></span>  
  
### <a name="alignment-component"></a><span data-ttu-id="43906-142">对齐组件</span><span class="sxs-lookup"><span data-stu-id="43906-142">Alignment Component</span></span>  
 <span data-ttu-id="43906-143">可选的 *对齐* 组件是一个带符号的整数，指示首选的设置了格式的字段宽度。</span><span class="sxs-lookup"><span data-stu-id="43906-143">The optional *alignment* component is a signed integer indicating the preferred formatted field width.</span></span> <span data-ttu-id="43906-144">如果 *alignment* 值小于设置了格式的字符串的长度， *alignment* 将被忽略，并使用设置了格式的字符串的长度作为字段宽度。</span><span class="sxs-lookup"><span data-stu-id="43906-144">If the value of *alignment* is less than the length of the formatted string, *alignment* is ignored and the length of the formatted string is used as the field width.</span></span> <span data-ttu-id="43906-145">如果 *alignment* 为正数，字段中设置了格式的数据为右对齐；如果 *alignment* 为负数，字段中的设置了格式的数据为左对齐。</span><span class="sxs-lookup"><span data-stu-id="43906-145">The formatted data in the field is right-aligned if *alignment* is positive and left-aligned if *alignment* is negative.</span></span> <span data-ttu-id="43906-146">如果需要填充，则使用空白。</span><span class="sxs-lookup"><span data-stu-id="43906-146">If padding is necessary, white space is used.</span></span> <span data-ttu-id="43906-147">如果指定 *alignment* ，则需要使用逗号。</span><span class="sxs-lookup"><span data-stu-id="43906-147">The comma is required if *alignment*  is specified.</span></span>  
  
 <span data-ttu-id="43906-148">下面的示例定义两个数组，一个包含雇员的姓名，另一个则包含雇员在两周内的工作小时数。</span><span class="sxs-lookup"><span data-stu-id="43906-148">The following example defines two arrays, one containing the names of employees and the other containing the hours they worked over a two-week period.</span></span> <span data-ttu-id="43906-149">复合格式字符串使 20 字符字段中的姓名左对齐，使 5 字符字段中的工作小时数右对齐。</span><span class="sxs-lookup"><span data-stu-id="43906-149">The composite format string left-aligns the names in a 20-character field, and right-aligns their hours in a 5-character field.</span></span> <span data-ttu-id="43906-150">请注意“N1”标准格式字符串还用于设置带有小数位的小时数格式。</span><span class="sxs-lookup"><span data-stu-id="43906-150">Note that the "N1" standard format string is also used to format the hours with one fractional digit.</span></span>  
  
 [!code-csharp[Formatting.Composite#8](../../../samples/snippets/csharp/VS_Snippets_CLR/Formatting.Composite/cs/alignment1.cs#8)]
 [!code-vb[Formatting.Composite#8](../../../samples/snippets/visualbasic/VS_Snippets_CLR/Formatting.Composite/vb/alignment1.vb#8)]  
  
### <a name="format-string-component"></a><span data-ttu-id="43906-151">格式字符串组件</span><span class="sxs-lookup"><span data-stu-id="43906-151">Format String Component</span></span>  
 <span data-ttu-id="43906-152">可选的 *格式字符串* 组件是适合正在设置格式的对象类型的格式字符串。</span><span class="sxs-lookup"><span data-stu-id="43906-152">The optional *formatString* component is a format string that is appropriate for the type of object being formatted.</span></span> <span data-ttu-id="43906-153">如果相应对象是数值，指定标准或自定义数字格式字符串；如果相应对象是 <xref:System.DateTime> 对象，指定标准或自定义日期和时间格式字符串；或者，如果相应对象是枚举值，指定[枚举格式字符串](enumeration-format-strings.md)。</span><span class="sxs-lookup"><span data-stu-id="43906-153">Specify a standard or custom numeric format string if the corresponding object is a numeric value, a standard or custom date and time format string if the corresponding object is a <xref:System.DateTime> object, or an [enumeration format string](enumeration-format-strings.md) if the corresponding object is an enumeration value.</span></span> <span data-ttu-id="43906-154">如果不指定 *formatString* ，则对数字、日期和时间或者枚举类型使用常规（“G”）格式说明符。</span><span class="sxs-lookup"><span data-stu-id="43906-154">If *formatString* is not specified, the general ("G") format specifier for a numeric, date and time, or enumeration type is used.</span></span> <span data-ttu-id="43906-155">如果指定 *formatString* ，则需要使用冒号。</span><span class="sxs-lookup"><span data-stu-id="43906-155">The colon is required if *formatString* is specified.</span></span>  
  
 <span data-ttu-id="43906-156">下表列出了 .NET 类库中支持预定义的格式字符串集的类型或类型的类别，并提供指向列出了支持的格式字符串的主题的链接。</span><span class="sxs-lookup"><span data-stu-id="43906-156">The following table lists types or categories of types in the .NET class library that support a predefined set of format strings, and provides links to the topics that list the supported format strings.</span></span> <span data-ttu-id="43906-157">请注意，字符串格式化是一个可扩展的机制，可使用该机制定义所有现有类型的新的格式字符串，并定义受应用程序定义的类型支持的格式字符串集。</span><span class="sxs-lookup"><span data-stu-id="43906-157">Note that string formatting is an extensible mechanism that makes it possible to define new format strings for all existing types as well as to define a set of format strings supported by an application-defined type.</span></span> <span data-ttu-id="43906-158">有关详细信息，请参阅 <xref:System.IFormattable> 和 <xref:System.ICustomFormatter> 接口主题。</span><span class="sxs-lookup"><span data-stu-id="43906-158">For more information, see the <xref:System.IFormattable> and <xref:System.ICustomFormatter> interface topics.</span></span>  
  
|<span data-ttu-id="43906-159">类型或类型类别</span><span class="sxs-lookup"><span data-stu-id="43906-159">Type or type category</span></span>|<span data-ttu-id="43906-160">查看</span><span class="sxs-lookup"><span data-stu-id="43906-160">See</span></span>|  
|---------------------------|---------|  
|<span data-ttu-id="43906-161">日期和时间类型（<xref:System.DateTime>，<xref:System.DateTimeOffset>）</span><span class="sxs-lookup"><span data-stu-id="43906-161">Date and time types (<xref:System.DateTime>, <xref:System.DateTimeOffset>)</span></span>|[<span data-ttu-id="43906-162">标准日期和时间格式字符串</span><span class="sxs-lookup"><span data-stu-id="43906-162">Standard Date and Time Format Strings</span></span>](standard-date-and-time-format-strings.md)<br /><br /> [<span data-ttu-id="43906-163">自定义日期和时间格式字符串</span><span class="sxs-lookup"><span data-stu-id="43906-163">Custom Date and Time Format Strings</span></span>](custom-date-and-time-format-strings.md)|  
|<span data-ttu-id="43906-164">枚举类型（所有派生自 <xref:System.Enum?displayProperty=nameWithType> 的类型）</span><span class="sxs-lookup"><span data-stu-id="43906-164">Enumeration types (all types derived from <xref:System.Enum?displayProperty=nameWithType>)</span></span>|[<span data-ttu-id="43906-165">枚举格式字符串</span><span class="sxs-lookup"><span data-stu-id="43906-165">Enumeration Format Strings</span></span>](enumeration-format-strings.md)|  
|<span data-ttu-id="43906-166">数值类型（<xref:System.Numerics.BigInteger>、<xref:System.Byte>、<xref:System.Decimal>、<xref:System.Double>、<xref:System.Int16>、<xref:System.Int32>、<xref:System.Int64>、<xref:System.SByte>、<xref:System.Single>、<xref:System.UInt16>、 <xref:System.UInt32>、<xref:System.UInt64>）</span><span class="sxs-lookup"><span data-stu-id="43906-166">Numeric types (<xref:System.Numerics.BigInteger>, <xref:System.Byte>, <xref:System.Decimal>, <xref:System.Double>, <xref:System.Int16>, <xref:System.Int32>, <xref:System.Int64>, <xref:System.SByte>, <xref:System.Single>, <xref:System.UInt16>, <xref:System.UInt32>, <xref:System.UInt64>)</span></span>|[<span data-ttu-id="43906-167">标准数字格式字符串</span><span class="sxs-lookup"><span data-stu-id="43906-167">Standard Numeric Format Strings</span></span>](standard-numeric-format-strings.md)<br /><br /> [<span data-ttu-id="43906-168">自定义数字格式字符串</span><span class="sxs-lookup"><span data-stu-id="43906-168">Custom Numeric Format Strings</span></span>](custom-numeric-format-strings.md)|  
|<xref:System.Guid>|<xref:System.Guid.ToString%28System.String%29?displayProperty=nameWithType>|  
|<xref:System.TimeSpan>|[<span data-ttu-id="43906-169">标准 TimeSpan 格式字符串</span><span class="sxs-lookup"><span data-stu-id="43906-169">Standard TimeSpan Format Strings</span></span>](standard-timespan-format-strings.md)<br /><br /> [<span data-ttu-id="43906-170">自定义 TimeSpan 格式字符串</span><span class="sxs-lookup"><span data-stu-id="43906-170">Custom TimeSpan Format Strings</span></span>](custom-timespan-format-strings.md)|  
  
### <a name="escaping-braces"></a><span data-ttu-id="43906-171">转义大括号</span><span class="sxs-lookup"><span data-stu-id="43906-171">Escaping Braces</span></span>  
 <span data-ttu-id="43906-172">左大括号和右大括号被解释为格式项的开始和结束。</span><span class="sxs-lookup"><span data-stu-id="43906-172">Opening and closing braces are interpreted as starting and ending a format item.</span></span> <span data-ttu-id="43906-173">因此，必须使用转义序列显示文本左大括号或右大括号。</span><span class="sxs-lookup"><span data-stu-id="43906-173">Consequently, you must use an escape sequence to display a literal opening brace or closing brace.</span></span> <span data-ttu-id="43906-174">在固定文本中指定两个左大括号 ("{{") 以显示一个左大括号 ("{")，或指定两个右大括号 ("}}") 以显示一个右大括号 ("}")。</span><span class="sxs-lookup"><span data-stu-id="43906-174">Specify two opening braces ("{{") in the fixed text to display one opening brace ("{"), or two closing braces ("}}") to display one closing brace ("}").</span></span> <span data-ttu-id="43906-175">按照在格式项中遇到大括号的顺序依次解释它们。</span><span class="sxs-lookup"><span data-stu-id="43906-175">Braces in a format item are interpreted sequentially in the order they are encountered.</span></span> <span data-ttu-id="43906-176">不支持解释嵌套的大括号。</span><span class="sxs-lookup"><span data-stu-id="43906-176">Interpreting nested braces is not supported.</span></span>  
  
 <span data-ttu-id="43906-177">解释转义大括号的方式会导致意外的结果。</span><span class="sxs-lookup"><span data-stu-id="43906-177">The way escaped braces are interpreted can lead to unexpected results.</span></span> <span data-ttu-id="43906-178">例如，假设格式项为“{{{0:D}}}”，旨在显示左大括号、采用十进制数格式的数值和右大括号。</span><span class="sxs-lookup"><span data-stu-id="43906-178">For example, consider the format item "{{{0:D}}}", which is intended to display an opening brace, a numeric value formatted as a decimal number, and a closing brace.</span></span> <span data-ttu-id="43906-179">但是，实际是按照以下方式解释该格式项：</span><span class="sxs-lookup"><span data-stu-id="43906-179">However, the format item is actually interpreted in the following manner:</span></span>  
  
1. <span data-ttu-id="43906-180">前两个左大括号 ("{{") 被转义，生成一个左大括号。</span><span class="sxs-lookup"><span data-stu-id="43906-180">The first two opening braces ("{{") are escaped and yield one opening brace.</span></span>  
  
2. <span data-ttu-id="43906-181">之后的三个字符 ("{0:") 被解释为格式项的开始。</span><span class="sxs-lookup"><span data-stu-id="43906-181">The next three characters ("{0:") are interpreted as the start of a format item.</span></span>  
  
3. <span data-ttu-id="43906-182">下一个字符 ("D") 将被解释为 Decimal 标准数值格式说明符，但后面的两个转义大括号 ("}}") 生成单个大括号。</span><span class="sxs-lookup"><span data-stu-id="43906-182">The next character ("D") would be interpreted as the Decimal standard numeric format specifier, but the next two escaped braces ("}}") yield a single brace.</span></span> <span data-ttu-id="43906-183">由于得到的字符串 ("D}") 不是标准数值格式说明符号，所以得到的字符串会被解释为用于显示字符串“D}”的自定义格式字符串。</span><span class="sxs-lookup"><span data-stu-id="43906-183">Because the resulting string ("D}") is not a standard numeric format specifier, the resulting string is interpreted as a custom format string that means display the literal string "D}".</span></span>  
  
4. <span data-ttu-id="43906-184">最后一个大括号 ("}") 被解释为格式项的结束。</span><span class="sxs-lookup"><span data-stu-id="43906-184">The last brace ("}") is interpreted as the end of the format item.</span></span>  
  
5. <span data-ttu-id="43906-185">显示的最终结果是字符串“{D}”。</span><span class="sxs-lookup"><span data-stu-id="43906-185">The final result that is displayed is the literal string, "{D}".</span></span> <span data-ttu-id="43906-186">不会显示本来要设置格式的数值。</span><span class="sxs-lookup"><span data-stu-id="43906-186">The numeric value that was to be formatted is not displayed.</span></span>  
  
 <span data-ttu-id="43906-187">在编写代码时，避免错误解释转义大括号和格式项的一种方法是单独设置大括号和格式项的格式。</span><span class="sxs-lookup"><span data-stu-id="43906-187">One way to write your code to avoid misinterpreting escaped braces and format items is to format the braces and format item separately.</span></span> <span data-ttu-id="43906-188">也就是说，在第一个格式设置操作中显示文本左大括号，在下一操作中显示格式项的结果，然后在最后一个操作中显示文本右大括号。</span><span class="sxs-lookup"><span data-stu-id="43906-188">That is, in the first format operation display a literal opening brace, in the next operation display the result of the format item, then in the final operation display a literal closing brace.</span></span> <span data-ttu-id="43906-189">下面的示例阐释了这种方法。</span><span class="sxs-lookup"><span data-stu-id="43906-189">The following example illustrates this approach.</span></span>  
  
 [!code-csharp[Formatting.Composite#2](../../../samples/snippets/csharp/VS_Snippets_CLR/Formatting.Composite/cs/Escaping1.cs#2)]
 [!code-vb[Formatting.Composite#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR/Formatting.Composite/vb/Escaping1.vb#2)]  
  
### <a name="processing-order"></a><span data-ttu-id="43906-190">处理顺序</span><span class="sxs-lookup"><span data-stu-id="43906-190">Processing Order</span></span>  
 <span data-ttu-id="43906-191">如果对复合格式设置方法的调用包括其值不为 `null`的<xref:System.IFormatProvider>参数，则运行时会调用其 <xref:System.IFormatProvider.GetFormat%2A?displayProperty=nameWithType> 方法来请求 <xref:System.ICustomFormatter> 实现。</span><span class="sxs-lookup"><span data-stu-id="43906-191">If the call to the composite formatting method includes an <xref:System.IFormatProvider> argument whose value is not `null`, the runtime calls its <xref:System.IFormatProvider.GetFormat%2A?displayProperty=nameWithType> method to request an <xref:System.ICustomFormatter> implementation.</span></span> <span data-ttu-id="43906-192">如果此方法能够返回 <xref:System.ICustomFormatter> 实现，那么它将在复合格式方法调用期间缓存。</span><span class="sxs-lookup"><span data-stu-id="43906-192">If the method is able to return an <xref:System.ICustomFormatter> implementation, it's cached for the duration of the call of the composite formatting method.</span></span>
  
 <span data-ttu-id="43906-193">如下所示，将参数列表中与格式项对应的每个值转换为字符串：</span><span class="sxs-lookup"><span data-stu-id="43906-193">Each value in the parameter list that corresponds to a format item is converted to a string as follows:</span></span>  
  
1. <span data-ttu-id="43906-194">如果要设置格式的值为 `null`，则将返回空字符串 <xref:System.String.Empty?displayProperty=nameWithType>。</span><span class="sxs-lookup"><span data-stu-id="43906-194">If the value to be formatted is `null`, an empty string <xref:System.String.Empty?displayProperty=nameWithType> is returned.</span></span>  
  
2. <span data-ttu-id="43906-195">如果 <xref:System.ICustomFormatter> 实现可用，则运行时将调用其 <xref:System.ICustomFormatter.Format%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="43906-195">If an <xref:System.ICustomFormatter> implementation is available, the runtime calls its <xref:System.ICustomFormatter.Format%2A> method.</span></span> <span data-ttu-id="43906-196">它向方法传递格式项的 formatString 值（若有）或 `null`（若无）以及 <xref:System.IFormatProvider> 实现。</span><span class="sxs-lookup"><span data-stu-id="43906-196">It passes the method the format item's *formatString* value, if one is present, or `null` if it's not, along with the <xref:System.IFormatProvider> implementation.</span></span> <span data-ttu-id="43906-197">如果对 <xref:System.ICustomFormatter.Format%2A?displayProperty=nameWithType> 方法的调用返回 `null`，则继续执行下一步骤，将返回 <xref:System.ICustomFormatter.Format%2A?displayProperty=nameWithType> 调用的结果。</span><span class="sxs-lookup"><span data-stu-id="43906-197">If the call to the <xref:System.ICustomFormatter.Format%2A?displayProperty=nameWithType> method returns `null`, execution proceeds to the next step; otherwise, the result of the <xref:System.ICustomFormatter.Format%2A?displayProperty=nameWithType> call is returned.</span></span>
  
3. <span data-ttu-id="43906-198">如果该值实现 <xref:System.IFormattable> 接口，则调用此接口的 <xref:System.IFormattable.ToString%28System.String%2CSystem.IFormatProvider%29> 方法。</span><span class="sxs-lookup"><span data-stu-id="43906-198">If the value implements the <xref:System.IFormattable> interface, the interface's <xref:System.IFormattable.ToString%28System.String%2CSystem.IFormatProvider%29> method is called.</span></span> <span data-ttu-id="43906-199">如果格式项中存在 formatString 值，则向方法传递该值；如果不存在该值，则传递 `null`。</span><span class="sxs-lookup"><span data-stu-id="43906-199">The method is passed the *formatString* value, if one is present in the format item, or `null` if it's not.</span></span> <span data-ttu-id="43906-200">按如下方式确定 <xref:System.IFormatProvider> 自变量：</span><span class="sxs-lookup"><span data-stu-id="43906-200">The <xref:System.IFormatProvider> argument is determined as follows:</span></span>  
  
    - <span data-ttu-id="43906-201">对于数值，如果调用带非 null <xref:System.IFormatProvider> 自变量的复合格式设置方法，则运行时从其 <xref:System.Globalization.NumberFormatInfo> 方法请求 <xref:System.IFormatProvider.GetFormat%2A?displayProperty=nameWithType> 对象。</span><span class="sxs-lookup"><span data-stu-id="43906-201">For a numeric value, if a composite formatting method with a non-null <xref:System.IFormatProvider> argument is called, the runtime requests a <xref:System.Globalization.NumberFormatInfo> object from its <xref:System.IFormatProvider.GetFormat%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="43906-202">在以下情况下，使用当前线程区域性的 <xref:System.Globalization.NumberFormatInfo> 对象：无法提供该值、参数值为 `null` 或复合格式设置方法没有 <xref:System.IFormatProvider> 参数。</span><span class="sxs-lookup"><span data-stu-id="43906-202">If it's unable to supply one, if the value of the argument is `null`, or if the composite formatting method doesn't have an <xref:System.IFormatProvider> parameter, the <xref:System.Globalization.NumberFormatInfo> object for the current thread culture is used.</span></span>  
  
    - <span data-ttu-id="43906-203">对于日期和时间值，如果调用带非 null <xref:System.IFormatProvider> 自变量的复合格式设置方法，则运行时从其 <xref:System.Globalization.DateTimeFormatInfo> 方法请求 <xref:System.IFormatProvider.GetFormat%2A?displayProperty=nameWithType> 对象。</span><span class="sxs-lookup"><span data-stu-id="43906-203">For a date and time value, if a composite formatting method with a non-null <xref:System.IFormatProvider> argument is called, the runtime requests a <xref:System.Globalization.DateTimeFormatInfo> object from its <xref:System.IFormatProvider.GetFormat%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="43906-204">在以下情况下，使用当前线程区域性的 <xref:System.Globalization.DateTimeFormatInfo> 对象：无法提供该值、参数值为 `null` 或复合格式设置方法没有 <xref:System.IFormatProvider> 参数。</span><span class="sxs-lookup"><span data-stu-id="43906-204">If it's unable to supply one, if the value of the argument is `null`, or if the composite formatting method doesn't have an <xref:System.IFormatProvider> parameter, the <xref:System.Globalization.DateTimeFormatInfo> object for the current thread culture is used.</span></span>  
  
    - <span data-ttu-id="43906-205">对于其他类型的对象，如果调用带 <xref:System.IFormatProvider> 参数的复合格式设置方法，它的值会直接传递到 <xref:System.IFormattable.ToString%2A?displayProperty=nameWithType> 实现。</span><span class="sxs-lookup"><span data-stu-id="43906-205">For objects of other types, if a composite formatting method is called with an <xref:System.IFormatProvider> argument, its value is passed directly to the <xref:System.IFormattable.ToString%2A?displayProperty=nameWithType> implementation.</span></span> <span data-ttu-id="43906-206">否则，`null` 传递到 <xref:System.IFormattable.ToString%2A?displayProperty=nameWithType> 实现。</span><span class="sxs-lookup"><span data-stu-id="43906-206">Otherwise, `null` is passed to the <xref:System.IFormattable.ToString%2A?displayProperty=nameWithType> implementation.</span></span>  
  
4. <span data-ttu-id="43906-207">调用类型的无参数的 `ToString` 方法（该方法将重写 <xref:System.Object.ToString?displayProperty=nameWithType> 或继承其基类的行为）。</span><span class="sxs-lookup"><span data-stu-id="43906-207">The type's parameterless `ToString` method, which either overrides <xref:System.Object.ToString?displayProperty=nameWithType> or inherits the behavior of its base class, is called.</span></span> <span data-ttu-id="43906-208">在这种情况下，如果格式项中存在 formatString 组件指定的格式字符串，则将忽略该字符串。</span><span class="sxs-lookup"><span data-stu-id="43906-208">In this case, the format string specified by the *formatString* component in the format item, if it's present, is ignored.</span></span>  
  
 <span data-ttu-id="43906-209">前面的步骤执行完毕之后应用对齐。</span><span class="sxs-lookup"><span data-stu-id="43906-209">Alignment is applied after the preceding steps have been performed.</span></span>  
  
## <a name="code-examples"></a><span data-ttu-id="43906-210">代码示例</span><span class="sxs-lookup"><span data-stu-id="43906-210">Code Examples</span></span>  
 <span data-ttu-id="43906-211">下面的示例显示使用复合格式设置创建的一个字符串和使用对象的 `ToString` 方法创建的另一个字符串。</span><span class="sxs-lookup"><span data-stu-id="43906-211">The following example shows one string created using composite formatting and another created using an object's `ToString` method.</span></span> <span data-ttu-id="43906-212">两种格式设置类型产生相同的结果。</span><span class="sxs-lookup"><span data-stu-id="43906-212">Both types of formatting produce equivalent results.</span></span>  
  
 [!code-csharp[Formatting.Composite#3](../../../samples/snippets/csharp/VS_Snippets_CLR/Formatting.Composite/cs/Composite1.cs#3)]
 [!code-vb[Formatting.Composite#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR/Formatting.Composite/vb/Composite1.vb#3)]  
  
 <span data-ttu-id="43906-213">假定当前日期是五月的星期四，那么在美国英语区域性中上述示例中的两个字符串的值都是 `Thursday May`英语区域性。</span><span class="sxs-lookup"><span data-stu-id="43906-213">Assuming that the current day is a Thursday in May, the value of both strings in the preceding example is `Thursday May` in the U.S. English culture.</span></span>  
  
 <span data-ttu-id="43906-214"><xref:System.Console.WriteLine%2A?displayProperty=nameWithType> 提供与 <xref:System.String.Format%2A?displayProperty=nameWithType> 相同的功能。</span><span class="sxs-lookup"><span data-stu-id="43906-214"><xref:System.Console.WriteLine%2A?displayProperty=nameWithType> exposes the same functionality as <xref:System.String.Format%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="43906-215">这两种方法的唯一差异是 <xref:System.String.Format%2A?displayProperty=nameWithType> 将其结果作为字符串返回，而 <xref:System.Console.WriteLine%2A?displayProperty=nameWithType> 将结果写入与 <xref:System.Console> 对象关联的输出流中。</span><span class="sxs-lookup"><span data-stu-id="43906-215">The only difference between the two methods is that <xref:System.String.Format%2A?displayProperty=nameWithType> returns its result as a string, while <xref:System.Console.WriteLine%2A?displayProperty=nameWithType> writes the result to the output stream associated with the <xref:System.Console> object.</span></span> <span data-ttu-id="43906-216">下面的示例使用 <xref:System.Console.WriteLine%2A?displayProperty=nameWithType> 方法将 `MyInt` 的值的格式设置为货币值。</span><span class="sxs-lookup"><span data-stu-id="43906-216">The following example uses the <xref:System.Console.WriteLine%2A?displayProperty=nameWithType> method to format the value of `MyInt` to a currency value.</span></span>  
  
 [!code-csharp[Formatting.Composite#4](../../../samples/snippets/csharp/VS_Snippets_CLR/Formatting.Composite/cs/Composite1.cs#4)]
 [!code-vb[Formatting.Composite#4](../../../samples/snippets/visualbasic/VS_Snippets_CLR/Formatting.Composite/vb/Composite1.vb#4)]  
  
 <span data-ttu-id="43906-217">下面的示例说明为多个对象设置格式，包括用两种不同的方式为一个对象设置格式。</span><span class="sxs-lookup"><span data-stu-id="43906-217">The following example demonstrates formatting multiple objects, including formatting one object two different ways.</span></span>  
  
 [!code-csharp[Formatting.Composite#5](../../../samples/snippets/csharp/VS_Snippets_CLR/Formatting.Composite/cs/Composite1.cs#5)]
 [!code-vb[Formatting.Composite#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR/Formatting.Composite/vb/Composite1.vb#5)]  
  
 <span data-ttu-id="43906-218">下面的示例演示了对齐在格式设置中的使用方式。</span><span class="sxs-lookup"><span data-stu-id="43906-218">The following example demonstrates the use of alignment in formatting.</span></span> <span data-ttu-id="43906-219">设置了格式的参数放置在竖线字符 (|) 之间以突出显示得到的对齐。</span><span class="sxs-lookup"><span data-stu-id="43906-219">The arguments that are formatted are placed between vertical bar characters (&#124;) to highlight the resulting alignment.</span></span>  
  
 [!code-csharp[Formatting.Composite#6](../../../samples/snippets/csharp/VS_Snippets_CLR/Formatting.Composite/cs/Composite1.cs#6)]
 [!code-vb[Formatting.Composite#6](../../../samples/snippets/visualbasic/VS_Snippets_CLR/Formatting.Composite/vb/Composite1.vb#6)]  
  
## <a name="see-also"></a><span data-ttu-id="43906-220">请参阅</span><span class="sxs-lookup"><span data-stu-id="43906-220">See also</span></span>

- <xref:System.Console.WriteLine%2A>
- <xref:System.String.Format%2A?displayProperty=nameWithType>
- [<span data-ttu-id="43906-221">字符串内插 (C#)</span><span class="sxs-lookup"><span data-stu-id="43906-221">String interpolation (C#)</span></span>](../../csharp/language-reference/tokens/interpolated.md)
- [<span data-ttu-id="43906-222">字符串内插 (Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="43906-222">String interpolation (Visual Basic)</span></span>](../../visual-basic/programming-guide/language-features/strings/interpolated-strings.md)
- [<span data-ttu-id="43906-223">格式设置类型</span><span class="sxs-lookup"><span data-stu-id="43906-223">Formatting Types</span></span>](formatting-types.md)
- [<span data-ttu-id="43906-224">标准数字格式字符串</span><span class="sxs-lookup"><span data-stu-id="43906-224">Standard Numeric Format Strings</span></span>](standard-numeric-format-strings.md)
- [<span data-ttu-id="43906-225">自定义数字格式字符串</span><span class="sxs-lookup"><span data-stu-id="43906-225">Custom Numeric Format Strings</span></span>](custom-numeric-format-strings.md)
- [<span data-ttu-id="43906-226">标准日期和时间格式字符串</span><span class="sxs-lookup"><span data-stu-id="43906-226">Standard Date and Time Format Strings</span></span>](standard-date-and-time-format-strings.md)
- [<span data-ttu-id="43906-227">自定义日期和时间格式字符串</span><span class="sxs-lookup"><span data-stu-id="43906-227">Custom Date and Time Format Strings</span></span>](custom-date-and-time-format-strings.md)
- [<span data-ttu-id="43906-228">标准 TimeSpan 格式字符串</span><span class="sxs-lookup"><span data-stu-id="43906-228">Standard TimeSpan Format Strings</span></span>](standard-timespan-format-strings.md)
- [<span data-ttu-id="43906-229">自定义 TimeSpan 格式字符串</span><span class="sxs-lookup"><span data-stu-id="43906-229">Custom TimeSpan Format Strings</span></span>](custom-timespan-format-strings.md)
- [<span data-ttu-id="43906-230">枚举格式字符串</span><span class="sxs-lookup"><span data-stu-id="43906-230">Enumeration Format Strings</span></span>](enumeration-format-strings.md)
